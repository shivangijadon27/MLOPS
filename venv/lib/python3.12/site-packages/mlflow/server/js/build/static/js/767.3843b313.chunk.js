"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[767],{3409:function(e,n,t){t.d(n,{tz:function(){return h},h:function(){return U},iE:function(){return Y},nN:function(){return w},XQ:function(){return y},lh:function(){return M},Vn:function(){return H},OM:function(){return L},t4:function(){return C},dC:function(){return D},WW:function(){return O},Id:function(){return _},R3:function(){return A},zZ:function(){return E},IT:function(){return F},T4:function(){return N},gy:function(){return R}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(70431),d=t(80739);var c=t(91105),u=t(69983),p=t(60284),m=t(44105),g=t(15756),v=t(73408);const h=200,f=120,T=60;var k={name:"lugakg",styles:"font-weight:normal"};const y=({icon:e,title:n,value:t,subtitle:o})=>{const{theme:s}=(0,r.u)();return(0,v.FD)("div",{css:(0,i.AH)({marginBottom:s.spacing.lg},""),children:[(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,i.AH)({color:s.colors.textSecondary,display:"flex"},""),children:e}),(0,v.Y)(r.T.Text,{bold:!0,size:"lg",children:n})]}),void 0!==t&&(0,v.FD)(r.T.Title,{level:3,css:(0,i.AH)({margin:0,marginTop:s.spacing.sm},""),children:[t,o&&(0,v.FD)(v.FK,{children:[" ",(0,v.Y)(r.T.Text,{color:"secondary",css:k,children:o})]})]})]})},x=({children:e,height:n=280})=>{const{theme:t}=(0,r.u)();return(0,v.Y)("div",{css:(0,i.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.lg,height:n,display:"flex",alignItems:"center",justifyContent:"center"},""),children:e})};var S={name:"1u1zie3",styles:"width:120px"},b={name:"m0jwvv",styles:"width:80px"},I={name:"82a6rk",styles:"flex:1"};const M=({height:e=280})=>{const{theme:n}=(0,r.u)();return(0,v.FD)("div",{css:(0,i.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,padding:n.spacing.lg,height:e,display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,v.Y)(s.TitleSkeleton,{css:S}),(0,v.Y)(s.TitleSkeleton,{css:b}),(0,v.Y)("div",{css:I,children:(0,v.Y)(s.TableSkeleton,{lines:4})})]})},w=({height:e,message:n})=>(0,v.Y)(x,{height:e,children:(0,v.Y)(r.T.Text,{color:"error",children:n||(0,v.Y)(a.A,{id:"cp/h86",defaultMessage:"Failed to load chart data"})})}),Y=({height:e,message:n})=>(0,v.Y)("div",{css:(0,i.AH)({height:e||"100%",display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,v.Y)(r.T.Text,{color:"secondary",children:n||(0,v.Y)(a.A,{id:"zwktEP",defaultMessage:"No data available for the selected time range"})})});function A(e,n,t){const i=p.Ay.getExperimentPageTabRoute(e,m.fM.Traces),o=new URLSearchParams,{startTimeLabel:r,startTime:s,endTime:a}=null!==n&&void 0!==n?n:{};return r&&o.set("startTimeLabel",r),s&&o.set("startTime",s),a&&o.set("endTime",a),null===t||void 0===t||t.forEach(e=>o.append("filter",e)),`${i}?${o.toString()}`}function _(e,n,t,i){return A(e,{startTimeLabel:"CUSTOM",startTime:new Date(n).toISOString(),endTime:new Date(n+1e3*t).toISOString()},i)}function C(e){return[g.w8.ASSESSMENT,g.dD.IS_NOT_NULL,"",e].join("::")}function L(e,n){return[g.w8.ASSESSMENT,g.tl.EQUALS,n,e].join("::")}function D(e){return[g.Gq,g.tl.EQUALS,e].join("::")}function O(e){return[g.RC,g.tl.EQUALS,e].join("::")}function H({active:e,payload:n,label:t,formatter:s,linkConfig:l}){var d,p,m,g,h;const{theme:T}=(0,r.u)(),k=(0,c.Zp)(),{hideTooltipLinks:y,tooltipLinkUrlBuilder:x,tooltipLinkText:S}=null!==(d=(0,o.useContext)(u.J0))&&void 0!==d?d:{};if(!e||null===n||void 0===n||!n.length)return null;const b=null===(p=n[0])||void 0===p?void 0:p.payload,I=void 0!==(null===l||void 0===l?void 0:l.onLinkClick),M=(null===l||void 0===l?void 0:l.experimentId)&&(null===l||void 0===l?void 0:l.timeIntervalSeconds)&&void 0!==(null===b||void 0===b?void 0:b.timestampMs),w=!y&&l&&(I||M);return(0,v.FD)("div",{css:(0,i.AH)({backgroundColor:`${T.colors.backgroundPrimary}80`,backdropFilter:"blur(2px)",border:`1px solid ${T.colors.border}`,borderRadius:T.borders.borderRadiusMd,fontSize:T.typography.fontSizeSm,padding:T.spacing.sm,pointerEvents:"auto",marginLeft:-20,marginRight:-20},""),children:[t&&(0,v.Y)("div",{css:(0,i.AH)({fontWeight:500,marginBottom:T.spacing.xs},""),children:t}),(0,v.Y)("div",{css:(0,i.AH)({maxHeight:f,overflowY:"auto",overflowX:"hidden"},""),children:n.map((e,n)=>{const[t,o]=s(e.value,e.name);return(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:T.spacing.xs,paddingTop:T.spacing.xs,paddingBottom:T.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,i.AH)({width:T.spacing.sm,height:T.spacing.sm,borderRadius:"50%",backgroundColor:e.color,flexShrink:0},"")}),(0,v.FD)("span",{css:(0,i.AH)({color:e.color},""),children:[o,":"]}),(0,v.Y)("span",{children:t})]},n)})}),w&&(0,v.Y)("div",{css:(0,i.AH)({borderTop:`1px solid ${T.colors.border}`,marginTop:T.spacing.xs,paddingTop:T.spacing.xs},""),children:(0,v.Y)(r.T.Link,{componentId:null!==(m=null===l||void 0===l?void 0:l.componentId)&&void 0!==m?m:"mlflow.overview.usage.traces.view_traces_link",onClick:()=>{if(I)l.onLinkClick(t,b);else if(M){const e=x?x(l.experimentId,b.timestampMs,l.timeIntervalSeconds):_(l.experimentId,b.timestampMs,l.timeIntervalSeconds);k(e)}},css:(0,i.AH)({cursor:"pointer",display:"flex",alignItems:"center",gap:T.spacing.xs},""),children:null!==(g=null!==(h=null===l||void 0===l?void 0:l.linkText)&&void 0!==h?h:S)&&void 0!==g?g:(0,v.Y)(a.A,{id:"c+3yBY",defaultMessage:"View traces for this period"})})})]})}function E(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary,dy:e.spacing.sm},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}}function F(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary},axisLine:!1,tickLine:!1,width:40}}function R(e){var n;const{theme:t}=(0,r.u)();return{formatter:e=>(0,v.Y)("span",{css:(0,i.AH)({color:t.colors.textPrimary,fontSize:t.typography.fontSizeSm,cursor:"pointer"},""),children:e}),wrapperStyle:{maxHeight:null!==(n=null===e||void 0===e?void 0:e.maxHeight)&&void 0!==n?n:T,overflowY:"auto",overflowX:"hidden",paddingTop:t.spacing.xs}}}const U=({children:e,componentId:n,...t})=>{const{theme:s}=(0,r.u)(),a=function(e){const n=(0,o.useRef)((0,l.A)()),t=(0,o.useRef)(0),i=(0,d.R)();return{onClick:(0,o.useCallback)(()=>{if(!e)return;const o=Date.now();o-t.current<1e4||(t.current=o,i({componentId:e,componentViewId:n.current,componentType:r.f.Card,eventType:r.d.OnClick,value:"chart_interaction"}))},[e,i])}}(n);return(0,v.Y)("div",{css:(0,i.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusMd,padding:s.spacing.lg,backgroundColor:s.colors.backgroundPrimary},""),...a,...t,children:e})};function N(){const{theme:e}=(0,r.u)();return{strokeOpacity:.3,fill:e.colors.blue200,fillOpacity:.3}}},23327:function(e,n,t){t.d(n,{o:function(){return a}});var i=t(49708),o=t(61077),r=t(90935);const s="traceMetrics";function a({experimentIds:e,startTimeMs:n,endTimeMs:t,viewType:a,metricName:l,aggregations:d,timeIntervalSeconds:c,filters:u,dimensions:p,enabled:m=!0}){const g={experiment_ids:e,view_type:a,metric_name:l,aggregations:d,time_interval_seconds:c,start_time_ms:n,end_time_ms:t,filters:u,dimensions:p};return(0,i.I)({queryKey:[s,e,n,t,a,l,d,c,u,p],queryFn:async()=>await async function(e){return(0,o.qP)((0,o.we)("ajax-api/3.0/mlflow/traces/metrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).catch(r.J)}(g),enabled:e.length>0&&m,refetchOnWindowFocus:!1})}},90767:function(e,n,t){t.d(n,{TraceTokenUsageChart:function(){return b}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(66774),d=t(90970),c=t(56809),u=t(60719),p=t(49960),m=t(44941),g=(0,d.gu)({chartName:"AreaChart",GraphicalChild:c.G,axisComponents:[{axisType:"xAxis",AxisComp:u.W},{axisType:"yAxis",AxisComp:p.h}],formatAxisMap:m.pr}),v=t(858),h=t(6581),f=t(16844),T=t(23327),k=t(83110),y=t(69983);var x=t(3409),S=t(73408);const b=()=>{const{theme:e}=(0,r.u)(),n=(0,x.zZ)(),t=(0,x.IT)(),d=(0,x.gy)(),{getOpacity:m,handleLegendMouseEnter:b,handleLegendMouseLeave:I}=(0,k.pH)(.8,.2),{experimentIds:M,timeIntervalSeconds:w}=(0,y.W0)(),{chartData:Y,totalTokens:A,totalInputTokens:_,totalOutputTokens:C,isLoading:L,error:D,hasData:O}=function(){var e,n,t;const{experimentIds:i,startTimeMs:r,endTimeMs:s,timeIntervalSeconds:a,timeBuckets:l,filters:d}=(0,y.W0)(),{data:c,isLoading:u,error:p}=(0,T.o)({experimentIds:i,startTimeMs:r,endTimeMs:s,viewType:f.mW.TRACES,metricName:f.po.INPUT_TOKENS,aggregations:[{aggregation_type:f.DF.SUM}],timeIntervalSeconds:a,filters:d}),{data:m,isLoading:g,error:v}=(0,T.o)({experimentIds:i,startTimeMs:r,endTimeMs:s,viewType:f.mW.TRACES,metricName:f.po.OUTPUT_TOKENS,aggregations:[{aggregation_type:f.DF.SUM}],timeIntervalSeconds:a,filters:d}),{data:h,isLoading:x,error:S}=(0,T.o)({experimentIds:i,startTimeMs:r,endTimeMs:s,viewType:f.mW.TRACES,metricName:f.po.TOTAL_TOKENS,aggregations:[{aggregation_type:f.DF.SUM}],filters:d}),b=(0,o.useMemo)(()=>(null===c||void 0===c?void 0:c.data_points)||[],[null===c||void 0===c?void 0:c.data_points]),I=(0,o.useMemo)(()=>(null===m||void 0===m?void 0:m.data_points)||[],[null===m||void 0===m?void 0:m.data_points]),M=u||g||x,w=p||v||S,Y=(null===h||void 0===h||null===(e=h.data_points)||void 0===e||null===(n=e[0])||void 0===n||null===(t=n.values)||void 0===t?void 0:t[f.DF.SUM])||0,A=(0,o.useMemo)(()=>b.reduce((e,n)=>{var t;return e+((null===(t=n.values)||void 0===t?void 0:t[f.DF.SUM])||0)},0),[b]),_=(0,o.useMemo)(()=>I.reduce((e,n)=>{var t;return e+((null===(t=n.values)||void 0===t?void 0:t[f.DF.SUM])||0)},0),[I]),C=(0,o.useCallback)(e=>{var n;return(null===(n=e.values)||void 0===n?void 0:n[f.DF.SUM])||0},[]),L=(0,k.NM)(b,C),D=(0,k.NM)(I,C);return{chartData:(0,o.useMemo)(()=>l.map(e=>({name:(0,k.fq)(e,a),inputTokens:L.get(e)||0,outputTokens:D.get(e)||0,timestampMs:e})),[l,L,D,a]),totalTokens:Y,totalInputTokens:A,totalOutputTokens:_,isLoading:M,error:w,hasData:b.length>0||I.length>0}}(),H=(0,o.useCallback)((e,n)=>[(0,k.B4)(e),n],[]),E={inputTokens:e.colors.blue400,outputTokens:e.colors.green400};return L?(0,S.Y)(x.lh,{}):D?(0,S.Y)(x.nN,{}):(0,S.FD)(x.h,{componentId:"mlflow.charts.trace_token_usage",children:[(0,S.Y)(x.XQ,{icon:(0,S.Y)(s.LightningIcon,{}),title:(0,S.Y)(a.A,{id:"TLHzWu",defaultMessage:"Token Usage"}),value:(0,k.B4)(A),subtitle:`(${(0,k.B4)(_)} input, ${(0,k.B4)(C)} output)`}),(0,S.Y)("div",{css:(0,i.AH)({height:x.tz,marginTop:e.spacing.sm},""),children:O?(0,S.Y)(l.u,{width:"100%",height:"100%",children:(0,S.FD)(g,{data:Y,margin:{top:10,right:30,left:10,bottom:0},children:[(0,S.Y)(u.W,{dataKey:"name",...n}),(0,S.Y)(p.h,{...t}),(0,S.Y)(v.m,{content:(0,S.Y)(x.Vn,{formatter:H,linkConfig:{experimentId:M[0],timeIntervalSeconds:w,componentId:"mlflow.overview.usage.token_usage.view_traces_link"}}),cursor:{fill:e.colors.actionTertiaryBackgroundHover}}),(0,S.Y)(c.G,{type:"monotone",dataKey:"inputTokens",stackId:"1",stroke:E.inputTokens,fill:E.inputTokens,strokeOpacity:m("Input Tokens"),fillOpacity:m("Input Tokens"),strokeWidth:2,dot:(0,k.vx)(E.inputTokens),name:"Input Tokens"}),(0,S.Y)(c.G,{type:"monotone",dataKey:"outputTokens",stackId:"1",stroke:E.outputTokens,fill:E.outputTokens,strokeOpacity:m("Output Tokens"),fillOpacity:m("Output Tokens"),strokeWidth:2,dot:(0,k.vx)(E.outputTokens),name:"Output Tokens"}),(0,S.Y)(h.s,{verticalAlign:"bottom",iconType:"plainline",onMouseEnter:b,onMouseLeave:I,...d})]})}):(0,S.Y)(x.iE,{})})]})}},90935:function(e,n,t){t.d(n,{J:function(){return o}});var i=t(36476);async function o(e){if(e instanceof i.Un){var n;const t=await(null===(n=e.response)||void 0===n?void 0:n.json());e.message=null===t||void 0===t?void 0:t.message}throw e}}}]);