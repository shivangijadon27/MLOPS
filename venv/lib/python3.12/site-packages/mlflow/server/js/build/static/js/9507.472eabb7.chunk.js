"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[9507],{14429:function(e,t,i){i.d(t,{KT:function(){return m},Pz:function(){return u},UY:function(){return g},VA:function(){return c},oy:function(){return d}});var a=i(46709),n=i(91105),l=i(79444);const s="startTimeLabel",r="startTime",o="endTime",d="LAST_7_DAYS",m=(0,a.createContext)(null),c=()=>{const e=(0,l.U)(),t=(0,a.useContext)(m),[i,c]=(0,n.ok)();let u,T,p;var f;t?(u=t.params.startTimeLabel||d,T=t.params.startTime,p=t.params.endTime):(u=i.get(s)||d,T=i.get(r)||void 0,p=null!==(f=i.get(o))&&void 0!==f?f:void 0);if("CUSTOM"!==u){const t=g(e.dateNow,{startTimeLabel:u});T=t.startTime,p=t.endTime}const v=(0,a.useMemo)(()=>({startTimeLabel:u,startTime:T,endTime:p}),[u,T,p]),h=(0,a.useCallback)((e,i=!1)=>{t?t.setParams(null!==e&&void 0!==e?e:{startTimeLabel:void 0,startTime:void 0,endTime:void 0},i):c(t=>(void 0===(null===e||void 0===e?void 0:e.startTime)?t.delete(r):"CUSTOM"===e.startTimeLabel&&t.set(r,e.startTime),void 0===(null===e||void 0===e?void 0:e.endTime)?t.delete(o):"CUSTOM"===e.startTimeLabel&&t.set(o,e.endTime),void 0===(null===e||void 0===e?void 0:e.startTimeLabel)?t.delete(s):t.set(s,e.startTimeLabel),t),{replace:i})},[t,c]);return[v,h,Boolean(i.has(s)||(null===t||void 0===t?void 0:t.disableAutomaticInitialization))]},u=()=>{const[e]=c();return(0,a.useMemo)(()=>{const{startTime:t,endTime:i}=e;return{startTime:t?new Date(t).getTime().toString():void 0,endTime:i?new Date(i).getTime().toString():void 0}},[e])};function g(e,t){return t.startTimeLabel&&"CUSTOM"!==t.startTimeLabel?function(e,t){switch(t){case"LAST_HOUR":return{startTime:new Date(new Date(e).setUTCHours((new Date).getUTCHours()-1)).toISOString(),endTime:e.toISOString()};case"LAST_24_HOURS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-1)).toISOString(),endTime:e.toISOString()};case"LAST_7_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-7)).toISOString(),endTime:e.toISOString()};case"LAST_30_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-30)).toISOString(),endTime:e.toISOString()};case"LAST_YEAR":return{startTime:new Date(new Date(e).setUTCFullYear((new Date).getUTCFullYear()-1)).toISOString(),endTime:e.toISOString()};case"ALL":return{startTime:void 0,endTime:e.toISOString()};default:throw new Error(`Unexpected start time label: ${t}`)}}(e,t.startTimeLabel):{startTime:t.startTime,endTime:t.endTime}}},62593:function(e,t,i){i.d(t,{Y:function(){return A}});var a=i(68248),n=i(46709),l=i(27757),s=i(40724),r=i(79444),o=i(14429),d=i(84411),m=i(25889),c=i(34421),u=i(36120),g=i(48123),T=i(40263),p=i(26415),f=i(94473),v=i(82719),h=i(69983),S=i(4286),w=i(93281),D=i(83110),Y=i(73408);const y=({experimentIds:e,showTokenStats:t=!1,additionalControls:i,hideTooltipLinks:r=!1,tooltipLinkUrlBuilder:y,tooltipLinkText:A,filters:L})=>{const{theme:b}=(0,l.u)(),[x,M]=(0,n.useState)(null),[C]=(0,o.VA)(),k=C.startTime?new Date(C.startTime).getTime():void 0,I=C.endTime?new Date(C.endTime).getTime():void 0,O=(0,w.N3)(k,I),U=null!==x&&void 0!==x?x:O,_=w.ZG[U],F=(0,n.useMemo)(()=>(0,D.yB)(k,I,_),[k,I,_]);return(0,Y.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"column",gap:b.spacing.md},""),children:[(0,Y.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:b.spacing.sm,flexWrap:"wrap"},""),children:[i,(0,Y.Y)(S.l,{value:U,onChange:M,startTimeMs:k,endTimeMs:I,allowClear:null!==x&&x!==O,onClear:()=>M(null)}),(0,Y.Y)(d.$,{excludeOptions:["ALL"]})]}),(0,Y.Y)(h.F7,{experimentIds:e,startTimeMs:k,endTimeMs:I,timeIntervalSeconds:_,timeBuckets:F,hideTooltipLinks:r,tooltipLinkUrlBuilder:y,tooltipLinkText:A,filters:L,children:(0,Y.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"column",gap:b.spacing.md},""),children:[(0,Y.Y)(m.a,{title:(0,Y.Y)(s.A,{id:"6ejdmD",defaultMessage:"Requests"})}),(0,Y.FD)(v.vK,{children:[(0,Y.Y)(c.K,{}),(0,Y.Y)(u.L,{})]}),t?(0,Y.FD)(v.vK,{children:[(0,Y.Y)(g.o,{}),(0,Y.Y)(T.A,{title:(0,Y.Y)(s.A,{id:"WHwU2F",defaultMessage:"Tokens per Request"}),subtitle:(0,Y.Y)(s.A,{id:"A+GxQM",defaultMessage:"avg per request"})})]}):(0,Y.Y)(g.o,{}),(0,Y.FD)(v.vK,{children:[(0,Y.Y)(p.q,{}),(0,Y.Y)(f.m,{})]})]})})]})},A=e=>(0,Y.Y)(r.k,{children:(0,Y.Y)(y,{...e})})},69507:function(e,t,i){i.r(t),i.d(t,{GatewayUsagePage:function(){return S},default:function(){return w}});var a=i(68248),n=i(46709),l=i(91105),s=i(27757),r=i(82716),o=i(40724),d=i(16844),m=i(30431),c=i(49708),u=i(25117);var g=i(62593),T=i(29447),p=i(73408);var f={name:"16gsvie",styles:"min-width:200px"},v={name:"p4355k",styles:"min-width:180px"},h={name:"ti75j2",styles:"margin:0"};const S=()=>{const{theme:e}=(0,s.u)(),[t,i]=(0,n.useState)(null),[S,w]=(0,n.useState)(null),{data:D,isLoading:Y}=(0,m.c)(),{data:y,isLoading:A,error:L}=(()=>{var e,t,i;const a=(0,c.I)(["auth_users"],{queryFn:u.t.listUsers,retry:!1,refetchOnWindowFocus:!1});return{data:null!==(e=null===(t=a.data)||void 0===t?void 0:t.users)&&void 0!==e?e:[],error:null!==(i=a.error)&&void 0!==i?i:void 0,isLoading:a.isLoading}})(),b=(0,n.useMemo)(()=>D.filter(e=>e.usage_tracking&&e.experiment_id),[D]),x=(0,n.useMemo)(()=>{var e;return t&&"all"!==t&&null!==(e=b.find(e=>e.endpoint_id===t))&&void 0!==e?e:null},[t,b]),M=!t||"all"===t,C=(0,n.useMemo)(()=>M?b.map(e=>e.experiment_id).filter(Boolean):null!==x&&void 0!==x&&x.experiment_id?[x.experiment_id]:[],[M,b,x]),k=(0,n.useMemo)(()=>{if(x)return(e,t,i)=>T.Ay.getEndpointDetailsRoute(x.endpoint_id,{tab:"traces",startTime:new Date(t).toISOString(),endTime:new Date(t+1e3*i).toISOString()})},[x]),I=(0,n.useMemo)(()=>{if(S)return[(0,d.Fu)(d.d7,S)]},[S]);if(!Y&&0===b.length)return(0,p.Y)("div",{css:(0,a.AH)({flex:1,overflow:"auto",padding:e.spacing.md},""),children:(0,p.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:300,textAlign:"center",padding:e.spacing.lg},""),children:[(0,p.Y)(r.ChartLineIcon,{css:(0,a.AH)({fontSize:48,color:e.colors.textSecondary,marginBottom:e.spacing.md},"")}),(0,p.Y)(s.T.Title,{level:3,children:(0,p.Y)(o.A,{id:"CO81il",defaultMessage:"No usage data available"})}),(0,p.Y)(s.T.Text,{color:"secondary",css:(0,a.AH)({marginBottom:e.spacing.md},""),children:(0,p.Y)(o.A,{id:"WGU215",defaultMessage:"Enable usage tracking on your endpoints to see usage metrics here."})}),(0,p.Y)(l.N_,{to:T.Ay.gatewayPageRoute,children:(0,p.Y)(o.A,{id:"zcuHsG",defaultMessage:"Go to Endpoints"})})]})});const O=(0,p.FD)(p.FK,{children:[(0,p.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:e.spacing.xs},""),children:[(0,p.Y)(s.T.Text,{color:"secondary",children:(0,p.Y)(o.A,{id:"KcGozs",defaultMessage:"Endpoint:"})}),(0,p.FD)(r.SimpleSelect,{id:"gateway-usage-endpoint-selector",componentId:"mlflow.gateway.usage.endpoint-selector",value:null!==t&&void 0!==t?t:"all",onChange:({target:e})=>i("all"===e.value?null:e.value),css:f,disabled:Y,children:[(0,p.Y)(r.SimpleSelectOption,{value:"all",children:(0,p.Y)(o.A,{id:"9G21RV",defaultMessage:"All endpoints"})}),b.map(e=>(0,p.Y)(r.SimpleSelectOption,{value:e.endpoint_id,children:e.name},e.endpoint_id))]}),Y&&(0,p.Y)(s.S,{size:"small"})]}),!L&&(0,p.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:e.spacing.xs},""),children:[(0,p.Y)(s.T.Text,{color:"secondary",children:(0,p.Y)(o.A,{id:"hX4/P0",defaultMessage:"User:"})}),(0,p.FD)(r.SimpleSelect,{id:"gateway-usage-user-selector",componentId:"mlflow.gateway.usage.user-selector",value:null!==S&&void 0!==S?S:"all",onChange:({target:e})=>w("all"===e.value?null:e.value),css:v,disabled:A||0===y.length,children:[(0,p.Y)(r.SimpleSelectOption,{value:"all",children:(0,p.Y)(o.A,{id:"s2G/vI",defaultMessage:"All users"})}),y.map(e=>(0,p.Y)(r.SimpleSelectOption,{value:String(e.id),children:e.username},e.id))]}),A&&(0,p.Y)(s.S,{size:"small"})]})]});return(0,p.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"column",flex:1,overflow:"auto",padding:e.spacing.md},""),children:[(0,p.Y)("div",{css:(0,a.AH)({display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:e.spacing.sm},""),children:(0,p.FD)("div",{children:[(0,p.Y)(s.T.Title,{level:2,css:h,children:(0,p.Y)(o.A,{id:"TYidgr",defaultMessage:"Gateway Usage"})}),(0,p.Y)(s.T.Text,{color:"secondary",children:(0,p.Y)(o.A,{id:"aRjFm8",defaultMessage:"Monitor usage and performance across all endpoints"})})]})}),Y||C.length>0?(0,p.Y)(g.Y,{experimentIds:C,showTokenStats:!0,additionalControls:O,hideTooltipLinks:M,tooltipLinkUrlBuilder:k,tooltipLinkText:(0,p.Y)(o.A,{id:"V+4GZQ",defaultMessage:"View logs for this period"}),filters:I}):(0,p.Y)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",justifyContent:"center",minHeight:200,color:e.colors.textSecondary},""),children:(0,p.Y)(s.T.Text,{children:(0,p.Y)(o.A,{id:"5T4wqF",defaultMessage:"Select an endpoint to view usage metrics"})})})]})};var w=S},79444:function(e,t,i){i.d(t,{U:function(){return d},k:function(){return o}});var a=i(76118),n=i(46709),l=i(73408);const s=()=>({dateNow:new Date,lastRefreshTime:Date.now(),refresh:()=>{}}),r=(0,n.createContext)(s()),o=({config:e,children:t})=>{const i=s(),o=(0,a.merge)({},i,e),[d,m]=n.useState(o.lastRefreshTime),c=(0,n.useMemo)(()=>new Date(d),[d]),u=(0,n.useCallback)(()=>{m(Date.now())},[]);return(0,l.Y)(r.Provider,{value:{...o,dateNow:c,lastRefreshTime:d,refresh:u},children:t})},d=()=>{const e=(0,n.useContext)(r);return e||s()}},84411:function(e,t,i){i.d(t,{$:function(){return h}});var a=i(68248),n=i(46709),l=i(82716),s=i(27757),r=i(79081),o=i(15756),d=i(42747),m=i(92338),c=i(14429),u=i(76118),g=i(16453),T=i(79444),p=i(39595),f=i(92388),v=i(73408);const h=n.memo(function({excludeOptions:e,refreshButtonComponentId:t="mlflow.experiment-evaluation-monitoring.refresh-date-button"}){const i=(0,d.tz)(),{theme:h}=(0,s.u)(),S=((0,p.jE)(),(0,f.C)({queryKey:[o.TH]})),[w,D]=(0,c.VA)(),Y=(0,n.useMemo)(()=>{const t=(0,m.p)(i);return null!==e&&void 0!==e&&e.length?t.filter(t=>!e.includes(t.key)):t},[i,e]),y=i.formatMessage({id:"BJvcsS",defaultMessage:"Time Range"}),A=(0,T.U)();return(0,v.FD)("div",{css:(0,a.AH)({display:"flex",gap:h.spacing.sm,alignItems:"center"},""),children:[(0,v.FD)(l.DialogCombobox,{componentId:"mlflow.experiment-evaluation-monitoring.date-selector",label:y,value:w.startTimeLabel?[w.startTimeLabel]:[c.oy],children:[(0,v.Y)(l.DialogComboboxTrigger,{renderDisplayedValue:e=>{var t;return null===(t=Y.find(t=>t.key===e))||void 0===t?void 0:t.label},allowClear:!(0,u.isNil)(w.startTimeLabel)&&w.startTimeLabel!==c.oy,onClear:()=>{D({startTimeLabel:c.oy})},"data-testid":"time-range-select-dropdown"}),(0,v.Y)(l.DialogComboboxContent,{children:(0,v.Y)(l.DialogComboboxOptionList,{children:Y.map(e=>(0,v.Y)(l.DialogComboboxOptionListSelectItem,{checked:w.startTimeLabel===e.key||e.key===c.oy&&(0,u.isNil)(w.startTimeLabel),title:e.label,"data-testid":`time-range-select-${e}`,value:e.key,onChange:()=>{D({...w,startTimeLabel:e.key})},children:e.label},e.key))})})]}),"CUSTOM"===w.startTimeLabel&&(0,v.Y)(v.FK,{children:(0,v.Y)(g.cv,{id:"date-picker-range",includeTime:!0,selected:{from:new Date(w.startTime),to:w.endTime?new Date(w.endTime):A.dateNow},onChange:e=>{const t=e.target.value;D({...w,startTime:null!==t&&void 0!==t&&t.from?t.from.toISOString():void 0,endTime:null!==t&&void 0!==t&&t.to?t.to.toISOString():void 0})},startDatePickerProps:{componentId:"experiment-evaluation-monitoring-start-date-picker",datePickerProps:{disabled:{after:A.dateNow}},value:w.startTime?new Date(w.startTime):void 0},endDatePickerProps:{componentId:"experiment-evaluation-monitoring-end-date-picker",datePickerProps:{disabled:{after:A.dateNow}},value:w.endTime?new Date(w.endTime):void 0}})}),(0,v.Y)(r.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:i.formatMessage({id:"Arvaod",defaultMessage:"Showing data up to {date}."},{date:A.dateNow.toLocaleString(navigator.language,{timeZoneName:"short"})}),children:(0,v.Y)(s.B,{type:"link",componentId:t,disabled:Boolean(S),onClick:()=>{A.refresh()},children:(0,v.Y)(l.RefreshIcon,{})})})]})})},92338:function(e,t,i){function a(e){return[{key:"LAST_HOUR",label:e.formatMessage({id:"bjoGjg",defaultMessage:"Last hour"})},{key:"LAST_24_HOURS",label:e.formatMessage({id:"JChRnq",defaultMessage:"Last 24 hours"})},{key:"LAST_7_DAYS",label:e.formatMessage({id:"eQsXm7",defaultMessage:"Last 7 days"})},{key:"LAST_30_DAYS",label:e.formatMessage({id:"p1H1KR",defaultMessage:"Last 30 days"})},{key:"LAST_YEAR",label:e.formatMessage({id:"EI7moF",defaultMessage:"Last year"})},{key:"ALL",label:e.formatMessage({id:"HeNa8H",defaultMessage:"All"})},{key:"CUSTOM",label:e.formatMessage({id:"TpmJlu",defaultMessage:"Custom"})}]}i.d(t,{p:function(){return a}})}}]);