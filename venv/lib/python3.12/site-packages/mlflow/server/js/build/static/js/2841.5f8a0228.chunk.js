"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[2841],{3409:function(e,n,t){t.d(n,{tz:function(){return h},h:function(){return O},iE:function(){return I},nN:function(){return A},XQ:function(){return x},lh:function(){return Y},Vn:function(){return H},OM:function(){return L},t4:function(){return _},dC:function(){return E},WW:function(){return D},Id:function(){return C},R3:function(){return M},zZ:function(){return R},IT:function(){return N},T4:function(){return z},gy:function(){return F}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(70431),d=t(80739);var c=t(91105),u=t(69983),p=t(60284),m=t(44105),g=t(15756),v=t(73408);const h=200,f=120,T=60;var y={name:"lugakg",styles:"font-weight:normal"};const x=({icon:e,title:n,value:t,subtitle:o})=>{const{theme:s}=(0,r.u)();return(0,v.FD)("div",{css:(0,i.AH)({marginBottom:s.spacing.lg},""),children:[(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,i.AH)({color:s.colors.textSecondary,display:"flex"},""),children:e}),(0,v.Y)(r.T.Text,{bold:!0,size:"lg",children:n})]}),void 0!==t&&(0,v.FD)(r.T.Title,{level:3,css:(0,i.AH)({margin:0,marginTop:s.spacing.sm},""),children:[t,o&&(0,v.FD)(v.FK,{children:[" ",(0,v.Y)(r.T.Text,{color:"secondary",css:y,children:o})]})]})]})},k=({children:e,height:n=280})=>{const{theme:t}=(0,r.u)();return(0,v.Y)("div",{css:(0,i.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.lg,height:n,display:"flex",alignItems:"center",justifyContent:"center"},""),children:e})};var b={name:"1u1zie3",styles:"width:120px"},S={name:"m0jwvv",styles:"width:80px"},w={name:"82a6rk",styles:"flex:1"};const Y=({height:e=280})=>{const{theme:n}=(0,r.u)();return(0,v.FD)("div",{css:(0,i.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,padding:n.spacing.lg,height:e,display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,v.Y)(s.TitleSkeleton,{css:b}),(0,v.Y)(s.TitleSkeleton,{css:S}),(0,v.Y)("div",{css:w,children:(0,v.Y)(s.TableSkeleton,{lines:4})})]})},A=({height:e,message:n})=>(0,v.Y)(k,{height:e,children:(0,v.Y)(r.T.Text,{color:"error",children:n||(0,v.Y)(a.A,{id:"cp/h86",defaultMessage:"Failed to load chart data"})})}),I=({height:e,message:n})=>(0,v.Y)("div",{css:(0,i.AH)({height:e||"100%",display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,v.Y)(r.T.Text,{color:"secondary",children:n||(0,v.Y)(a.A,{id:"zwktEP",defaultMessage:"No data available for the selected time range"})})});function M(e,n,t){const i=p.Ay.getExperimentPageTabRoute(e,m.fM.Traces),o=new URLSearchParams,{startTimeLabel:r,startTime:s,endTime:a}=null!==n&&void 0!==n?n:{};return r&&o.set("startTimeLabel",r),s&&o.set("startTime",s),a&&o.set("endTime",a),null===t||void 0===t||t.forEach(e=>o.append("filter",e)),`${i}?${o.toString()}`}function C(e,n,t,i){return M(e,{startTimeLabel:"CUSTOM",startTime:new Date(n).toISOString(),endTime:new Date(n+1e3*t).toISOString()},i)}function _(e){return[g.w8.ASSESSMENT,g.dD.IS_NOT_NULL,"",e].join("::")}function L(e,n){return[g.w8.ASSESSMENT,g.tl.EQUALS,n,e].join("::")}function E(e){return[g.Gq,g.tl.EQUALS,e].join("::")}function D(e){return[g.RC,g.tl.EQUALS,e].join("::")}function H({active:e,payload:n,label:t,formatter:s,linkConfig:l}){var d,p,m,g,h;const{theme:T}=(0,r.u)(),y=(0,c.Zp)(),{hideTooltipLinks:x,tooltipLinkUrlBuilder:k,tooltipLinkText:b}=null!==(d=(0,o.useContext)(u.J0))&&void 0!==d?d:{};if(!e||null===n||void 0===n||!n.length)return null;const S=null===(p=n[0])||void 0===p?void 0:p.payload,w=void 0!==(null===l||void 0===l?void 0:l.onLinkClick),Y=(null===l||void 0===l?void 0:l.experimentId)&&(null===l||void 0===l?void 0:l.timeIntervalSeconds)&&void 0!==(null===S||void 0===S?void 0:S.timestampMs),A=!x&&l&&(w||Y);return(0,v.FD)("div",{css:(0,i.AH)({backgroundColor:`${T.colors.backgroundPrimary}80`,backdropFilter:"blur(2px)",border:`1px solid ${T.colors.border}`,borderRadius:T.borders.borderRadiusMd,fontSize:T.typography.fontSizeSm,padding:T.spacing.sm,pointerEvents:"auto",marginLeft:-20,marginRight:-20},""),children:[t&&(0,v.Y)("div",{css:(0,i.AH)({fontWeight:500,marginBottom:T.spacing.xs},""),children:t}),(0,v.Y)("div",{css:(0,i.AH)({maxHeight:f,overflowY:"auto",overflowX:"hidden"},""),children:n.map((e,n)=>{const[t,o]=s(e.value,e.name);return(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:T.spacing.xs,paddingTop:T.spacing.xs,paddingBottom:T.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,i.AH)({width:T.spacing.sm,height:T.spacing.sm,borderRadius:"50%",backgroundColor:e.color,flexShrink:0},"")}),(0,v.FD)("span",{css:(0,i.AH)({color:e.color},""),children:[o,":"]}),(0,v.Y)("span",{children:t})]},n)})}),A&&(0,v.Y)("div",{css:(0,i.AH)({borderTop:`1px solid ${T.colors.border}`,marginTop:T.spacing.xs,paddingTop:T.spacing.xs},""),children:(0,v.Y)(r.T.Link,{componentId:null!==(m=null===l||void 0===l?void 0:l.componentId)&&void 0!==m?m:"mlflow.overview.usage.traces.view_traces_link",onClick:()=>{if(w)l.onLinkClick(t,S);else if(Y){const e=k?k(l.experimentId,S.timestampMs,l.timeIntervalSeconds):C(l.experimentId,S.timestampMs,l.timeIntervalSeconds);y(e)}},css:(0,i.AH)({cursor:"pointer",display:"flex",alignItems:"center",gap:T.spacing.xs},""),children:null!==(g=null!==(h=null===l||void 0===l?void 0:l.linkText)&&void 0!==h?h:b)&&void 0!==g?g:(0,v.Y)(a.A,{id:"c+3yBY",defaultMessage:"View traces for this period"})})})]})}function R(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary,dy:e.spacing.sm},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}}function N(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary},axisLine:!1,tickLine:!1,width:40}}function F(e){var n;const{theme:t}=(0,r.u)();return{formatter:e=>(0,v.Y)("span",{css:(0,i.AH)({color:t.colors.textPrimary,fontSize:t.typography.fontSizeSm,cursor:"pointer"},""),children:e}),wrapperStyle:{maxHeight:null!==(n=null===e||void 0===e?void 0:e.maxHeight)&&void 0!==n?n:T,overflowY:"auto",overflowX:"hidden",paddingTop:t.spacing.xs}}}const O=({children:e,componentId:n,...t})=>{const{theme:s}=(0,r.u)(),a=function(e){const n=(0,o.useRef)((0,l.A)()),t=(0,o.useRef)(0),i=(0,d.R)();return{onClick:(0,o.useCallback)(()=>{if(!e)return;const o=Date.now();o-t.current<1e4||(t.current=o,i({componentId:e,componentViewId:n.current,componentType:r.f.Card,eventType:r.d.OnClick,value:"chart_interaction"}))},[e,i])}}(n);return(0,v.Y)("div",{css:(0,i.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusMd,padding:s.spacing.lg,backgroundColor:s.colors.backgroundPrimary},""),...a,...t,children:e})};function z(){const{theme:e}=(0,r.u)();return{strokeOpacity:.3,fill:e.colors.blue200,fillOpacity:.3}}},23327:function(e,n,t){t.d(n,{o:function(){return a}});var i=t(49708),o=t(61077),r=t(90935);const s="traceMetrics";function a({experimentIds:e,startTimeMs:n,endTimeMs:t,viewType:a,metricName:l,aggregations:d,timeIntervalSeconds:c,filters:u,dimensions:p,enabled:m=!0}){const g={experiment_ids:e,view_type:a,metric_name:l,aggregations:d,time_interval_seconds:c,start_time_ms:n,end_time_ms:t,filters:u,dimensions:p};return(0,i.I)({queryKey:[s,e,n,t,a,l,d,c,u,p],queryFn:async()=>await async function(e){return(0,o.qP)((0,o.we)("ajax-api/3.0/mlflow/traces/metrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).catch(r.J)}(g),enabled:e.length>0&&m,refetchOnWindowFocus:!1})}},30618:function(e,n,t){t.d(n,{b:function(){return l}});var i=t(90970),o=t(15714),r=t(60719),s=t(49960),a=t(44941),l=(0,i.gu)({chartName:"LineChart",GraphicalChild:o.N,axisComponents:[{axisType:"xAxis",AxisComp:r.W},{axisType:"yAxis",AxisComp:s.h}],formatAxisMap:a.pr})},90935:function(e,n,t){t.d(n,{J:function(){return o}});var i=t(36476);async function o(e){if(e instanceof i.Un){var n;const t=await(null===(n=e.response)||void 0===n?void 0:n.json());e.message=null===t||void 0===t?void 0:t.message}throw e}},92841:function(e,n,t){t.d(n,{TraceTokenStatsChart:function(){return b}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(66774),d=t(30618),c=t(60719),u=t(49960),p=t(858),m=t(15714),g=t(97245),v=t(6581),h=t(16844),f=t(23327),T=t(83110),y=t(69983);var x=t(3409),k=t(73408);const b=({title:e,subtitle:n})=>{const{theme:t}=(0,r.u)(),b=(0,x.zZ)(),S=(0,x.IT)(),w=(0,x.gy)(),{getOpacity:Y,handleLegendMouseEnter:A,handleLegendMouseLeave:I}=(0,T.pH)(),{experimentIds:M,timeIntervalSeconds:C}=(0,y.W0)(),{chartData:_,avgTokens:L,isLoading:E,error:D,hasData:H}=function(){var e,n,t;const{experimentIds:i,startTimeMs:r,endTimeMs:s,timeIntervalSeconds:a,timeBuckets:l,filters:d}=(0,y.W0)(),{data:c,isLoading:u,error:p}=(0,f.o)({experimentIds:i,startTimeMs:r,endTimeMs:s,viewType:h.mW.TRACES,metricName:h.po.TOTAL_TOKENS,aggregations:[{aggregation_type:h.DF.PERCENTILE,percentile_value:h.a9},{aggregation_type:h.DF.PERCENTILE,percentile_value:h.CX},{aggregation_type:h.DF.PERCENTILE,percentile_value:h.Jq}],timeIntervalSeconds:a,filters:d}),{data:m,isLoading:g,error:v}=(0,f.o)({experimentIds:i,startTimeMs:r,endTimeMs:s,viewType:h.mW.TRACES,metricName:h.po.TOTAL_TOKENS,aggregations:[{aggregation_type:h.DF.AVG}],filters:d}),x=(0,o.useMemo)(()=>(null===c||void 0===c?void 0:c.data_points)||[],[null===c||void 0===c?void 0:c.data_points]),k=u||g,b=p||v,S=null===m||void 0===m||null===(e=m.data_points)||void 0===e||null===(n=e[0])||void 0===n||null===(t=n.values)||void 0===t?void 0:t[h.DF.AVG],w=(0,o.useCallback)(e=>{var n,t,i;return{p50:(null===(n=e.values)||void 0===n?void 0:n[(0,h.re)(h.a9)])||0,p90:(null===(t=e.values)||void 0===t?void 0:t[(0,h.re)(h.CX)])||0,p99:(null===(i=e.values)||void 0===i?void 0:i[(0,h.re)(h.Jq)])||0}},[]),Y=(0,T.NM)(x,w);return{chartData:(0,o.useMemo)(()=>l.map(e=>{const n=Y.get(e);return{name:(0,T.fq)(e,a),p50:(null===n||void 0===n?void 0:n.p50)||0,p90:(null===n||void 0===n?void 0:n.p90)||0,p99:(null===n||void 0===n?void 0:n.p99)||0,timestampMs:e}}),[l,Y,a]),avgTokens:S,isLoading:k,error:b,hasData:x.length>0}}(),R=(0,o.useCallback)((e,n)=>[(0,T.B4)(e),n],[]),N={p50:t.colors.green300,p90:t.colors.green500,p99:t.colors.yellow500};return E?(0,k.Y)(x.lh,{}):D?(0,k.Y)(x.nN,{}):(0,k.FD)(x.h,{componentId:"mlflow.charts.trace_token_stats",children:[(0,k.Y)(x.XQ,{icon:(0,k.Y)(s.BarChartIcon,{}),title:null!==e&&void 0!==e?e:(0,k.Y)(a.A,{id:"IlYdrX",defaultMessage:"Tokens per Trace"}),value:void 0!==L?(0,T.B4)(Math.round(L)):void 0,subtitle:void 0!==L?null!==n&&void 0!==n?n:(0,k.Y)(a.A,{id:"MXhKKt",defaultMessage:"avg per trace"}):void 0}),(0,k.Y)("div",{css:(0,i.AH)({height:x.tz,marginTop:t.spacing.sm},""),children:H?(0,k.Y)(l.u,{width:"100%",height:"100%",children:(0,k.FD)(d.b,{data:_,margin:{top:10,right:30,left:10,bottom:0},children:[(0,k.Y)(c.W,{dataKey:"name",...b}),(0,k.Y)(u.h,{...S}),(0,k.Y)(p.m,{content:(0,k.Y)(x.Vn,{formatter:R,linkConfig:{experimentId:M[0],timeIntervalSeconds:C,componentId:"mlflow.overview.usage.token_stats.view_traces_link"}}),cursor:{stroke:t.colors.actionTertiaryBackgroundHover}}),(0,k.Y)(m.N,{type:"monotone",dataKey:"p50",stroke:N.p50,strokeWidth:2,dot:(0,T.vx)(N.p50),name:"p50",strokeOpacity:Y("p50")}),(0,k.Y)(m.N,{type:"monotone",dataKey:"p90",stroke:N.p90,strokeWidth:2,dot:(0,T.vx)(N.p90),name:"p90",strokeOpacity:Y("p90")}),(0,k.Y)(m.N,{type:"monotone",dataKey:"p99",stroke:N.p99,strokeWidth:2,dot:(0,T.vx)(N.p99),name:"p99",strokeOpacity:Y("p99")}),void 0!==L&&(0,k.Y)(g.e,{y:L,stroke:t.colors.textSecondary,strokeDasharray:"4 4",label:{value:`AVG (${(0,T.B4)(Math.round(L))})`,position:"insideTopRight",fill:t.colors.textSecondary,fontSize:10}}),(0,k.Y)(v.s,{verticalAlign:"bottom",iconType:"plainline",onMouseEnter:A,onMouseLeave:I,...w})]})}):(0,k.Y)(x.iE,{})})]})}}}]);