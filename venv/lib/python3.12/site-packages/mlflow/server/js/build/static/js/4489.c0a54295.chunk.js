"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[4489],{3409:function(e,t,n){n.d(t,{tz:function(){return h},h:function(){return N},iE:function(){return C},nN:function(){return A},XQ:function(){return x},lh:function(){return Y},Vn:function(){return D},OM:function(){return E},t4:function(){return R},dC:function(){return L},WW:function(){return _},Id:function(){return M},R3:function(){return I},zZ:function(){return F},IT:function(){return H},T4:function(){return U},gy:function(){return O}});var r=n(68248),i=n(46709),o=n(27757),s=n(82716),a=n(40724),l=n(70431),d=n(80739);var c=n(91105),u=n(69983),m=n(60284),g=n(44105),p=n(15756),v=n(73408);const h=200,f=120,T=60;var y={name:"lugakg",styles:"font-weight:normal"};const x=({icon:e,title:t,value:n,subtitle:i})=>{const{theme:s}=(0,o.u)();return(0,v.FD)("div",{css:(0,r.AH)({marginBottom:s.spacing.lg},""),children:[(0,v.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,r.AH)({color:s.colors.textSecondary,display:"flex"},""),children:e}),(0,v.Y)(o.T.Text,{bold:!0,size:"lg",children:t})]}),void 0!==n&&(0,v.FD)(o.T.Title,{level:3,css:(0,r.AH)({margin:0,marginTop:s.spacing.sm},""),children:[n,i&&(0,v.FD)(v.FK,{children:[" ",(0,v.Y)(o.T.Text,{color:"secondary",css:y,children:i})]})]})]})},S=({children:e,height:t=280})=>{const{theme:n}=(0,o.u)();return(0,v.Y)("div",{css:(0,r.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,padding:n.spacing.lg,height:t,display:"flex",alignItems:"center",justifyContent:"center"},""),children:e})};var b={name:"1u1zie3",styles:"width:120px"},k={name:"m0jwvv",styles:"width:80px"},w={name:"82a6rk",styles:"flex:1"};const Y=({height:e=280})=>{const{theme:t}=(0,o.u)();return(0,v.FD)("div",{css:(0,r.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.lg,height:e,display:"flex",flexDirection:"column",gap:t.spacing.md},""),children:[(0,v.Y)(s.TitleSkeleton,{css:b}),(0,v.Y)(s.TitleSkeleton,{css:k}),(0,v.Y)("div",{css:w,children:(0,v.Y)(s.TableSkeleton,{lines:4})})]})},A=({height:e,message:t})=>(0,v.Y)(S,{height:e,children:(0,v.Y)(o.T.Text,{color:"error",children:t||(0,v.Y)(a.A,{id:"cp/h86",defaultMessage:"Failed to load chart data"})})}),C=({height:e,message:t})=>(0,v.Y)("div",{css:(0,r.AH)({height:e||"100%",display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,v.Y)(o.T.Text,{color:"secondary",children:t||(0,v.Y)(a.A,{id:"zwktEP",defaultMessage:"No data available for the selected time range"})})});function I(e,t,n){const r=m.Ay.getExperimentPageTabRoute(e,g.fM.Traces),i=new URLSearchParams,{startTimeLabel:o,startTime:s,endTime:a}=null!==t&&void 0!==t?t:{};return o&&i.set("startTimeLabel",o),s&&i.set("startTime",s),a&&i.set("endTime",a),null===n||void 0===n||n.forEach(e=>i.append("filter",e)),`${r}?${i.toString()}`}function M(e,t,n,r){return I(e,{startTimeLabel:"CUSTOM",startTime:new Date(t).toISOString(),endTime:new Date(t+1e3*n).toISOString()},r)}function R(e){return[p.w8.ASSESSMENT,p.dD.IS_NOT_NULL,"",e].join("::")}function E(e,t){return[p.w8.ASSESSMENT,p.tl.EQUALS,t,e].join("::")}function L(e){return[p.Gq,p.tl.EQUALS,e].join("::")}function _(e){return[p.RC,p.tl.EQUALS,e].join("::")}function D({active:e,payload:t,label:n,formatter:s,linkConfig:l}){var d,m,g,p,h;const{theme:T}=(0,o.u)(),y=(0,c.Zp)(),{hideTooltipLinks:x,tooltipLinkUrlBuilder:S,tooltipLinkText:b}=null!==(d=(0,i.useContext)(u.J0))&&void 0!==d?d:{};if(!e||null===t||void 0===t||!t.length)return null;const k=null===(m=t[0])||void 0===m?void 0:m.payload,w=void 0!==(null===l||void 0===l?void 0:l.onLinkClick),Y=(null===l||void 0===l?void 0:l.experimentId)&&(null===l||void 0===l?void 0:l.timeIntervalSeconds)&&void 0!==(null===k||void 0===k?void 0:k.timestampMs),A=!x&&l&&(w||Y);return(0,v.FD)("div",{css:(0,r.AH)({backgroundColor:`${T.colors.backgroundPrimary}80`,backdropFilter:"blur(2px)",border:`1px solid ${T.colors.border}`,borderRadius:T.borders.borderRadiusMd,fontSize:T.typography.fontSizeSm,padding:T.spacing.sm,pointerEvents:"auto",marginLeft:-20,marginRight:-20},""),children:[n&&(0,v.Y)("div",{css:(0,r.AH)({fontWeight:500,marginBottom:T.spacing.xs},""),children:n}),(0,v.Y)("div",{css:(0,r.AH)({maxHeight:f,overflowY:"auto",overflowX:"hidden"},""),children:t.map((e,t)=>{const[n,i]=s(e.value,e.name);return(0,v.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:T.spacing.xs,paddingTop:T.spacing.xs,paddingBottom:T.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,r.AH)({width:T.spacing.sm,height:T.spacing.sm,borderRadius:"50%",backgroundColor:e.color,flexShrink:0},"")}),(0,v.FD)("span",{css:(0,r.AH)({color:e.color},""),children:[i,":"]}),(0,v.Y)("span",{children:n})]},t)})}),A&&(0,v.Y)("div",{css:(0,r.AH)({borderTop:`1px solid ${T.colors.border}`,marginTop:T.spacing.xs,paddingTop:T.spacing.xs},""),children:(0,v.Y)(o.T.Link,{componentId:null!==(g=null===l||void 0===l?void 0:l.componentId)&&void 0!==g?g:"mlflow.overview.usage.traces.view_traces_link",onClick:()=>{if(w)l.onLinkClick(n,k);else if(Y){const e=S?S(l.experimentId,k.timestampMs,l.timeIntervalSeconds):M(l.experimentId,k.timestampMs,l.timeIntervalSeconds);y(e)}},css:(0,r.AH)({cursor:"pointer",display:"flex",alignItems:"center",gap:T.spacing.xs},""),children:null!==(p=null!==(h=null===l||void 0===l?void 0:l.linkText)&&void 0!==h?h:b)&&void 0!==p?p:(0,v.Y)(a.A,{id:"c+3yBY",defaultMessage:"View traces for this period"})})})]})}function F(){const{theme:e}=(0,o.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary,dy:e.spacing.sm},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}}function H(){const{theme:e}=(0,o.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary},axisLine:!1,tickLine:!1,width:40}}function O(e){var t;const{theme:n}=(0,o.u)();return{formatter:e=>(0,v.Y)("span",{css:(0,r.AH)({color:n.colors.textPrimary,fontSize:n.typography.fontSizeSm,cursor:"pointer"},""),children:e}),wrapperStyle:{maxHeight:null!==(t=null===e||void 0===e?void 0:e.maxHeight)&&void 0!==t?t:T,overflowY:"auto",overflowX:"hidden",paddingTop:n.spacing.xs}}}const N=({children:e,componentId:t,...n})=>{const{theme:s}=(0,o.u)(),a=function(e){const t=(0,i.useRef)((0,l.A)()),n=(0,i.useRef)(0),r=(0,d.R)();return{onClick:(0,i.useCallback)(()=>{if(!e)return;const i=Date.now();i-n.current<1e4||(n.current=i,r({componentId:e,componentViewId:t.current,componentType:o.f.Card,eventType:o.d.OnClick,value:"chart_interaction"}))},[e,r])}}(t);return(0,v.Y)("div",{css:(0,r.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusMd,padding:s.spacing.lg,backgroundColor:s.colors.backgroundPrimary},""),...a,...n,children:e})};function U(){const{theme:e}=(0,o.u)();return{strokeOpacity:.3,fill:e.colors.blue200,fillOpacity:.3}}},4489:function(e,t,n){n.d(t,{TraceErrorsChart:function(){return w}});var r=n(68248),i=n(46709),o=n(27757),s=n(40724),a=n(66774),l=n(64168),d=n(60719),c=n(49960),u=n(858),m=n(13240),g=n(97245),p=n(15714),v=n(6581),h=n(91105),f=n(16844),T=n(23327),y=n(83110),x=n(69983);const S=(0,f.iK)(f.PA.STATUS,f.uI.ERROR);var b=n(3409),k=n(73408);const w=()=>{const{theme:e}=(0,o.u)(),t=(0,b.zZ)(),n=(0,b.IT)(),w=(0,b.gy)(),{getOpacity:Y,handleLegendMouseEnter:A,handleLegendMouseLeave:C}=(0,y.pH)(),{experimentIds:I,timeIntervalSeconds:M}=(0,x.W0)(),R=(0,h.Zp)(),{chartData:E,totalErrors:L,overallErrorRate:_,avgErrorRate:D,isLoading:F,error:H,hasData:O}=function(){const{experimentIds:e,startTimeMs:t,endTimeMs:n,timeIntervalSeconds:r,timeBuckets:o,filters:s}=(0,x.W0)(),a=(0,i.useMemo)(()=>[...null!==s&&void 0!==s?s:[],S],[s]),{data:l,isLoading:d,error:c}=(0,T.o)({experimentIds:e,startTimeMs:t,endTimeMs:n,viewType:f.mW.TRACES,metricName:f.po.TRACE_COUNT,aggregations:[{aggregation_type:f.DF.COUNT}],timeIntervalSeconds:r,filters:a}),{data:u,isLoading:m,error:g}=(0,T.o)({experimentIds:e,startTimeMs:t,endTimeMs:n,viewType:f.mW.TRACES,metricName:f.po.TRACE_COUNT,aggregations:[{aggregation_type:f.DF.COUNT}],timeIntervalSeconds:r,filters:s}),p=(0,i.useMemo)(()=>(null===l||void 0===l?void 0:l.data_points)||[],[null===l||void 0===l?void 0:l.data_points]),v=(0,i.useMemo)(()=>(null===u||void 0===u?void 0:u.data_points)||[],[null===u||void 0===u?void 0:u.data_points]),h=d||m,b=c||g,k=(0,i.useMemo)(()=>p.reduce((e,t)=>{var n;return e+((null===(n=t.values)||void 0===n?void 0:n[f.DF.COUNT])||0)},0),[p]),w=(0,i.useMemo)(()=>v.reduce((e,t)=>{var n;return e+((null===(n=t.values)||void 0===n?void 0:n[f.DF.COUNT])||0)},0),[v]),Y=w>0?k/w*100:0,A=(0,i.useCallback)(e=>{var t;return(null===(t=e.values)||void 0===t?void 0:t[f.DF.COUNT])||0},[]),C=(0,y.NM)(p,A),I=(0,y.NM)(v,A),M=(0,i.useMemo)(()=>o.map(e=>{const t=C.get(e)||0,n=I.get(e)||0,i=n>0?t/n*100:0;return{name:(0,y.fq)(e,r),errorCount:t,errorRate:Math.round(100*i)/100,timestampMs:e}}),[o,C,I,r]),R=(0,i.useMemo)(()=>0===M.length?0:M.reduce((e,t)=>e+t.errorRate,0)/M.length,[M]);return{chartData:M,totalErrors:k,overallErrorRate:Y,avgErrorRate:R,isLoading:h,error:b,hasData:v.length>0}}(),N=(0,i.useCallback)((e,t)=>"Error Count"===t?[e.toLocaleString(),t]:[`${e.toFixed(1)}%`,t],[]),U=(0,i.useCallback)((e,t)=>{if(void 0===(null===t||void 0===t?void 0:t.timestampMs))return;const n=(0,b.Id)(I[0],t.timestampMs,M,[(0,b.WW)("ERROR")]);R(n)},[I,M,R]);return F?(0,k.Y)(b.lh,{}):H?(0,k.Y)(b.nN,{}):(0,k.FD)(b.h,{componentId:"mlflow.charts.trace_errors",children:[(0,k.Y)(b.XQ,{icon:(0,k.Y)(o.k,{}),title:(0,k.Y)(s.A,{id:"t3mHNt",defaultMessage:"Errors"}),value:L.toLocaleString(),subtitle:`(Overall error rate: ${_.toFixed(1)}%)`}),(0,k.Y)("div",{css:(0,r.AH)({height:b.tz,marginTop:e.spacing.sm},""),children:O?(0,k.Y)(a.u,{width:"100%",height:"100%",children:(0,k.FD)(l.X,{data:E,margin:{top:10,right:10,left:10,bottom:0},children:[(0,k.Y)(d.W,{dataKey:"name",...t}),(0,k.Y)(c.h,{yAxisId:"left",...n}),(0,k.Y)(c.h,{yAxisId:"right",orientation:"right",domain:[0,100],tickFormatter:e=>`${e}%`,...n}),(0,k.Y)(u.m,{content:(0,k.Y)(b.Vn,{formatter:N,linkConfig:{componentId:"mlflow.overview.usage.errors.view_traces_link",onLinkClick:U}}),cursor:{fill:e.colors.actionTertiaryBackgroundHover}}),(0,k.Y)(m.y,{yAxisId:"left",dataKey:"errorCount",fill:e.colors.red400,radius:[4,4,0,0],name:"Error Count",fillOpacity:Y("Error Count"),legendType:"square"}),D>0&&(0,k.Y)(g.e,{yAxisId:"right",y:D,stroke:e.colors.textSecondary,strokeDasharray:"4 4",label:{value:`AVG (${D.toFixed(1)}%)`,position:"insideTopRight",fill:e.colors.textSecondary,fontSize:10}}),(0,k.Y)(p.N,{yAxisId:"right",type:"monotone",dataKey:"errorRate",stroke:e.colors.yellow500,strokeWidth:2,dot:(0,y.vx)(e.colors.yellow500),name:"Error Rate",strokeOpacity:Y("Error Rate"),legendType:"plainline"}),(0,k.Y)(v.s,{verticalAlign:"bottom",onMouseEnter:A,onMouseLeave:C,...w})]})}):(0,k.Y)(b.iE,{})})]})}},23327:function(e,t,n){n.d(t,{o:function(){return a}});var r=n(49708),i=n(61077),o=n(90935);const s="traceMetrics";function a({experimentIds:e,startTimeMs:t,endTimeMs:n,viewType:a,metricName:l,aggregations:d,timeIntervalSeconds:c,filters:u,dimensions:m,enabled:g=!0}){const p={experiment_ids:e,view_type:a,metric_name:l,aggregations:d,time_interval_seconds:c,start_time_ms:t,end_time_ms:n,filters:u,dimensions:m};return(0,r.I)({queryKey:[s,e,t,n,a,l,d,c,u,m],queryFn:async()=>await async function(e){return(0,i.qP)((0,i.we)("ajax-api/3.0/mlflow/traces/metrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).catch(o.J)}(p),enabled:e.length>0&&g,refetchOnWindowFocus:!1})}},90935:function(e,t,n){n.d(t,{J:function(){return i}});var r=n(36476);async function i(e){if(e instanceof r.Un){var t;const n=await(null===(t=e.response)||void 0===t?void 0:t.json());e.message=null===n||void 0===n?void 0:n.message}throw e}}}]);