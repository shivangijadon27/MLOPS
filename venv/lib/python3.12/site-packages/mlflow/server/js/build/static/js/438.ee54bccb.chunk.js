"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[438],{3409:function(e,n,t){t.d(n,{tz:function(){return h},h:function(){return N},iE:function(){return Y},nN:function(){return k},XQ:function(){return y},lh:function(){return w},Vn:function(){return O},OM:function(){return I},t4:function(){return D},dC:function(){return L},WW:function(){return H},Id:function(){return _},R3:function(){return A},zZ:function(){return E},IT:function(){return F},T4:function(){return j},gy:function(){return R}});var o=t(68248),i=t(46709),r=t(27757),s=t(82716),l=t(40724),a=t(70431),d=t(80739);var c=t(91105),u=t(69983),m=t(60284),g=t(44105),p=t(15756),f=t(73408);const h=200,v=120,x=60;var b={name:"lugakg",styles:"font-weight:normal"};const y=({icon:e,title:n,value:t,subtitle:i})=>{const{theme:s}=(0,r.u)();return(0,f.FD)("div",{css:(0,o.AH)({marginBottom:s.spacing.lg},""),children:[(0,f.FD)("div",{css:(0,o.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,f.Y)("span",{css:(0,o.AH)({color:s.colors.textSecondary,display:"flex"},""),children:e}),(0,f.Y)(r.T.Text,{bold:!0,size:"lg",children:n})]}),void 0!==t&&(0,f.FD)(r.T.Title,{level:3,css:(0,o.AH)({margin:0,marginTop:s.spacing.sm},""),children:[t,i&&(0,f.FD)(f.FK,{children:[" ",(0,f.Y)(r.T.Text,{color:"secondary",css:b,children:i})]})]})]})},T=({children:e,height:n=280})=>{const{theme:t}=(0,r.u)();return(0,f.Y)("div",{css:(0,o.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.lg,height:n,display:"flex",alignItems:"center",justifyContent:"center"},""),children:e})};var C={name:"1u1zie3",styles:"width:120px"},S={name:"m0jwvv",styles:"width:80px"},M={name:"82a6rk",styles:"flex:1"};const w=({height:e=280})=>{const{theme:n}=(0,r.u)();return(0,f.FD)("div",{css:(0,o.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,padding:n.spacing.lg,height:e,display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,f.Y)(s.TitleSkeleton,{css:C}),(0,f.Y)(s.TitleSkeleton,{css:S}),(0,f.Y)("div",{css:M,children:(0,f.Y)(s.TableSkeleton,{lines:4})})]})},k=({height:e,message:n})=>(0,f.Y)(T,{height:e,children:(0,f.Y)(r.T.Text,{color:"error",children:n||(0,f.Y)(l.A,{id:"cp/h86",defaultMessage:"Failed to load chart data"})})}),Y=({height:e,message:n})=>(0,f.Y)("div",{css:(0,o.AH)({height:e||"100%",display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,f.Y)(r.T.Text,{color:"secondary",children:n||(0,f.Y)(l.A,{id:"zwktEP",defaultMessage:"No data available for the selected time range"})})});function A(e,n,t){const o=m.Ay.getExperimentPageTabRoute(e,g.fM.Traces),i=new URLSearchParams,{startTimeLabel:r,startTime:s,endTime:l}=null!==n&&void 0!==n?n:{};return r&&i.set("startTimeLabel",r),s&&i.set("startTime",s),l&&i.set("endTime",l),null===t||void 0===t||t.forEach(e=>i.append("filter",e)),`${o}?${i.toString()}`}function _(e,n,t,o){return A(e,{startTimeLabel:"CUSTOM",startTime:new Date(n).toISOString(),endTime:new Date(n+1e3*t).toISOString()},o)}function D(e){return[p.w8.ASSESSMENT,p.dD.IS_NOT_NULL,"",e].join("::")}function I(e,n){return[p.w8.ASSESSMENT,p.tl.EQUALS,n,e].join("::")}function L(e){return[p.Gq,p.tl.EQUALS,e].join("::")}function H(e){return[p.RC,p.tl.EQUALS,e].join("::")}function O({active:e,payload:n,label:t,formatter:s,linkConfig:a}){var d,m,g,p,h;const{theme:x}=(0,r.u)(),b=(0,c.Zp)(),{hideTooltipLinks:y,tooltipLinkUrlBuilder:T,tooltipLinkText:C}=null!==(d=(0,i.useContext)(u.J0))&&void 0!==d?d:{};if(!e||null===n||void 0===n||!n.length)return null;const S=null===(m=n[0])||void 0===m?void 0:m.payload,M=void 0!==(null===a||void 0===a?void 0:a.onLinkClick),w=(null===a||void 0===a?void 0:a.experimentId)&&(null===a||void 0===a?void 0:a.timeIntervalSeconds)&&void 0!==(null===S||void 0===S?void 0:S.timestampMs),k=!y&&a&&(M||w);return(0,f.FD)("div",{css:(0,o.AH)({backgroundColor:`${x.colors.backgroundPrimary}80`,backdropFilter:"blur(2px)",border:`1px solid ${x.colors.border}`,borderRadius:x.borders.borderRadiusMd,fontSize:x.typography.fontSizeSm,padding:x.spacing.sm,pointerEvents:"auto",marginLeft:-20,marginRight:-20},""),children:[t&&(0,f.Y)("div",{css:(0,o.AH)({fontWeight:500,marginBottom:x.spacing.xs},""),children:t}),(0,f.Y)("div",{css:(0,o.AH)({maxHeight:v,overflowY:"auto",overflowX:"hidden"},""),children:n.map((e,n)=>{const[t,i]=s(e.value,e.name);return(0,f.FD)("div",{css:(0,o.AH)({display:"flex",alignItems:"center",gap:x.spacing.xs,paddingTop:x.spacing.xs,paddingBottom:x.spacing.xs},""),children:[(0,f.Y)("span",{css:(0,o.AH)({width:x.spacing.sm,height:x.spacing.sm,borderRadius:"50%",backgroundColor:e.color,flexShrink:0},"")}),(0,f.FD)("span",{css:(0,o.AH)({color:e.color},""),children:[i,":"]}),(0,f.Y)("span",{children:t})]},n)})}),k&&(0,f.Y)("div",{css:(0,o.AH)({borderTop:`1px solid ${x.colors.border}`,marginTop:x.spacing.xs,paddingTop:x.spacing.xs},""),children:(0,f.Y)(r.T.Link,{componentId:null!==(g=null===a||void 0===a?void 0:a.componentId)&&void 0!==g?g:"mlflow.overview.usage.traces.view_traces_link",onClick:()=>{if(M)a.onLinkClick(t,S);else if(w){const e=T?T(a.experimentId,S.timestampMs,a.timeIntervalSeconds):_(a.experimentId,S.timestampMs,a.timeIntervalSeconds);b(e)}},css:(0,o.AH)({cursor:"pointer",display:"flex",alignItems:"center",gap:x.spacing.xs},""),children:null!==(p=null!==(h=null===a||void 0===a?void 0:a.linkText)&&void 0!==h?h:C)&&void 0!==p?p:(0,f.Y)(l.A,{id:"c+3yBY",defaultMessage:"View traces for this period"})})})]})}function E(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary,dy:e.spacing.sm},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}}function F(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary},axisLine:!1,tickLine:!1,width:40}}function R(e){var n;const{theme:t}=(0,r.u)();return{formatter:e=>(0,f.Y)("span",{css:(0,o.AH)({color:t.colors.textPrimary,fontSize:t.typography.fontSizeSm,cursor:"pointer"},""),children:e}),wrapperStyle:{maxHeight:null!==(n=null===e||void 0===e?void 0:e.maxHeight)&&void 0!==n?n:x,overflowY:"auto",overflowX:"hidden",paddingTop:t.spacing.xs}}}const N=({children:e,componentId:n,...t})=>{const{theme:s}=(0,r.u)(),l=function(e){const n=(0,i.useRef)((0,a.A)()),t=(0,i.useRef)(0),o=(0,d.R)();return{onClick:(0,i.useCallback)(()=>{if(!e)return;const i=Date.now();i-t.current<1e4||(t.current=i,o({componentId:e,componentViewId:n.current,componentType:r.f.Card,eventType:r.d.OnClick,value:"chart_interaction"}))},[e,o])}}(n);return(0,f.Y)("div",{css:(0,o.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusMd,padding:s.spacing.lg,backgroundColor:s.colors.backgroundPrimary},""),...l,...t,children:e})};function j(){const{theme:e}=(0,r.u)();return{strokeOpacity:.3,fill:e.colors.blue200,fillOpacity:.3}}},23327:function(e,n,t){t.d(n,{o:function(){return l}});var o=t(49708),i=t(61077),r=t(90935);const s="traceMetrics";function l({experimentIds:e,startTimeMs:n,endTimeMs:t,viewType:l,metricName:a,aggregations:d,timeIntervalSeconds:c,filters:u,dimensions:m,enabled:g=!0}){const p={experiment_ids:e,view_type:l,metric_name:a,aggregations:d,time_interval_seconds:c,start_time_ms:n,end_time_ms:t,filters:u,dimensions:m};return(0,o.I)({queryKey:[s,e,n,t,l,a,d,c,u,m],queryFn:async()=>await async function(e){return(0,i.qP)((0,i.we)("ajax-api/3.0/mlflow/traces/metrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).catch(r.J)}(p),enabled:e.length>0&&g,refetchOnWindowFocus:!1})}},30618:function(e,n,t){t.d(n,{b:function(){return a}});var o=t(90970),i=t(15714),r=t(60719),s=t(49960),l=t(44941),a=(0,o.gu)({chartName:"LineChart",GraphicalChild:i.N,axisComponents:[{axisType:"xAxis",AxisComp:r.W},{axisType:"yAxis",AxisComp:s.h}],formatAxisMap:l.pr})},41473:function(e,n,t){t.d(n,{q:function(){return i}});var o=t(46709);function i(e="model"){const[n,t]=(0,o.useState)(e),i=(0,o.useCallback)(()=>{t(e=>"model"===e?"provider":"model")},[]);return{dimension:n,setDimension:t,toggleDimension:i}}},60438:function(e,n,t){t.d(n,{TraceCostOverTimeChart:function(){return k}});var o=t(68248),i=t(46709),r=t(27757),s=t(82716),l=t(7655),a=t(40724),d=t(66774),c=t(30618),u=t(60719),m=t(49960),g=t(858),p=t(15714),f=t(6581),h=t(16844),v=t(23327),x=t(83110),b=t(69983);var y=t(41473),T=t(92287),C=t(3409),S=t(73408);var M={name:"1f1m9i6",styles:"display:flex;justify-content:space-between;align-items:flex-start"},w={name:"lq4swo",styles:"min-width:120px"};const k=()=>{const{theme:e}=(0,r.u)(),n=(0,l.A)(),t=(0,C.zZ)(),k=(0,C.IT)(),Y=(0,C.gy)(),{getChartColor:A}=(0,x.yC)(),{getOpacity:_,handleLegendMouseEnter:D,handleLegendMouseLeave:I}=(0,x.pH)(.8,.2),{dimension:L,setDimension:H}=(0,y.q)(),{chartData:O,dimensionValues:E,totalCost:F,isLoading:R,error:N,hasData:j}=function(e="model"){const{experimentIds:n,startTimeMs:t,endTimeMs:o,timeIntervalSeconds:r,timeBuckets:s,filters:l}=(0,b.W0)(),a="model"===e?h.it.MODEL_NAME:h.it.MODEL_PROVIDER,{data:d,isLoading:c,error:u}=(0,v.o)({experimentIds:n,startTimeMs:t,endTimeMs:o,viewType:h.mW.SPANS,metricName:h.Ub.TOTAL_COST,aggregations:[{aggregation_type:h.DF.SUM}],dimensions:[a],timeIntervalSeconds:r,filters:l}),m=(0,i.useMemo)(()=>(null===d||void 0===d?void 0:d.data_points)||[],[null===d||void 0===d?void 0:d.data_points]),g=(0,i.useMemo)(()=>{const e=new Set;for(const t of m){var n;const o=null===(n=t.dimensions)||void 0===n?void 0:n[a];o&&e.add(o)}return Array.from(e).sort()},[m,a]),p=(0,i.useMemo)(()=>{const e=new Map;for(const i of m){var n,t,o;const r=null===(n=i.dimensions)||void 0===n?void 0:n[h.Ad],s=null===(t=i.dimensions)||void 0===t?void 0:t[a],l=(null===(o=i.values)||void 0===o?void 0:o[h.DF.SUM])||0;if(r&&s){const n=new Date(r).getTime();e.has(n)||e.set(n,new Map),e.get(n).set(s,l)}}return e},[m,a]),f=(0,i.useMemo)(()=>s.map(e=>{const n=p.get(e),t={name:(0,x.fq)(e,r)};for(const o of g)t[o]=(null===n||void 0===n?void 0:n.get(o))||0;return t}),[s,p,g,r]),y=(0,i.useMemo)(()=>m.reduce((e,n)=>{var t;return e+((null===(t=n.values)||void 0===t?void 0:t[h.DF.SUM])||0)},0),[m]);return{chartData:f,dimensionValues:g,totalCost:y,isLoading:c,error:u,hasData:m.length>0}}(L),[z,U]=(0,i.useState)(null);(0,i.useEffect)(()=>{U(null)},[L]);const P=null===z,W=P?E:z.filter(e=>E.includes(e)),q=(0,i.useCallback)(()=>{U(P?[]:null)},[P]),B=(0,i.useCallback)(e=>{U(n=>{if(null===n)return E.filter(n=>n!==e);const t=n.includes(e)?n.filter(n=>n!==e):[...n,e];return t.length===E.length?null:t})},[E]),$=(0,i.useMemo)(()=>{const e="model"===L?n.formatMessage({id:"DLZwqO",defaultMessage:"All models"}):n.formatMessage({id:"abIH3b",defaultMessage:"All providers"});return P?e:0===W.length?"model"===L?n.formatMessage({id:"KIlp8v",defaultMessage:"No models selected"}):n.formatMessage({id:"45tCkn",defaultMessage:"No providers selected"}):n.formatMessage({id:"8cK5xK",defaultMessage:"{count} selected"},{count:W.length})},[P,W,n,L]),K=(0,i.useCallback)((e,n)=>[(0,h.lE)(e),n],[]);return R?(0,S.Y)(C.lh,{}):N?(0,S.Y)(C.nN,{}):(0,S.FD)(C.h,{componentId:"mlflow.overview.usage.trace_cost_over_time",children:[(0,S.FD)("div",{css:M,children:[(0,S.Y)(C.XQ,{icon:(0,S.Y)(s.ChartLineIcon,{}),title:(0,S.Y)(a.A,{id:"ljOsC9",defaultMessage:"Cost Over Time"}),value:(0,h.lE)(F),subtitle:(0,S.Y)(a.A,{id:"WcHytj",defaultMessage:"Total Cost"})}),(0,S.FD)("div",{css:(0,o.AH)({display:"flex",gap:e.spacing.sm,flexShrink:0},""),children:[(0,S.Y)(T.g,{componentId:"mlflow.overview.usage.trace_cost_over_time.dimension",value:L,onChange:H}),j&&E.length>0&&(0,S.FD)(s.DialogCombobox,{componentId:"mlflow.overview.usage.trace_cost_over_time.item_selector",label:$,multiSelect:!0,value:[],children:[(0,S.Y)(s.DialogComboboxTrigger,{allowClear:!1,css:w,"data-testid":"item-selector-dropdown"}),(0,S.Y)(s.DialogComboboxContent,{maxHeight:300,align:"end",children:(0,S.Y)(s.DialogComboboxOptionList,{children:(0,S.FD)(s.DialogComboboxOptionListSearch,{children:[(0,S.Y)(s.DialogComboboxOptionListCheckboxItem,{value:"__select_all__",checked:P,onChange:q,children:(0,S.Y)(a.A,{id:"UJWipj",defaultMessage:"Select All"})},"__select_all__"),E.map(e=>(0,S.Y)(s.DialogComboboxOptionListCheckboxItem,{value:e,checked:P||W.includes(e),onChange:()=>B(e),children:e},e))]})})})]})]})]}),(0,S.Y)("div",{css:(0,o.AH)({height:C.tz,marginTop:e.spacing.sm},""),children:j&&W.length>0?(0,S.Y)(d.u,{width:"100%",height:"100%",children:(0,S.FD)(c.b,{data:O,margin:{top:10,right:30,left:10,bottom:0},children:[(0,S.Y)(u.W,{dataKey:"name",...t}),(0,S.Y)(m.h,{...k}),(0,S.Y)(g.m,{content:(0,S.Y)(C.Vn,{formatter:K}),cursor:{stroke:e.colors.actionTertiaryBackgroundHover}}),W.map(e=>{const n=E.indexOf(e);return(0,S.Y)(p.N,{type:"monotone",dataKey:e,stroke:A(n),strokeOpacity:_(e),strokeWidth:2,dot:(0,x.vx)(A(n)),name:e},e)}),(0,S.Y)(f.s,{verticalAlign:"bottom",iconType:"plainline",onMouseEnter:D,onMouseLeave:I,...Y})]})}):(0,S.Y)(C.iE,{message:(0,S.Y)(a.A,{id:"iRs4JD",defaultMessage:"No cost data available"})})})]})}},90935:function(e,n,t){t.d(n,{J:function(){return i}});var o=t(36476);async function i(e){if(e instanceof o.Un){var n;const t=await(null===(n=e.response)||void 0===n?void 0:n.json());e.message=null===t||void 0===t?void 0:t.message}throw e}},92287:function(e,n,t){t.d(n,{g:function(){return s}});t(46709);var o=t(82716),i=t(40724),r=t(73408);const s=({componentId:e,value:n,onChange:t})=>(0,r.FD)(o.SegmentedControlGroup,{name:`${e}-dimension`,componentId:e,value:n,onChange:({target:{value:e}})=>t(e),children:[(0,r.Y)(o.SegmentedControlButton,{value:"model",children:(0,r.Y)(i.A,{id:"AQh8lf",defaultMessage:"Model"})}),(0,r.Y)(o.SegmentedControlButton,{value:"provider",children:(0,r.Y)(i.A,{id:"L71uzj",defaultMessage:"Provider"})})]})}}]);