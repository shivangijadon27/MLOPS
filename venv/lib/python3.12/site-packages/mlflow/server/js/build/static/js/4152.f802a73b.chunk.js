"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[4152],{43979:function(e,s,n){n.d(s,{J:function(){return d}});var i=n(68248),t=n(82716),o=n(27757),r=n(12998),l=n(84411),a=n(42747),c=n(73408);const d=({viewState:e,sessionId:s,className:n})=>{const{theme:d}=(0,o.u)();return(0,c.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${d.colors.borderDecorative}`,paddingBottom:`${d.spacing.sm}px`},""),className:n,children:[!("single-chat-session"===e)&&(0,c.Y)(l.$,{}),"single-chat-session"===e&&(0,c.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:d.spacing.sm},""),children:[(0,c.Y)(t.Tag,{color:"default",componentId:"mlflow.chat-sessions.session-header-label",css:(0,i.AH)({padding:d.spacing.xs+2,margin:0},""),children:(0,c.FD)("span",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:d.spacing.sm},""),children:[(0,c.Y)(t.SpeechBubbleIcon,{}),(0,c.Y)(o.T.Text,{ellipsis:!0,bold:!0,children:(0,c.Y)(a.sA,{id:"EAf6xM",defaultMessage:"Session"})})]})}),(0,c.Y)(o.T.Title,{level:3,withoutMargins:!0,children:s}),s&&(0,c.Y)(r.ad,{copyText:s,componentId:"mlflow.chat-sessions.copy-session-id",buttonProps:{icon:void 0}})]})]})}},54152:function(e,s,n){n.r(s),n.d(s,{default:function(){return se}});var i=n(68248),t=n(91113),o=n(55570),r=n(42747),l=n(15756),a=n(91105),c=n(59930),d=n.n(c),u=n(54741),m=n(46709),p=n(27757),h=n(16844),g=n(76118),f=n(40724),v=n(25637),x=n(27882),T=n(40332),Y=n(30518),I=n(73408);var w={name:"1b2lv1",styles:"padding-left:0;border:0"};const y=({traces:e,sessionId:s,onRefreshSession:n})=>{const{theme:t}=(0,p.u)(),o=(0,m.useMemo)(()=>{var s;const n=null===(s=(0,g.first)(e))||void 0===s?void 0:s.info;if(n&&(0,h.gD)(n))return n},[e]),r=(0,m.useMemo)(()=>{var e,s;return null!==(e=null===o||void 0===o||null===(s=o.assessments)||void 0===s?void 0:s.filter(h.rX))&&void 0!==e?e:[]},[o]),l=h.iX,a=(0,h.M5)();if(!o)return null;const c=(0,I.Y)(l,{assessments:r,traceId:o.trace_id,css:w,assessmentsTitleOverride:S,disableCloseButton:!0,enableRunScorer:(0,x.u6)(),sessionId:s});return(0,I.Y)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",minHeight:0,paddingTop:t.spacing.sm,overflow:"auto"},""),children:(0,I.Y)(v.ResizableBox,{width:300,height:void 0,axis:"x",resizeHandles:["w"],minConstraints:[300,150],maxConstraints:[600,150],handle:(0,I.Y)("div",{css:(0,i.AH)({width:t.spacing.sm,left:-t.spacing.sm/2,height:"100%",position:"absolute",top:0,cursor:"ew-resize","&:hover":{backgroundColor:t.colors.border,opacity:.5}},"")}),css:(0,i.AH)({position:"relative",display:"flex",borderLeft:`1px solid ${t.colors.border}`,marginLeft:t.spacing.sm,paddingLeft:t.spacing.sm,flex:1},""),children:(0,I.Y)(h.ei,{...a,modelTraceInfo:o,chatSessionId:s,children:(0,x.u6)()?(0,I.Y)(A,{onRefreshSession:n,sessionId:s,children:c}):c})})})};var b={name:"ozd7xs",styles:"flex-shrink:0"};const S=e=>(0,I.Y)(p.T.Title,{level:3,withoutMargins:!0,css:b,children:(0,I.Y)(f.A,{id:"5IeFBG",defaultMessage:"Session scorers{count, plural, =0 {} other { (#)}}",values:{count:null!==e&&void 0!==e?e:0}})}),A=({children:e,onRefreshSession:s,sessionId:n})=>{const i=(0,T.r)(Y.j1.SESSIONS);return(0,m.useEffect)(()=>{var e;return null===(e=i.subscribeToScorerFinished)||void 0===e?void 0:e.call(i,e=>{var i;null!==(i=e.results)&&void 0!==i&&i.some(e=>"sessionId"in e&&e.sessionId===n)&&(null===s||void 0===s||s())})},[i,n,s]),(0,I.Y)(h.Fg,{...i,children:e})};var M=n(43979),E=n(82716),k=n(54712);const R=({traces:e,selectedTurnIndex:s,setSelectedTurnIndex:n,setSelectedTrace:t,chatRefs:o})=>{const{theme:r}=(0,p.u)(),l=(0,m.useCallback)(e=>{const s=(0,h.MF)(e);o.current[s]&&o.current[s].scrollIntoView({behavior:"smooth"})},[o]);return e?(0,I.Y)("div",{css:(0,i.AH)({minHeight:0,width:200,borderRight:`1px solid ${r.colors.border}`,overflow:"auto",paddingTop:r.spacing.sm,paddingRight:r.spacing.sm},""),children:e.map((t,o)=>(0,I.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:r.spacing.sm,backgroundColor:s===o?r.colors.actionDefaultBackgroundHover:void 0,padding:r.spacing.xs,borderRadius:r.borders.borderRadiusSm,cursor:"pointer"},""),onMouseEnter:()=>n(o),onClick:()=>l(t),children:[(0,I.Y)(k.b,{displayLink:o!==e.length-1}),(0,I.Y)(p.T.Text,{bold:!0,children:(0,I.Y)(f.A,{id:"8ikgws",defaultMessage:"Turn {turnNumber}",values:{turnNumber:o+1}})})]},(0,h.MF)(t)))}):null};var D={name:"xjt14x",styles:"width:60%"},_={name:"2ji30f",styles:"width:80%"},C={name:"maimdf",styles:"width:70%"};const F=()=>{const{theme:e}=(0,p.u)();return(0,I.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",minHeight:0,width:200,borderRight:`1px solid ${e.colors.border}`,gap:e.spacing.xs,paddingTop:e.spacing.sm,paddingRight:e.spacing.sm},""),children:[(0,I.Y)(E.TitleSkeleton,{css:D}),(0,I.Y)(E.TitleSkeleton,{css:_}),(0,I.Y)(E.TitleSkeleton,{css:C})]})};var H=n(69986),L=n(48785),N=n(88442),O=n(44105),P=n(15376);const B={sessionTokens:{input_tokens:0,output_tokens:0},sessionLatency:0,goal:void 0,persona:void 0,perTurnMetrics:[]};var G=n(66916),$=n(79081);var U={name:"wcr0fy",styles:"max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;vertical-align:bottom"},X={name:"wcr0fy",styles:"max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;vertical-align:bottom"};const q=({chatSessionMetrics:e})=>{var s;const{theme:n}=(0,p.u)();return(0,I.FD)("div",{css:(0,i.AH)({borderBottom:`1px solid ${n.colors.grey100}`,paddingBottom:n.spacing.sm,display:"flex",gap:n.spacing.sm},""),children:[e.sessionTokens.total_tokens&&(0,I.FD)("div",{css:(0,i.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,I.Y)(p.T.Text,{color:"secondary",children:(0,I.Y)(r.sA,{id:"Cu5P8e",defaultMessage:"Tokens"})}),(0,I.Y)(E.Tag,{componentId:"mlflow.experiment.chat-session.metrics.tokens-tag",icon:(0,I.Y)(E.TokenIcon,{}),children:e.sessionTokens.total_tokens})]}),e.sessionLatency&&(0,I.FD)("div",{css:(0,i.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,I.Y)(p.T.Text,{color:"secondary",children:(0,I.Y)(r.sA,{id:"XHKE0m",defaultMessage:"Latency"})}),(0,I.Y)(E.Tag,{componentId:"mlflow.experiment.chat-session.metrics.latency-tag",icon:(0,I.Y)(G.C,{}),children:(0,I.Y)(r.sA,{id:"iZOdRI",defaultMessage:"{latency} sec",values:{latency:null===(s=e.sessionLatency)||void 0===s?void 0:s.toFixed(4)}})})]}),e.goal&&(0,I.FD)("div",{css:(0,i.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,I.Y)(p.T.Text,{color:"secondary",children:(0,I.Y)(r.sA,{id:"Ia/nT7",defaultMessage:"Goal"})}),(0,I.Y)(E.Tag,{componentId:"mlflow.experiment.chat-session.metrics.goal-tag",children:(0,I.Y)($.T,{componentId:"mlflow.experiment.chat-session.metrics.goal-tooltip",content:e.goal,children:(0,I.Y)("span",{css:U,children:e.goal})})})]}),e.persona&&(0,I.FD)("div",{css:(0,i.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,I.Y)(p.T.Text,{color:"secondary",children:(0,I.Y)(r.sA,{id:"+Wj0Js",defaultMessage:"Persona"})}),(0,I.Y)(E.Tag,{componentId:"mlflow.experiment.chat-session.metrics.persona-tag",children:(0,I.Y)($.T,{componentId:"mlflow.experiment.chat-session.metrics.persona-tooltip",content:e.persona,children:(0,I.Y)("span",{css:X,children:e.persona})})})]})]})};var z=n(54871),V=n(55532),Z=n(25862);const j=({children:e,invalidateTraceQuery:s})=>{const n=V.p,i=Z.q;return(0,I.Y)(h.gm,{renderExportTracesToDatasetsModal:n,DrawerComponent:i,children:(0,I.Y)(h.ei,{invalidateTraceQuery:s,children:e})})};var J={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},Q={name:"1ndun5c",styles:"display:flex;flex:1;min-height:0"},K={name:"1ndun5c",styles:"display:flex;flex:1;min-height:0"};const W=(0,o.X)(t.A.mlflowServices.CHAT_SESSIONS,()=>{const{theme:e}=(0,p.u)(),{experimentId:s,sessionId:n}=(0,a.g)(),t=(0,a.zy)(),[o,r]=(0,m.useState)(null),[c,f]=(0,m.useState)(null),v=(0,m.useRef)({});d()(s,"Experiment ID must be defined"),d()(n,"Session ID must be defined"),(0,z.qd)("sessionId",n),(0,z.qd)("traceId",c?(0,h.MF)(c):null);const x=(0,m.useMemo)(()=>new URLSearchParams(t.search).get(O.hb),[t.search]),{loading:T}=(0,u.L)({experimentId:s}),Y=(0,m.useMemo)(()=>[(0,l.$U)(s)],[s]),w=(0,m.useMemo)(()=>(0,L._)({sessionId:n}),[n]),{data:b,isLoading:S}=(0,l.Zn)({locations:Y,filters:w,disabled:!1}),A=(0,m.useMemo)(()=>null===b||void 0===b?void 0:b.sort((e,s)=>new Date(e.request_time).getTime()-new Date(s.request_time).getTime()),[b]),E=(({traceInfos:e})=>(0,m.useMemo)(()=>{var s,n,i;const t=(0,g.last)(e);if(!t)return B;const o=(0,h.m4)(t),r=(0,g.first)(e),l=null===r||void 0===r||null===(s=r.trace_metadata)||void 0===s?void 0:s[P.wJ],a=null===r||void 0===r||null===(n=r.trace_metadata)||void 0===n?void 0:n[P.xm],{sessionLatency:c,perTurnMetrics:d}=null!==(i=null===e||void 0===e?void 0:e.reduce((e,s)=>{const n=parseFloat(s.execution_duration||"0");return{sessionLatency:e.sessionLatency+n,perTurnMetrics:[...e.perTurnMetrics,{tokens:(0,h.m4)(s),latency:s.execution_duration}]}},{sessionLatency:0,perTurnMetrics:[]}))&&void 0!==i?i:{};return{sessionTokens:o,sessionLatency:c,goal:l,persona:a,perTurnMetrics:d}},[e]))({traceInfos:A}),k=H.Uv,D=(0,m.useCallback)(e=>e,[]),{data:_,isLoading:C,invalidateSingleTraceQuery:G}=(0,l.Wx)(k,A);return(0,m.useEffect)(()=>{if(x&&_&&_.length>0&&!C){const e=_.findIndex(e=>(0,h.MF)(e)===x);if(-1!==e){r(e);const s=v.current[x];s&&s.scrollIntoView({behavior:"smooth",block:"center"})}}},[x,_,C]),(0,I.Y)(j,{invalidateTraceQuery:G,children:(0,I.FD)("div",{css:J,children:[(0,I.Y)(M.J,{viewState:"single-chat-session",sessionId:n,css:(0,h.aZ)()?{borderBottom:"none"}:void 0}),(0,h.aZ)()&&(0,I.Y)(q,{chatSessionMetrics:E}),C||S?(0,I.FD)("div",{css:Q,children:[(0,I.Y)(F,{}),(0,I.Y)(N.I,{})]}):(0,I.FD)("div",{css:K,children:[(0,I.Y)(R,{traces:null!==_&&void 0!==_?_:[],selectedTurnIndex:o,setSelectedTurnIndex:r,setSelectedTrace:f,chatRefs:v}),(0,I.Y)(N.L,{traces:null!==_&&void 0!==_?_:[],selectedTurnIndex:o,setSelectedTurnIndex:r,setSelectedTrace:f,chatRefs:v,getAssessmentTitle:D}),(0,h.aZ)()&&(0,I.Y)(y,{traces:null!==_&&void 0!==_?_:[],sessionId:n,onRefreshSession:()=>{const e=(0,g.first)(A);e&&G(e.trace_id)}})]}),null!==c&&null!==o&&(0,I.Y)(h.RI,{handleClose:()=>f(null),selectPreviousEval:()=>{if(o>0&&_){const e=o-1;r(e),f(_[e])}},selectNextEval:()=>{if(_&&o<_.length-1){const e=o+1;r(e),f(_[e])}},isPreviousAvailable:o>0,isNextAvailable:void 0!==_&&o<_.length-1,renderModalTitle:()=>(0,h.MF)(c),experimentId:s,traceInfo:null!==A&&void 0!==A&&A[o]&&(0,h.gD)(A[o])?A[o]:void 0,children:(0,I.Y)("div",{css:(0,i.AH)({height:"100%",marginLeft:-e.spacing.lg,marginRight:-e.spacing.lg,marginBottom:-e.spacing.lg},""),children:(0,h.u6)()?(0,I.Y)(ee,{children:(0,I.Y)(h.a8,{modelTrace:c,collapseAssessmentPane:"force-open"})}):(0,I.Y)(h.a8,{modelTrace:c,collapseAssessmentPane:"force-open"})})})]})})},(0,I.Y)(r.sA,{id:"fYtbd8",defaultMessage:"An error occurred while rendering the chat session."})),ee=({children:e})=>{const s=(0,T.r)();return(0,I.Y)(h.Fg,{...s,children:e})};var se=W},55570:function(e,s,n){n.d(s,{X:function(){return d}});n(46709);var i=n(89949),t=n(82716),o=n(27757),r=n(40724),l=n(73408);function a(){return(0,l.Y)(t.Empty,{"data-testid":"fallback",title:(0,l.Y)(r.A,{id:"qAdWdK",defaultMessage:"Error"}),description:(0,l.Y)(r.A,{id:"RzZVxC",defaultMessage:"An error occurred while rendering this component."}),image:(0,l.Y)(o.k,{})})}function c({children:e,customFallbackComponent:s}){function n(e,s){console.error("Caught Unexpected Error: ",e,s.componentStack)}return s?(0,l.Y)(i.tH,{onError:n,FallbackComponent:s,children:e}):(0,l.Y)(i.tH,{onError:n,fallback:(0,l.Y)(a,{}),children:e})}function d(e,s,n,i){return function(e){return(0,l.Y)(c,{customFallbackComponent:i,children:(0,l.Y)(s,{...e})})}}},91113:function(e,s,n){n.d(s,{h:function(){return l}});var i=n(36476),t=n(77153),o=n(24523);class r{}r.mlflowServices={MODEL_REGISTRY:"Model Registry",EXPERIMENTS:"Experiments",CHAT_SESSIONS:"Chat Sessions",MODEL_SERVING:"Model Serving",RUN_TRACKING:"Run Tracking"};const l=(e,s)=>{if(!(e instanceof t.s))return;const{status:n}=e;let r;const l={status:n};e.getErrorCode()===o.tG.RESOURCE_DOES_NOT_EXIST&&(r=new i.m_(l)),e.getErrorCode()===o.tG.PERMISSION_DENIED&&(r=new i.i_(l)),e.getErrorCode()===o.tG.INTERNAL_ERROR&&(r=new i.PO(l)),e.getErrorCode()===o.tG.INVALID_PARAMETER_VALUE&&(r=new i.v7(l));const a=e.getMessageField();return r&&a&&(r.message=a),r};s.A=r}}]);