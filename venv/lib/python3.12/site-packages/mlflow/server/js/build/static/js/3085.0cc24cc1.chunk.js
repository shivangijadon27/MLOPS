"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[3085],{3409:function(e,n,t){t.d(n,{tz:function(){return h},h:function(){return O},iE:function(){return C},nN:function(){return w},XQ:function(){return S},lh:function(){return k},Vn:function(){return F},OM:function(){return L},t4:function(){return I},dC:function(){return R},WW:function(){return _},Id:function(){return D},R3:function(){return M},zZ:function(){return z},IT:function(){return H},T4:function(){return $},gy:function(){return E}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(70431),c=t(80739);var d=t(91105),u=t(69983),m=t(60284),g=t(44105),p=t(15756),f=t(73408);const h=200,v=120,x=60;var y={name:"lugakg",styles:"font-weight:normal"};const S=({icon:e,title:n,value:t,subtitle:o})=>{const{theme:s}=(0,r.u)();return(0,f.FD)("div",{css:(0,i.AH)({marginBottom:s.spacing.lg},""),children:[(0,f.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,f.Y)("span",{css:(0,i.AH)({color:s.colors.textSecondary,display:"flex"},""),children:e}),(0,f.Y)(r.T.Text,{bold:!0,size:"lg",children:n})]}),void 0!==t&&(0,f.FD)(r.T.Title,{level:3,css:(0,i.AH)({margin:0,marginTop:s.spacing.sm},""),children:[t,o&&(0,f.FD)(f.FK,{children:[" ",(0,f.Y)(r.T.Text,{color:"secondary",css:y,children:o})]})]})]})},b=({children:e,height:n=280})=>{const{theme:t}=(0,r.u)();return(0,f.Y)("div",{css:(0,i.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.lg,height:n,display:"flex",alignItems:"center",justifyContent:"center"},""),children:e})};var T={name:"1u1zie3",styles:"width:120px"},A={name:"m0jwvv",styles:"width:80px"},Y={name:"82a6rk",styles:"flex:1"};const k=({height:e=280})=>{const{theme:n}=(0,r.u)();return(0,f.FD)("div",{css:(0,i.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,padding:n.spacing.lg,height:e,display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,f.Y)(s.TitleSkeleton,{css:T}),(0,f.Y)(s.TitleSkeleton,{css:A}),(0,f.Y)("div",{css:Y,children:(0,f.Y)(s.TableSkeleton,{lines:4})})]})},w=({height:e,message:n})=>(0,f.Y)(b,{height:e,children:(0,f.Y)(r.T.Text,{color:"error",children:n||(0,f.Y)(a.A,{id:"cp/h86",defaultMessage:"Failed to load chart data"})})}),C=({height:e,message:n})=>(0,f.Y)("div",{css:(0,i.AH)({height:e||"100%",display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,f.Y)(r.T.Text,{color:"secondary",children:n||(0,f.Y)(a.A,{id:"zwktEP",defaultMessage:"No data available for the selected time range"})})});function M(e,n,t){const i=m.Ay.getExperimentPageTabRoute(e,g.fM.Traces),o=new URLSearchParams,{startTimeLabel:r,startTime:s,endTime:a}=null!==n&&void 0!==n?n:{};return r&&o.set("startTimeLabel",r),s&&o.set("startTime",s),a&&o.set("endTime",a),null===t||void 0===t||t.forEach(e=>o.append("filter",e)),`${i}?${o.toString()}`}function D(e,n,t,i){return M(e,{startTimeLabel:"CUSTOM",startTime:new Date(n).toISOString(),endTime:new Date(n+1e3*t).toISOString()},i)}function I(e){return[p.w8.ASSESSMENT,p.dD.IS_NOT_NULL,"",e].join("::")}function L(e,n){return[p.w8.ASSESSMENT,p.tl.EQUALS,n,e].join("::")}function R(e){return[p.Gq,p.tl.EQUALS,e].join("::")}function _(e){return[p.RC,p.tl.EQUALS,e].join("::")}function F({active:e,payload:n,label:t,formatter:s,linkConfig:l}){var c,m,g,p,h;const{theme:x}=(0,r.u)(),y=(0,d.Zp)(),{hideTooltipLinks:S,tooltipLinkUrlBuilder:b,tooltipLinkText:T}=null!==(c=(0,o.useContext)(u.J0))&&void 0!==c?c:{};if(!e||null===n||void 0===n||!n.length)return null;const A=null===(m=n[0])||void 0===m?void 0:m.payload,Y=void 0!==(null===l||void 0===l?void 0:l.onLinkClick),k=(null===l||void 0===l?void 0:l.experimentId)&&(null===l||void 0===l?void 0:l.timeIntervalSeconds)&&void 0!==(null===A||void 0===A?void 0:A.timestampMs),w=!S&&l&&(Y||k);return(0,f.FD)("div",{css:(0,i.AH)({backgroundColor:`${x.colors.backgroundPrimary}80`,backdropFilter:"blur(2px)",border:`1px solid ${x.colors.border}`,borderRadius:x.borders.borderRadiusMd,fontSize:x.typography.fontSizeSm,padding:x.spacing.sm,pointerEvents:"auto",marginLeft:-20,marginRight:-20},""),children:[t&&(0,f.Y)("div",{css:(0,i.AH)({fontWeight:500,marginBottom:x.spacing.xs},""),children:t}),(0,f.Y)("div",{css:(0,i.AH)({maxHeight:v,overflowY:"auto",overflowX:"hidden"},""),children:n.map((e,n)=>{const[t,o]=s(e.value,e.name);return(0,f.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:x.spacing.xs,paddingTop:x.spacing.xs,paddingBottom:x.spacing.xs},""),children:[(0,f.Y)("span",{css:(0,i.AH)({width:x.spacing.sm,height:x.spacing.sm,borderRadius:"50%",backgroundColor:e.color,flexShrink:0},"")}),(0,f.FD)("span",{css:(0,i.AH)({color:e.color},""),children:[o,":"]}),(0,f.Y)("span",{children:t})]},n)})}),w&&(0,f.Y)("div",{css:(0,i.AH)({borderTop:`1px solid ${x.colors.border}`,marginTop:x.spacing.xs,paddingTop:x.spacing.xs},""),children:(0,f.Y)(r.T.Link,{componentId:null!==(g=null===l||void 0===l?void 0:l.componentId)&&void 0!==g?g:"mlflow.overview.usage.traces.view_traces_link",onClick:()=>{if(Y)l.onLinkClick(t,A);else if(k){const e=b?b(l.experimentId,A.timestampMs,l.timeIntervalSeconds):D(l.experimentId,A.timestampMs,l.timeIntervalSeconds);y(e)}},css:(0,i.AH)({cursor:"pointer",display:"flex",alignItems:"center",gap:x.spacing.xs},""),children:null!==(p=null!==(h=null===l||void 0===l?void 0:l.linkText)&&void 0!==h?h:T)&&void 0!==p?p:(0,f.Y)(a.A,{id:"c+3yBY",defaultMessage:"View traces for this period"})})})]})}function z(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary,dy:e.spacing.sm},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}}function H(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary},axisLine:!1,tickLine:!1,width:40}}function E(e){var n;const{theme:t}=(0,r.u)();return{formatter:e=>(0,f.Y)("span",{css:(0,i.AH)({color:t.colors.textPrimary,fontSize:t.typography.fontSizeSm,cursor:"pointer"},""),children:e}),wrapperStyle:{maxHeight:null!==(n=null===e||void 0===e?void 0:e.maxHeight)&&void 0!==n?n:x,overflowY:"auto",overflowX:"hidden",paddingTop:t.spacing.xs}}}const O=({children:e,componentId:n,...t})=>{const{theme:s}=(0,r.u)(),a=function(e){const n=(0,o.useRef)((0,l.A)()),t=(0,o.useRef)(0),i=(0,c.R)();return{onClick:(0,o.useCallback)(()=>{if(!e)return;const o=Date.now();o-t.current<1e4||(t.current=o,i({componentId:e,componentViewId:n.current,componentType:r.f.Card,eventType:r.d.OnClick,value:"chart_interaction"}))},[e,i])}}(n);return(0,f.Y)("div",{css:(0,i.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusMd,padding:s.spacing.lg,backgroundColor:s.colors.backgroundPrimary},""),...a,...t,children:e})};function $(){const{theme:e}=(0,r.u)();return{strokeOpacity:.3,fill:e.colors.blue200,fillOpacity:.3}}},23327:function(e,n,t){t.d(n,{o:function(){return a}});var i=t(49708),o=t(61077),r=t(90935);const s="traceMetrics";function a({experimentIds:e,startTimeMs:n,endTimeMs:t,viewType:a,metricName:l,aggregations:c,timeIntervalSeconds:d,filters:u,dimensions:m,enabled:g=!0}){const p={experiment_ids:e,view_type:a,metric_name:l,aggregations:c,time_interval_seconds:d,start_time_ms:n,end_time_ms:t,filters:u,dimensions:m};return(0,i.I)({queryKey:[s,e,n,t,a,l,c,d,u,m],queryFn:async()=>await async function(e){return(0,o.qP)((0,o.we)("ajax-api/3.0/mlflow/traces/metrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).catch(r.J)}(p),enabled:e.length>0&&g,refetchOnWindowFocus:!1})}},33085:function(e,n,t){t.d(n,{TraceCostBreakdownChart:function(){return Y}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(56711),c=t(66774),d=t(37212),u=t(34610),m=t(1203),g=t(6581),p=t(16844),f=t(23327),h=t(69983);var v=t(41473),x=t(92287),y=t(3409),S=t(83110),b=t(73408);var T={name:"1f1m9i6",styles:"display:flex;justify-content:space-between;align-items:flex-start"},A={name:"ozd7xs",styles:"flex-shrink:0"};const Y=()=>{const{theme:e}=(0,r.u)(),{dimension:n,setDimension:t}=(0,v.q)(),{chartData:Y,totalCost:k,isLoading:w,error:C,hasData:M}=function(e="model"){const{experimentIds:n,startTimeMs:t,endTimeMs:i,filters:r}=(0,h.W0)(),s="model"===e?p.it.MODEL_NAME:p.it.MODEL_PROVIDER,{data:a,isLoading:l,error:c}=(0,f.o)({experimentIds:n,startTimeMs:t,endTimeMs:i,viewType:p.mW.SPANS,metricName:p.Ub.TOTAL_COST,aggregations:[{aggregation_type:p.DF.SUM}],dimensions:[s],filters:r}),d=(0,o.useMemo)(()=>(null===a||void 0===a?void 0:a.data_points)||[],[null===a||void 0===a?void 0:a.data_points]),{chartData:u,totalCost:m}=(0,o.useMemo)(()=>{const e=d.reduce((e,n)=>{var t;return e+((null===(t=n.values)||void 0===t?void 0:t[p.DF.SUM])||0)},0);return{chartData:d.map(n=>{var t,i;const o=(null===(t=n.values)||void 0===t?void 0:t[p.DF.SUM])||0;return{name:(null===(i=n.dimensions)||void 0===i?void 0:i[s])||"Unknown",value:o,percentage:e>0?o/e*100:0}}).filter(e=>e.value>0).sort((e,n)=>n.value-e.value),totalCost:e}},[d,s]);return{chartData:u,totalCost:m,isLoading:l,error:c,hasData:u.length>0}}(n),{getChartColor:D}=(0,S.yC)(),[I,L]=(0,o.useState)(void 0),{getOpacity:R,handleLegendMouseEnter:_,handleLegendMouseLeave:F}=(0,S.pH)(),z=(0,o.useMemo)(()=>(e=>n=>{const t=n,{cx:i,cy:o,innerRadius:r,outerRadius:s,startAngle:a,endAngle:c,fill:d,name:u,value:m,percentage:g}=t,{sx:f,sy:h,mx:v,my:x,ex:y,ey:T,textAnchor:A,cos:Y}=(0,S.II)(t,e);return(0,b.FD)("g",{children:[(0,b.Y)("text",{x:i,y:o,textAnchor:"middle",fill:e.colors.textPrimary,fontSize:e.typography.fontSizeSm,fontWeight:500,children:u}),(0,b.Y)(l.h,{cx:i,cy:o,innerRadius:r,outerRadius:s,startAngle:a,endAngle:c,fill:d}),(0,b.Y)(l.h,{cx:i,cy:o,startAngle:a,endAngle:c,innerRadius:s+e.spacing.xs,outerRadius:s+e.spacing.sm,fill:d}),(0,b.Y)("path",{d:`M${f},${h}L${v},${x}L${y},${T}`,stroke:d,fill:"none"}),(0,b.Y)("circle",{cx:y,cy:T,r:2,fill:d,stroke:"none"}),(0,b.Y)("text",{x:y+(Y>=0?1:-1)*e.spacing.xs,y:T,textAnchor:A,fill:e.colors.textSecondary,fontSize:e.typography.fontSizeSm,children:(0,p.lE)(m)}),(0,b.FD)("text",{x:y+(Y>=0?1:-1)*e.spacing.xs,y:T+e.spacing.md,textAnchor:A,fill:e.colors.textSecondary,fontSize:e.typography.fontSizeSm,children:[g.toFixed(2),"%"]})]})})(e),[e]),H=(0,o.useCallback)((e,n)=>{L(n)},[]),E=(0,o.useCallback)(()=>{L(void 0)},[]),O=(0,o.useCallback)(e=>{_(e);const n=Y.findIndex(n=>n.name===e.value);-1!==n&&L(n)},[_,Y]),$=(0,o.useCallback)(()=>{F(),L(void 0)},[F]),P=(0,o.useCallback)((n,t)=>{var o,r;const s=t;return(0,b.FD)("span",{css:(0,i.AH)({color:e.colors.textPrimary,fontSize:e.typography.fontSizeSm},""),children:[n,(0,b.FD)("span",{css:(0,i.AH)({color:e.colors.textSecondary,marginLeft:e.spacing.xs},""),children:[null===(o=s.payload)||void 0===o||null===(r=o.percentage)||void 0===r?void 0:r.toFixed(0),"%"]})]})},[e]);return w?(0,b.Y)(y.lh,{}):C?(0,b.Y)(y.nN,{}):(0,b.FD)(y.h,{componentId:"mlflow.charts.trace_cost_breakdown",children:[(0,b.FD)("div",{css:T,children:[(0,b.Y)(y.XQ,{icon:(0,b.Y)(s.PieChartIcon,{}),title:(0,b.Y)(a.A,{id:"PAUNgq",defaultMessage:"Cost Breakdown"}),value:(0,p.lE)(k),subtitle:(0,b.Y)(a.A,{id:"0iR7OV",defaultMessage:"Total Cost"})}),(0,b.Y)("div",{css:A,children:(0,b.Y)(x.g,{componentId:"mlflow.charts.trace_cost_breakdown.dimension",value:n,onChange:t})})]}),(0,b.Y)("div",{css:(0,i.AH)({height:y.tz,marginTop:e.spacing.sm},""),children:M?(0,b.Y)(c.u,{width:"100%",height:"100%",children:(0,b.FD)(d.r,{children:[(0,b.Y)(u.F,{data:Y,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,paddingAngle:2,dataKey:"value",nameKey:"name",activeIndex:I,activeShape:z,onMouseEnter:H,onMouseLeave:E,children:Y.map((e,n)=>(0,b.Y)(m.f,{fill:D(n),fillOpacity:R(e.name)},`cell-${n}`))}),(0,b.Y)(g.s,{layout:"vertical",align:"right",verticalAlign:"middle",formatter:P,onMouseEnter:O,onMouseLeave:$,wrapperStyle:{fontSize:e.typography.fontSizeSm,maxHeight:y.tz,overflowY:"auto"}})]})}):(0,b.Y)(y.iE,{message:(0,b.Y)(a.A,{id:"iRs4JD",defaultMessage:"No cost data available"})})})]})}},41473:function(e,n,t){t.d(n,{q:function(){return o}});var i=t(46709);function o(e="model"){const[n,t]=(0,i.useState)(e),o=(0,i.useCallback)(()=>{t(e=>"model"===e?"provider":"model")},[]);return{dimension:n,setDimension:t,toggleDimension:o}}},90935:function(e,n,t){t.d(n,{J:function(){return o}});var i=t(36476);async function o(e){if(e instanceof i.Un){var n;const t=await(null===(n=e.response)||void 0===n?void 0:n.json());e.message=null===t||void 0===t?void 0:t.message}throw e}},92287:function(e,n,t){t.d(n,{g:function(){return s}});t(46709);var i=t(82716),o=t(40724),r=t(73408);const s=({componentId:e,value:n,onChange:t})=>(0,r.FD)(i.SegmentedControlGroup,{name:`${e}-dimension`,componentId:e,value:n,onChange:({target:{value:e}})=>t(e),children:[(0,r.Y)(i.SegmentedControlButton,{value:"model",children:(0,r.Y)(o.A,{id:"AQh8lf",defaultMessage:"Model"})}),(0,r.Y)(i.SegmentedControlButton,{value:"provider",children:(0,r.Y)(o.A,{id:"L71uzj",defaultMessage:"Provider"})})]})}}]);