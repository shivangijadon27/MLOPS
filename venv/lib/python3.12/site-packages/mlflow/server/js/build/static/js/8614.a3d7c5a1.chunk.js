"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[8614],{3409:function(e,n,t){t.d(n,{tz:function(){return f},h:function(){return O},iE:function(){return A},nN:function(){return Y},XQ:function(){return y},lh:function(){return M},Vn:function(){return z},OM:function(){return L},t4:function(){return D},dC:function(){return R},WW:function(){return _},Id:function(){return I},R3:function(){return C},zZ:function(){return H},IT:function(){return E},T4:function(){return N},gy:function(){return F}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(70431),c=t(80739);var d=t(91105),u=t(69983),m=t(60284),p=t(44105),g=t(15756),h=t(73408);const f=200,v=120,x=60;var T={name:"lugakg",styles:"font-weight:normal"};const y=({icon:e,title:n,value:t,subtitle:o})=>{const{theme:s}=(0,r.u)();return(0,h.FD)("div",{css:(0,i.AH)({marginBottom:s.spacing.lg},""),children:[(0,h.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,h.Y)("span",{css:(0,i.AH)({color:s.colors.textSecondary,display:"flex"},""),children:e}),(0,h.Y)(r.T.Text,{bold:!0,size:"lg",children:n})]}),void 0!==t&&(0,h.FD)(r.T.Title,{level:3,css:(0,i.AH)({margin:0,marginTop:s.spacing.sm},""),children:[t,o&&(0,h.FD)(h.FK,{children:[" ",(0,h.Y)(r.T.Text,{color:"secondary",css:T,children:o})]})]})]})},S=({children:e,height:n=280})=>{const{theme:t}=(0,r.u)();return(0,h.Y)("div",{css:(0,i.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.lg,height:n,display:"flex",alignItems:"center",justifyContent:"center"},""),children:e})};var b={name:"1u1zie3",styles:"width:120px"},w={name:"m0jwvv",styles:"width:80px"},k={name:"82a6rk",styles:"flex:1"};const M=({height:e=280})=>{const{theme:n}=(0,r.u)();return(0,h.FD)("div",{css:(0,i.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,padding:n.spacing.lg,height:e,display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,h.Y)(s.TitleSkeleton,{css:b}),(0,h.Y)(s.TitleSkeleton,{css:w}),(0,h.Y)("div",{css:k,children:(0,h.Y)(s.TableSkeleton,{lines:4})})]})},Y=({height:e,message:n})=>(0,h.Y)(S,{height:e,children:(0,h.Y)(r.T.Text,{color:"error",children:n||(0,h.Y)(a.A,{id:"cp/h86",defaultMessage:"Failed to load chart data"})})}),A=({height:e,message:n})=>(0,h.Y)("div",{css:(0,i.AH)({height:e||"100%",display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,h.Y)(r.T.Text,{color:"secondary",children:n||(0,h.Y)(a.A,{id:"zwktEP",defaultMessage:"No data available for the selected time range"})})});function C(e,n,t){const i=m.Ay.getExperimentPageTabRoute(e,p.fM.Traces),o=new URLSearchParams,{startTimeLabel:r,startTime:s,endTime:a}=null!==n&&void 0!==n?n:{};return r&&o.set("startTimeLabel",r),s&&o.set("startTime",s),a&&o.set("endTime",a),null===t||void 0===t||t.forEach(e=>o.append("filter",e)),`${i}?${o.toString()}`}function I(e,n,t,i){return C(e,{startTimeLabel:"CUSTOM",startTime:new Date(n).toISOString(),endTime:new Date(n+1e3*t).toISOString()},i)}function D(e){return[g.w8.ASSESSMENT,g.dD.IS_NOT_NULL,"",e].join("::")}function L(e,n){return[g.w8.ASSESSMENT,g.tl.EQUALS,n,e].join("::")}function R(e){return[g.Gq,g.tl.EQUALS,e].join("::")}function _(e){return[g.RC,g.tl.EQUALS,e].join("::")}function z({active:e,payload:n,label:t,formatter:s,linkConfig:l}){var c,m,p,g,f;const{theme:x}=(0,r.u)(),T=(0,d.Zp)(),{hideTooltipLinks:y,tooltipLinkUrlBuilder:S,tooltipLinkText:b}=null!==(c=(0,o.useContext)(u.J0))&&void 0!==c?c:{};if(!e||null===n||void 0===n||!n.length)return null;const w=null===(m=n[0])||void 0===m?void 0:m.payload,k=void 0!==(null===l||void 0===l?void 0:l.onLinkClick),M=(null===l||void 0===l?void 0:l.experimentId)&&(null===l||void 0===l?void 0:l.timeIntervalSeconds)&&void 0!==(null===w||void 0===w?void 0:w.timestampMs),Y=!y&&l&&(k||M);return(0,h.FD)("div",{css:(0,i.AH)({backgroundColor:`${x.colors.backgroundPrimary}80`,backdropFilter:"blur(2px)",border:`1px solid ${x.colors.border}`,borderRadius:x.borders.borderRadiusMd,fontSize:x.typography.fontSizeSm,padding:x.spacing.sm,pointerEvents:"auto",marginLeft:-20,marginRight:-20},""),children:[t&&(0,h.Y)("div",{css:(0,i.AH)({fontWeight:500,marginBottom:x.spacing.xs},""),children:t}),(0,h.Y)("div",{css:(0,i.AH)({maxHeight:v,overflowY:"auto",overflowX:"hidden"},""),children:n.map((e,n)=>{const[t,o]=s(e.value,e.name);return(0,h.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:x.spacing.xs,paddingTop:x.spacing.xs,paddingBottom:x.spacing.xs},""),children:[(0,h.Y)("span",{css:(0,i.AH)({width:x.spacing.sm,height:x.spacing.sm,borderRadius:"50%",backgroundColor:e.color,flexShrink:0},"")}),(0,h.FD)("span",{css:(0,i.AH)({color:e.color},""),children:[o,":"]}),(0,h.Y)("span",{children:t})]},n)})}),Y&&(0,h.Y)("div",{css:(0,i.AH)({borderTop:`1px solid ${x.colors.border}`,marginTop:x.spacing.xs,paddingTop:x.spacing.xs},""),children:(0,h.Y)(r.T.Link,{componentId:null!==(p=null===l||void 0===l?void 0:l.componentId)&&void 0!==p?p:"mlflow.overview.usage.traces.view_traces_link",onClick:()=>{if(k)l.onLinkClick(t,w);else if(M){const e=S?S(l.experimentId,w.timestampMs,l.timeIntervalSeconds):I(l.experimentId,w.timestampMs,l.timeIntervalSeconds);T(e)}},css:(0,i.AH)({cursor:"pointer",display:"flex",alignItems:"center",gap:x.spacing.xs},""),children:null!==(g=null!==(f=null===l||void 0===l?void 0:l.linkText)&&void 0!==f?f:b)&&void 0!==g?g:(0,h.Y)(a.A,{id:"c+3yBY",defaultMessage:"View traces for this period"})})})]})}function H(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary,dy:e.spacing.sm},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}}function E(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary},axisLine:!1,tickLine:!1,width:40}}function F(e){var n;const{theme:t}=(0,r.u)();return{formatter:e=>(0,h.Y)("span",{css:(0,i.AH)({color:t.colors.textPrimary,fontSize:t.typography.fontSizeSm,cursor:"pointer"},""),children:e}),wrapperStyle:{maxHeight:null!==(n=null===e||void 0===e?void 0:e.maxHeight)&&void 0!==n?n:x,overflowY:"auto",overflowX:"hidden",paddingTop:t.spacing.xs}}}const O=({children:e,componentId:n,...t})=>{const{theme:s}=(0,r.u)(),a=function(e){const n=(0,o.useRef)((0,l.A)()),t=(0,o.useRef)(0),i=(0,c.R)();return{onClick:(0,o.useCallback)(()=>{if(!e)return;const o=Date.now();o-t.current<1e4||(t.current=o,i({componentId:e,componentViewId:n.current,componentType:r.f.Card,eventType:r.d.OnClick,value:"chart_interaction"}))},[e,i])}}(n);return(0,h.Y)("div",{css:(0,i.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusMd,padding:s.spacing.lg,backgroundColor:s.colors.backgroundPrimary},""),...a,...t,children:e})};function N(){const{theme:e}=(0,r.u)();return{strokeOpacity:.3,fill:e.colors.blue200,fillOpacity:.3}}},23327:function(e,n,t){t.d(n,{o:function(){return a}});var i=t(49708),o=t(61077),r=t(90935);const s="traceMetrics";function a({experimentIds:e,startTimeMs:n,endTimeMs:t,viewType:a,metricName:l,aggregations:c,timeIntervalSeconds:d,filters:u,dimensions:m,enabled:p=!0}){const g={experiment_ids:e,view_type:a,metric_name:l,aggregations:c,time_interval_seconds:d,start_time_ms:n,end_time_ms:t,filters:u,dimensions:m};return(0,i.I)({queryKey:[s,e,n,t,a,l,c,d,u,m],queryFn:async()=>await async function(e){return(0,o.qP)((0,o.we)("ajax-api/3.0/mlflow/traces/metrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).catch(r.J)}(g),enabled:e.length>0&&p,refetchOnWindowFocus:!1})}},39833:function(e,n,t){t.d(n,{E:function(){return l}});var i=t(90970),o=t(13240),r=t(60719),s=t(49960),a=t(44941),l=(0,i.gu)({chartName:"BarChart",GraphicalChild:o.y,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:r.W},{axisType:"yAxis",AxisComp:s.h}],formatAxisMap:a.pr})},48614:function(e,n,t){t.d(n,{TraceRequestsChart:function(){return w}});var i=t(68248),o=t(46709),r=t(27757),s=t(82716),a=t(40724),l=t(66774),c=t(39833),d=t(60719),u=t(49960),m=t(858),p=t(13240),g=t(97245),h=t(52434),f=t(16844),v=t(23327),x=t(83110),T=t(69983);var y=t(3409),S=t(73408);var b={name:"1f1m9i6",styles:"display:flex;justify-content:space-between;align-items:flex-start"};const w=({title:e})=>{const{theme:n}=(0,r.u)(),t=(0,y.zZ)(),w=(0,y.IT)(),k=(0,y.T4)(),{experimentIds:M,timeIntervalSeconds:Y}=(0,T.W0)(),{totalRequests:A,avgRequests:C,isLoading:I,error:D,hasData:L,zoom:R}=function(){const{experimentIds:e,startTimeMs:n,endTimeMs:t,timeIntervalSeconds:i,timeBuckets:r,filters:s}=(0,T.W0)(),{data:a,isLoading:l,error:c}=(0,v.o)({experimentIds:e,startTimeMs:n,endTimeMs:t,viewType:f.mW.TRACES,metricName:f.po.TRACE_COUNT,aggregations:[{aggregation_type:f.DF.COUNT}],timeIntervalSeconds:i,filters:s}),d=(0,o.useMemo)(()=>(null===a||void 0===a?void 0:a.data_points)||[],[null===a||void 0===a?void 0:a.data_points]),u=(0,o.useMemo)(()=>d.reduce((e,n)=>{var t;return e+((null===(t=n.values)||void 0===t?void 0:t[f.DF.COUNT])||0)},0),[d]),m=(0,o.useMemo)(()=>u/r.length,[u,r.length]),p=(0,o.useCallback)(e=>{var n;return(null===(n=e.values)||void 0===n?void 0:n[f.DF.COUNT])||0},[]),g=(0,x.NM)(d,p),h=(0,o.useMemo)(()=>r.map(e=>({name:(0,x.fq)(e,i),count:g.get(e)||0,timestampMs:e})),[r,g,i]),y=(0,x.RZ)(h,"name"),S=(0,o.useMemo)(()=>y.isZoomed?0===y.zoomedData.length?0:y.zoomedData.reduce((e,n)=>e+n.count,0)/y.zoomedData.length:m,[y.isZoomed,y.zoomedData,m]);return{chartData:h,totalRequests:u,avgRequests:S,isLoading:l,error:c,hasData:d.length>0,zoom:y}}(),{zoomedData:_,isZoomed:z,refAreaLeft:H,refAreaRight:E,handleMouseDown:F,handleMouseMove:O,handleMouseUp:N,zoomOut:U}=R,q=(0,o.useCallback)(e=>[`${e}`,"Requests"],[]),j=(0,o.useMemo)(()=>(0,S.Y)(y.Vn,{formatter:q,linkConfig:{experimentId:M[0],timeIntervalSeconds:Y,componentId:"mlflow.overview.usage.traces.view_traces_link"}}),[M,Y,q]);return I?(0,S.Y)(y.lh,{}):D?(0,S.Y)(y.nN,{}):(0,S.FD)(y.h,{componentId:"mlflow.charts.trace_requests",children:[(0,S.FD)("div",{css:b,children:[(0,S.Y)(y.XQ,{icon:(0,S.Y)(s.ChartLineIcon,{}),title:null!==e&&void 0!==e?e:(0,S.Y)(a.A,{id:"KE/zZf",defaultMessage:"Traces"}),value:A.toLocaleString()}),z&&(0,S.Y)(r.B,{componentId:"mlflow.charts.trace_requests.zoom_out",size:"small",onClick:U,children:(0,S.Y)(a.A,{id:"FcddG+",defaultMessage:"Zoom Out"})})]}),(0,S.Y)("div",{css:(0,i.AH)({height:y.tz,userSelect:"none"},""),children:L?(0,S.Y)(l.u,{width:"100%",height:"100%",children:(0,S.FD)(c.E,{data:_,margin:{top:10,right:20,left:10,bottom:0},onMouseDown:F,onMouseMove:O,onMouseUp:N,onMouseLeave:N,children:[(0,S.Y)(d.W,{dataKey:"name",...t}),(0,S.Y)(u.h,{...w}),(0,S.Y)(m.m,{content:j,cursor:{fill:n.colors.actionTertiaryBackgroundHover}}),(0,S.Y)(p.y,{dataKey:"count",fill:n.colors.blue400,radius:[4,4,0,0]}),C>0&&(0,S.Y)(g.e,{y:C,stroke:n.colors.textSecondary,strokeDasharray:"4 4",label:{value:`AVG (${Math.round(C).toLocaleString()})`,position:"insideTopRight",fill:n.colors.textSecondary,fontSize:10}}),H&&E&&(0,S.Y)(h.T,{x1:H,x2:E,...k})]})}):(0,S.Y)(y.iE,{})})]})}},90935:function(e,n,t){t.d(n,{J:function(){return o}});var i=t(36476);async function o(e){if(e instanceof i.Un){var n;const t=await(null===(n=e.response)||void 0===n?void 0:n.json());e.message=null===t||void 0===t?void 0:t.message}throw e}}}]);