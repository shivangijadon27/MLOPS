"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1117],{3469:function(e,o,s){s.d(o,{t:function(){return y}});var i=s(68248),n=s(76118),t=s(46709),r=s(82716),l=s(27757),a=s(79081),d=s(93083),c=s(7655),p=s(40724),m=s(73408);var u={name:"1d3w5wq",styles:"width:100%"},g={name:"s079uh",styles:"margin-top:2px"},v={name:"82a6rk",styles:"flex:1"},h={name:"82a6rk",styles:"flex:1"};const f=({renderKey:e,setDraftAliases:o,existingAliases:s,draftAliases:n,version:a,aliasToVersionMap:f,disabled:Y})=>{const y=(0,c.A)(),[w,M]=(0,t.useState)(!1),{theme:A}=(0,l.u)(),x=(0,t.useCallback)(e=>{o(o=>o.filter(o=>o!==e))},[o]),b=(0,t.useCallback)(e=>{const s=e.map(e=>e.replace(/[^\w-]/g,"").toLowerCase().substring(0,255)).filter(e=>e.length>0),i=Array.from(new Set(s));o(i),M(!1)},[o]);return(0,m.FD)(r.LegacySelect,{disabled:Y,filterOption:(e,o)=>null===o||void 0===o?void 0:o.value.toLowerCase().startsWith(e.toLowerCase()),placeholder:y.formatMessage({id:"bQZDSv",defaultMessage:"Enter aliases (champion, challenger, etc)"}),allowClear:!0,css:u,mode:"tags",onChange:b,dangerouslySetAntdProps:{dropdownMatchSelectWidth:!0,tagRender:({value:e})=>(0,m.Y)(d.Z,{compact:!0,css:g,closable:!0,onClose:()=>x(e.toString()),value:e.toString()})},onDropdownVisibleChange:M,open:w,value:n||[],children:[s.map(e=>(0,m.Y)(r.LegacySelect.Option,{value:e,"data-testid":"model-alias-option",children:(0,m.FD)("div",{css:(0,i.AH)({display:"flex",marginRight:A.spacing.xs},""),children:[(0,m.Y)("div",{css:v,children:e}),(0,m.Y)("div",{children:(0,m.Y)(p.A,{id:"4OcdLd",defaultMessage:"This version"})})]},e)},e)),Object.entries(f).filter(([,e])=>e!==a).map(([e,o])=>(0,m.Y)(r.LegacySelect.Option,{value:e,"data-testid":"model-alias-option",children:(0,m.FD)("div",{css:(0,i.AH)({display:"flex",marginRight:A.spacing.xs},""),children:[(0,m.Y)("div",{css:h,children:e}),(0,m.Y)("div",{children:(0,m.Y)(p.A,{id:"Boj6Fm",defaultMessage:"Version {version}",values:{version:o}})})]},e)},e))]},JSON.stringify(e))};var Y=s(77153);const y=({aliases:e,onSuccess:o,onSave:s,getTitle:d,description:c})=>{const[u,g]=(0,t.useState)(!1),[v,h]=(0,t.useState)(!1),[y]=r.LegacyForm.useForm(),[w,M]=(0,t.useState)(""),{theme:A}=(0,l.u)(),[x,b]=(0,t.useState)([]),[S,D]=(0,t.useState)([]),[k,C]=(0,t.useState)("0"),T=(0,t.useCallback)(o=>{const s=e.filter(({version:e})=>e===o).map(({alias:e})=>e)||[];o&&(b(s),D(s),C(o),h(!0))},[e]),V=(0,t.useMemo)(()=>{const o=e.reduce((e,o)=>{var s;return e.some(({version:e})=>e===o.version)?(null===(s=e.find(({version:e})=>e===o.version))||void 0===s||s.aliases.push(o.alias),e):[...e,{version:o.version,aliases:[o.alias]}]},[]).filter(({version:e})=>e!==k);return S.map(e=>({alias:e,otherVersion:o.find(o=>{var s;return null===(s=o.aliases)||void 0===s?void 0:s.find(o=>o===e)})})).filter(({otherVersion:e})=>e)},[e,S,k]),I=(0,t.useMemo)(()=>e.reduce((e,{alias:o,version:s})=>({...e,[o]:s}),{})||{},[e]),E=(0,n.isEqual)(x.slice().sort(),S.slice().sort()),P=S.length>10,F=E||P;return{EditAliasesModal:(0,m.FD)(a.d,{componentId:"mlflow.edit-aliases-modal",visible:v,footer:(0,m.FD)("div",{children:[(0,m.Y)(l.B,{componentId:"mlflow.edit-aliases-modal.cancel-button",onClick:()=>h(!1),children:(0,m.Y)(p.A,{id:"3yuDKB",defaultMessage:"Cancel"})}),(0,m.Y)(l.B,{componentId:"mlflow.edit-aliases-modal.save-button",loading:u,type:"primary",disabled:F,onClick:()=>{M(""),g(!0),s(k,x,S).then(()=>{g(!1),h(!1),null===o||void 0===o||o()}).catch(e=>{if(g(!1),e instanceof Y.s){const o=e.getMessageField()||e.getUserVisibleError().toString()||e.text;M(o)}else M(e.message)})},children:(0,m.Y)(p.A,{id:"j4vtTO",defaultMessage:"Save aliases"})})]}),destroyOnClose:!0,title:d(k),onCancel:()=>h(!1),confirmLoading:!1,children:[(0,m.Y)(l.T.Paragraph,{children:c}),(0,m.FD)(r.LegacyForm,{form:y,layout:"vertical",children:[(0,m.Y)(r.LegacyForm.Item,{children:(0,m.Y)(f,{disabled:!1,renderKey:V,aliasToVersionMap:I,version:k,draftAliases:S,existingAliases:x,setDraftAliases:D})}),(0,m.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:A.spacing.xs},""),children:[P&&(0,m.Y)(r.Alert,{componentId:"mlflow.edit-aliases-modal.exceeding-limit-alert",role:"alert",message:(0,m.Y)(p.A,{id:"rzIPYc",defaultMessage:"You are exceeding a limit of {limit} aliases assigned to the single model version",values:{limit:10}}),type:"error",closable:!1}),V.map(({alias:e,otherVersion:o})=>(0,m.Y)(r.Alert,{componentId:"mlflow.edit-aliases-modal.conflicted-alias-alert",role:"alert",message:(0,m.Y)(p.A,{id:"CUKIO0",defaultMessage:'The "{alias}" alias is also being used on version {otherVersion}. Adding it to this version will remove it from version {otherVersion}.',values:{otherVersion:null===o||void 0===o?void 0:o.version,alias:e}}),type:"info",closable:!1},e)),w&&(0,m.Y)(r.Alert,{componentId:"mlflow.edit-aliases-modal.error-alert",role:"alert",message:w,type:"error",closable:!1})]})]})]}),showEditAliasesModal:T}}},37626:function(e,o,s){s.d(o,{_:function(){return r}});var i=s(46709),n=s(91105);const t="viewState",r=()=>{var e;const[o,s]=(0,n.ok)(),r=null!==(e=o.get(t))&&void 0!==e?e:"logs",l=(0,i.useCallback)((e,o=!1)=>{s(o=>void 0===e?(o.delete(t),o):(o.set(t,e),o),{replace:o})},[s]);return[r,l]}},41117:function(e,o,s){s.r(o),s.d(o,{default:function(){return Ge}});var i=s(68248),n=s(59930),t=s.n(n),r=s(56530),l=s(49708),a=s(59795);const d=async({queryKey:e})=>{var o;const[,{promptName:s}]=e,[i,n]=await Promise.all([a.M.getPromptDetails(s),a.M.getPromptVersions(s)]);return{prompt:i.registered_model,versions:null!==(o=n.model_versions)&&void 0!==o?o:[]}};var c=s(91105),p=s(60312),m=s(27757),u=s(82716),g=s(79081),v=s(40724),h=s(6050),f=s(46709),Y=s(60284),y=s(60527),w=s(61060),M=s(73408);var A=s(76256),x=s(90061),b=s(43617),S=s(7655),D=s(11522),k=s(52471);const C=({row:{original:e},table:{options:{meta:o}}})=>{const{theme:s}=(0,m.u)(),n=(0,S.A)(),{aliasesByVersion:t,showEditAliasesModal:r,registeredPrompt:l}=o,a=t[e.version]||[];return(0,M.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:[(0,M.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:s.spacing.sm,flexWrap:"wrap"},""),children:[(0,M.FD)(m.T.Text,{bold:!0,children:["Version ",e.version]}),l&&(0,M.Y)(k.Y,{modelName:l.name,version:e.version,aliases:a,onAddEdit:()=>{null===r||void 0===r||r(e.version)}})]}),(0,M.Y)(m.T.Text,{size:"sm",color:"secondary",children:D.A.formatTimestamp(e.creation_timestamp,n)})]})},T=({isSelectedFirstToCompare:e,isSelectedSecondToCompare:o,onSelectFirst:s,onSelectSecond:n})=>{const{theme:t}=(0,m.u)(),r=(0,S.A)();return(0,M.Y)("div",{css:(0,i.AH)({width:t.general.buttonHeight,display:"flex",alignItems:"center",paddingRight:t.spacing.sm},""),children:(0,M.FD)("div",{css:(0,i.AH)({display:"flex",height:t.general.buttonInnerHeight+t.spacing.xs,gap:0,flex:1},""),children:[(0,M.Y)(g.T,{componentId:"mlflow.prompts.details.select_baseline.tooltip",content:(0,M.Y)(v.A,{id:"KV3BXl",defaultMessage:"Select as baseline version"}),delayDuration:0,side:"left",children:(0,M.Y)("button",{onClick:s,role:"radio","aria-checked":e,"aria-label":r.formatMessage({id:"KV3BXl",defaultMessage:"Select as baseline version"}),css:(0,i.AH)({flex:1,border:`1px solid ${e?t.colors.actionDefaultBorderFocus:t.colors.actionDefaultBorderDefault}`,borderRight:0,marginLeft:1,borderTopLeftRadius:t.borders.borderRadiusMd,borderBottomLeftRadius:t.borders.borderRadiusMd,backgroundColor:e?t.colors.actionDefaultBackgroundPress:t.colors.actionDefaultBackgroundDefault,cursor:"pointer","&:hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},"")})}),(0,M.Y)(g.T,{componentId:"mlflow.prompts.details.select_compared.tooltip",content:(0,M.Y)(v.A,{id:"9IN1I8",defaultMessage:"Select as compared version"}),delayDuration:0,side:"right",children:(0,M.Y)("button",{onClick:n,role:"radio","aria-checked":o,"aria-label":r.formatMessage({id:"9IN1I8",defaultMessage:"Select as compared version"}),css:(0,i.AH)({flex:1,border:`1px solid ${o?t.colors.actionDefaultBorderFocus:t.colors.actionDefaultBorderDefault}`,borderLeft:`1px solid ${e||o?t.colors.actionDefaultBorderFocus:t.colors.actionDefaultBorderDefault}`,borderTopRightRadius:t.borders.borderRadiusMd,borderBottomRightRadius:t.borders.borderRadiusMd,backgroundColor:o?t.colors.actionDefaultBackgroundPress:t.colors.actionDefaultBackgroundDefault,cursor:"pointer","&:hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},"")})})]})})};var V={name:"inxa61",styles:"flex:1;overflow:hidden"},I={name:"1h3rtzg",styles:"align-items:center"};const E=({promptVersions:e,onUpdateComparedVersion:o,isLoading:s,onUpdateSelectedVersion:n,comparedVersion:t,selectedVersion:r,mode:l,registeredPrompt:a,showEditAliasesModal:d,aliasesByVersion:c})=>{const p=(0,S.A)(),{theme:g}=(0,m.u)(),Y=(0,f.useMemo)(()=>[{id:"version",header:p.formatMessage({id:"Vn+uJi",defaultMessage:"Version"}),accessorKey:"version",cell:C}],[p]),y=(0,A.L)("mlflow/server/js/src/experiment-tracking/pages/prompts/components/PromptVersionsTable.tsx",{data:null!==e&&void 0!==e?e:[],getRowId:e=>e.version,columns:Y,getCoreRowModel:(0,x.HT)(),meta:{showEditAliasesModal:d,aliasesByVersion:c,registeredPrompt:a}});return(0,M.Y)("div",{css:V,children:(0,M.FD)(u.Table,{scrollable:!0,empty:s||0!==(null===e||void 0===e?void 0:e.length)?null:(0,M.Y)(u.Empty,{title:(0,M.Y)(v.A,{id:"9pJlQd",defaultMessage:"No prompt versions created"}),description:(0,M.Y)(v.A,{id:"7zgX/l",defaultMessage:'Use "Create prompt version" button in order to create a new prompt version'})}),"aria-label":"Prompt versions table",children:[(0,M.Y)(u.TableRow,{isHeader:!0,children:y.getLeafHeaders().map(e=>(0,M.Y)(u.TableHeader,{componentId:"mlflow.prompts.versions.table.header",children:(0,b.Kv)(e.column.columnDef.header,e.getContext())},e.id))}),s?(0,M.Y)(u.TableSkeletonRows,{table:y}):y.getRowModel().rows.map(e=>{const s=[h.Dp.PREVIEW,h.Dp.TRACES].includes(l)&&r===e.original.version,a=[h.Dp.COMPARE].includes(l)&&r===e.original.version,d=[h.Dp.COMPARE].includes(l)&&t===e.original.version,c=l===h.Dp.PREVIEW||l===h.Dp.TRACES;return(0,M.FD)(u.TableRow,{css:(0,i.AH)({backgroundColor:s?g.colors.actionDefaultBackgroundPress:a||d?g.colors.actionDefaultBackgroundHover:"transparent",cursor:c?"pointer":"default"},""),onClick:()=>{l!==h.Dp.PREVIEW&&l!==h.Dp.TRACES||n(e.original.version)},children:[e.getAllCells().map(e=>(0,M.Y)(u.TableCell,{css:I,children:(0,b.Kv)(e.column.columnDef.cell,e.getContext())},e.id)),s&&(0,M.Y)("div",{css:(0,i.AH)({width:2*g.spacing.md,display:"flex",alignItems:"center",paddingRight:g.spacing.sm},""),children:(0,M.Y)(m.o,{})}),l===h.Dp.COMPARE&&(0,M.Y)(T,{onSelectFirst:()=>n(e.original.version),onSelectSecond:()=>o(e.original.version),isSelectedFirstToCompare:a,isSelectedSecondToCompare:d})]},e.id)})]})})};var P=s(3469),F=s(76118);const R=(e,o)=>"switchSides"===o.type?{...e,selectedVersion:e.comparedVersion,comparedVersion:e.selectedVersion}:"setPreviewMode"===o.type?{...e,mode:h.Dp.PREVIEW,selectedVersion:o.selectedVersion}:"setCompareMode"===o.type?{...e,mode:h.Dp.COMPARE,selectedVersion:o.selectedVersion,comparedVersion:o.comparedVersion}:"setTracesMode"===o.type?{...e,mode:h.Dp.TRACES,selectedVersion:o.selectedVersion}:"setSelectedVersion"===o.type?{...e,selectedVersion:o.selectedVersion}:"setComparedVersion"===o.type?{...e,comparedVersion:o.comparedVersion}:e;var _=s(60062),B=s(82e3),H=s(12803);var L={name:"1pzk433",styles:"width:100px"};const N=({isLoadingRuns:e,runIds:o,runInfoMap:s})=>{const[i,n]=(0,f.useState)(!1),{theme:t}=(0,m.u)(),r=i?o.length:Math.min(3,o.length||0),l=o.length>3;return(0,M.FD)(M.FK,{children:[(0,M.Y)(m.T.Text,{bold:!0,children:(0,M.Y)(v.A,{id:"9ZHB3D",defaultMessage:"MLflow runs:"})}),(0,M.Y)("div",{children:e?(0,M.Y)(u.ParagraphSkeleton,{css:L}):(0,M.Y)(M.FK,{children:(0,M.FD)("div",{style:{display:"flex",flexWrap:"wrap",gap:t.spacing.sm},children:[o.slice(0,r).map((e,o)=>{const i=s[e];if(!(0,F.isNil)(null===i||void 0===i?void 0:i.experimentId)&&null!==i&&void 0!==i&&i.runUuid&&null!==i&&void 0!==i&&i.runName){const{experimentId:e,runUuid:s,runName:n}=i;return(0,M.FD)(m.T.Text,{children:[(0,M.Y)(c.N_,{to:Y.Ay.getRunPageRoute(e,s),children:n}),o<r-1&&","]})}return(0,M.Y)("span",{children:(null===i||void 0===i?void 0:i.runName)||(null===i||void 0===i?void 0:i.runUuid)})}),l&&(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.runs.show_more",size:"small",type:"link",onClick:()=>n(!i),children:i?(0,M.Y)(v.A,{id:"pVF+2s",defaultMessage:"Show less"}):(0,M.Y)(v.A,{id:"fh6RWb",defaultMessage:"{count} more...",values:{count:o.length-r}})})]})})})]})};var z=s(181),O=s(59281);var K={name:"ti75j2",styles:"margin:0"};const j=({tags:e,onEditVersionMetadata:o})=>{const[s,i]=(0,f.useState)(!1),{theme:n}=(0,m.u)(),t=s?e.length:Math.min(3,e.length||0),r=e.length>3,l=!(0,F.isNil)(o),a=e.length>0?(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.version.edit_tags",size:"small",icon:(0,M.Y)(u.PencilIcon,{}),onClick:o}):(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.version.add_tags",size:"small",type:"link",onClick:o,children:(0,M.Y)(v.A,{id:"JGQ5B2",defaultMessage:"Add"})});return(0,M.FD)(M.FK,{children:[(0,M.Y)(m.T.Text,{bold:!0,children:(0,M.Y)(v.A,{id:"GgPNAZ",defaultMessage:"Metadata:"})}),(0,M.Y)("div",{children:(0,M.Y)(M.FK,{children:(0,M.FD)("div",{style:{display:"flex",flexWrap:"wrap",gap:n.spacing.xs},children:[e.slice(0,t).map(e=>(0,M.Y)(O.t,{css:K,tag:e},e.key)),l&&a,!l&&0===e.length&&(0,M.Y)(m.T.Hint,{children:"\u2014"}),r&&(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.version.tags.show_more",size:"small",type:"link",onClick:()=>i(!s),children:s?(0,M.Y)(v.A,{id:"pVF+2s",defaultMessage:"Show less"}):(0,M.Y)(v.A,{id:"fh6RWb",defaultMessage:"{count} more...",values:{count:e.length-t}})})]})})})]})};var W={name:"wjlmq0",styles:"max-width:none"};const U=({registeredPromptVersion:e,registeredPrompt:o,showEditAliasesModal:s,onEditVersion:n,showEditPromptVersionMetadataModal:t,showEditModelConfigModal:r,aliasesByVersion:l,isBaseline:a})=>{var d;const{theme:c}=(0,m.u)(),p=(0,f.useMemo)(()=>{var o,s;const i=null===e||void 0===e||null===(o=e.tags)||void 0===o||null===(s=o.find(e=>e.key===h.xd))||void 0===s?void 0:s.value;return i?i.split(",").map(e=>e.trim()):[]},[e]),{isLoading:g,runInfoMap:Y}=((e=[])=>{const o=(0,_.E)({queries:e.map(e=>({queryKey:["prompt_associated_runs",e],queryFn:async({queryKey:[,e]})=>{try{const o=await H.x.getRun({run_id:e});return(0,B.LJ)(o)}catch(o){return null}}}))}),s={};return o.forEach((o,i)=>{var n,t;const r=e[i];s[r]=null===(n=o.data)||void 0===n||null===(t=n.run)||void 0===t?void 0:t.info}),{isLoading:e.length>0&&o.some(e=>e.isLoading),runInfoMap:s}})(p||[]);if(!o||!e)return null;const y=(null===e||void 0===e||null===(d=e.tags)||void 0===d?void 0:d.filter(e=>(0,z.oD)(e.key)))||[],w=(0,M.Y)(v.A,{id:"loe2Ov",defaultMessage:"Version {version}",values:{version:e.version}}),A=t?()=>{t(e)}:void 0;return(0,M.FD)("div",{css:(0,i.AH)({display:"grid",gridTemplateColumns:"120px 1fr",gridAutoRows:`minmax(${c.typography.lineHeightLg}, auto)`,alignItems:"flex-start",rowGap:c.spacing.xs,columnGap:c.spacing.sm},""),children:[n&&(0,M.FD)(M.FK,{children:[(0,M.Y)(m.T.Text,{bold:!0,children:"Version:"}),(0,M.FD)(m.T.Text,{children:[(0,M.Y)(m.T.Link,{componentId:"mlflow.prompts.details.version.goto",onClick:()=>n(e),children:w})," ",a&&(0,M.Y)(v.A,{id:"FTx+Hi",defaultMessage:"(baseline)"})]})]}),(0,M.Y)(m.T.Text,{bold:!0,children:(0,M.Y)(v.A,{id:"wFvyI1",defaultMessage:"Registered at:"})}),(0,M.Y)(m.T.Text,{children:D.A.formatTimestamp(e.creation_timestamp)}),(0,M.Y)(m.T.Text,{bold:!0,children:(0,M.Y)(v.A,{id:"h3vlVA",defaultMessage:"Aliases:"})}),(0,M.Y)("div",{children:(0,M.Y)(k.Y,{css:W,modelName:o.name,version:e.version,aliases:l[e.version]||[],onAddEdit:()=>{null===s||void 0===s||s(e.version)}})}),e.description&&(0,M.FD)(M.FK,{children:[(0,M.Y)(m.T.Text,{bold:!0,children:(0,M.Y)(v.A,{id:"KGMbzq",defaultMessage:"Commit message:"})}),(0,M.Y)(m.T.Text,{children:e.description})]}),(0,M.Y)(j,{onEditVersionMetadata:A,tags:y}),(()=>{const o=(0,h.RJ)(null===e||void 0===e?void 0:e.tags),s=!!o;return s||r?(0,M.FD)(M.FK,{children:[(0,M.Y)(m.T.Text,{bold:!0,children:(0,M.Y)(v.A,{id:"qKGnLV",defaultMessage:"Model Config:"})}),(0,M.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"flex-start",gap:c.spacing.sm},""),children:[s?(0,M.Y)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:c.spacing.xs,flex:1},""),children:Object.entries(o).map(([e,o])=>{if(void 0===o||null===o)return null;if(Array.isArray(o)&&0===o.length)return null;if("extra_params"===e&&"object"===typeof o&&!Array.isArray(o)){const s=o;return 0===Object.keys(s).length?null:(0,M.FD)("div",{children:[(0,M.Y)(m.T.Text,{css:(0,i.AH)({color:c.colors.textSecondary},""),children:"extra_params:"}),(0,M.Y)("div",{css:(0,i.AH)({marginLeft:c.spacing.md},""),children:Object.entries(s).map(([o,s])=>{if(void 0===s||null===s)return null;const n="object"===typeof s?JSON.stringify(s):String(s);return(0,M.FD)("div",{children:[(0,M.FD)(m.T.Text,{css:(0,i.AH)({color:c.colors.textSecondary},""),children:[o,":"," "]}),(0,M.Y)(m.T.Text,{children:n})]},`${e}.${o}`)})})]},e)}const s=h.Mz[e],n=Array.isArray(o)?o.join(", "):String(o);return(0,M.FD)("div",{children:[(0,M.FD)(m.T.Text,{css:(0,i.AH)({color:c.colors.textSecondary},""),children:[s,": "]}),(0,M.Y)(m.T.Text,{children:n})]},e)})}):(0,M.Y)(m.T.Hint,{children:"\u2014"}),r&&(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.version.edit_model_config",size:"small",icon:(0,M.Y)(u.PencilIcon,{}),onClick:()=>r(e)})]})]}):null})(),(g||p.length>0)&&(0,M.Y)(N,{isLoadingRuns:g,runIds:p,runInfoMap:Y})]})};var $=s(73879);var q=s(67850),G=s(16844),J=s(19112),X=s(91701);var Z={name:"bjn8wh",styles:"position:relative"};const Q=({code:e,language:o})=>{const{theme:s}=(0,m.u)();return(0,M.FD)("div",{css:Z,children:[(0,M.Y)(X.i,{css:(0,i.AH)({zIndex:1,position:"absolute",top:s.spacing.xs,right:s.spacing.xs},""),showLabel:!1,copyText:e,icon:(0,M.Y)(u.CopyIcon,{})}),(0,M.Y)(J.z7,{language:o,showLineNumbers:!1,style:{padding:s.spacing.sm,color:s.colors.textPrimary,backgroundColor:s.colors.backgroundSecondary,whiteSpace:"pre-wrap"},wrapLongLines:!0,children:e})]})},ee=({visible:e,promptName:o,promptVersion:s,onCancel:i})=>{const{theme:n}=(0,m.u)(),t=`import os\nfrom typing import Any\nimport openai\nimport mlflow\nfrom mlflow.genai.scorers import Correctness, Safety\nfrom mlflow.genai.optimize import GepaPromptOptimizer\nfrom mlflow.genai import datasets\n\nEVAL_DATASET_NAME='<YOUR DATASET NAME>' # Replace with your dataset\ndataset = datasets.get_dataset(EVAL_DATASET_NAME)\n\n# Define your prediction function\ndef predict_fn(**kwargs) -> str:\n    prompt = mlflow.genai.load_prompt("prompts:/${o}/${s}")\n    completion = openai.OpenAI().chat.completions.create(\n        model="gpt-5-mini", # Replace with your model\n        messages=[{"role": "user", "content": prompt.format(**kwargs)}],\n    )\n    return completion.choices[0].message.content\n\n# Optimize your prompt\nresult = mlflow.genai.optimize_prompts(\n    predict_fn=predict_fn,\n    train_data=dataset,\n    prompt_uris=["prompts:/${o}/${s}"],\n    optimizer=GepaPromptOptimizer(reflection_model="openai:/gpt-5"),\n    scorers=[Correctness(model="openai:/gpt-5")), Safety(model="openai:/gpt-5"))],\n)\n\n# Open the prompt registry page to check the new prompt\nprint(f"The new prompt URI: {result.optimized_prompts[0].uri}")`;return(0,M.Y)(g.d,{componentId:"mlflow.experiment.prompt.optimize-modal",title:(0,M.Y)(v.A,{id:"QravWY",defaultMessage:"Optimize Prompt"}),footer:null,visible:e,onCancel:i,children:(0,M.FD)("div",{style:{display:"flex",flexDirection:"column",gap:n.spacing.md},children:[(0,M.Y)(m.T.Paragraph,{children:(0,M.Y)(v.A,{id:"wciksY",defaultMessage:"Here's how to optimize your prompt with your dataset in your Python code:"})}),(0,M.Y)(Q,{code:"pip install -U 'mlflow>=3.5.0' 'dspy>=3.0.0' openai",language:"text"}),(0,M.Y)(Q,{code:t,language:"python"}),(0,M.Y)(m.T.Paragraph,{children:(0,M.Y)(v.A,{id:"aMOq4p",defaultMessage:"See {mlflowLink} for more details.",values:{mlflowLink:(0,M.Y)(m.T.Link,{componentId:"mlflow.experiment.prompt.optimize-modal.mlflow-link",target:"_blank",href:"https://mlflow.org/docs/latest/genai/prompt-registry/optimize-prompts/",children:(0,M.Y)(v.A,{id:"c0ljd6",defaultMessage:"MLflow documentation"})})}})})]})})};const oe=/\{\{\s*(.*?)\s*\}\}/g;var se={name:"1eoy87d",styles:"display:flex;justify-content:space-between"},ie={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},ne={name:"zjik7",styles:"display:flex"},te={name:"s5xdrg",styles:"display:flex;align-items:center"},re={name:"s5xdrg",styles:"display:flex;align-items:center"},le={name:"1089mxj",styles:"white-space:pre-wrap"};const ae=({promptVersion:e,onUpdatedContent:o,onDeletedVersion:s,aliasesByVersion:n,registeredPrompt:t,showEditAliasesModal:r,showEditPromptVersionMetadataModal:l,showEditModelConfigModal:d})=>{const c=(0,f.useMemo)(()=>e?(0,h.dv)(e):"",[e]),p=(0,f.useMemo)(()=>(0,h.f5)(e),[e]),Y=(0,f.useMemo)(()=>p?(0,h.yC)(c):void 0,[p,c]),{DeletePromptModal:y,openModal:A}=(({promptVersion:e,onSuccess:o})=>{const[s,i]=(0,f.useState)(!1),{mutate:n}=(0,w.n)({mutationFn:async({promptName:e,version:o})=>{await a.M.deleteRegisteredPromptVersion(e,o)}});return{DeletePromptModal:(0,M.Y)(g.d,{componentId:"mlflow.prompts.delete_version_modal",visible:s,onCancel:()=>i(!1),title:(0,M.Y)(v.A,{id:"WfY+Gj",defaultMessage:"Delete prompt version"}),okText:(0,M.Y)(v.A,{id:"orKoPo",defaultMessage:"Delete"}),okButtonProps:{danger:!0},onOk:async()=>{null!==e&&void 0!==e&&e.name?(n({promptName:e.name,version:e.version},{onSuccess:()=>{null===o||void 0===o||o(),i(!1)}}),i(!1)):i(!1)},cancelText:(0,M.Y)(v.A,{id:"VpFZR/",defaultMessage:"Cancel"}),children:(0,M.Y)(v.A,{id:"x2+7hZ",defaultMessage:"Are you sure you want to delete the prompt version?"})}),openModal:()=>i(!0)}})({promptVersion:e,onSuccess:()=>null===s||void 0===s?void 0:s()}),[x,b]=(0,f.useState)(!1),[S,D]=(0,f.useState)(!1),[k,C]=(0,f.useState)(!0),T=(0,f.useMemo)(()=>{if(!c)return[];const e=[],o=p?(null===Y||void 0===Y?void 0:Y.map(e=>e.content).join("\n"))||"":c;let s;for(;null!==(s=oe.exec(o));)e.push(s[1]);return e.some(e=>e.includes("{")||e.includes("}"))?null:(0,F.uniq)(e)},[c,p,Y]),{theme:V}=(de(e,T,p?h.Xs:void 0),(0,m.u)());return(0,M.FD)("div",{css:(0,i.AH)({flex:1,padding:V.spacing.md,paddingTop:0,borderRadius:V.borders.borderRadiusSm,overflow:"auto",display:"flex",flexDirection:"column"},""),children:[(0,M.FD)("div",{css:se,children:[(0,M.Y)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",flex:1,columnGap:V.spacing.md,rowGap:V.spacing.sm,marginRight:V.spacing.md},""),children:(0,M.Y)(m.T.Title,{withoutMargins:!0,level:3,children:(0,M.Y)(v.A,{id:"5UrahG",defaultMessage:"Viewing version {version}",values:{version:null===e||void 0===e?void 0:e.version}})})}),(0,M.FD)("div",{css:(0,i.AH)({display:"flex",gap:V.spacing.sm},""),children:[(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.delete_version",icon:(0,M.Y)(u.TrashIcon,{}),type:"primary",danger:!0,onClick:A,children:(0,M.Y)(v.A,{id:"H7JwOl",defaultMessage:"Delete version"})}),(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.preview.optimize",icon:(0,M.Y)(u.LightningIcon,{}),onClick:()=>D(!0),children:(0,M.Y)(v.A,{id:"k/fDlw",defaultMessage:"Optimize"})}),(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.preview.use",icon:(0,M.Y)(u.PlayIcon,{}),onClick:()=>b(!0),children:(0,M.Y)(v.A,{id:"8EK+SZ",defaultMessage:"Use"})})]})]}),(0,M.Y)(g.S,{shrinks:!1}),(0,M.Y)(U,{aliasesByVersion:n,registeredPrompt:t,registeredPromptVersion:e,showEditAliasesModal:r,showEditPromptVersionMetadataModal:l,showEditModelConfigModal:d}),p&&(0,M.Y)(g.S,{shrinks:!1}),(0,M.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:V.spacing.sm},""),children:[(0,M.Y)("div",{css:ie,children:!p&&(0,M.FD)(u.SegmentedControlGroup,{name:"render-mode",size:"small",componentId:"mlflow.prompts.details.toggle-markdown-rendering",value:k,onChange:e=>C(e.target.value),css:ne,children:[(0,M.Y)(u.SegmentedControlButton,{value:!1,children:(0,M.Y)(g.T,{componentId:"mlflow.prompts.details.plaintext-rendering-tooltip",content:(0,M.Y)(v.A,{id:"k/AedV",defaultMessage:"Plain text"}),children:(0,M.Y)("div",{css:te,children:(0,M.FD)(m.T.Text,{children:[" ",(0,M.Y)(v.A,{id:"2hwoFW",defaultMessage:"Text"})]})})})}),(0,M.Y)(u.SegmentedControlButton,{value:!0,children:(0,M.Y)(g.T,{componentId:"mlflow.prompts.details.markdown-rendering-tooltip",content:(0,M.Y)(v.A,{id:"8VzQLx",defaultMessage:"Markdown"}),children:(0,M.Y)("div",{css:re,children:(0,M.Y)(u.MarkdownIcon,{css:(0,i.AH)({fontSize:V.typography.fontSizeLg},"")})})})})]})}),(0,M.Y)("div",{css:(0,i.AH)({backgroundColor:p?void 0:V.colors.backgroundSecondary,padding:V.spacing.md,overflow:"auto",display:"flex",flexDirection:"column",gap:V.spacing.sm},""),children:p&&Y?Y.map((e,o)=>(0,M.Y)(G.Xb,{message:{...e,content:e.content}},o)):k?(0,M.Y)($.V,{children:c||"Empty"}):(0,M.Y)(m.T.Text,{css:le,children:c||"Empty"})})]}),(0,M.FD)(g.d,{componentId:"mlflow.prompts.details.preview.usage_example_modal",title:(0,M.Y)(v.A,{id:"VrxfuC",defaultMessage:"Usage example"}),visible:x,onCancel:()=>b(!1),cancelText:(0,M.Y)(v.A,{id:"cmYzGP",defaultMessage:"Dismiss"}),children:[(0,M.Y)(q.i,{code:de(e,T,p?h.Xs:void 0)})," "]}),(0,M.Y)(ee,{visible:S,promptName:(null===e||void 0===e?void 0:e.name)||"",promptVersion:(null===e||void 0===e?void 0:e.version)||"",onCancel:()=>D(!1)}),y]})},de=(e,o,s=h.Qk)=>{let i=`from openai import OpenAI\nimport mlflow\nclient = OpenAI(api_key="<YOUR_API_KEY>")\n\n# Set MLflow tracking URI\nmlflow.set_tracking_uri("<YOUR_TRACKING_URI>")\n\n# Example of loading and using the prompt\nprompt = mlflow.genai.load_prompt("prompts:/${null===e||void 0===e?void 0:e.name}/${null===e||void 0===e?void 0:e.version}")`;return null===o?s===h.Xs?i+='\n\n# Replace the variables with the actual values\nvariables = {\n   "key": "value",\n   ...\n}\n\nmessages = prompt.format(**variables)\nresponse = client.chat.completions.create(\n    messages=messages,\n    model="gpt-4o-mini",\n)':i+='\n\n# Replace the variables with the actual values\nvariables = {\n   "key": "value",\n   ...\n}\n\nresponse = client.chat.completions.create(\n    messages=[{\n        "role": "user",\n        "content": prompt.format(**variables),\n    }],\n    model="gpt-4o-mini",\n)':s===h.Xs?i+=`\nmessages = prompt.format_messages(${o.map(e=>`${e}="<${e}>"`).join(", ")})\nresponse = client.chat.completions.create(\n    messages=messages,\n    model="gpt-4o-mini",\n)`:i+=`\nresponse = client.chat.completions.create(\n    messages=[{\n        "role": "user",\n        "content": prompt.format(${o.map(e=>`${e}="<${e}>"`).join(", ")}),\n    }],\n    model="gpt-4o-mini",\n)`,i+="\n\nprint(response.choices[0].message.content)",i};var ce=s(76055);var pe={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},me={name:"zjik7",styles:"display:flex"},ue={name:"82a6rk",styles:"flex:1"},ge={name:"82a6rk",styles:"flex:1"},ve={name:"ppz665",styles:"display:flex;flex:1;overflow:auto;align-items:flex-start"},he={name:"1089mxj",styles:"white-space:pre-wrap"},fe={name:"h55e3f",styles:"svg{rotate:90deg;}"},Ye={name:"1089mxj",styles:"white-space:pre-wrap"};const ye=({baselineVersion:e,comparedVersion:o,onSwitchSides:s,onEditVersion:n,registeredPrompt:t,aliasesByVersion:r,showEditAliasesModal:l})=>{const{theme:a}=(0,m.u)(),d=(0,S.A)(),[c,p]=(0,f.useState)(!0),Y=(0,f.useMemo)(()=>e?(0,h.dv)(e):"",[e]),y=(0,f.useMemo)(()=>o?(0,h.dv)(o):"",[o]),w=(0,f.useMemo)(()=>(0,h.yC)(Y),[Y]),A=(0,f.useMemo)(()=>(0,h.yC)(y),[y]),x=(e,o)=>e?e.map(e=>`${e.role}: ${e.content}`).join("\n\n"):null!==o&&void 0!==o?o:"",b=x(w,Y),D=x(A,y),k=(0,f.useMemo)(()=>{var e;return null!==(e=(0,ce.b2)(null!==b&&void 0!==b?b:"",null!==D&&void 0!==D?D:""))&&void 0!==e?e:[]},[b,D]),C=(0,f.useMemo)(()=>({addedBackground:a.isDarkMode?a.colors.green700:a.colors.green300,removedBackground:a.isDarkMode?a.colors.red700:a.colors.red300}),[a]);return(0,M.FD)("div",{css:(0,i.AH)({flex:1,padding:a.spacing.md,paddingTop:0,borderRadius:a.borders.borderRadiusSm,overflow:"hidden",display:"flex",flexDirection:"column"},""),children:[(0,M.FD)("div",{css:pe,children:[(0,M.Y)(m.T.Title,{level:3,children:(0,M.Y)(v.A,{id:"B8RvlZ",defaultMessage:"Comparing version {baseline} with version {compared}",values:{baseline:null===e||void 0===e?void 0:e.version,compared:null===o||void 0===o?void 0:o.version}})}),(0,M.FD)(u.SegmentedControlGroup,{name:"compare-render-mode",size:"small",componentId:"mlflow.prompts.compare.toggle-markdown-rendering",value:c,onChange:e=>p(e.target.value),children:[(0,M.Y)(u.SegmentedControlButton,{value:!1,children:(0,M.Y)(v.A,{id:"2hwoFW",defaultMessage:"Text"})}),(0,M.Y)(u.SegmentedControlButton,{value:!0,children:(0,M.Y)(u.MarkdownIcon,{})})]})]}),c&&(0,M.FD)(M.FK,{children:[(0,M.Y)(g.S,{shrinks:!1,size:"sm"}),(0,M.Y)(u.Alert,{componentId:"mlflow.prompts.compare.markdown-diff-warning",type:"warning",message:(0,M.Y)(v.A,{id:"DQ3XQT",defaultMessage:"Diff highlighting is not supported in Markdown view. Switch to Text view to see differences."}),closable:!1})]}),(0,M.Y)(g.S,{shrinks:!1}),(0,M.FD)("div",{css:me,children:[(0,M.Y)("div",{css:ue,children:(0,M.Y)(U,{aliasesByVersion:r,onEditVersion:n,registeredPrompt:t,registeredPromptVersion:e,showEditAliasesModal:l,isBaseline:!0})}),(0,M.Y)("div",{css:(0,i.AH)({paddingLeft:a.spacing.sm,paddingRight:a.spacing.sm},""),children:(0,M.Y)("div",{css:(0,i.AH)({width:a.general.heightSm},"")})}),(0,M.Y)("div",{css:ge,children:(0,M.Y)(U,{aliasesByVersion:r,onEditVersion:n,registeredPrompt:t,registeredPromptVersion:o,showEditAliasesModal:l})})]}),(0,M.Y)(g.S,{shrinks:!1}),(0,M.FD)("div",{css:ve,children:[(0,M.Y)("div",{css:(0,i.AH)({backgroundColor:a.colors.backgroundSecondary,padding:a.spacing.md,flex:1},""),children:c?(0,M.Y)($.V,{children:b||"Empty"}):(0,M.Y)(m.T.Text,{css:he,children:b||"Empty"})}),(0,M.Y)("div",{css:(0,i.AH)({paddingLeft:a.spacing.sm,paddingRight:a.spacing.sm},""),children:(0,M.Y)(g.T,{componentId:"mlflow.prompts.details.switch_sides.tooltip",content:(0,M.Y)(v.A,{id:"Cbgg9B",defaultMessage:"Switch sides"}),side:"top",children:(0,M.Y)(m.B,{"aria-label":d.formatMessage({id:"Cbgg9B",defaultMessage:"Switch sides"}),componentId:"mlflow.prompts.details.switch_sides",icon:(0,M.Y)(u.ExpandMoreIcon,{css:fe}),onClick:s})})}),(0,M.Y)("div",{css:(0,i.AH)({backgroundColor:a.colors.backgroundSecondary,padding:a.spacing.md,flex:1},""),children:c?(0,M.Y)($.V,{children:D||"Empty"}):(0,M.Y)(m.T.Text,{css:Ye,children:k.map((e,o)=>(0,M.Y)("span",{css:(0,i.AH)({backgroundColor:e.added?C.addedBackground:e.removed?C.removedBackground:void 0,textDecoration:e.removed?"line-through":"none"},""),children:e.value},o))})})]})]})};var we=s(55570),Me=s(91113),Ae=s(68079),xe=s(73227);const be=({promptEntity:e,onTagsUpdated:o})=>{const s=(0,S.A)(),{theme:n}=(0,m.u)(),{EditTagsModal:t,showEditPromptTagsModal:r}=(0,xe.i)({onSuccess:o}),l=(null===e||void 0===e?void 0:e.tags.filter(e=>(0,z.oD)(e.key)))||[],a=l.length>0;return(0,M.FD)("div",{css:(0,i.AH)({paddingTop:n.spacing.xs,paddingBottom:n.spacing.xs,display:"flex",flexWrap:"wrap",alignItems:"center","> *":{marginRight:"0 !important"},gap:n.spacing.xs},""),children:[null===l||void 0===l?void 0:l.map(e=>(0,M.Y)(O.t,{tag:e},e.key)),(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.tags.edit",size:"small",icon:a?(0,M.Y)(u.PencilIcon,{}):void 0,onClick:()=>e&&r(e),"aria-label":s.formatMessage({id:"DHO5TT",defaultMessage:"Edit tags"}),children:a?void 0:(0,M.Y)(v.A,{id:"Nlm9bK",defaultMessage:"Add tags"}),type:"tertiary"}),t]})};var Se=s(42110);function De({promptName:e}){return(0,M.Y)(Se.E,{statusCode:404,subMessage:`Prompt name '${e}' does not exist`,fallbackHomePageReactRoute:Y.Ay.promptsPageRoute})}var ke=s(27042);var Ce=s(884),Te=s(46646);var Ve=s(99213),Ie=s(44105),Ee=s(79444),Pe=s(43544),Fe=s(37626),Re=s(14429),_e=s(43979),Be=s(65641),He=s(15756);const Le=({experimentId:e,promptVersion:o})=>{const{theme:s}=(0,m.u)(),[n]=(0,Re.VA)(),t=(0,Ee.U)(),[r]=(0,Fe._)(),l=o.name,a=o.version,d=(0,f.useMemo)(()=>{const{startTime:e,endTime:o}=(0,Re.UY)(t.dateNow,n);return{startTime:e?new Date(e).getTime().toString():void 0,endTime:o?new Date(o).getTime().toString():void 0}},[t.dateNow,n]),c=(0,f.useMemo)(()=>[{column:"prompt",operator:He.tl.EQUALS,value:`${l}/${a}`}],[l,a]);return(0,M.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,height:"100%",overflowY:"hidden"},""),children:[(0,M.Y)(_e.J,{viewState:r}),"logs"===r&&(0,M.Y)(Be.v,{experimentId:e||"",endpointName:"",timeRange:d,additionalFilters:c})]})},Ne=({promptVersion:e,experimentId:o})=>{const{theme:s}=(0,m.u)();return o?null!==e&&void 0!==e&&e.name&&null!==e&&void 0!==e&&e.version?(0,M.Y)(Pe.y,{children:(0,M.Y)(Ee.k,{children:(0,M.Y)(Le,{experimentId:o,promptVersion:e})})}):(0,M.Y)("div",{css:(0,i.AH)({padding:s.spacing.lg},""),children:(0,M.Y)(m.T.Paragraph,{children:(0,M.Y)(v.A,{id:"aO2NFe",defaultMessage:"No prompt version selected. Select a prompt version to view associated traces."})})}):(0,M.Y)("div",{css:(0,i.AH)({padding:s.spacing.lg},""),children:(0,M.Y)(m.T.Paragraph,{children:(0,M.Y)(v.A,{id:"Sd7sQi",defaultMessage:"Traces are only available for experiment-scoped prompts."})})})};var ze=s(54871);const Oe=e=>(0,M.Y)(v.A,{id:"b0KTgh",defaultMessage:"Add/edit alias for prompt version {version}",values:{version:e}});var Ke={name:"1m5f2z8",styles:"overflow:hidden;display:flex;flex-direction:column"},je={name:"1rtaly3",styles:"flex:1;display:flex;overflow:hidden"},We={name:"1t91kdm",styles:"flex:1;display:flex;flex-direction:column"};const Ue=({experimentId:e}={})=>{var o,s,n;const{promptName:A}=(0,c.g)(),{theme:x}=(0,m.u)(),b=(0,c.Zp)(),D=(0,r.wA)();t()(A,"Prompt name should be defined");const{data:k,refetch:C,isLoading:T,error:V}=(({promptName:e},o={})=>{var s;const i=(0,l.I)(["prompt_details",{promptName:e}],{queryFn:d,retry:!1,...o});return{data:i.data,error:null!==(s=i.error)&&void 0!==s?s:void 0,isLoading:i.isLoading,refetch:i.refetch}})({promptName:A}),{CreatePromptModal:I,openModal:_}=(0,y.z)({mode:y.v.CreatePromptVersion,registeredPrompt:null===k||void 0===k?void 0:k.prompt,latestVersion:(0,F.first)(null===k||void 0===k?void 0:k.versions),experimentId:e,onSuccess:async({promptVersion:e})=>{await C(),e&&W({version:e})}}),{DeletePromptModal:B,openModal:H}=(({registeredPrompt:e,onSuccess:o})=>{const[s,i]=(0,f.useState)(!1),{mutate:n}=(0,w.n)({mutationFn:async({promptName:e})=>{await a.M.deleteRegisteredPrompt(e)}});return{DeletePromptModal:(0,M.Y)(g.d,{componentId:"mlflow.prompts.delete_modal",visible:s,onCancel:()=>i(!1),title:(0,M.Y)(v.A,{id:"p2po2x",defaultMessage:"Delete prompt"}),okText:(0,M.Y)(v.A,{id:"kgJSBI",defaultMessage:"Delete"}),okButtonProps:{danger:!0},onOk:async()=>{null!==e&&void 0!==e&&e.name?(n({promptName:e.name},{onSuccess:()=>{null===o||void 0===o||o(),i(!1)}}),i(!1)):i(!1)},cancelText:(0,M.Y)(v.A,{id:"ZlokCq",defaultMessage:"Cancel"}),children:(0,M.Y)(v.A,{id:"WVUF2N",defaultMessage:"Are you sure you want to delete the prompt?"})}),openModal:()=>i(!0)}})({registeredPrompt:null===k||void 0===k?void 0:k.prompt,onSuccess:()=>b(e?Y.Ay.getExperimentPageTabRoute(e,Ie.fM.Prompts):Y.Ay.promptsPageRoute)}),{EditPromptVersionMetadataModal:L,showEditPromptVersionMetadataModal:N}=(({onSuccess:e})=>{const o=(0,w.n)({mutationFn:async({toAdd:e,toDelete:o,promptName:s,promptVersion:i})=>Promise.all([...e.map(({key:e,value:o})=>a.M.setRegisteredPromptVersionTag(s,i,e,o)),...o.map(({key:e})=>a.M.deleteRegisteredPromptVersionTag(s,i,e))])}),{EditTagsModal:s,showEditTagsModal:i,isLoading:n}=(0,ke.Q)({title:(0,M.Y)(v.A,{id:"zxfWCx",defaultMessage:"Add/Edit Prompt Version Metadata"}),valueRequired:!0,saveTagsHandler:(s,i,n)=>{const{addedOrModifiedTags:t,deletedTags:r}=(0,z.Rf)(i,n);return new Promise((i,n)=>{if(!s.name)return n();o.mutate({promptName:s.name,promptVersion:s.version,toAdd:t,toDelete:r},{onSuccess:()=>{i(),null===e||void 0===e||e()},onError:n})})}});return{EditPromptVersionMetadataModal:s,showEditPromptVersionMetadataModal:(0,f.useCallback)(e=>{var o;return i({name:e.name,version:e.version,tags:null===(o=e.tags)||void 0===o?void 0:o.filter(e=>(0,z.oD)(e.key))})},[i]),isLoading:n}})({onSuccess:C}),{EditModelConfigModal:O,openEditModelConfigModal:K}=(({onSuccess:e})=>{const[o,s]=(0,f.useState)(!1),[i,n]=(0,f.useState)(null),t=((0,S.A)(),(0,Ce.mN)({defaultValues:{modelConfig:{}}})),r=(0,w.n)({mutationFn:async({promptName:e,promptVersion:o,modelConfigJson:s})=>a.M.setRegisteredPromptVersionTag(e,o,h.Nb,s)}),l=(0,f.useCallback)(e=>{r.reset(),n(e);const o=(0,h.RJ)(e.tags);t.reset({modelConfig:(0,h.xT)(o)}),s(!0)},[t,r]),d=t.handleSubmit(async o=>{if(!i)return;const n=(0,h._f)(o.modelConfig);if(Object.keys(n).length>0)return void Object.entries(n).forEach(([e,o])=>{t.setError(`modelConfig.${e}`,{type:"validation",message:o})});const l=(0,h.V)(o.modelConfig),a=l?JSON.stringify(l):"{}";r.mutate({promptName:i.name,promptVersion:i.version,modelConfigJson:a},{onSuccess:()=>{s(!1),null===e||void 0===e||e()}})});return{EditModelConfigModal:(0,M.Y)(Ce.Op,{...t,children:(0,M.FD)(g.d,{componentId:"mlflow.prompts.edit_model_config.modal",visible:o,onCancel:()=>{s(!1),t.clearErrors()},title:(0,M.Y)(v.A,{id:"uX2XCM",defaultMessage:"Edit Model Configuration"}),okText:(0,M.Y)(v.A,{id:"MX4ypf",defaultMessage:"Save"}),okButtonProps:{loading:r.isLoading},onOk:d,cancelText:(0,M.Y)(v.A,{id:"5lsHqm",defaultMessage:"Cancel"}),size:"normal",children:[r.error&&(0,M.FD)(M.FK,{children:[(0,M.Y)(u.Alert,{componentId:"mlflow.prompts.edit_model_config.error",closable:!1,message:r.error.message,type:"error"}),(0,M.Y)(g.S,{})]}),(0,M.Y)(Te.G,{})]})}),openEditModelConfigModal:l}})({onSuccess:C}),{setCompareMode:j,setPreviewMode:W,setTracesMode:U,switchSides:$,viewState:q,setSelectedVersion:G,setComparedVersion:J}=(e=>{const[o,s]=(0,f.useReducer)(R,{mode:h.Dp.PREVIEW}),i=(0,f.useCallback)(o=>{var i;const n=null===(i=null!==o&&void 0!==o?o:(0,F.first)(null===e||void 0===e?void 0:e.versions))||void 0===i?void 0:i.version;s({type:"setPreviewMode",selectedVersion:n})},[e]),n=(0,f.useCallback)(e=>{s({type:"setSelectedVersion",selectedVersion:e})},[]),t=(0,f.useCallback)(e=>{s({type:"setComparedVersion",comparedVersion:e})},[]),r=(0,f.useCallback)(()=>{var i,n,t,r;const l=null===(i=(0,F.first)(null===e||void 0===e?void 0:e.versions))||void 0===i?void 0:i.version,a=null!==(n=o.selectedVersion)&&void 0!==n?n:null===e||void 0===e||null===(t=e.versions[1])||void 0===t?void 0:t.version,d=a===l?null===e||void 0===e||null===(r=e.versions[1])||void 0===r?void 0:r.version:l;s({type:"setCompareMode",selectedVersion:a,comparedVersion:d})},[e,o.selectedVersion]),l=(0,f.useCallback)(o=>{var i;const n=null===(i=null!==o&&void 0!==o?o:(0,F.first)(null===e||void 0===e?void 0:e.versions))||void 0===i?void 0:i.version;s({type:"setTracesMode",selectedVersion:n})},[e]),a=(0,f.useCallback)(()=>s({type:"switchSides"}),[]);return(0,F.first)(null===e||void 0===e?void 0:e.versions)&&o.mode===h.Dp.PREVIEW&&!o.selectedVersion&&i((0,F.first)(null===e||void 0===e?void 0:e.versions)),{viewState:o,setPreviewMode:i,setCompareMode:r,setTracesMode:l,switchSides:a,setSelectedVersion:n,setComparedVersion:t}})(k);(0,ze.qd)("promptName",A),(0,ze.qd)("promptVersion",q.selectedVersion),(0,ze.qd)("comparedPromptVersion",q.comparedVersion);const{mode:X}=q,Z=!T&&!(null!==k&&void 0!==k&&k.versions.length),Q=!T&&!Z&&[h.Dp.PREVIEW,h.Dp.COMPARE,h.Dp.TRACES].includes(X),ee=null===k||void 0===k?void 0:k.versions.find(({version:e})=>e===q.selectedVersion),oe=null===k||void 0===k?void 0:k.versions.find(({version:e})=>e===q.comparedVersion),se=(0,f.useMemo)(()=>{var e,o;const s={};return null===k||void 0===k||null===(e=k.prompt)||void 0===e||null===(o=e.aliases)||void 0===o||o.forEach(({alias:e,version:o})=>{s[o]||(s[o]=[]),s[o].push(e)}),s},[k]),{EditAliasesModal:ie,showEditAliasesModal:ne}=(0,P.t)({aliases:null!==(o=null===k||void 0===k||null===(s=k.prompt)||void 0===s?void 0:s.aliases)&&void 0!==o?o:[],onSuccess:C,getTitle:Oe,onSave:async(e,o,s)=>{var i,n;return D((0,Ve.mq)(null!==(i=null===k||void 0===k||null===(n=k.prompt)||void 0===n?void 0:n.name)&&void 0!==i?i:"",e,o,s))},description:(0,M.Y)(v.A,{id:"4GPLHq",defaultMessage:"Aliases allow you to assign a mutable, named reference to a particular prompt version."})});if(V)return(0,M.Y)(De,{promptName:A});const te=e?void 0:(0,M.Y)(u.Breadcrumb,{children:(0,M.Y)(u.Breadcrumb.Item,{children:(0,M.Y)(c.N_,{to:Y.Ay.promptsPageRoute,children:"Prompts"})})});return T?(0,M.Y)(p.m,{children:(0,M.Y)(Ue.Skeleton,{breadcrumbs:te})}):(0,M.FD)(p.m,{css:Ke,children:[(0,M.Y)(g.S,{shrinks:!1}),(0,M.Y)(u.Header,{breadcrumbs:te,title:null===k||void 0===k||null===(n=k.prompt)||void 0===n?void 0:n.name,buttons:(0,M.FD)(M.FK,{children:[(0,M.FD)(u.DropdownMenu.Root,{children:[(0,M.Y)(u.DropdownMenu.Trigger,{asChild:!0,children:(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.actions",icon:(0,M.Y)(u.OverflowIcon,{}),"aria-label":"More actions"})}),(0,M.Y)(u.DropdownMenu.Content,{children:(0,M.Y)(u.DropdownMenu.Item,{componentId:"mlflow.prompts.details.actions.delete",onClick:H,children:(0,M.Y)(v.A,{id:"BwgPX0",defaultMessage:"Delete"})})})]}),(0,M.Y)(m.B,{componentId:"mlflow.prompts.details.create",type:"primary",onClick:_,children:(0,M.Y)(v.A,{id:"RJenO+",defaultMessage:"Create prompt version"})})]})}),(0,M.Y)(be,{onTagsUpdated:C,promptEntity:null===k||void 0===k?void 0:k.prompt}),(0,M.Y)(g.S,{shrinks:!1}),(0,M.FD)("div",{css:je,children:[(0,M.FD)("div",{css:(0,i.AH)({flex:Q?"0 0 320px":1,display:"flex",flexDirection:"column"},""),children:[(0,M.Y)("div",{css:(0,i.AH)({display:"flex",gap:x.spacing.sm},""),children:(0,M.FD)(u.SegmentedControlGroup,{name:"mlflow.prompts.details.mode",componentId:"mlflow.prompts.details.mode",value:X,disabled:T,children:[(0,M.Y)(u.SegmentedControlButton,{value:h.Dp.PREVIEW,onClick:()=>W(),children:(0,M.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:x.spacing.xs},""),children:[(0,M.Y)(u.ZoomMarqueeSelection,{}),(0,M.Y)(v.A,{id:"wrNl6F",defaultMessage:"Preview"})]})}),(0,M.Y)(u.SegmentedControlButton,{disabled:Boolean(!(null!==k&&void 0!==k&&k.versions.length)||(null===k||void 0===k?void 0:k.versions.length)<2),value:h.Dp.COMPARE,onClick:j,children:(0,M.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:x.spacing.xs},""),children:[(0,M.Y)(u.ColumnsIcon,{})," ",(0,M.Y)(v.A,{id:"SI6n4L",defaultMessage:"Compare"})]})}),(0,M.Y)(u.SegmentedControlButton,{disabled:!e,value:h.Dp.TRACES,onClick:()=>U(),children:(0,M.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:x.spacing.xs},""),children:[(0,M.Y)(u.ForkHorizontalIcon,{}),(0,M.Y)(v.A,{id:"7MxBYq",defaultMessage:"Traces"})]})})]})}),(0,M.Y)(g.S,{shrinks:!1,size:"sm"}),(0,M.Y)(E,{isLoading:T,registeredPrompt:null===k||void 0===k?void 0:k.prompt,promptVersions:null===k||void 0===k?void 0:k.versions,selectedVersion:q.selectedVersion,comparedVersion:q.comparedVersion,showEditAliasesModal:ne,aliasesByVersion:se,onUpdateSelectedVersion:G,onUpdateComparedVersion:J,mode:X})]}),Q&&(0,M.Y)("div",{css:We,children:(0,M.FD)("div",{css:(0,i.AH)({borderLeft:`1px solid ${x.colors.border}`,flex:1,overflow:"hidden",display:"flex"},""),children:[X===h.Dp.PREVIEW&&(0,M.Y)(ae,{promptVersion:ee,onUpdatedContent:C,onDeletedVersion:async()=>{await C().then(({data:e})=>{!(0,F.isEmpty)(null===e||void 0===e?void 0:e.versions)&&null!==e&&void 0!==e&&e.versions[0].version&&G(null===e||void 0===e?void 0:e.versions[0].version)})},aliasesByVersion:se,showEditAliasesModal:ne,registeredPrompt:null===k||void 0===k?void 0:k.prompt,showEditPromptVersionMetadataModal:N,showEditModelConfigModal:K}),X===h.Dp.COMPARE&&(0,M.Y)(ye,{baselineVersion:ee,comparedVersion:oe,onSwitchSides:$,onEditVersion:W,showEditAliasesModal:ne,registeredPrompt:null===k||void 0===k?void 0:k.prompt,aliasesByVersion:se}),X===h.Dp.TRACES&&(0,M.Y)(Ne,{promptVersion:ee,experimentId:e})]})})]}),(0,M.Y)(g.S,{shrinks:!1}),ie,I,B,L,O]})};var $e={name:"1gt3dvv",styles:"flex:0 0 320px"},qe={name:"82a6rk",styles:"flex:1"};Ue.Skeleton=function({breadcrumbs:e}){const{theme:o}=(0,m.u)();return(0,M.FD)(M.FK,{children:[(0,M.Y)(g.S,{shrinks:!1}),(0,M.Y)(u.Header,{breadcrumbs:e,title:(0,M.Y)(u.GenericSkeleton,{css:(0,i.AH)({height:o.general.heightBase,width:200},"")}),buttons:(0,M.Y)(u.GenericSkeleton,{css:(0,i.AH)({height:o.general.heightBase,width:120},"")})}),(0,M.Y)(g.S,{shrinks:!1}),(0,M.Y)(u.TableSkeleton,{lines:4}),(0,M.Y)(g.S,{shrinks:!1}),(0,M.FD)("div",{css:(0,i.AH)({display:"flex",gap:o.spacing.lg},""),children:[(0,M.Y)("div",{css:$e,children:(0,M.Y)(u.TableSkeleton,{lines:6})}),(0,M.Y)("div",{css:qe,children:(0,M.Y)(u.TableSkeleton,{lines:4})})]})]})};var Ge=(0,we.X)(Me.A.mlflowServices.EXPERIMENTS,Ue,void 0,Ae.u)},43544:function(e,o,s){s.d(o,{y:function(){return c}});var i=s(89949),n=s(82716),t=s(27757),r=s(40724),l=s(73408);var a={name:"1vfb318",styles:"flex:1;display:flex;align-items:center;justify-content:center"};const d=({error:e})=>{var o;return(0,l.Y)(n.PageWrapper,{css:a,children:(0,l.Y)(n.Empty,{"data-testid":"fallback",title:(0,l.Y)(r.A,{id:"FbAMd+",defaultMessage:"Error"}),description:null!==(o=null===e||void 0===e?void 0:e.message)&&void 0!==o?o:(0,l.Y)(r.A,{id:"CbzDeZ",defaultMessage:"An error occurred while rendering this component."}),image:(0,l.Y)(t.k,{})})})},c=({children:e})=>(0,l.Y)(i.tH,{fallback:(0,l.Y)(d,{}),children:e})},43979:function(e,o,s){s.d(o,{J:function(){return c}});var i=s(68248),n=s(82716),t=s(27757),r=s(12998),l=s(84411),a=s(42747),d=s(73408);const c=({viewState:e,sessionId:o,className:s})=>{const{theme:c}=(0,t.u)();return(0,d.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${c.colors.borderDecorative}`,paddingBottom:`${c.spacing.sm}px`},""),className:s,children:[!("single-chat-session"===e)&&(0,d.Y)(l.$,{}),"single-chat-session"===e&&(0,d.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:c.spacing.sm},""),children:[(0,d.Y)(n.Tag,{color:"default",componentId:"mlflow.chat-sessions.session-header-label",css:(0,i.AH)({padding:c.spacing.xs+2,margin:0},""),children:(0,d.FD)("span",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:c.spacing.sm},""),children:[(0,d.Y)(n.SpeechBubbleIcon,{}),(0,d.Y)(t.T.Text,{ellipsis:!0,bold:!0,children:(0,d.Y)(a.sA,{id:"EAf6xM",defaultMessage:"Session"})})]})}),(0,d.Y)(t.T.Title,{level:3,withoutMargins:!0,children:o}),o&&(0,d.Y)(r.ad,{copyText:o,componentId:"mlflow.chat-sessions.copy-session-id",buttonProps:{icon:void 0}})]})]})}},52471:function(e,o,s){s.d(o,{Y:function(){return d}});var i=s(68248),n=s(82716),t=s(27757),r=s(93083),l=s(40724),a=s(73408);const d=({aliases:e=[],onAddEdit:o,className:s})=>{const{theme:d}=(0,t.u)();return(0,a.Y)("div",{css:(0,i.AH)({maxWidth:300,display:"flex",flexWrap:"wrap",alignItems:"flex-start","> *":{marginRight:"0 !important"},rowGap:d.spacing.xs/2,columnGap:d.spacing.xs},""),className:s,children:e.length<1?(0,a.Y)(t.B,{componentId:"codegen_mlflow_app_src_model-registry_components_aliases_modelversiontablealiasescell.tsx_30",size:"small",type:"link",onClick:o,children:(0,a.Y)(l.A,{id:"pU6cxH",defaultMessage:"Add"})}):(0,a.FD)(a.FK,{children:[e.map(e=>(0,a.Y)(r.Z,{value:e,css:(0,i.AH)({marginTop:d.spacing.xs/2},"")},e)),(0,a.Y)(t.B,{componentId:"codegen_mlflow_app_src_model-registry_components_aliases_modelversiontablealiasescell.tsx_41",size:"small",icon:(0,a.Y)(n.PencilIcon,{}),onClick:o})]})})}},67850:function(e,o,s){s.d(o,{i:function(){return c}});var i=s(68248),n=(s(46709),s(82716)),t=s(27757),r=s(19112),l=s(91701),a=s(73408);var d={name:"bjn8wh",styles:"position:relative"};const c=({code:e})=>{const{theme:o}=(0,t.u)();return(0,a.FD)("div",{css:d,children:[(0,a.Y)(l.i,{css:(0,i.AH)({zIndex:1,position:"absolute",top:o.spacing.xs,right:o.spacing.xs},""),showLabel:!1,copyText:e,icon:(0,a.Y)(n.CopyIcon,{})}),(0,a.Y)(r.z7,{language:"python",showLineNumbers:!1,style:{padding:o.spacing.sm,color:o.colors.textPrimary,backgroundColor:o.colors.backgroundSecondary,whiteSpace:"pre-wrap"},wrapLongLines:!0,children:e})]})}},93083:function(e,o,s){s.d(o,{Z:function(){return l}});var i=s(68248),n=s(82716),t=s(27757),r=s(73408);const l=({value:e,closable:o,onClose:s,className:l,compact:a=!1})=>{const{theme:d}=(0,t.u)();return(0,r.Y)(n.Tag,{componentId:"codegen_mlflow_app_src_model-registry_components_aliases_modelversionaliastag.tsx_23",css:(0,i.AH)({fontWeight:d.typography.typographyBoldFontWeight,marginRight:d.spacing.xs},""),className:l,closable:o,onClose:s,title:e,children:(0,r.FD)("span",{css:(0,i.AH)({display:"block",whiteSpace:"nowrap",maxWidth:a?160:300,textOverflow:"ellipsis",overflow:"hidden"},""),children:["@","\xa0",e]})})}}}]);