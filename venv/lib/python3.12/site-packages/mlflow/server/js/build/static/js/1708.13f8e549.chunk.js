"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1708],{6050:function(e,o,t){t.d(o,{$:function(){return p},$t:function(){return f},Cs:function(){return b},Dh:function(){return a},Dp:function(){return v},Mz:function(){return g},Nb:function(){return u},PS:function(){return s},Qk:function(){return m},RJ:function(){return S},TV:function(){return c},U7:function(){return C},V:function(){return Y},Xs:function(){return d},_f:function(){return M},dv:function(){return h},f5:function(){return y},pY:function(){return i},xT:function(){return P},xd:function(){return l},yC:function(){return w}});var r=t(181),n=t(44105);const a="mlflow.prompt.text",l="mlflow.prompt.run_ids",s="mlflow.prompt.is_prompt",i="true",m="text",d="chat",p="_mlflow_prompt_type",c="_mlflow_experiment_ids",u="_mlflow_prompt_model_config",g={provider:"Provider",model_name:"Model",temperature:"Temperature",max_tokens:"Max Tokens",top_p:"Top P",top_k:"Top K",frequency_penalty:"Frequency Penalty",presence_penalty:"Presence Penalty",stop_sequences:"Stop Sequences"},f="promptVersion";let v=function(e){return e.PREVIEW="preview",e.COMPARE="compare",e.TRACES="traces",e}({});const h=e=>{var o,t;return null===e||void 0===e||null===(o=e.tags)||void 0===o||null===(t=o.find(e=>e.key===a))||void 0===t?void 0:t.value},y=e=>{var o,t;return(null===e||void 0===e||null===(o=e.tags)||void 0===o||null===(t=o.find(e=>e.key===p))||void 0===t?void 0:t.value)===d},w=e=>{if(!e)return;const o=(0,r.pt)(e);return(e=>Array.isArray(e)&&e.every(e=>(e=>e&&"object"===typeof e&&"string"===typeof e.role&&"string"===typeof e.content)(e)))(o)?o:void 0},C=e=>{const o=e[n.VT];if(!o||!o.value)return[];try{const e=JSON.parse(o.value);if(Array.isArray(e))return e.filter(e=>e&&"string"===typeof e.name&&"string"===typeof e.version)}catch(t){}return[]},b=e=>{if(!e)return"";return/(\s+(ILIKE|LIKE)\s+)|=|!=/i.test(e)?e:`name ILIKE '%${e}%'`},S=e=>{const o=null===e||void 0===e?void 0:e.find(e=>e.key===u);if(null!==o&&void 0!==o&&o.value)try{return JSON.parse(o.value)}catch(t){return void console.error("Failed to parse model config:",t)}},Y=e=>{var o,t,r,n,a,l,s,i,m;if(!Object.values(e).some(e=>!!e))return;const d={},p=null===(o=e.provider)||void 0===o?void 0:o.trim();p&&(d.provider=p);const c=null===(t=e.modelName)||void 0===t?void 0:t.trim();if(c&&(d.model_name=c),null!==(r=e.temperature)&&void 0!==r&&r.trim()){const o=parseFloat(e.temperature);isNaN(o)||(d.temperature=o)}if(null!==(n=e.maxTokens)&&void 0!==n&&n.trim()){const o=parseInt(e.maxTokens,10);isNaN(o)||(d.max_tokens=o)}if(null!==(a=e.topP)&&void 0!==a&&a.trim()){const o=parseFloat(e.topP);isNaN(o)||(d.top_p=o)}if(null!==(l=e.topK)&&void 0!==l&&l.trim()){const o=parseInt(e.topK,10);isNaN(o)||(d.top_k=o)}if(null!==(s=e.frequencyPenalty)&&void 0!==s&&s.trim()){const o=parseFloat(e.frequencyPenalty);isNaN(o)||(d.frequency_penalty=o)}if(null!==(i=e.presencePenalty)&&void 0!==i&&i.trim()){const o=parseFloat(e.presencePenalty);isNaN(o)||(d.presence_penalty=o)}if(null!==(m=e.stopSequences)&&void 0!==m&&m.trim()){const o=e.stopSequences.split(",").map(e=>e.trim()).filter(e=>e.length>0);o.length>0&&(d.stop_sequences=o)}return Object.keys(d).length>0?d:void 0},P=e=>{var o,t;return e?{provider:null!==(o=e.provider)&&void 0!==o?o:"",modelName:null!==(t=e.model_name)&&void 0!==t?t:"",temperature:void 0!==e.temperature?String(e.temperature):"",maxTokens:void 0!==e.max_tokens?String(e.max_tokens):"",topP:void 0!==e.top_p?String(e.top_p):"",topK:void 0!==e.top_k?String(e.top_k):"",frequencyPenalty:void 0!==e.frequency_penalty?String(e.frequency_penalty):"",presencePenalty:void 0!==e.presence_penalty?String(e.presence_penalty):"",stopSequences:e.stop_sequences?e.stop_sequences.join(", "):""}:{}},M=e=>{var o,t,r,n,a,l;const s={};if(null!==(o=e.temperature)&&void 0!==o&&o.trim()){const o=parseFloat(e.temperature);(isNaN(o)||o<0)&&(s.temperature="Temperature must be a number >= 0")}if(null!==(t=e.maxTokens)&&void 0!==t&&t.trim()){const o=parseInt(e.maxTokens,10);(isNaN(o)||o<=0)&&(s.maxTokens="Max tokens must be an integer > 0")}if(null!==(r=e.topP)&&void 0!==r&&r.trim()){const o=parseFloat(e.topP);(isNaN(o)||o<0||o>1)&&(s.topP="Top P must be a number between 0 and 1")}if(null!==(n=e.topK)&&void 0!==n&&n.trim()){const o=parseInt(e.topK,10);(isNaN(o)||o<=0)&&(s.topK="Top K must be an integer > 0")}if(null!==(a=e.frequencyPenalty)&&void 0!==a&&a.trim()){const o=parseFloat(e.frequencyPenalty);(isNaN(o)||o<-2||o>2)&&(s.frequencyPenalty="Frequency penalty must be a number between -2 and 2")}if(null!==(l=e.presencePenalty)&&void 0!==l&&l.trim()){const o=parseFloat(e.presencePenalty);(isNaN(o)||o<-2||o>2)&&(s.presencePenalty="Presence penalty must be a number between -2 and 2")}return s}},46646:function(e,o,t){t.d(o,{G:function(){return w}});var r=t(68248),n=t(27757),a=t(79081),l=t(82716),s=t(46709),i=t(884),m=t(7655),d=t(40724),p=t(56123),c=t(8264);const u=["openai","anthropic","gemini","databricks"];var g=t(73408);var f={name:"1ykowef",styles:"margin-bottom:0"},v={name:"d8zogk",styles:"border:0;background:none;padding:0"},h={name:"1d3w5wq",styles:"width:100%"},y={name:"1d3w5wq",styles:"width:100%"};const w=()=>{var e,o,t,w,C,b,S;const{theme:Y}=(0,n.u)(),P=(0,m.A)(),{control:M,watch:F,setValue:I,formState:{errors:T}}=(0,i.xW)(),_=(0,s.useCallback)(e=>`modelConfig.${e}`,[]),x=e=>{var o;return null===T||void 0===T||null===(o=T.modelConfig)||void 0===o?void 0:o[e]},N=F(_("provider")),k=(0,s.useCallback)(()=>{I(_("modelName"),"")},[I,_]),{providers:A,providersLoading:E,models:R,modelsLoading:D}=((e,o)=>{const{data:t,isLoading:r}=(0,p.e)(),n=""===e?void 0:e,{data:a,isLoading:l}=(0,c.o)({provider:n}),i=(0,s.useMemo)(()=>{if(t)return[...u.filter(e=>t.includes(e)),...t.filter(e=>!u.includes(e)).sort()]},[t]),m=(0,s.useRef)(e);return(0,s.useEffect)(()=>{void 0!==m.current&&m.current!==e&&o(),m.current=e},[e,o]),{providers:i,providersLoading:r,models:a,modelsLoading:l}})(N,k);return(0,g.FD)("div",{css:(0,r.AH)({border:`1px solid ${Y.colors.border}`,borderRadius:Y.general.borderRadiusBase,padding:Y.spacing.md},""),children:[(0,g.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:Y.spacing.xs,marginBottom:Y.spacing.sm},""),children:[(0,g.Y)(n.T.Title,{level:4,css:f,children:(0,g.Y)(d.A,{id:"sXyBDU",defaultMessage:"Model Configuration"})}),(0,g.FD)(n.aw.Root,{componentId:"mlflow.prompts.model_config.help",children:[(0,g.Y)(n.aw.Trigger,{"aria-label":"Model configuration help",css:v,children:(0,g.Y)(a.I,{})}),(0,g.FD)(n.aw.Content,{align:"start",children:[(0,g.Y)(d.A,{id:"Sb+wLa",defaultMessage:"Model configuration stores the LLM settings associated with this prompt."}),(0,g.Y)(n.aw.Arrow,{})]})]})]}),(0,g.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:Y.spacing.md},""),children:[(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.provider",children:(0,g.Y)(d.A,{id:"wJX0a/",defaultMessage:"Provider"})}),(0,g.Y)(i.xI,{name:_("provider"),control:M,render:({field:e,fieldState:o})=>(0,g.FD)(g.FK,{children:[(0,g.FD)(l.DialogCombobox,{componentId:"mlflow.prompts.model_config.provider",label:P.formatMessage({id:"wJX0a/",defaultMessage:"Provider"}),modal:!1,value:e.value?[e.value]:void 0,children:[(0,g.Y)(l.DialogComboboxTrigger,{id:"mlflow.prompts.model_config.provider",css:h,allowClear:!0,placeholder:P.formatMessage({id:"zuEXrI",defaultMessage:"e.g., openai, anthropic, gemini"}),withInlineLabel:!1,onClear:()=>{e.onChange(""),I(_("modelName"),"")}}),(0,g.Y)(l.DialogComboboxContent,{loading:E,maxHeight:400,matchTriggerWidth:!0,children:!E&&A&&(0,g.Y)(l.DialogComboboxOptionList,{children:(0,g.Y)(l.DialogComboboxOptionListSearch,{autoFocus:!0,children:A.map(o=>(0,g.Y)(l.DialogComboboxOptionListSelectItem,{value:o,onChange:o=>e.onChange(o),checked:e.value===o,children:o},o))})})})]}),o.error&&(0,g.Y)(l.FormUI.Message,{type:"error",message:o.error.message})]})})]}),(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.modelName",children:(0,g.Y)(d.A,{id:"W99FRU",defaultMessage:"Model Name"})}),(0,g.Y)(i.xI,{name:_("modelName"),control:M,render:({field:e,fieldState:o})=>(0,g.FD)(g.FK,{children:[(0,g.FD)(l.DialogCombobox,{componentId:"mlflow.prompts.model_config.modelName",label:P.formatMessage({id:"W99FRU",defaultMessage:"Model Name"}),modal:!1,value:e.value?[e.value]:void 0,children:[(0,g.Y)(l.DialogComboboxTrigger,{id:"mlflow.prompts.model_config.modelName",css:y,allowClear:!0,placeholder:P.formatMessage({id:"pvjUFP",defaultMessage:"e.g., gpt-5.2, claude-4.5-opus"}),withInlineLabel:!1,disabled:!N,onClear:()=>e.onChange("")}),(0,g.Y)(l.DialogComboboxContent,{loading:D,maxHeight:400,matchTriggerWidth:!0,children:!D&&R&&(0,g.Y)(l.DialogComboboxOptionList,{children:(0,g.Y)(l.DialogComboboxOptionListSearch,{autoFocus:!0,children:R.map(o=>(0,g.Y)(l.DialogComboboxOptionListSelectItem,{value:o.model,onChange:o=>e.onChange(o),checked:e.value===o.model,children:o.model},o.model))})})})]}),o.error&&(0,g.Y)(l.FormUI.Message,{type:"error",message:o.error.message})]})})]}),(0,g.FD)("div",{css:(0,r.AH)({display:"grid",gridTemplateColumns:"1fr 1fr",gap:Y.spacing.sm},""),children:[(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.temperature",children:(0,g.Y)(d.A,{id:"+/Zrmm",defaultMessage:"Temperature"})}),(0,g.Y)(l.RHFControlledComponents.Input,{control:M,id:"mlflow.prompts.model_config.temperature",componentId:"mlflow.prompts.model_config.temperature",name:_("temperature"),validationState:x("temperature")?"error":void 0}),x("temperature")&&(0,g.Y)(l.FormUI.Message,{type:"error",message:null===(e=x("temperature"))||void 0===e?void 0:e.message})]}),(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.maxTokens",children:(0,g.Y)(d.A,{id:"rstugP",defaultMessage:"Max Tokens"})}),(0,g.Y)(l.RHFControlledComponents.Input,{control:M,id:"mlflow.prompts.model_config.maxTokens",componentId:"mlflow.prompts.model_config.maxTokens",name:_("maxTokens"),validationState:x("maxTokens")?"error":void 0}),x("maxTokens")&&(0,g.Y)(l.FormUI.Message,{type:"error",message:null===(o=x("maxTokens"))||void 0===o?void 0:o.message})]}),(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.topP",children:(0,g.Y)(d.A,{id:"RmmAwm",defaultMessage:"Top P"})}),(0,g.Y)(l.RHFControlledComponents.Input,{control:M,id:"mlflow.prompts.model_config.topP",componentId:"mlflow.prompts.model_config.topP",name:_("topP"),validationState:x("topP")?"error":void 0}),x("topP")&&(0,g.Y)(l.FormUI.Message,{type:"error",message:null===(t=x("topP"))||void 0===t?void 0:t.message})]}),(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.topK",children:(0,g.Y)(d.A,{id:"VSitCY",defaultMessage:"Top K"})}),(0,g.Y)(l.RHFControlledComponents.Input,{control:M,id:"mlflow.prompts.model_config.topK",componentId:"mlflow.prompts.model_config.topK",name:_("topK"),validationState:x("topK")?"error":void 0}),x("topK")&&(0,g.Y)(l.FormUI.Message,{type:"error",message:null===(w=x("topK"))||void 0===w?void 0:w.message})]}),(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.frequencyPenalty",children:(0,g.Y)(d.A,{id:"QZXOSm",defaultMessage:"Frequency Penalty"})}),(0,g.Y)(l.RHFControlledComponents.Input,{control:M,id:"mlflow.prompts.model_config.frequencyPenalty",componentId:"mlflow.prompts.model_config.frequencyPenalty",name:_("frequencyPenalty"),validationState:x("frequencyPenalty")?"error":void 0}),x("frequencyPenalty")&&(0,g.Y)(l.FormUI.Message,{type:"error",message:null===(C=x("frequencyPenalty"))||void 0===C?void 0:C.message})]}),(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.presencePenalty",children:(0,g.Y)(d.A,{id:"xpwj4T",defaultMessage:"Presence Penalty"})}),(0,g.Y)(l.RHFControlledComponents.Input,{control:M,id:"mlflow.prompts.model_config.presencePenalty",componentId:"mlflow.prompts.model_config.presencePenalty",name:_("presencePenalty"),validationState:x("presencePenalty")?"error":void 0}),x("presencePenalty")&&(0,g.Y)(l.FormUI.Message,{type:"error",message:null===(b=x("presencePenalty"))||void 0===b?void 0:b.message})]})]}),(0,g.FD)("div",{children:[(0,g.Y)(l.FormUI.Label,{htmlFor:"mlflow.prompts.model_config.stopSequences",children:(0,g.Y)(d.A,{id:"9oh44C",defaultMessage:"Stop Sequences (comma-separated)"})}),(0,g.Y)(l.RHFControlledComponents.Input,{control:M,id:"mlflow.prompts.model_config.stopSequences",componentId:"mlflow.prompts.model_config.stopSequences",name:_("stopSequences"),placeholder:P.formatMessage({id:"x03ytD",defaultMessage:"e.g., END, ###, STOP"}),validationState:x("stopSequences")?"error":void 0}),x("stopSequences")&&(0,g.Y)(l.FormUI.Message,{type:"error",message:null===(S=x("stopSequences"))||void 0===S?void 0:S.message})]})]})]})}},55570:function(e,o,t){t.d(o,{X:function(){return d}});t(46709);var r=t(89949),n=t(82716),a=t(27757),l=t(40724),s=t(73408);function i(){return(0,s.Y)(n.Empty,{"data-testid":"fallback",title:(0,s.Y)(l.A,{id:"qAdWdK",defaultMessage:"Error"}),description:(0,s.Y)(l.A,{id:"RzZVxC",defaultMessage:"An error occurred while rendering this component."}),image:(0,s.Y)(a.k,{})})}function m({children:e,customFallbackComponent:o}){function t(e,o){console.error("Caught Unexpected Error: ",e,o.componentStack)}return o?(0,s.Y)(r.tH,{onError:t,FallbackComponent:o,children:e}):(0,s.Y)(r.tH,{onError:t,fallback:(0,s.Y)(i,{}),children:e})}function d(e,o,t,r){return function(e){return(0,s.Y)(m,{customFallbackComponent:r,children:(0,s.Y)(o,{...e})})}}},59795:function(e,o,t){t.d(o,{M:function(){return s}});var r=t(36476),n=t(61077),a=t(6050);const l=async({reject:e,response:o,err:t})=>{const n=(0,r.a$)(o),a=n instanceof r.Bk?t:n;if(o)try{var l;const e=null===(l=await o.json())||void 0===l?void 0:l.message;e&&(a.message=e)}catch{}e(a)},s={listRegisteredPrompts:(e,o,t)=>{const r=new URLSearchParams,s=(0,a.Cs)(e);let i=`tags.\`${a.PS}\` = '${a.pY}'`;t&&(i+=` AND tags.\`${a.TV}\` ILIKE '%,${t},%'`),s&&(i+=` AND ${s}`),o&&r.append("page_token",o),r.append("filter",i);const m=["ajax-api/2.0/mlflow/registered-models/search",r.toString()].join("?");return(0,n.AC)({relativeUrl:m,error:l})},setRegisteredPromptTag:(e,o,t)=>(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/registered-models/set-tag",method:"POST",body:JSON.stringify({key:o,value:t,name:e}),error:l}),deleteRegisteredPromptTag:(e,o)=>(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/registered-models/delete-tag",method:"DELETE",body:JSON.stringify({key:o,name:e}),error:l}),createRegisteredPrompt:(e,o=[])=>(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/registered-models/create",method:"POST",body:JSON.stringify({name:e,tags:[{key:a.PS,value:a.pY},...o]}),error:l}),createRegisteredPromptVersion:(e,o=[],t)=>(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/model-versions/create",method:"POST",body:JSON.stringify({name:e,description:t,source:"dummy-source",tags:[{key:a.PS,value:a.pY},...o]}),error:l}),setRegisteredPromptVersionTag:(e,o,t,r)=>(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/model-versions/set-tag",method:"POST",body:JSON.stringify({key:t,value:r,name:e,version:o}),error:l}),deleteRegisteredPromptVersionTag:(e,o,t)=>{(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/model-versions/delete-tag",method:"DELETE",body:JSON.stringify({key:t,name:e,version:o}),error:l})},getPromptDetails:e=>{const o=new URLSearchParams;o.append("name",e);const t=["ajax-api/2.0/mlflow/registered-models/get",o.toString()].join("?");return(0,n.AC)({relativeUrl:t,error:l})},getPromptVersions:e=>{const o=new URLSearchParams;o.append("filter",`name='${e}' AND tags.\`${a.PS}\` = '${a.pY}'`);const t=["ajax-api/2.0/mlflow/model-versions/search",o.toString()].join("?");return(0,n.AC)({relativeUrl:t,error:l})},getPromptVersionsForRun:e=>{const o=new URLSearchParams;o.append("filter",`tags.\`${a.PS}\` = '${a.pY}' AND tags.\`${a.xd}\` ILIKE "%${e}%"`);const t=["ajax-api/2.0/mlflow/model-versions/search",o.toString()].join("?");return(0,n.AC)({relativeUrl:t,error:l})},deleteRegisteredPrompt:e=>(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/registered-models/delete",method:"DELETE",body:JSON.stringify({name:e}),error:l}),deleteRegisteredPromptVersion:(e,o)=>(0,n.AC)({relativeUrl:"ajax-api/2.0/mlflow/model-versions/delete",method:"DELETE",body:JSON.stringify({name:e,version:o}),error:l})}},60312:function(e,o,t){t.d(o,{m:function(){return l}});var r=t(82716),n=t(73408);var a={name:"13udsys",styles:"height:100%"};const l=({children:e,className:o})=>(0,n.Y)(r.PageWrapper,{css:a,className:o,children:e})},60527:function(e,o,t){t.d(o,{v:function(){return C},z:function(){return S}});var r=t(79081),n=t(82716),a=t(27757),l=t(46709),s=t(884),i=t(7655),m=t(40724),d=t(61060),p=t(59795),c=t(6050);var u=t(68248),g=t(73408);const f=["system","user","assistant"],v=({id:e,value:o,onChange:t,onBlur:r,placeholder:a})=>{const l=(0,n.useComboboxState)({componentId:e,items:f,allItems:f,setItems:()=>{},setInputValue:e=>{"string"===typeof e&&t(e)},multiSelect:!1,allowNewValue:!0,preventUnsetOnBlur:!0,itemToString:e=>null!==e&&void 0!==e?e:"",matcher:(e,o)=>{var t;return null!==(t=null===e||void 0===e?void 0:e.toLowerCase().includes(o.toLowerCase()))&&void 0!==t&&t},formValue:null!==o&&void 0!==o?o:"",initialInputValue:null!==o&&void 0!==o?o:"",formOnChange:e=>{"string"===typeof e?t(e):e||t("")}});return(0,g.FD)(n.TypeaheadComboboxRoot,{id:e,comboboxState:l,children:[(0,g.Y)(n.TypeaheadComboboxInput,{placeholder:a,comboboxState:l,formOnChange:e=>{"string"===typeof e?t(e):e||t("")},onBlur:r,allowClear:!0,showComboboxToggleButton:!0}),(0,g.Y)(n.TypeaheadComboboxMenu,{comboboxState:l,matchTriggerWidth:!0,children:f.map((e,o)=>(0,g.Y)(n.TypeaheadComboboxMenuItem,{item:e,index:o,comboboxState:l,children:e},e))})]})};var h={name:"1d3w5wq",styles:"width:100%"};const y=({name:e})=>{var o,t;const{control:r,formState:m}=(0,s.xW)(),{fields:d,insert:p,remove:c,replace:f}=(0,s.jz)({control:r,name:e}),{theme:y}=(0,a.u)(),{formatMessage:w}=(0,i.A)();return(0,g.FD)("div",{css:(0,u.AH)({display:"flex",flexDirection:"column",gap:y.spacing.sm},""),children:[d.map((o,t)=>(0,g.FD)("div",{css:(0,u.AH)({display:"grid",gridTemplateColumns:"120px 1fr auto auto",gap:y.spacing.sm},""),children:[(0,g.Y)(l.Fragment,{children:(0,g.Y)(s.xI,{control:r,name:`${e}.${t}.role`,render:({field:{value:e,onChange:o,onBlur:r}})=>(0,g.Y)(v,{id:`mlflow.prompts.chat_creator.role_${t}`,placeholder:w({id:"/DcBLQ",defaultMessage:"role"}),value:null!==e&&void 0!==e?e:"",onChange:o,onBlur:r})})}),(0,g.Y)(n.RHFControlledComponents.TextArea,{componentId:"mlflow.prompts.chat_creator.content",name:`${e}.${t}.content`,control:r,autoSize:{minRows:1,maxRows:6},css:h}),(0,g.Y)(a.B,{componentId:"mlflow.prompts.chat_creator.add_after",type:"tertiary",icon:(0,g.Y)(n.PlusIcon,{}),"aria-label":w({id:"MxiIan",defaultMessage:"Add message"}),onClick:()=>(e=>p(e+1,{role:"user",content:""}))(t)}),(0,g.Y)(a.B,{componentId:"mlflow.prompts.chat_creator.remove",type:"tertiary",icon:(0,g.Y)(n.TrashIcon,{}),"aria-label":w({id:"hT5ZGW",defaultMessage:"Remove message"}),onClick:()=>c(t),disabled:1===d.length})]},o.id)),(null===(o=m.errors)||void 0===o?void 0:o[e])&&(0,g.Y)(n.FormUI.Message,{type:"error",message:null===(t=m.errors[e])||void 0===t?void 0:t.message})]})};var w=t(46646);let C=function(e){return e.CreatePrompt="CreatePrompt",e.CreatePromptVersion="CreatePromptVersion",e}({});var b={name:"1hcx8jb",styles:"padding:0"};const S=({mode:e=C.CreatePromptVersion,registeredPrompt:o,latestVersion:t,experimentId:u,onSuccess:f})=>{const[v,h]=(0,l.useState)(!1),[S,Y]=(0,l.useState)(!1),P=(0,i.A)(),M=(0,s.mN)({defaultValues:{draftName:"",draftValue:"",chatMessages:[{role:"user",content:""}],commitMessage:"",tags:[],promptType:c.Qk,modelConfig:{}}}),F=e===C.CreatePrompt,I=e===C.CreatePromptVersion,{mutate:T,error:_,reset:x,isLoading:N}=(0,d.n)({mutationFn:async({promptName:e,promptType:o,createPromptEntity:t,content:r,commitMessage:n,tags:a,promptTags:l=[]})=>{var s;t&&await p.M.createRegisteredPrompt(e,l);const i=await p.M.createRegisteredPromptVersion(e,[{key:c.Dh,value:r},{key:c.$,value:o},...a],n),m=null===i||void 0===i||null===(s=i.model_version)||void 0===s?void 0:s.version;if(!m)throw new Error("Failed to create a new prompt version");return{version:m}}}),k=(0,g.Y)(s.Op,{...M,children:(0,g.FD)(r.d,{componentId:"mlflow.prompts.create.modal",visible:v,onCancel:()=>h(!1),title:I?(0,g.Y)(m.A,{id:"XLSmZx",defaultMessage:"Create prompt version"}):(0,g.Y)(m.A,{id:"wh+Eos",defaultMessage:"Create prompt"}),okText:(0,g.Y)(m.A,{id:"TSXmaB",defaultMessage:"Create"}),okButtonProps:{loading:N},onOk:M.handleSubmit(async e=>{const t=I&&null!==o&&void 0!==o&&o.name?null===o||void 0===o?void 0:o.name:e.draftName;if(e.promptType===c.Xs){if(e.chatMessages.some(e=>!e.content||!e.content.trim()))return void M.setError("chatMessages",{type:"required",message:P.formatMessage({id:"4g2H7S",defaultMessage:"Prompt content is required"})})}const r=(0,c._f)(e.modelConfig);if(Object.keys(r).length>0)return void Object.entries(r).forEach(([e,o])=>{M.setError(`modelConfig.${e}`,{type:"validation",message:o})});const n=e.chatMessages.map(e=>({...e,content:e.content.trim()})),a=u?[{key:c.TV,value:`,${u},`}]:[],l=(0,c.V)(e.modelConfig),s=l?[{key:c.Nb,value:JSON.stringify(l)}]:[];T({createPromptEntity:F,content:e.promptType===c.Xs?JSON.stringify(n):e.draftValue,commitMessage:e.commitMessage,promptName:t,tags:[...e.tags,...s],promptTags:a,promptType:e.promptType},{onSuccess:e=>{const o=null===e||void 0===e?void 0:e.version;null===f||void 0===f||f({promptName:t,promptVersion:o}),h(!1)}})}),cancelText:(0,g.Y)(m.A,{id:"WP50re",defaultMessage:"Cancel"}),size:"wide",children:[(null===_||void 0===_?void 0:_.message)&&(0,g.FD)(g.FK,{children:[(0,g.Y)(n.Alert,{componentId:"mlflow.prompts.create.error",closable:!1,message:_.message,type:"error"}),(0,g.Y)(r.S,{})]}),F&&(0,g.FD)(g.FK,{children:[(0,g.Y)(n.FormUI.Label,{htmlFor:"mlflow.prompts.create.name",children:"Name:"}),(0,g.Y)(n.RHFControlledComponents.Input,{control:M.control,id:"mlflow.prompts.create.name",componentId:"mlflow.prompts.create.name",name:"draftName",rules:{required:{value:!0,message:P.formatMessage({id:"Rlwm5V",defaultMessage:"Name is required"})},pattern:{value:/^[a-zA-Z0-9_\-.]+$/,message:P.formatMessage({id:"HZdpLU",defaultMessage:"Only alphanumeric characters, underscores, hyphens, and dots are allowed"})}},placeholder:P.formatMessage({id:"zAuZ2j",defaultMessage:"Provide an unique prompt name"}),validationState:M.formState.errors.draftName?"error":void 0}),M.formState.errors.draftName&&(0,g.Y)(n.FormUI.Message,{type:"error",message:M.formState.errors.draftName.message}),(0,g.Y)(r.S,{})]}),(0,g.Y)(n.FormUI.Label,{children:(0,g.Y)(m.A,{id:"81PFb9",defaultMessage:"Prompt type:"})}),(0,g.Y)(s.xI,{control:M.control,name:"promptType",render:({field:e})=>(0,g.FD)(n.SegmentedControlGroup,{name:"promptType",componentId:"promptType",value:e.value,onChange:e.onChange,children:[(0,g.Y)(n.SegmentedControlButton,{value:c.Qk,children:(0,g.Y)(m.A,{id:"ERWI9o",defaultMessage:"Text"})}),(0,g.Y)(n.SegmentedControlButton,{value:c.Xs,children:(0,g.Y)(m.A,{id:"xKpbD3",defaultMessage:"Chat"})})]})}),(0,g.Y)(r.S,{}),(0,g.Y)(n.FormUI.Label,{htmlFor:"mlflow.prompts.create.content",children:"Prompt:"}),M.watch("promptType")===c.Xs?(0,g.Y)(y,{name:"chatMessages"}):(0,g.Y)(n.RHFControlledComponents.TextArea,{control:M.control,id:"mlflow.prompts.create.content",componentId:"mlflow.prompts.create.content",name:"draftValue",autoSize:{minRows:3,maxRows:10},rules:{required:{value:!0,message:P.formatMessage({id:"wq+WyH",defaultMessage:"Prompt content is required"})}},placeholder:P.formatMessage({id:"2JfWh3",defaultMessage:"Type prompt content here. Wrap variables with double curly brace e.g. '{{' name '}}'."}),validationState:M.formState.errors.draftValue?"error":void 0}),M.watch("promptType")===c.Qk&&M.formState.errors.draftValue&&(0,g.Y)(n.FormUI.Message,{type:"error",message:M.formState.errors.draftValue.message}),(0,g.Y)(r.S,{}),(0,g.Y)(n.FormUI.Label,{htmlFor:"mlflow.prompts.create.commit_message",children:"Commit message (optional):"}),(0,g.Y)(n.RHFControlledComponents.Input,{control:M.control,id:"mlflow.prompts.create.commit_message",componentId:"mlflow.prompts.create.commit_message",name:"commitMessage"}),(0,g.Y)(r.S,{}),(0,g.Y)(a.B,{componentId:"mlflow.prompts.create.toggle_advanced_settings",type:"link",onClick:()=>Y(!S),icon:S?(0,g.Y)(n.ChevronDownIcon,{}):(0,g.Y)(a.o,{}),css:b,children:(0,g.Y)(m.A,{id:"R1FeSE",defaultMessage:"Advanced settings (optional)"})}),S&&(0,g.FD)(g.FK,{children:[(0,g.Y)(r.S,{size:"sm"}),(0,g.Y)(w.G,{})]})]})});return{CreatePromptModal:k,openModal:()=>{var o,r;x();const n=e===C.CreatePromptVersion&&t&&null!==(o=(0,c.dv)(t))&&void 0!==o?o:"",a=(0,c.f5)(t)?c.Xs:c.Qk,l=(0,c.yC)(n),s=e===C.CreatePromptVersion&&(null===t||void 0===t||null===(r=t.tags)||void 0===r?void 0:r.some(e=>e.key===c.Nb&&e.value));M.reset({commitMessage:"",draftName:"",draftValue:l?"":n,chatMessages:l?l.map(e=>({...e})):[{role:"user",content:""}],tags:[],promptType:a,modelConfig:{}}),Y(!!s),h(!0)}}}},68079:function(e,o,t){t.d(o,{u:function(){return m}});var r=t(82716),n=t(27757),a=t(40724),l=t(60312),s=t(73408);var i={name:"1vfb318",styles:"flex:1;display:flex;align-items:center;justify-content:center"};const m=({error:e})=>{var o;return(0,s.Y)(l.m,{css:i,children:(0,s.Y)(r.Empty,{"data-testid":"fallback",title:(0,s.Y)(a.A,{id:"AOoWxS",defaultMessage:"Error"}),description:null!==(o=null===e||void 0===e?void 0:e.message)&&void 0!==o?o:(0,s.Y)(a.A,{id:"zmMR5p",defaultMessage:"An error occurred while rendering this component."}),image:(0,s.Y)(n.k,{})})})}},73227:function(e,o,t){t.d(o,{i:function(){return i}});var r=t(61060),n=t(27042),a=t(59795),l=t(46709),s=t(181);const i=({onSuccess:e})=>{const o=(0,r.n)({mutationFn:async({toAdd:e,toDelete:o,promptId:t})=>Promise.all([...e.map(({key:e,value:o})=>a.M.setRegisteredPromptTag(t,e,o)),...o.map(({key:e})=>a.M.deleteRegisteredPromptTag(t,e))])}),{EditTagsModal:t,showEditTagsModal:i,isLoading:m}=(0,n.Q)({valueRequired:!0,saveTagsHandler:(t,r,n)=>{const{addedOrModifiedTags:a,deletedTags:l}=(0,s.Rf)(r,n);return new Promise((r,n)=>{if(!t.name)return n();o.mutate({promptId:t.name,toAdd:a,toDelete:l},{onSuccess:()=>{r(),null===e||void 0===e||e()},onError:n})})}});return{EditTagsModal:t,showEditPromptTagsModal:(0,l.useCallback)(e=>i({name:e.name,tags:e.tags.filter(e=>(0,s.oD)(e.key))}),[i]),isLoading:m}}},91113:function(e,o,t){t.d(o,{h:function(){return s}});var r=t(36476),n=t(77153),a=t(24523);class l{}l.mlflowServices={MODEL_REGISTRY:"Model Registry",EXPERIMENTS:"Experiments",CHAT_SESSIONS:"Chat Sessions",MODEL_SERVING:"Model Serving",RUN_TRACKING:"Run Tracking"};const s=(e,o)=>{if(!(e instanceof n.s))return;const{status:t}=e;let l;const s={status:t};e.getErrorCode()===a.tG.RESOURCE_DOES_NOT_EXIST&&(l=new r.m_(s)),e.getErrorCode()===a.tG.PERMISSION_DENIED&&(l=new r.i_(s)),e.getErrorCode()===a.tG.INTERNAL_ERROR&&(l=new r.PO(s)),e.getErrorCode()===a.tG.INVALID_PARAMETER_VALUE&&(l=new r.v7(s));const i=e.getMessageField();return l&&i&&(l.message=i),l};o.A=l}}]);