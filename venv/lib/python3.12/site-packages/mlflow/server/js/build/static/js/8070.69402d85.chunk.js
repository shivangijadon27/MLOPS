"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[8070],{110:function(e,t,n){n.d(t,{N_:function(){return h},Oz:function(){return f},g:function(){return m},tW:function(){return a.tW},zy:function(){return g}});var s=n(46709),r=n(27637),a=n(55113),o=n(58024),i=n(73408);const l="workspace",c=()=>{if("undefined"===typeof window)return null;try{return window.localStorage.getItem("mlflow.activeWorkspace")}catch{return null}},d=["/settings"],u=e=>{const t=e.split("?")[0].split("#")[0];return d.some(e=>t===e||t.startsWith(e+"/"))},p=e=>{if("string"!==typeof e||0===e.length)return e;if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e))return e;const t=e.startsWith("#")?"#":"",n=t?e.slice(1):e;if(!(""!==t||n.startsWith("/")))return e;let s=n,r="";const a=s.indexOf("#");a>=0&&(s=s.slice(0,a));const o=s.indexOf("?");o>=0&&(r=s.slice(o+1),s=s.slice(0,o));const i=new URLSearchParams(r).has(l);if(u(s||"/"))return(e=>{const t=e.startsWith("#")?"#":"";let n=t?e.slice(1):e,s="",r="";const a=n.indexOf("#");a>=0&&(r=n.slice(a),n=n.slice(0,a));const o=n.indexOf("?");o>=0&&(s=n.slice(o+1),n=n.slice(0,o));const i=new URLSearchParams(s);i.delete(l);const c=i.toString();return`${t}${n}${c?"?"+c:""}${r}`})(e);if(i)return e;const d=c();return d?((e,t)=>{const n=e.startsWith("#")?"#":"";let s=n?e.slice(1):e,r="",a="";const o=s.indexOf("#");o>=0&&(a=s.slice(o),s=s.slice(0,o));const i=s.indexOf("?");i>=0&&(r=s.slice(i+1),s=s.slice(0,i));const c=new URLSearchParams(r);return c.set(l,t),`${n}${s}?${c.toString()}${a}`})(e,d):e},m=o.g,g=o.zy,h=s.forwardRef(function(e,t){const{to:n,disableWorkspacePrefix:s,...a}=e,o=s?n:(e=>{if("string"===typeof e)return p(e);if("object"===typeof e&&null!==e){const t="pathname"in e?e.pathname:void 0;if("string"!==typeof t)return e;if(u(t)){if(e.search){const t=new URLSearchParams(e.search);t.delete(l);const n=t.toString();return{...e,search:n?`?${n}`:void 0}}return e}const n=c();if(!n)return e;const s=e.search||"",r=new URLSearchParams(s.startsWith("?")?s.slice(1):s);return r.set(l,n),{...e,search:`?${r.toString()}`}}return e})(n);return(0,i.Y)(r.N_,{ref:t,to:o,...a})}),f=e=>e},3241:function(e,t,n){var s=n(68248),r=n(46709),a=n(27556),o=n(82716),i=n(27757),l=n(66916),c=n(73408);var d={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};t.A=({searchFilter:e,setSearchFilter:t,matchData:n,handleNextSearchMatch:u,handlePreviousSearchMatch:p})=>{const[m,g]=(0,r.useState)(e),h=(0,a.YQ)(t,350),{theme:f}=(0,i.u)();return(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:f.spacing.sm},""),children:[(0,c.Y)(l.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:m,onClear:()=>{t(""),g("")},onChange:e=>{g(e.target.value),h(e.target.value.toLowerCase())},prefix:(0,c.Y)(l.S,{}),css:d}),n.match&&(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",marginLeft:f.spacing.xs,marginRight:f.spacing.sm,alignItems:"center"},""),children:[(0,c.FD)(i.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginRight:f.spacing.sm},""),children:[n.currentMatchIndex+1," / ",n.totalMatches]}),(0,c.Y)(i.B,{"data-testid":"prev-search-match",icon:(0,c.Y)(o.ChevronUpIcon,{}),onClick:p,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,c.Y)(i.B,{"data-testid":"next-search-match",icon:(0,c.Y)(o.ChevronDownIcon,{}),onClick:u,componentId:"shared.model-trace-explorer.next-search-match"})]})]})}},4947:function(e,t,n){n(76118),n(46709);var s=n(33481);n(64667),n(71540);s._1.CHUNK_RELEVANCE,s._1.TOTAL_INPUT_TOKEN_COUNT,s._1.TOTAL_OUTPUT_TOKEN_COUNT,s._1.TOTAL_TOKEN_COUNT,s._1.DOCUMENT_RECALL,s._1.DOCUMENT_RATINGS},5075:function(e,t,n){n.d(t,{Q:function(){return u}});var s=n(68248),r=(n(46709),n(82716)),a=n(27757),o=n(79081),i=n(42747),l=n(73408);const c={user_frustration:{none:{color:"lime",icon:r.CheckCircleIcon,label:(0,l.Y)(i.sA,{id:"Sm0bXt",defaultMessage:"None"})},resolved:{color:"lemon",icon:r.CheckCircleIcon,label:(0,l.Y)(i.sA,{id:"q90WPh",defaultMessage:"Resolved"})},unresolved:{color:"coral",icon:r.XCircleIcon,label:(0,l.Y)(i.sA,{id:"OcYzCN",defaultMessage:"Unresolved"})}}};var d={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const u=({jsonValue:e,className:t,prefix:n,skipIcons:u=!1,overrideColor:p,assessmentName:m})=>{const{theme:g}=(0,a.u)();if(!e||'""'===e)return null;let h;try{h=JSON.parse(e)}catch(b){h=e}let f="default",v=JSON.stringify(h,null,2);const x=((e,t,n,r)=>{if(!e)return;const a=c[e];if(!a)return;const o=a[String(null!==t&&void 0!==t?t:"")];if(!o)return;const i=o.icon;return{color:o.color,children:(0,l.FD)(l.FK,{children:[!r&&(0,l.Y)(i,{css:(0,s.AH)({marginRight:n.spacing.xs},"")}),o.label]})}})(m,h,g,u);x?(f=x.color,v=x.children):"yes"===h?(f="lime",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(r.CheckCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===h?(f="coral",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(r.XCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof h?v=h:null===h?(f="coral",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(a.k,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===h?(f="lime",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(r.CheckCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===h&&(f="coral",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(r.XCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"4U/RVz",defaultMessage:"False"})]}));const y=(0,l.FD)(l.FK,{children:[n,v]});return(0,l.Y)(o.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:y,children:(0,l.Y)(r.Tag,{css:(0,s.AH)({display:"inline-flex",maxWidth:"100%",minWidth:g.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:null!==p&&void 0!==p?p:f,className:t,children:(0,l.FD)("span",{css:d,children:[n,v]})})})}},8531:function(e,t,n){n.d(t,{a:function(){return U}});var s=n(68248),r=n(46709),a=n(27757),o=n(42747),i=n(81390),l=n(82716),c=n(79081),d=n(86125),u=n(51847),p=n(73408);const m=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:n}=(0,a.u)();return(0,p.FD)(a.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,p.Y)(a.aw.Trigger,{asChild:!0,children:(0,p.Y)(a.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,p.Y)(l.FilterIcon,{}),size:"small",children:(0,p.Y)(o.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,p.Y)(a.aw.Content,{align:"start",children:(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{bold:!0,children:(0,p.Y)(o.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,p.Y)(a.T.Text,{color:"secondary",children:(0,p.Y)(o.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map(([r,o])=>{const i=(0,p.Y)(u.P,{type:(0,d.tC)(r)});return(0,p.FD)(l.Checkbox,{componentId:"shared.model-trace-explorer.toggle-span-filter",style:{width:"100%"},isChecked:o,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[r]:!o}}),children:[i,(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),children:(0,d.LS)(r)})]},r)}),(0,p.Y)(a.T.Text,{color:"secondary",children:(0,p.Y)(o.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,p.FD)(l.Checkbox,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_timeline_tree_timelinetreefilterbutton_83",style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,p.Y)(o.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,p.Y)(l.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,p.Y)(o.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,p.FD)(l.Checkbox,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_timeline_tree_timelinetreefilterbutton_111",style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,p.Y)(o.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,p.Y)(l.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,p.Y)(o.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},g=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:n,setSpanFilterState:r})=>{const{theme:i}=(0,a.u)();return(0,p.FD)("div",{css:(0,s.AH)({padding:`${i.spacing.xs}px ${i.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${i.colors.border}`,boxSizing:"border-box",paddingLeft:i.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,p.Y)(a.T.Text,{bold:!0,children:(0,p.Y)(o.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[(0,p.Y)(m,{spanFilterState:n,setSpanFilterState:r}),(0,p.FD)(l.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,p.Y)(l.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,p.Y)(c.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,p.Y)(o.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,p.Y)(l.ListBorderIcon,{})}),value:!1}),(0,p.Y)(l.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,p.Y)(c.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,p.Y)(o.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,p.Y)(l.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},h=({active:e})=>{const{theme:t}=(0,a.u)(),n=e?t.colors.blue500:t.colors.border;return(0,p.Y)("div",{css:(0,s.AH)({position:"absolute",left:"100%",bottom:0,width:i.De/2+1,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${n}`,borderRight:`1px solid ${n}`,zIndex:i.u4.LOW},"")})},f=({active:e})=>{const{theme:t}=(0,a.u)(),n=e?t.colors.blue500:t.colors.border;return(0,p.Y)("div",{css:(0,s.AH)({position:"absolute",left:"50%",top:0,width:i.De/2,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${n}`,borderLeft:`1px solid ${n}`,zIndex:e?i.u4.NORMAL:i.u4.LOW},"")})},v=({active:e})=>{const{theme:t}=(0,a.u)(),n=e?t.colors.blue500:t.colors.border;return(0,p.Y)("div",{css:(0,s.AH)({position:"absolute",width:i.De/2,left:"50%",height:i.QJ,borderLeft:`1px solid ${n}`,boxSizing:"border-box",zIndex:e?i.u4.NORMAL:i.u4.LOW},"")})},x=({isActiveSpan:e,isInActiveChain:t,linesToRender:n,hasChildren:r,isExpanded:a})=>0===n.length?(0,p.Y)("div",{css:(0,s.AH)({width:0,height:i.QJ,boxSizing:"border-box",position:"relative"},""),children:r&&(0,p.Y)(h,{active:t&&!e})}):(0,p.Y)(p.FK,{children:n.map(({shouldRender:o,isActive:l},c)=>(0,p.FD)("div",{css:(0,s.AH)({width:i.De,height:i.QJ,boxSizing:"border-box",position:"relative"},""),children:[o&&(0,p.Y)(v,{active:l}),c===n.length-1&&(0,p.FD)(p.FK,{children:[(0,p.Y)(f,{active:t}),r&&a&&(0,p.Y)(h,{active:t&&!e})]})]},c))});var y=n(94664);var b={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Y=({span:e,children:t})=>{var n;const{theme:r}=(0,a.u)(),l=(0,d.tC)(null!==(n=e.type)&&void 0!==n?n:y.UG.UNKNOWN),m=r.isDarkMode?r.colors.grey800:r.colors.grey100,g=r.isDarkMode?r.colors.grey500:r.colors.grey350;return(0,p.Y)(c.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,p.FD)("div",{css:b,children:[(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,p.Y)(u.P,{type:l,isInTooltip:!0}),(0,p.Y)("span",{css:(0,s.AH)({color:m},""),children:e.title}),(0,p.Y)("span",{css:(0,s.AH)({marginLeft:r.spacing.xs,color:g,fontSize:r.typography.fontSizeSm},""),children:(0,i.X6)(e.end-e.start)})]}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",color:m},""),children:[(0,p.Y)(o.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",(0,i.X6)(e.start)," | ",(0,p.Y)(o.sA,{id:"q90jVU",defaultMessage:"End:"})," ",(0,i.X6)(e.end)]})]}),side:"right",maxWidth:700,children:t})};var A=n(53915);var S={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},T={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const w=({node:e,selectedKey:t,expandedKeys:n,setExpandedKeys:r,traceStartTime:o,traceEndTime:c,onSelect:u,linesToRender:m})=>{var g,h;const f=n.has(e.key),{theme:v}=(0,a.u)(),y=(null!==(g=e.children)&&void 0!==g?g:[]).length>0,{setAssessmentsPaneExpanded:b}=(0,A.nJ)(),M=t===e.key,E=(0,i.VD)(e,String(t)),I=E>-1,C=(0,d.N7)(e)>0,k=M?v.colors.actionDefaultBackgroundHover:"transparent";return(0,p.FD)(p.FK,{children:[(0,p.Y)(Y,{span:e,children:(0,p.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:k,":hover":{backgroundColor:v.colors.actionDefaultBackgroundHover},":active":{backgroundColor:v.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===u||void 0===u||u(e)},children:(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${v.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,p.FD)("div",{css:S,children:[y?(0,p.Y)(a.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:v.spacing.xs},""),icon:f?(0,p.Y)(l.ChevronDownIcon,{}):(0,p.Y)(a.o,{}),onClick:t=>{t.stopPropagation();const s=new Set(n);f?s.delete(e.key):s.add(e.key),r(s)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,p.Y)("div",{css:(0,s.AH)({width:24,marginRight:v.spacing.xs},"")}),(0,p.Y)(x,{isActiveSpan:M,isInActiveChain:I,linesToRender:m,hasChildren:y,isExpanded:f}),(0,p.Y)("span",{css:(0,s.AH)({flexShrink:0,marginRight:v.spacing.xs,borderRadius:v.borders.borderRadiusSm,border:`1px solid ${E>-1?v.colors.blue500:v.colors.backgroundSecondary}`,zIndex:i.u4.NORMAL},""),children:e.icon}),(0,p.Y)(a.T.Text,{color:C?"error":"primary",css:T,children:e.title}),e.assessments.length>0&&(0,p.FD)(l.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,s.AH)({margin:0,borderRadius:v.borders.borderRadiusSm},""),onClick:()=>null===b||void 0===b?void 0:b(!0),children:[(0,p.Y)(l.GavelIcon,{}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginLeft:v.spacing.xs},""),children:e.assessments.length})]})]})})})}),f&&(null===(h=e.children)||void 0===h?void 0:h.map((s,a)=>{var i,l;return(0,p.Y)(w,{node:s,expandedKeys:n,setExpandedKeys:r,selectedKey:t,traceStartTime:o,traceEndTime:c,onSelect:u,linesToRender:m.concat({shouldRender:a<(null!==(i=null===(l=e.children)||void 0===l?void 0:l.length)&&void 0!==i?i:0)-1,isActive:a<E})},s.key)}))]})};var M=n(49633);var E={name:"s5xdrg",styles:"display:flex;align-items:center"},I={name:"1aunqn6",styles:"display:none;align-items:center"},C={name:"s5xdrg",styles:"display:flex;align-items:center"},k={name:"1aunqn6",styles:"display:none;align-items:center"};const D=({node:e,selectedKey:t,leftOffset:n,width:o,onSelect:c,expandedKeys:d,setExpandedKeys:u})=>{var m;const{theme:g}=(0,a.u)(),h=(0,r.useRef)(null),f=(0,r.useRef)(null),v=t===e.key?g.colors.actionDefaultBackgroundHover:"transparent",x=(null!==(m=e.children)&&void 0!==m?m:[]).length>0,y=d.has(e.key);return(0,r.useLayoutEffect)(()=>{const e=h.current,t=f.current;if(!e||!t)return;e.style.display="inline-flex",t.style.display="inline-flex";const n=Math.max(e.offsetWidth,t.offsetWidth)<o-2*g.spacing.sm;var s;s=n,e.style.display=s?"inline-flex":"none",t.style.display=s?"none":"inline-flex"},[g.spacing.sm,o,y,e.title,e.icon]),(0,p.Y)(Y,{span:e,children:(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:g.spacing.xs,paddingRight:g.spacing.sm,paddingTop:g.spacing.xs,paddingBottom:g.spacing.xs,backgroundColor:v,alignItems:"center",":hover":{backgroundColor:g.colors.actionDefaultBackgroundHover},":active":{backgroundColor:g.colors.actionDefaultBackgroundPress},zIndex:i.u4.NORMAL},""),onClick:()=>null===c||void 0===c?void 0:c(e),children:[x?(0,p.Y)(a.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:g.spacing.xs},""),icon:y?(0,p.Y)(l.ChevronDownIcon,{}):(0,p.Y)(a.o,{}),onClick:t=>{t.stopPropagation();const n=new Set(d);y?n.delete(e.key):n.add(e.key),u(n)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,p.Y)("div",{css:(0,s.AH)({width:g.spacing.lg,marginRight:g.spacing.xs},"")}),(0,p.Y)("div",{css:(0,s.AH)({width:n,flexShrink:0},"")}),(0,p.Y)("div",{css:(0,s.AH)({position:"relative",width:o,height:g.typography.lineHeightLg,backgroundColor:g.isDarkMode?g.colors.blue600:g.colors.blue300,border:`1px solid ${g.isDarkMode?g.colors.blue400:g.colors.blue500}`,borderRadius:g.borders.borderRadiusSm,flexShrink:0,display:"flex",alignItems:"center"},""),children:(0,p.Y)(a.T.Text,{color:"primary",css:E,children:(0,p.FD)("span",{ref:h,css:I,children:[e.icon&&(0,p.Y)("span",{css:(0,s.AH)({flexShrink:0,"& > div":{height:g.general.buttonInnerHeight,borderTopRightRadius:0,borderBottomRightRadius:0}},""),children:e.icon}),(0,p.Y)("span",{css:(0,s.AH)({marginLeft:g.spacing.xs,color:g.colors.textPrimary},""),children:e.title})]})})}),(0,p.Y)("div",{css:(0,s.AH)({flex:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-flex",alignItems:"center",gap:g.spacing.xs,marginLeft:g.spacing.sm},""),children:(0,p.FD)("div",{css:(0,s.AH)({display:"inline-flex",alignItems:"center",backgroundColor:g.colors.backgroundSecondary,border:`1px solid ${g.colors.border}`,borderRadius:g.borders.borderRadiusSm,paddingRight:g.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{color:"primary",css:C,children:(0,p.FD)("span",{ref:f,css:k,children:[e.icon&&(0,p.Y)("span",{css:(0,s.AH)({flexShrink:0,marginLeft:0,borderRight:`1px solid ${g.colors.border}`,"& > div":{height:g.general.buttonInnerHeight,borderTopRightRadius:0,borderBottomRightRadius:0}},""),children:e.icon}),(0,p.Y)("span",{css:(0,s.AH)({color:g.colors.textPrimary,marginLeft:g.spacing.xs},""),children:e.title})]})}),(0,p.Y)(a.T.Text,{color:"secondary",children:(0,p.Y)("span",{css:(0,s.AH)({marginLeft:g.spacing.xs},""),children:(0,i.X6)(e.end-e.start)})})]})})]},e.key)})};var N={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},R={name:"bjn8wh",styles:"position:relative"},_={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const L=({nodes:e,selectedKey:t,onSelect:n,traceStartTime:o,traceEndTime:l,expandedKeys:c,setExpandedKeys:d})=>{var u,m;const{theme:g}=(0,a.u)(),h=(0,r.useRef)(null),f=null!==(u=null===(m=(0,M.wY)({ref:h}))||void 0===m?void 0:m.width)&&void 0!==u?u:0,v=(0,r.useMemo)(()=>function(e,t,n,s=60){const r=t-e;if(r<=0||n<=0)return[];const a=Math.floor(n/s);if(a<1)return[];const o=r/a,i=Math.pow(10,Math.floor(Math.log10(o))),l=o/i;let c;c=l<=1?1:l<=2?2:l<=5?5:10;const d=c*i,u=t+2*d,p=[];for(let m=Math.ceil(e/d)*d;m<=u;m+=d)p.push(Number(m.toFixed(10)));return p}(o,l,f),[l,o,f]),x=Math.min(...v),y=(v[v.length-1]+v[v.length-2])/2,b=v.slice(0,-1),Y=e=>function(e,t,n,s){return(e-t)/(n-t)*s}(e,x,y,f);return(0,p.FD)("div",{css:N,children:[(0,p.Y)("div",{ref:h,css:(0,s.AH)({display:"flex",width:"100%",flexDirection:"row",height:g.typography.lineHeightBase,paddingLeft:32,paddingRight:g.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:g.colors.backgroundPrimary,zIndex:i.u4.HIGH},""),children:(0,p.Y)("div",{"data-testid":"time-marker-area",css:R,children:b.map(e=>(0,p.Y)(a.T.Text,{css:(0,s.AH)({position:"absolute",transform:"translateX(-50%)",left:Y(e),whiteSpace:"nowrap"},""),children:(0,i.X6)(e)},e))})}),(0,p.Y)("div",{css:(0,s.AH)({flex:1,pointerEvents:"none",zIndex:i.u4.LOW},""),children:(0,p.Y)("div",{css:_,children:b.map(e=>(0,p.Y)("div",{css:(0,s.AH)({position:"absolute",left:Y(e)+32,borderRight:`1px solid ${g.colors.border}`,height:"100%"},"")},e))})}),e.map(e=>{const s=Y(e.start),r=Y(e.end)-s;return(0,p.Y)(D,{selectedKey:t,onSelect:n,node:e,leftOffset:s,width:r,expandedKeys:c,setExpandedKeys:d},e.key)})]})};var F={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},H={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},O={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},z={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const U=({rootNodes:e,selectedNode:t,setSelectedNode:n,traceStartTime:l,traceEndTime:c,expandedKeys:d,setExpandedKeys:u,spanFilterState:m,setSpanFilterState:h,className:f})=>{const{theme:v}=(0,a.u)(),x=(0,r.useCallback)(e=>{null===n||void 0===n||n(e)},[n]),{showTimelineTreeGantt:y,setShowTimelineTreeGantt:b}=(0,A.nJ)(),Y=(0,r.useMemo)(()=>(0,i.os)(e,d),[e,d]),S=(0,r.useMemo)(()=>{var n;return(0,p.Y)("div",{css:F,children:y?(0,p.Y)(L,{nodes:Y,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",onSelect:x,traceStartTime:l,traceEndTime:c,expandedKeys:d,setExpandedKeys:u}):e.map(e=>{var n;return(0,p.Y)(w,{node:e,expandedKeys:d,setExpandedKeys:u,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",traceStartTime:l,traceEndTime:c,onSelect:x,linesToRender:[]},e.key)})})},[y,Y,null===t||void 0===t?void 0:t.key,x,l,c,e,d,u]);return(0,p.Y)("div",{css:(0,s.AH)({height:"100%",borderRadius:v.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:f,children:(0,p.Y)("div",{css:H,children:(0,p.FD)("div",{css:O,children:[(0,p.Y)(g,{showTimelineInfo:y,setShowTimelineInfo:b,spanFilterState:m,setSpanFilterState:h}),e.length>0?(0,p.Y)("div",{css:z,children:S}):(0,p.Y)("div",{css:(0,s.AH)({flex:1,display:"flex",justifyContent:"center",padding:v.spacing.md,paddingTop:v.spacing.lg},""),children:(0,p.Y)(o.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})}},9636:function(e,t,n){n.d(t,{$:function(){return a}});var s=n(46709);const r=s.createContext({renderRunJudgeModal:void 0,evaluations:void 0,subscribeToScorerFinished:void 0,reset:void 0}),a=()=>s.useContext(r)},9858:function(e,t,n){n(76118),n(90448)},12129:function(e,t,n){n(16844)},12998:function(e,t,n){n.d(t,{Ld:function(){return c}});var s=n(46709),r=n(72801),a=n(79081),o=n(82716),i=n(42747),l=n(73408);function c(e,t,n){const c=(0,i.tz)(),d=t||c.formatMessage({id:"hBAhI8",defaultMessage:"Copy"}),u=c.formatMessage({id:"g4hHzO",defaultMessage:"Copied"}),p=(0,r.useClipboard)(),m=(0,s.useRef)(),[g,h]=(0,s.useState)(!1),[f,v]=(0,s.useState)(!1);(0,s.useEffect)(()=>()=>{window.clearTimeout(m.current)},[]);return{actionIcon:g?(0,l.Y)(a.C,{}):(0,l.Y)(o.CopyIcon,{}),tooltipMessage:g?u:d,copy:()=>{p.copy(e),window.clearTimeout(m.current),h(!0),null===n||void 0===n||n(),m.current=window.setTimeout(()=>{h(!1)},3e3)},copied:g,ariaLabel:d,tooltipOpen:f||g,handleTooltipOpenChange:v}}},13433:function(e,t,n){n.d(t,{G3:function(){return u},N5:function(){return d},_A:function(){return m},aG:function(){return l},bU:function(){return c}});var s=n(59930),r=n.n(s),a=n(76118),o=n(33120),i=n(86125);const l=({traceId:e,assessmentId:t})=>(0,o.ff)((0,o.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"DELETE"),c=({payload:e})=>(0,o.ff)((0,o.we)(`ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`),"POST",e),d=({traceId:e})=>(0,o.ff)((0,o.we)(`ajax-api/3.0/mlflow/traces/${e}`)),u=({traceId:e,assessmentId:t,payload:n})=>(0,o.ff)((0,o.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"PATCH",n),p=async({traceIds:e,traceLocation:t})=>{const n=(0,a.isString)(t)?t:(0,i.nr)(t),s=(0,o.we)(`ajax-api/4.0/mlflow/traces/${n}/batchGet`),r=new URLSearchParams;for(const a of e)r.append("trace_ids",a);const l=`${s}?${r.toString()}`;return await(0,o.ff)(l,"GET")},m={searchTracesV4:async({signal:e,orderBy:t,locations:n,filter:s,pageSize:r})=>{var a;const i={locations:n,filter:s,max_results:null!==r&&void 0!==r?r:1e3,order_by:t},l=await(0,o.ff)((0,o.we)("ajax-api/4.0/mlflow/traces/search"),"POST",i,e);return null!==(a=null===l||void 0===l?void 0:l.trace_infos)&&void 0!==a?a:[]},getBatchTracesV4:p,getTraceV4:async(e,t)=>{let n,s;if("string"===typeof e){const t=(0,i.iZ)(e);r()(null===t||void 0===t?void 0:t.trace_id,"Could not parse trace ID from serialized trace identifier"),r()(null===t||void 0===t?void 0:t.trace_location,"Could not parse trace location from serialized trace identifier"),n=t.trace_id,s=(0,i.M2)(t.trace_location)}else r()(e.trace_id,"Trace ID is required"),r()(e.trace_location,"Trace location is required"),n=e.trace_id,s=e.trace_location;const o=await p({traceIds:[n],traceLocation:s}),l=(0,a.first)(o.traces.map(e=>({info:e.trace_info,data:{spans:e.spans}})));return r()(l,"No trace found in response"),l},getTraceInfoV4:({traceId:e,traceLocation:t})=>{const n=(0,a.isString)(t)?t:(0,i.nr)(t),s=`${(0,o.we)(`ajax-api/4.0/mlflow/traces/${n}/${e}/info`)}?${(new URLSearchParams).toString()}`;return(0,o.ff)(s)},createAssessmentV4:({payload:{assessment:e},traceLocation:t})=>{r()(t,"Trace location is required for creating assessment via V4 API");const n=(0,a.isString)(t)?t:(0,i.nr)(t);r()(n,"Trace location could not be resolved");const s=e,l=new URLSearchParams,c=`${(0,o.we)(`ajax-api/4.0/mlflow/traces/${n}/${e.trace_id}/assessments`)}?${l.toString()}`;return(0,o.ff)(c,"POST",s)},updateAssessmentV4:({traceId:e,assessmentId:t,payload:n,traceLocation:s})=>{const{assessment:l,update_mask:c}=n;r()(s,"Trace location is required for updating assessment via V4 API");const d=(0,a.isString)(s)?s:(0,i.nr)(s);r()(d,"Trace location could not be resolved");const u=new URLSearchParams;u.append("update_mask",c);const p=`${(0,o.we)(`ajax-api/4.0/mlflow/traces/${d}/${e}/assessments/${t}`)}?${u.toString()}`;return(0,o.ff)(p,"PATCH",l)},deleteAssessmentV4:({traceId:e,sqlWarehouseId:t,assessmentId:n,traceLocation:s})=>{const l=new URLSearchParams;r()(s,"Trace location is required for deleting assessment via V4 API");const c=(0,a.isString)(s)?s:(0,i.nr)(s);r()(c,"Trace location could not be resolved");const d=`${(0,o.we)(`ajax-api/4.0/mlflow/traces/${c}/${e}/assessments/${n}`)}?${l.toString()}`;return(0,o.ff)(d,"DELETE")},setTraceTagV4:async({traceLocation:e,tag:t,traceId:n})=>{const s=(0,i.nr)(e),r=`${(0,o.we)(`ajax-api/4.0/mlflow/traces/${s}/${n}/tags`)}?${(new URLSearchParams).toString()}`;return(0,o.ff)(r,"PATCH",t)},deleteTraceTagV4:async({tagKey:e,traceId:t,traceLocation:n})=>{const s=(0,i.nr)(n),r=`${(0,o.we)(`ajax-api/4.0/mlflow/traces/${s}/${t}/tags/${encodeURIComponent(e)}`)}?${(new URLSearchParams).toString()}`;return(0,o.ff)(r,"DELETE")}}},16844:function(e,t,n){n.d(t,{a8:function(){return ue},ModelTraceExplorerOSSNotebookRenderer:function(){return fe},gE:function(){return xe}});var s=n(46709),r=n(89949),a=n(27882),o=n(86125),i=n(82716),l=n(27757),c=n(42747),d=n(73408);const u=()=>(0,d.Y)(i.Empty,{title:(0,d.Y)(c.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,d.Y)(c.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,d.Y)(l.k,{})});var p=n(15929),m=n(68248),g=n(94664),h=n(45547);const f=e=>JSON.stringify(`import mlflow\n\n# returns an MLflow Trace object\ntrace = mlflow.get_trace('${e}')\n\n# trace.info contains tags and metadata\ntrace_info = trace.info\n\n# the trace's spans are stored in trace.data\nspans = trace.data.spans`);var v={name:"b9l38d",styles:"width:min-content"};const x=({traceId:e,setForceDisplay:t})=>{const{theme:n}=(0,l.u)();return(0,d.Y)(i.Empty,{image:(0,d.Y)(l.W,{}),title:(0,d.Y)(c.sA,{id:"4Itm9y",defaultMessage:"Large trace"}),description:(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md,alignItems:"center"},""),children:[(0,d.Y)(c.sA,{id:"TvjS47",defaultMessage:"This trace is very large, and may cause UI slowness when attempting to render. You can click the button below to attempt to display it anyway."}),(0,d.Y)(l.B,{componentId:"shared.model-trace-explorer.trace-too-large.force-display-button",css:v,onClick:()=>t(!0),children:(0,d.Y)(c.sA,{id:"rFJSWc",defaultMessage:"Attempt to display"})}),(0,d.Y)("span",{children:(0,d.Y)(c.sA,{id:"1Buj/Q",defaultMessage:"Alternatively, you can interact with this trace via the MLflow Python SDK, using the {code} function. For more information, please check the {documentation_link}.",values:{code:(0,d.Y)(l.T.Text,{code:!0,children:"mlflow.get_trace()"}),documentation_link:(0,d.Y)(l.T.Link,{href:"https://mlflow.org/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Trace",target:"_blank",openInNewTab:!0,componentId:"shared.model-trace-explorer.trace-too-large.documentation-link",children:(0,d.Y)(c.sA,{id:"7RNlsx",defaultMessage:"MLflow API documentation"})})}})}),(0,d.Y)(h.w,{data:f(e),renderMode:g.cC.PYTHON,initialExpanded:!0})]})})};var y=n(53915),b=n(66916),Y=n(79081),A=n(97447),S=n(76118),T=n(43695);const w=e=>void 0!==e&&(0,S.isObject)(e)&&"input_cost"in e&&"output_cost"in e&&"total_cost"in e;var M={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},E={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const I=({cost:e})=>{const{theme:t}=(0,l.u)(),n=(0,s.useMemo)(()=>(0,T.l)(e.total_cost),[e.total_cost]),r=(0,s.useMemo)(()=>(0,T.l)(e.input_cost),[e.input_cost]),a=(0,s.useMemo)(()=>(0,T.l)(e.output_cost),[e.output_cost]);return(0,d.Y)(i.HoverCard,{trigger:(0,d.FD)("div",{css:(0,m.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:t.spacing.sm},""),children:[(0,d.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,d.Y)(c.sA,{id:"62NIhn",defaultMessage:"Cost"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.header-details.cost.tag",color:"lime",children:(0,d.Y)("span",{children:n})})]}),content:(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",gap:t.spacing.md,padding:t.spacing.sm,maxWidth:400},""),children:[(0,d.Y)(l.T.Title,{level:3,withoutMargins:!0,children:(0,d.Y)(c.sA,{id:"9IIkwh",defaultMessage:"Cost breakdown"})}),(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,d.FD)("div",{css:M,children:[(0,d.Y)(l.T.Text,{size:"md",children:(0,d.Y)(c.sA,{id:"5Sk9A1",defaultMessage:"Input cost"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.cost-hovercard.input-cost.tag",children:(0,d.Y)("span",{children:r})})]}),(0,d.FD)("div",{css:E,children:[(0,d.Y)(l.T.Text,{size:"md",children:(0,d.Y)(c.sA,{id:"+d9nXK",defaultMessage:"Output cost"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.cost-hovercard.output-cost.tag",children:(0,d.Y)("span",{children:a})})]}),(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:t.spacing.sm,borderTop:`1px solid ${t.colors.borderDecorative}`},""),children:[(0,d.Y)(l.T.Text,{size:"md",bold:!0,children:(0,d.Y)(c.sA,{id:"o2qOGQ",defaultMessage:"Total"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.cost-hovercard.total-cost.tag",children:(0,d.Y)("span",{children:n})})]})]})]}),side:"bottom",align:"start"})};var C=n(90828);var k={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},D={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},N={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},R={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const _=({tokenUsage:e})=>{var t,n;const{theme:r}=(0,l.u)(),a=(0,s.useMemo)(()=>e.total_tokens.toString(),[e]),o=(0,s.useMemo)(()=>e.input_tokens.toString(),[e]),u=(0,s.useMemo)(()=>e.output_tokens.toString(),[e]),p=null!==(t=e.cache_read_input_tokens)&&void 0!==t?t:null,g=null!==(n=e.cache_creation_input_tokens)&&void 0!==n?n:null;return(0,d.Y)(i.HoverCard,{trigger:(0,d.FD)("div",{css:(0,m.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:r.spacing.sm},""),children:[(0,d.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,d.Y)(c.sA,{id:"zp4MBw",defaultMessage:"Token count"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",children:(0,d.FD)("span",{css:(0,m.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:r.spacing.xs},""),children:[(0,d.Y)("span",{children:(0,d.Y)(i.TokenIcon,{})}),(0,d.Y)("span",{children:(0,C.Y7)(a,40)})]})})]}),content:(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",gap:r.spacing.md,padding:r.spacing.sm,maxWidth:400},""),children:[(0,d.Y)(l.T.Title,{level:3,withoutMargins:!0,children:(0,d.Y)(c.sA,{id:"aFk+k/",defaultMessage:"Usage breakdown"})}),(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:[(0,d.FD)("div",{css:k,children:[(0,d.Y)(l.T.Text,{size:"md",children:(0,d.Y)(c.sA,{id:"XEcsei",defaultMessage:"Input tokens"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.input-tokens.tag",children:(0,d.Y)("span",{children:o})})]}),(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",gap:r.spacing.xs,paddingLeft:r.spacing.lg},""),children:[(0,d.FD)("div",{css:D,children:[(0,d.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,d.Y)(c.sA,{id:"BZ5364",defaultMessage:"(cache read)"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.cached-input-tokens.tag",children:(0,d.Y)("span",{children:null!==p?p.toString():"n/a"})})]}),(0,d.FD)("div",{css:N,children:[(0,d.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,d.Y)(c.sA,{id:"M0O/hf",defaultMessage:"(cache write)"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.cache-creation-tokens.tag",children:(0,d.Y)("span",{children:null!==g?g.toString():"n/a"})})]})]}),(0,d.FD)("div",{css:R,children:[(0,d.Y)(l.T.Text,{size:"md",children:(0,d.Y)(c.sA,{id:"2IGC5w",defaultMessage:"Output tokens"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.output-tokens.tag",children:(0,d.Y)("span",{children:u})})]}),(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:r.spacing.sm,borderTop:`1px solid ${r.colors.borderDecorative}`},""),children:[(0,d.Y)(l.T.Text,{size:"md",bold:!0,children:(0,d.Y)(c.sA,{id:"QK/Qyx",defaultMessage:"Total"})}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.total-tokens.tag",children:(0,d.Y)("span",{children:a})})]})]})]}),side:"bottom",align:"start"})};var L={name:"dgkyot",styles:"cursor:default;width:fit-content;max-width:100%"},F={name:"j601fv",styles:"flex-basis:45%;flex-shrink:0"},H={name:"1sdjnkx",styles:"word-break:break-word"};const O=({traceMetadata:e,getTruncatedLabel:t=e=>(0,C.Y7)(e,40)})=>{const{theme:n}=(0,l.u)(),r=e=>{if(e&&"object"===typeof e)try{return JSON.stringify(e)}catch{return String(e)}if("string"===typeof e){const t=(0,C.pt)(e);if(t&&"object"===typeof t)try{return JSON.stringify(t)}catch{return e}return e}return String(null!==e&&void 0!==e?e:"")},a=(0,s.useMemo)(()=>Object.entries(e||{}).filter(([e,t])=>null!==t&&""!==t&&!e.startsWith(C.nt)).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>({key:e,value:t,displayValue:r(t)})),[e]);return 0===a.length?null:(0,d.FD)("div",{css:(0,m.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,d.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,d.Y)(c.sA,{id:"zRKlAL",defaultMessage:"Metadata"})}),(0,d.Y)(i.Overflow,{noMargin:!0,children:(0,d.Y)(i.HoverCard,{trigger:(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.header-metadata-pill",color:"default",css:L,children:(0,d.FD)("span",{css:(0,m.AH)({display:"flex",alignItems:"center",gap:n.spacing.xs},""),children:[(0,d.Y)(Y.L,{css:(0,m.AH)({fontSize:12,color:n.colors.textSecondary},"")}),(0,d.Y)("span",{children:a.length})]})}),content:(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs,maxWidth:480,maxHeight:320,overflowY:"auto"},""),children:[a.slice(0,100).map(({key:e,displayValue:s,value:r})=>(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"row",alignItems:"flex-start",gap:n.spacing.xs},""),children:[(0,d.Y)(l.T.Text,{css:F,children:t(e)}),(0,d.Y)(l.T.Text,{color:"secondary",css:H,children:s})]},`${e}:${r}`)),a.length>100&&(0,d.FD)(l.T.Text,{color:"secondary",children:["+",a.length-100," more"]})]})})})]})};var z=n(86119);const U=({statusState:e,getTruncatedLabel:t})=>{const n=(0,c.tz)(),{theme:s}=(0,l.u)(),r=((e,t,n)=>({IN_PROGRESS:{label:t.formatMessage({id:"Y1eg9D",defaultMessage:"In progress"}),icon:(0,d.Y)(b.C,{css:(0,m.AH)({color:n.colors.textValidationWarning},"")}),color:"lemon"},OK:{label:t.formatMessage({id:"hUfxmd",defaultMessage:"OK"}),icon:(0,d.Y)(i.CheckCircleIcon,{css:(0,m.AH)({color:n.colors.textValidationSuccess},"")}),color:"teal"},ERROR:{label:t.formatMessage({id:"ho2T6B",defaultMessage:"Error"}),icon:(0,d.Y)(i.XCircleIcon,{css:(0,m.AH)({color:n.colors.textValidationDanger},"")}),color:"coral"},STATE_UNSPECIFIED:null}[e]))(e,n,s);return r?(0,d.Y)(A.f,{label:(0,d.Y)(c.sA,{id:"HNQ9dM",defaultMessage:"Status"}),value:r.label,color:r.color,icon:r.icon,getTruncatedLabel:t,onCopy:()=>{}}):null};var B=n(110),V=n(21636),j=n(81390);var $={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},K={name:"mqlsmr",styles:"font-size:12px;display:flex"},P={name:"e0dnmk",styles:"cursor:pointer"};const W=({modelTraceInfo:e})=>{var t;const{theme:n}=(0,l.u)(),[r,a]=(0,s.useState)(!1),{rootNode:u}=(0,y.nJ)(),{experimentId:p}=(0,B.g)(),g=Object.entries(null!==(t=e.tags)&&void 0!==t?t:{}).filter(([e])=>(0,C.oD)(e)),[h,f]=(0,s.useMemo)(()=>{var t;return(0,o.ko)(e)&&(0,o.gD)(e)?[(0,o.vX)(e),e.trace_id]:[(0,o.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""]},[e]),v=(0,s.useMemo)(()=>(0,o.m4)(e),[e]),x=(0,s.useMemo)(()=>(0,o.Dv)(e),[e]),T=(0,s.useMemo)(()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[V.n2]},[e]),M=(0,s.useMemo)(()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[V.E3]},[e]),E=(0,s.useMemo)(()=>(0,o.gD)(e)?e.state:void 0,[e]),k=(0,s.useMemo)(()=>{if(u)return(0,j.X6)(u.end-u.start)},[u]),D=e=>(0,C.Y7)(e,40),N=(0,s.useCallback)(()=>{a(!0),setTimeout(()=>a(!1),2e3)},[]);return(0,d.FD)("div",{css:(0,m.AH)({paddingLeft:n.spacing.md,paddingBottom:n.spacing.sm},""),children:[(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"row",gap:n.spacing.md,rowGap:n.spacing.sm,flexWrap:"wrap"},""),children:[E&&(0,d.Y)(U,{statusState:E,getTruncatedLabel:D}),h&&(0,d.Y)(A.f,{label:(0,d.Y)(c.sA,{id:"imKpxw",defaultMessage:"ID"}),value:h,displayValue:f,color:"purple",getTruncatedLabel:D,onCopy:N}),(R=v,void 0!==R&&(0,S.isObject)(R)&&"input_tokens"in R&&"output_tokens"in R&&"total_tokens"in R&&(0,d.Y)(_,{tokenUsage:v})),w(x)&&(0,d.Y)(I,{cost:x}),k&&(0,d.Y)(A.f,{label:(0,d.Y)(c.sA,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,d.Y)(b.C,{css:$}),value:k,getTruncatedLabel:D,onCopy:N}),T&&p&&(0,d.Y)(z.b,{handleCopy:N,experimentId:p,sessionId:T,traceId:h}),M&&(0,d.Y)(A.f,{label:(0,d.Y)(c.sA,{id:"128VYg",defaultMessage:"User"}),icon:(0,d.Y)(i.UserIcon,{css:K}),value:M,color:"default",getTruncatedLabel:D,onCopy:N}),(0,d.Y)(O,{traceMetadata:null===e||void 0===e?void 0:e.trace_metadata,getTruncatedLabel:D}),g.length>0&&(0,d.FD)("div",{css:(0,m.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,d.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,d.Y)(c.sA,{id:"7KPJii",defaultMessage:"Tags"})}),(0,d.Y)(i.Overflow,{noMargin:!0,children:g.map(([e,t])=>{const n=`${e}: ${t}`;return(0,d.Y)(Y.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:n,children:(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",onClick:()=>{var e;e=n,navigator.clipboard.writeText(e),N()},css:P,children:D(`${e}: ${t}`)})},e)})})]})]}),r&&(0,d.FD)(i.Notification.Provider,{children:[(0,d.Y)(i.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,d.Y)(i.Notification.Title,{children:(0,d.Y)(c.sA,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,d.Y)(i.Notification.Viewport,{})]})]});var R};var G=n(49708),J=n(13433),q=n(41151);var X=n(28993),Q=n(45218),Z=n(26059),ee=n(24411),te=n(84612);const ne=()=>{const{theme:e}=(0,l.u)(),[t,n]=(0,s.useState)(500),{rootNode:r,nodeMap:a,assessmentsPaneEnabled:u,assessmentsPaneExpanded:p,isInComparisonView:g,updatePaneSizeRatios:h,getPaneSizeRatios:f}=(0,y.nJ)(),v=(0,s.useMemo)(()=>Object.values(a).flatMap(e=>e.assessments),[a]),x=(0,s.useCallback)(e=>{h({summarySidebar:e})},[h]),b=(0,o.yt)(r);if(!r)return(0,d.Y)("div",{css:(0,m.AH)({marginTop:e.spacing.lg},""),children:(0,d.Y)(i.Empty,{description:(0,d.Y)(c.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})});const Y=(0,d.Y)(ee.i,{assessments:v,traceId:r.traceId,activeSpanId:void 0});return!g&&u&&p?(0,d.Y)(Z.A,{initialRatio:f().summarySidebar,paneWidth:t,setPaneWidth:n,leftChild:(0,d.Y)(Q.n,{rootNode:r,intermediateNodes:b}),rightChild:Y,leftMinWidth:Q.F+2*e.spacing.md,rightMinWidth:te.uZ+2*e.spacing.sm,onRatioChange:x}):(0,d.Y)(Q.n,{rootNode:r,intermediateNodes:b})};var se=n(3448);var re={name:"3epor4",styles:"& > div:nth-of-type(1){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},ae={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},oe={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const ie=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:r})=>{const{theme:a}=(0,l.u)(),{activeView:o,setActiveView:u,rootNode:p}=(0,y.nJ)(),g=(0,s.useCallback)(e=>{u(e)},[u]);return(0,d.FD)(i.Tabs.Root,{componentId:"shared.model-trace-explorer.view-mode-toggle",value:o,onValueChange:g,css:re,children:[(0,d.FD)(i.Tabs.List,{css:(0,m.AH)({paddingLeft:a.spacing.md,flexShrink:0},""),children:[p&&(0,d.Y)(i.Tabs.Trigger,{value:"summary",children:(0,d.Y)(c.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,d.Y)(i.Tabs.Trigger,{value:"detail",children:(0,d.Y)(c.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,d.Y)(i.Tabs.Content,{value:"summary",css:ae,children:(0,d.Y)(ne,{})}),(0,d.Y)(i.Tabs.Content,{value:"detail",css:oe,children:(0,d.Y)(se._,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:r})})]})};var le={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const ce=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})=>{var r,a,o;const{theme:u}=(0,l.u)(),{assessmentsPaneEnabled:p,assessmentsPaneExpanded:g,setAssessmentsPaneExpanded:h,rootNode:f,selectedNode:v}=(0,y.nJ)();return(0,d.FD)("div",{css:le,children:[(0,d.FD)("div",{css:(0,m.AH)({display:"flex",alignItems:"center",gap:u.spacing.xs,padding:`0px ${u.spacing.sm}px`,marginBottom:u.spacing.xs},""),children:[(0,d.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.toggle-assessments-pane",icon:g?(0,d.Y)(i.ChevronDownIcon,{}):(0,d.Y)(l.o,{}),onClick:()=>h(!g)}),(0,d.Y)(l.T.Text,{bold:!0,children:(0,d.Y)(c.sA,{id:"++Ydlz",defaultMessage:"Assessments"})})]}),p&&g&&(0,d.Y)("div",{css:(0,m.AH)({marginBottom:u.spacing.sm,padding:u.spacing.sm,paddingTop:0},""),children:(0,d.Y)(ee.i,{assessments:null!==(r=null===f||void 0===f?void 0:f.assessments)&&void 0!==r?r:[],traceId:null!==(a=null===f||void 0===f?void 0:f.traceId)&&void 0!==a?a:"",activeSpanId:null!==(o=null===v||void 0===v?void 0:v.key)&&void 0!==o?o:""})}),(0,d.Y)(ie,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})]})},de=({children:e})=>(0,d.Y)(r.tH,{fallbackRender:u,children:e}),ue=({modelTrace:e,className:t,initialActiveView:n,selectedSpanId:r,onSelectSpan:i,collapseAssessmentPane:l,isInComparisonView:c,showLoadingState:u})=>{var m,g,h,f;const[v,b]=(0,s.useState)(e),[Y,A]=(0,s.useState)(!1),S=(0,o.MF)(e),T=null!==(m=(0,o.ob)(e))&&void 0!==m?m:0,w=!(0,a.ny)()||T<(0,a.T9)(),M=null!==(g=null===(h=e.data)||void 0===h||null===(f=h.spans)||void 0===f?void 0:f.length)&&void 0!==g?g:0,[E,I]=(0,s.useState)(S.startsWith("tr-")),[C,k]=(0,s.useState)(!0),{isFetching:D}=(({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:n,enabled:r=!0})=>{const i=[o.BS,e],l=(0,q.M)(),c=(0,s.useMemo)(()=>(0,a.F9)()&&!e.startsWith("tr-")?r&&l.modelTraceInfo&&(0,o.gD)(l.modelTraceInfo):r&&e.startsWith("tr-"),[r,e,l.modelTraceInfo]);return(0,G.I)({queryKey:i,queryFn:()=>{var t;return(0,a.F9)()&&l.modelTraceInfo&&(0,o.gD)(l.modelTraceInfo)&&!e.startsWith("tr-")?J._A.getTraceInfoV4({traceId:e,traceLocation:null===(t=l.modelTraceInfo)||void 0===t?void 0:t.trace_location}):(0,J.N5)({traceId:e})},onSuccess:e=>{var s;const r=(0,o.gD)(e)?e:null===e||void 0===e||null===(s=e.trace)||void 0===s?void 0:s.trace_info;t(e=>({data:e.data,info:null!==r&&void 0!==r?r:{}})),n(!0)},onError:()=>{n(!1)},enabled:c,refetchOnWindowFocus:!1,refetchOnMount:"always"})})({traceId:S,setModelTrace:b,setAssessmentsPaneEnabled:I,enabled:w}),N=C&&D;(0,s.useEffect)(()=>{b(e),k(!0)},[S,M]),(0,s.useEffect)(()=>{C&&!D&&k(!1)},[C,D]);const R=(0,X.K)(e=>e.resetCache);return(0,s.useEffect)(()=>{R()},[R]),w||Y?(0,d.Y)(de,{traceId:S,children:(0,d.Y)(y.DK,{modelTrace:v,initialActiveView:n,selectedSpanIdOnRender:r,assessmentsPaneEnabled:E,isInComparisonView:c,initialAssessmentsPaneCollapsed:l,isTraceInitialLoading:N,children:u?(0,d.Y)(p.F,{}):(0,d.FD)(d.FK,{children:[(0,d.Y)(W,{modelTraceInfo:v.info}),c?(0,d.Y)(ce,{modelTraceInfo:v.info}):(0,d.Y)(ie,{modelTraceInfo:v.info,className:t,selectedSpanId:r,onSelectSpan:i})]})})}):(0,d.Y)(x,{traceId:S,setForceDisplay:A})};n(68364);n(777);var pe=n(34791);const me=(e,t)=>{const n=new URLSearchParams;n.append("selectedEvaluationId",e),n.append("compareRunsMode","TRACES");const s=(0,pe.y5)();return s&&n.append("workspace",s),`/#/experiments/${t}/traces?${n.toString()}`};var ge={name:"1elrbzk",styles:"width:calc(100% - 2px)"},he={name:"inxa61",styles:"flex:1;overflow:hidden"};const fe=()=>{const e=(0,s.useMemo)(()=>new URLSearchParams(window.location.search).getAll("trace_id"),[]),t=(0,s.useMemo)(()=>new URLSearchParams(window.location.search).getAll("experiment_id"),[]),[n,r]=(0,s.useState)(e.length>0?0:null),[a,o]=(0,s.useState)(null),[u,p]=(0,s.useState)(!0),[g,h]=(0,s.useState)(null),{theme:f}=(0,l.u)();return(0,s.useEffect)(()=>{(async()=>{if(null===n)return;p(!0);const t=e[n],s=await xe(t);"string"===typeof s?h(s):o(s),p(!1)})()},[n,e]),0===e.length||null===n?null:u?(0,d.Y)("div",{css:ge,children:(0,d.Y)(l.T.Text,{color:"secondary",children:(0,d.Y)(c.sA,{id:"JJFZ1V",defaultMessage:"Fetching trace data..."})})}):a?(0,d.FD)("div",{css:(0,m.AH)({display:"flex",flexDirection:"column",border:`1px solid ${f.colors.border}`,height:"calc(100% - 2px)"},""),children:[(0,d.FD)("div",{css:(0,m.AH)({display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${f.spacing.xs}px ${f.spacing.md}px`},""),children:[(0,d.FD)("div",{css:(0,m.AH)({display:"flex",alignItems:"center",gap:f.spacing.sm},""),children:[(0,d.Y)(l.T.Title,{level:4,withoutMargins:!0,children:"MLflow Trace UI"}),(0,d.Y)(i.InfoTooltip,{componentId:"mlflow.notebook.trace-ui-info",iconTitle:"More information",maxWidth:400,content:(0,d.Y)(c.sA,{id:"LED2z5",defaultMessage:"To disable or enable this display, call {disableFunction} or {enableFunction} and re-run the cell",values:{disableFunction:(0,d.Y)("code",{children:"mlflow.tracing.disable_notebook_display()"}),enableFunction:(0,d.Y)("code",{children:"mlflow.tracing.enable_notebook_display()"})}})}),(0,d.Y)(l.T.Link,{componentId:"mlflow.notebook.trace-ui-learn-more-link",href:"https://mlflow.org/docs/latest/llms/tracing/index.html?ref=jupyter-notebook-widget",openInNewTab:!0,title:"Learn More",children:(0,d.Y)(c.sA,{id:"uIY1qq",defaultMessage:"Learn More"})})]}),(0,d.Y)(l.T.Link,{componentId:"mlflow.notebook.trace-ui-see-in-mlflow-link",href:me(e[n],t[n]),openInNewTab:!0,title:"View in MLflow UI",children:(0,d.Y)(c.sA,{id:"4NyhOm",defaultMessage:"View in MLflow UI"})})]}),e.length>1&&(0,d.Y)(i.Pagination,{componentId:"mlflow.notebook.pagination",currentPageIndex:n+1,dangerouslySetAntdProps:{showQuickJumper:!0},numTotal:e.length,onChange:e=>r(e-1),pageSize:1,style:{marginBottom:f.spacing.sm,paddingLeft:f.spacing.sm,paddingRight:f.spacing.sm}}),(0,d.Y)("div",{css:he,children:(0,d.Y)(ue,{modelTrace:a,initialActiveView:"detail"})})]}):(0,d.Y)("div",{css:(0,m.AH)({paddingTop:f.spacing.md,width:"calc(100% - 2px)"},""),children:(0,d.Y)(i.Empty,{image:(0,d.Y)(l.k,{}),description:(0,d.FD)(d.FK,{children:[(0,d.Y)(l.T.Paragraph,{children:(0,d.Y)(c.sA,{id:"UD4Z+e",defaultMessage:"An error occurred while attempting to fetch trace data (ID: {traceId}). Please ensure that the MLflow tracking server is running, and that the trace data exists. Error details:",values:{traceId:e[n]}})}),g&&(0,d.Y)(l.T.Paragraph,{children:g})]}),title:(0,d.Y)(c.sA,{id:"md81Lo",defaultMessage:"Error"})})})};n(57248);var ve=n(61077);async function xe(e){try{const t=await(0,ve.ff)((0,ve.we)(`ajax-api/2.0/mlflow/get-trace-artifact?request_id=${e}`));return t.spans?{info:{request_id:e},data:t}:t.error_code?t.message:"Unknown error occurred"}catch(t){return t instanceof Error?t.message:"string"===typeof t?t:"Unknown error occurred"}}n(97407);n(9636),n(93812),n(47784);n(85418),n(5075);n(12998);n(77691)},19112:function(e,t,n){n.d(t,{z7:function(){return S},VE:function(){return b}});var s=n(76386),r=n(91215),a=n(49693),o=n(94066),i=n(3491),l=n(20515),c=n(27962),d=n(54921);var u={'code[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC"},'pre[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC",padding:"1em",margin:".5em 0",overflow:"auto"},'pre > code[class*="language-"]':{fontSize:"1em"},'pre[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},':not(pre) > code[class*="language-"]':{padding:".1em",borderRadius:".3em"},comment:{color:"#6c6783"},prolog:{color:"#6c6783"},doctype:{color:"#6c6783"},cdata:{color:"#6c6783"},punctuation:{color:"#6c6783"},namespace:{Opacity:".7"},tag:{color:"#3AACE2"},operator:{color:"#3AACE2"},number:{color:"#3AACE2"},property:{color:"#5DFAFC"},function:{color:"#5DFAFC"},"tag-id":{color:"#eeebff"},selector:{color:"#eeebff"},"atrule-id":{color:"#eeebff"},"code.language-javascript":{color:"#c4b9fe"},"attr-name":{color:"#c4b9fe"},"code.language-css":{color:"#ffffff"},"code.language-scss":{color:"#ffffff"},boolean:{color:"#ffffff"},string:{color:"#ffffff"},entity:{color:"#ffffff",cursor:"help"},url:{color:"#ffffff"},".language-css .token.string":{color:"#ffffff"},".language-scss .token.string":{color:"#ffffff"},".style .token.string":{color:"#ffffff"},"attr-value":{color:"#ffffff"},keyword:{color:"#ffffff"},control:{color:"#ffffff"},directive:{color:"#ffffff"},unit:{color:"#ffffff"},statement:{color:"#ffffff"},regex:{color:"#ffffff"},atrule:{color:"#ffffff"},placeholder:{color:"#ffffff"},variable:{color:"#ffffff"},deleted:{textDecoration:"line-through"},inserted:{borderBottom:"1px dotted #eeebff",textDecoration:"none"},italic:{fontStyle:"italic"},important:{fontWeight:"bold",color:"#c4b9fe"},bold:{fontWeight:"bold"},"pre > code.highlight":{Outline:".4em solid #8a75f5",OutlineOffset:".4em"},".line-numbers.line-numbers .line-numbers-rows":{borderRightColor:"#2c2937"},".line-numbers .line-numbers-rows > span:before":{color:"#3c3949"},".line-highlight.line-highlight":{background:"linear-gradient(to right, rgba(224, 145, 66, 0.2) 70%, rgba(224, 145, 66, 0))"}};var p={'code[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",overflow:"auto",position:"relative",margin:"0.5em 0",padding:"1.25em 1em"},'code[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},':not(pre) > code[class*="language-"]':{whiteSpace:"normal",borderRadius:"0.2em",padding:"0.1em"},".language-css > code":{color:"#f5871f"},".language-sass > code":{color:"#f5871f"},".language-scss > code":{color:"#f5871f"},'[class*="language-"] .namespace':{Opacity:"0.7"},atrule:{color:"#7c4dff"},"attr-name":{color:"#39adb5"},"attr-value":{color:"#f6a434"},attribute:{color:"#f6a434"},boolean:{color:"#7c4dff"},builtin:{color:"#39adb5"},cdata:{color:"#39adb5"},char:{color:"#39adb5"},class:{color:"#39adb5"},"class-name":{color:"#6182b8"},comment:{color:"#8e908c"},constant:{color:"#7c4dff"},deleted:{color:"#e53935"},doctype:{color:"#aabfc9"},entity:{color:"#e53935"},function:{color:"#4271ae"},hexcode:{color:"#f5871f"},id:{color:"#7c4dff",fontWeight:"bold"},important:{color:"#7c4dff",fontWeight:"bold"},inserted:{color:"#39adb5"},keyword:{color:"#8959a8"},number:{color:"#f5871f"},operator:{color:"#3e999f"},prolog:{color:"#aabfc9"},property:{color:"#39adb5"},"pseudo-class":{color:"#f6a434"},"pseudo-element":{color:"#f6a434"},punctuation:{color:"rgb(77, 77, 76)"},regex:{color:"#6182b8"},selector:{color:"#e53935"},string:{color:"#3ba85f"},symbol:{color:"#7c4dff"},tag:{color:"#e53935"},unit:{color:"#f5871f"},url:{color:"#e53935"},variable:{color:"#c72d4c"}},m=n(76118),g=n(73408),h=(n(46709),n(12998)),f=n(79081),v=n(27757);var x={name:"1739oy8",styles:"z-index:1"};function y({tooltipMessage:e,...t}){const n=x;return(0,g.Y)(f.T,{content:e,componentId:"codegen_web-shared_src_snippet_actions_snippetactionbutton.tsx_26",children:(0,g.Y)(v.B,{componentId:"codegen_web-shared_src_snippet_actions_snippetactionbutton.tsx_33",...t,css:n})})}function b({copyText:e,onClick:t,...n}){const{actionIcon:s,tooltipMessage:r,copy:a}=(0,h.Ld)(e);return(0,g.Y)(y,{tooltipMessage:r,icon:s,onClick:e=>{a(),null===t||void 0===t||t(e)},...n})}s.A.registerLanguage("sql",d.A),s.A.registerLanguage("java",a.A),s.A.registerLanguage("python",l.A),s.A.registerLanguage("go",r.A),s.A.registerLanguage("javascript",o.A),s.A.registerLanguage("yaml",c.A),s.A.registerLanguage("json",i.A);const Y="24px",A={light:p,duotoneDark:u};function S({theme:e="light",language:t,actions:n,style:r,children:a,showLineNumbers:o,lineNumberStyle:i,wrapLongLines:l,wrapLines:c,lineProps:d,PreTag:u}){const p={border:"none",borderRadius:0,margin:0,padding:Y,...r};return(0,g.Y)(s.A,{showLineNumbers:o,lineNumberStyle:i,language:t,style:A[e],customStyle:p,codeTagProps:{style:(0,m.pick)(r,"backgroundColor")},lineProps:d,wrapLongLines:l,wrapLines:c,PreTag:u,children:a})}},21209:function(e,t,n){n.d(t,{p:function(){return c}});var s=n(68248),r=n(46709),a=n(82716),o=n(27757),i=n(73408);var l={name:"1d3w5wq",styles:"width:100%"};const c=({sectionKey:e,title:t,children:n,withBorder:c=!1,isExceptionSection:d=!1,className:u})=>{const[p,m]=(0,r.useState)(!0),{theme:g}=(0,o.u)(),h=d?g.colors.actionDangerPrimaryBackgroundDefault:g.colors.border,f=d?`${g.colors.actionDangerPrimaryBackgroundDefault}15`:g.colors.backgroundSecondary,v=d?g.colors.backgroundPrimary:void 0;return(0,i.FD)("div",{className:u,css:(0,s.AH)({display:"flex",flexDirection:"column",borderRadius:g.borders.borderRadiusMd},""),children:[(0,i.FD)("div",{css:(0,s.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:g.spacing.xs,padding:c?g.spacing.sm:0,background:c?f:void 0,borderTopLeftRadius:g.borders.borderRadiusMd,borderTopRightRadius:g.borders.borderRadiusMd,borderBottomLeftRadius:p?0:g.borders.borderRadiusMd,borderBottomRightRadius:p?0:g.borders.borderRadiusMd,border:c?`1px solid ${h}`:void 0,marginBottom:c?0:g.spacing.sm},""),children:[(0,i.Y)(o.B,{size:"small",componentId:"shared.model-trace-explorer.expand",type:"tertiary",icon:p?(0,i.Y)(a.ChevronDownIcon,{}):(0,i.Y)(o.o,{}),onClick:()=>m(!p)}),(0,i.Y)(o.T.Title,{withoutMargins:!0,level:4,css:l,children:t})]}),p&&(0,i.Y)("div",{css:(0,s.AH)({border:c?`1px solid ${h}`:void 0,borderTop:"none",borderBottomLeftRadius:c?g.borders.borderRadiusMd:void 0,borderBottomRightRadius:c?g.borders.borderRadiusMd:void 0,padding:c?g.spacing.sm:0,background:v},""),children:n})]})}},21636:function(e,t,n){n.d(t,{Bt:function(){return r},E3:function(){return d},IR:function(){return u},K6:function(){return g},Uu:function(){return l},Ye:function(){return p},ak:function(){return c},gK:function(){return a},hb:function(){return m},kj:function(){return s},n2:function(){return i},zZ:function(){return o}});const s="yellow500",r="yellow200",a="mlflow.assessment.scorerTraceId",o="mlflow.assessment.judgeCost",i="mlflow.trace.session",l="mlflow.trace.tokenUsage",c="mlflow.trace.cost",d="mlflow.trace.user",u="mlflow.llm.model",p="mlflow.llm.cost",m="selectedTraceId",g="mlflow.trace.session"},22558:function(e,t,n){n.d(t,{$:function(){return y}});var s=n(68248),r=n(46709),a=n(82716),o=n(27757),i=n(42747),l=n(83219),c=n(86125),d=n(21209),u=n(53915),p=n(94777),m=n(42401),g=n(81390),h=n(73408);var f={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},v={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},x={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const y=({node:e,renderMode:t})=>{const{theme:n}=(0,o.u)(),[y,b]=(0,r.useState)(!1),Y=(0,r.useMemo)(()=>(0,c.g_)(e.inputs),[e]),A=(0,r.useMemo)(()=>(0,c.g_)(e.outputs),[e]),S=(0,c.bn)(e),T=e.chatMessageFormat,w=S.length>0,M=Y.length>0,E=A.length>0,{setSelectedNode:I,setActiveView:C,setShowTimelineTreeGantt:k}=(0,u.nJ)();return(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,h.Y)("div",{css:(0,s.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,h.Y)(o.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:n.spacing.xs},""),icon:y?(0,h.Y)(a.ChevronDownIcon,{}):(0,h.Y)(o.o,{}),onClick:()=>b(!y),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,h.Y)("div",{css:(0,s.AH)({position:"relative",boxSizing:"border-box",height:48,borderLeft:`2px solid ${n.colors.border}`,width:12},""),children:(0,h.Y)("div",{css:(0,s.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:n.borders.borderRadiusMd,borderBottom:`2px solid ${n.colors.border}`,borderLeft:`2px solid ${n.colors.border}`},"")})}),(0,h.FD)("div",{css:f,children:[(0,h.FD)("div",{css:v,children:[(0,h.Y)(o.T.Text,{color:"secondary",css:(0,s.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,h.Y)(i.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,h.Y)(p.o,{node:e})}})}),(0,h.Y)("span",{onClick:()=>{I(e),C("detail"),k(!0)},children:(0,h.Y)(o.T.Text,{css:x,color:"secondary",children:(0,g.X6)(e.end-e.start)})})]}),y&&(0,h.FD)("div",{children:[w&&(0,h.Y)(l.c,{node:e}),M&&(0,h.Y)(d.p,{sectionKey:"input",title:(0,h.Y)(i.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,h.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:Y.map(({key:e,value:n},s)=>(0,h.Y)(m.B,{title:e,data:n,renderMode:t,chatMessageFormat:T},e||s))})}),E&&(0,h.Y)(d.p,{sectionKey:"output",title:(0,h.Y)(i.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,h.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:A.map(({key:e,value:n})=>(0,h.Y)(m.B,{title:e,data:n,renderMode:t,chatMessageFormat:T},e))})})]})]})]})}},24411:function(e,t,n){n.d(t,{i:function(){return Ee}});var s=n(68248),r=n(76118),a=n(46709),o=n(27757),i=n(79081),l=n(42747),c=n(84612),d=n(27882),u=n(53915),p=n(28993),m=n(82716),g=n(44666),h=n(73408);const f=({assessment:e,setIsEditing:t,setShowDeleteModal:n})=>{var s;const r="feedback"in e,a=((null!==(s=(0,g.w)())&&void 0!==s?s:"")===e.source.source_id||r&&"HUMAN"!==e.source.source_type)&&t;return(0,h.FD)(m.DropdownMenu.Root,{children:[(0,h.Y)(m.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,h.Y)(m.OverflowIcon,{}),size:"small"})}),(0,h.FD)(m.DropdownMenu.Content,{minWidth:100,children:[a&&(0,h.FD)(m.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,h.Y)(m.DropdownMenu.IconWrapper,{children:(0,h.Y)(m.PencilIcon,{})}),(0,h.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,h.FD)(m.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>n(!0),children:[(0,h.Y)(m.DropdownMenu.IconWrapper,{children:(0,h.Y)(m.TrashIcon,{})}),(0,h.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})};var v=n(39595),x=n(61060),y=n(59542),b=n(86125),Y=n(13433),A=n(41151);const S=({assessment:e,isModalVisible:t,setIsModalVisible:n})=>{const{deleteAssessmentMutation:s,isLoading:r}=(({assessment:e,onSuccess:t,onError:n,onSettled:s,skip:r})=>{const a=(0,l.tz)(),o=(0,v.jE)(),i=null===e||void 0===e?void 0:e.trace_id,c=null===e||void 0===e?void 0:e.assessment_id,u=(0,p.K)(e=>e.logRemovedAssessment),m=(0,p.K)(e=>e.logAddedAssessment),g=(0,A.M)(),h=r||!i||!c,{mutate:f,isLoading:S}=(0,x.n)({mutationFn:()=>h?Promise.reject(new Error("Mutation is skipped")):(0,d.F9)()&&g.modelTraceInfo&&(0,b.gD)(g.modelTraceInfo)&&(0,b.ko)(g.modelTraceInfo)?Y._A.deleteAssessmentV4({traceId:i,assessmentId:c,traceLocation:g.modelTraceInfo.trace_location}):(0,Y.aG)({traceId:i,assessmentId:c}),onSuccess:()=>{var n;if((0,d.F9)()&&!h){if(e.overriddenAssessment){const t={...e.overriddenAssessment,valid:!0};m(i,t)}u(i,e)}o.invalidateQueries({queryKey:[b.BS,i]}),null===(n=g.invalidateTraceQuery)||void 0===n||n.call(g,i),(0,y.B)({queryClient:o}),null===t||void 0===t||t()},onError:e=>{e instanceof Error&&h||((0,b.ij)(a.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e))},onSettled:()=>{null===s||void 0===s||s()}});return{deleteAssessmentMutation:f,isLoading:S}})({assessment:e,onSettled:()=>{n(!1)}}),o=(0,a.useCallback)(()=>{s()},[s]);return(0,h.Y)(i.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:o,okButtonProps:{danger:!0,loading:r},okText:(0,h.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{n(!1)},cancelText:(0,h.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:r,title:(0,h.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,h.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};var T=n(66916),w=n(33145);const M=({assessment:e,onSuccess:t,onSettled:n,onCancel:i})=>{var u;const f="feedback"in e,S=(0,w.ed)(e),M=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(n){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(S,f),E=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(S),I=null!==(u=(0,g.w)())&&void 0!==u?u:"",{theme:C}=(0,o.u)(),[k,D]=(0,a.useState)(M),[N,R]=(0,a.useState)(E),[_,L]=(0,a.useState)(e.rationale),[F,H]=(0,a.useState)(null),{updateAssessmentMutation:O,isLoading:z}=(({assessment:e,onSuccess:t,onError:n,onSettled:s})=>{const a=(0,l.tz)(),o=(0,v.jE)(),i=(0,p.K)(e=>e.logAddedAssessment),c=(0,A.M)(),{mutate:u,isLoading:m}=(0,x.n)({mutationFn:t=>(0,d.F9)()&&null!==c&&void 0!==c&&c.modelTraceInfo&&(0,b.gD)(c.modelTraceInfo)&&(0,b.ko)(null===c||void 0===c?void 0:c.modelTraceInfo)?(t.assessment.assessment_name=e.assessment_name,Y._A.updateAssessmentV4({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t,traceLocation:c.modelTraceInfo.trace_location})):(0,Y.G3)({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,b.ij)(a.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:n=>{var s;if((0,d.F9)()&&(0,r.isObject)(n)){const e="assessment"in n?n.assessment:n;i(e.trace_id,e)}o.invalidateQueries({queryKey:[b.BS,e.trace_id]}),null===(s=c.invalidateTraceQuery)||void 0===s||s.call(c,e.trace_id),(0,y.B)({queryClient:o}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{updateAssessmentMutation:u,isLoading:m}})({assessment:e,onSuccess:t,onSettled:n}),{overrideAssessmentMutation:U,isLoading:B}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const a=(0,l.tz)(),o=(0,v.jE)(),i=(0,p.K)(e=>e.logAddedAssessment),c=(0,p.K)(e=>e.logRemovedAssessment),u=(0,A.M)(),{mutate:m,isLoading:h}=(0,x.n)({mutationFn:({oldAssessment:e,value:t,rationale:n})=>{var s;const a={...e,...t,rationale:n,source:{source_id:null!==(s=(0,g.w)())&&void 0!==s?s:"",source_type:"HUMAN"},overrides:e.assessment_id},o={assessment:(0,r.omit)(a,"assessment_id","create_time","last_update_time","overriddenAssessments")};return(0,d.F9)()&&u.modelTraceInfo&&(0,b.gD)(u.modelTraceInfo)&&(0,b.ko)(u.modelTraceInfo)?Y._A.createAssessmentV4({payload:o,traceLocation:u.modelTraceInfo.trace_location}):(0,Y.bU)({payload:o})},onError:e=>{(0,b.ij)(a.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:(n,s)=>{var a;if((0,d.F9)()&&(0,r.isObject)(n)){const t="assessment"in n?n.assessment:n;t.overriddenAssessment=s.oldAssessment,i(e,t),c(e,s.oldAssessment)}o.invalidateQueries({queryKey:[b.BS,e]}),null===(a=u.invalidateTraceQuery)||void 0===a||a.call(u,e),(0,y.B)({queryClient:o}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{overrideAssessmentMutation:m,isLoading:h}})({traceId:e.trace_id,onSuccess:t,onSettled:n}),V=z||B,j=(0,a.useCallback)(async()=>{if("json"===k)try{JSON.parse(N)}catch(n){return void H((0,h.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=(0,c.KN)({formValue:N,dataType:k,isFeedback:f});if(I!==e.source.source_id&&f)U({oldAssessment:e,value:t,..._?{rationale:_}:{}});else{const e={assessment:{...t,rationale:_},update_mask:(f?"feedback":"expectation")+",rationale"};O(e)}},[k,N,f,I,e,_,O,U]);return(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:C.spacing.xs,marginTop:C.spacing.sm,border:`1px solid ${C.colors.border}`,padding:C.spacing.sm,borderRadius:C.borders.borderRadiusSm},""),children:[(0,h.Y)(o.T.Text,{css:(0,s.AH)({marginTop:C.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,h.FD)(m.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:k,disabled:V,onChange:e=>{D(e.target.value),H(null)},children:[!f&&(0,h.Y)(m.SimpleSelectOption,{value:"json",children:(0,h.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,h.Y)(m.SimpleSelectOption,{value:"string",children:(0,h.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,h.Y)(m.SimpleSelectOption,{value:"boolean",children:(0,h.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,h.Y)(m.SimpleSelectOption,{value:"number",children:(0,h.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,h.Y)(o.T.Text,{css:(0,s.AH)({marginTop:C.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===k&&(0,h.FD)(h.FK,{children:[(0,h.Y)(T.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(N),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{R(e.target.value),H(null)},validationState:F?"error":void 0,disabled:V}),F&&(0,h.Y)(m.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:F,type:"error"})]}),"string"===k&&(0,h.Y)(T.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(N),onKeyDown:e=>e.stopPropagation(),onChange:e=>{R(e.target.value),H(null)},disabled:V,allowClear:!0}),"boolean"===k&&(0,h.FD)(m.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:N,disabled:V,onChange:e=>{R(e.target.value),H(null)},children:[(0,h.Y)(m.SegmentedControlButton,{value:!0,children:"True"}),(0,h.Y)(m.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===k&&(0,h.Y)(T.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(N),onKeyDown:e=>e.stopPropagation(),onChange:e=>{R(e.target.value?Number(e.target.value):""),H(null)},type:"number",disabled:V,allowClear:!0}),(0,h.Y)(o.T.Text,{css:(0,s.AH)({marginTop:C.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,h.Y)(T.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:_,autoSize:{minRows:1,maxRows:5},disabled:V,onKeyDown:e=>e.stopPropagation(),onChange:e=>L(e.target.value)}),(0,h.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:C.spacing.xs},""),children:[(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:V,onClick:i,children:(0,h.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,h.Y)(o.B,{css:(0,s.AH)({marginLeft:C.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:j,loading:V,children:(0,h.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var E=n(4564),I=n(777),C=n(94777),k=n(21636),D=n(86119),N=n(110);var R={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},_={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},L={name:"s5xdrg",styles:"display:flex;align-items:center"},F={name:"fxp7t8",styles:"flex:1;min-width:0"};const H=({expectation:e})=>{var t;const{theme:n}=(0,o.u)(),[i,d]=(0,a.useState)(!1),[p,g]=(0,a.useState)(!1),[v,x]=(0,a.useState)(!1),{nodeMap:y,activeView:b}=(0,u.nJ)(),{experimentId:Y}=(0,N.g)(),A=e.span_id?y[e.span_id]:null,T=null===(t=e.metadata)||void 0===t?void 0:t[k.K6],H="summary"===b&&!(0,r.isEmpty)(T),O="summary"===b&&A&&!H,z=(0,c.jf)(e.expectation),U=(0,w.RZ)(e.source);return(0,h.FD)("div",{css:(0,s.AH)({padding:n.spacing.sm+n.spacing.xs,paddingTop:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,h.FD)("div",{css:R,children:[(0,h.Y)(o.T.Text,{bold:!0,css:_,children:e.assessment_name}),(0,h.Y)(f,{assessment:e,setIsEditing:d,setShowDeleteModal:g}),(0,h.Y)(S,{assessment:e,isModalVisible:p,setIsModalVisible:g})]}),i?(0,h.Y)(M,{assessment:e,onSuccess:()=>d(!1),onCancel:()=>d(!1)}):(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,h.FD)("div",{css:L,children:[(0,h.Y)(U,{size:n.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:n.colors.actionIconBackgroundHover,borderRadius:n.borders.borderRadiusFull},"")}),(0,h.Y)(E.V,{source:e.source})]}),(0,h.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:v?"flex-start":"center",gap:n.spacing.xs},""),children:[(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.toggle-expectation-expanded",size:"small",icon:v?(0,h.Y)(m.ChevronDownIcon,{}):(0,h.Y)(o.o,{}),onClick:()=>x(!v)}),(0,h.Y)("div",{css:F,children:v?(0,h.Y)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundSecondary,padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderRadius:n.borders.borderRadiusMd,whiteSpace:"pre-wrap",wordBreak:"break-word"},""),children:(0,h.Y)(o.T.Text,{children:"string"===typeof z?z:JSON.stringify(z,null,2)})}):(0,h.Y)(I.S,{parsedValue:z,singleLine:!0})})]})]}),O&&(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,h.Y)(C.o,{node:A})]}),H&&(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"451ETc",defaultMessage:"Session"})}),(0,h.Y)(D.b,{experimentId:null!==Y&&void 0!==Y?Y:"",sessionId:null!==T&&void 0!==T?T:"",traceId:e.trace_id,handleCopy:()=>{},hideLabel:!0})]})]})};var O=n(40724),z=n(57248);const U=({name:e,setName:t,nameError:n,setNameError:s,handleChangeSchema:r})=>{const{schemas:o}=(0,z.a)(),i=(0,l.tz)(),c=o.map(e=>{var t;return null!==(t=e.name)&&void 0!==t?t:""}),[d,u]=(0,a.useState)(null),[p,g]=(0,a.useState)(o),f=(0,a.useMemo)(()=>{const t=[...p];if(e&&!c.includes(e)){const n=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);t.unshift(n)}return t},[e,p,c]),v=(0,a.useCallback)(e=>{u(e),s(null)},[s]);(0,a.useEffect)(()=>{r(d)},[r,d]);const x=(0,m.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:o,items:f,setItems:g,multiSelect:!1,setInputValue:e=>{t(e),s(null)},itemToString:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""},matcher:(e,t)=>{var n,s;return null!==(n=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(t.toLowerCase()))&&void 0!==n&&n},formValue:d,formOnChange:v,preventUnsetOnBlur:!0});return(0,h.FD)(m.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:x,children:[(0,h.Y)(m.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:i.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:n?"error":void 0,comboboxState:x,formOnChange:v,onPressEnter:()=>{f.length>0&&v(f[0])},allowClear:!0,showComboboxToggleButton:!0}),n&&(0,h.Y)(m.FormUI.Message,{type:"error",message:n}),(0,h.Y)(m.TypeaheadComboboxMenu,{comboboxState:x,children:f.map((e,t)=>{var n,s,r;return(0,h.Y)(m.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`,item:e,index:t,comboboxState:x,children:null!==(r=null===e||void 0===e?void 0:e.name)&&void 0!==r?r:""},`assessment-name-typeahead-${null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""}`)})})]})};var B=n(52033),V=n(72143),j=n(89634),$=n(27094);const K={json:V.f,string:$.k,boolean:B.B,number:j.O},P=(0,a.forwardRef)(({assessmentName:e,initialAssessmentType:t,spanId:n,traceId:i,setExpanded:u},f)=>{var S;const{theme:w}=(0,o.u)(),{schemas:M}=(0,z.a)(),[E,I]=(0,a.useState)(""),[C,D]=(0,a.useState)(null!==t&&void 0!==t?t:"feedback"),[N,R]=(0,a.useState)("boolean"),[_,L]=(0,a.useState)(!0),[F,H]=(0,a.useState)(""),[O,B]=(0,a.useState)(null),[V,j]=(0,a.useState)(null),$=!(0,r.isNil)(e),P=null!==(S=K[N])&&void 0!==S?S:K.string,{createAssessmentMutation:W,isLoading:G}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const a=(0,l.tz)(),o=(0,v.jE)(),i=(0,p.K)(e=>e.logAddedAssessment),c=(0,A.M)(),{mutate:u,isLoading:m}=(0,x.n)({mutationFn:e=>{const t=e;return(0,d.aZ)()&&c.chatSessionId&&e.assessment&&(e.assessment.metadata={...e.assessment.metadata,[k.n2]:c.chatSessionId}),(0,d.F9)()&&null!==c&&void 0!==c&&c.modelTraceInfo&&(0,b.gD)(c.modelTraceInfo)&&(0,b.ko)(null===c||void 0===c?void 0:c.modelTraceInfo)?Y._A.createAssessmentV4({payload:t,traceLocation:c.modelTraceInfo.trace_location}):(0,Y.bU)({payload:t})},onSuccess:n=>{var s;if((0,d.F9)()&&(0,r.isObject)(n)){const t="assessment"in n?n.assessment:n;i(e,t)}null===(s=c.invalidateTraceQuery)||void 0===s||s.call(c,e),o.invalidateQueries({queryKey:[b.BS,e]}),(0,y.B)({queryClient:o}),null===t||void 0===t||t()},onError:e=>{(0,b.ij)(a.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSettled:()=>{null===s||void 0===s||s()}});return{createAssessmentMutation:u,isLoading:m}})({traceId:i,onSettled:()=>{u(!1)}}),J=(0,a.useCallback)(async()=>{var t;if("json"===N)try{JSON.parse(_)}catch(a){return void j((0,h.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!$&&""===E)return void B((0,h.Y)(l.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const s=(0,c.KN)({formValue:_,dataType:N,isFeedback:"feedback"===C}),r={assessment:{assessment_name:$?e:E,trace_id:i,source:{source_type:"HUMAN",source_id:null!==(t=(0,g.w)())&&void 0!==t?t:""},span_id:n,rationale:F,...s}};W(r)},[N,_,C,$,e,E,i,n,F,W]),q=(0,a.useCallback)(e=>{if(!e)return I(""),D(null!==t&&void 0!==t?t:"feedback"),R("boolean"),L(!0),H(""),void j(null);if(M.some(t=>t.name===e.name))switch(I(e.name),D(e.assessmentType),R(e.dataType),e.dataType){case"string":case"json":L("");break;case"number":L(0);break;case"boolean":L(!0)}else I(e.name)},[M,t]);return(0,h.FD)("div",{ref:f,css:(0,s.AH)({display:"flex",flexDirection:"column",gap:w.spacing.xs,border:`1px solid ${w.colors.border}`,padding:w.spacing.sm,borderRadius:w.borders.borderRadiusSm},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,h.FD)(m.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",label:"Assessment Type",value:C,disabled:G,onChange:e=>{D(e.target.value),"feedback"===e.target.value&&"json"===N&&R("string")},children:[(0,h.Y)(m.SimpleSelectOption,{value:"feedback",children:(0,h.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,h.Y)(m.SimpleSelectOption,{value:"expectation",children:(0,h.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,h.Y)(o.T.Text,{css:(0,s.AH)({marginTop:w.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),$?(0,h.Y)(o.T.Text,{children:e}):(0,h.Y)(U,{name:E,setName:I,handleChangeSchema:q,nameError:O,setNameError:B}),(0,h.Y)(o.T.Text,{css:(0,s.AH)({marginTop:w.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,h.FD)(m.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",label:"Data Type",value:N,disabled:G,onChange:e=>{R(e.target.value),j(null)},children:["expectation"===C&&(0,h.Y)(m.SimpleSelectOption,{value:"json",children:(0,h.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,h.Y)(m.SimpleSelectOption,{value:"string",children:(0,h.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,h.Y)(m.SimpleSelectOption,{value:"boolean",children:(0,h.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,h.Y)(m.SimpleSelectOption,{value:"number",children:(0,h.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,h.Y)(o.T.Text,{css:(0,s.AH)({marginTop:w.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,h.Y)(P,{value:_,valueError:V,setValue:L,setValueError:j,isSubmitting:G}),(0,h.Y)(o.T.Text,{css:(0,s.AH)({marginTop:w.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,h.Y)(T.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:F,autoSize:{minRows:1,maxRows:5},disabled:G,onKeyDown:e=>e.stopPropagation(),onChange:e=>H(e.target.value)}),(0,h.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:w.spacing.xs},""),children:[(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:G,onClick:()=>u(!1),children:(0,h.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,h.Y)(o.B,{css:(0,s.AH)({marginLeft:w.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:J,loading:G,children:(0,h.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})}),W=({onClick:e})=>(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.add-expectation",size:"small",icon:(0,h.Y)(m.PlusIcon,{}),onClick:e,children:(0,h.Y)(O.A,{id:"OneX+E",defaultMessage:"Add expectation"})}),G=({expectations:e,activeSpanId:t,traceId:n})=>{const l=(0,a.useMemo)(()=>e.toSorted((e,t)=>e.assessment_name.localeCompare(t.assessment_name)),[e]),[c,d]=(0,a.useState)(!1),{theme:u}=(0,o.u)();return(0,h.FD)(h.FK,{children:[(0,h.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",height:u.spacing.lg,flexShrink:0},""),children:(0,h.FD)(o.T.Text,{bold:!0,children:[(0,h.Y)(O.A,{id:"UbXw8O",defaultMessage:"Expectations"})," ",!(0,r.isEmpty)(l)&&(0,h.FD)(h.FK,{children:["(",null===l||void 0===l?void 0:l.length,")"]})]})}),(0,h.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginBottom:u.spacing.sm},""),children:!(0,r.isEmpty)(l)&&(0,h.Y)(W,{onClick:()=>d(!0)})}),l.length>0?(0,h.Y)(h.FK,{children:(0,h.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginBottom:u.spacing.sm},""),children:l.map(e=>(0,h.Y)(H,{expectation:e},e.assessment_id))})}):!c&&(0,h.FD)("div",{css:(0,s.AH)({textAlign:"center",borderRadius:u.spacing.xs,border:`1px dashed ${u.colors.border}`,padding:`${u.spacing.md}px ${u.spacing.md}px`},""),children:[(0,h.FD)(o.T.Hint,{children:[(0,h.Y)(O.A,{id:"dTjHiD",defaultMessage:"Add a custom expectation to this trace."})," ",(0,h.Y)(o.T.Link,{componentId:"shared.model-trace-explorer.expectation-learn-more-link",openInNewTab:!0,href:"https://www.mlflow.org/docs/latest/genai/assessments/expectations/",children:(0,h.Y)(O.A,{id:"zMv2ev",defaultMessage:"Learn more."})})]}),(0,h.Y)(i.S,{size:"sm"}),(0,h.Y)(W,{onClick:()=>d(!0)})]}),c&&(0,h.Y)(P,{spanId:t,traceId:n,initialAssessmentType:"expectation",setExpanded:()=>d(!1)})]})};var J=n(5075);var q={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const X=({renderConnector:e=!0,assessment:t,setIsEditing:n,hideOverflowMenu:r=!1})=>{const{theme:i}=(0,o.u)(),[l,d]=(0,a.useState)(!1),u=(0,w.RZ)(t.source);return(0,h.FD)("div",{css:q,children:[e&&(0,h.Y)("div",{css:(0,s.AH)({position:"absolute",left:-1,top:0,width:10,height:i.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:i.borders.borderRadiusMd,borderBottom:`1px solid ${i.colors.border}`,borderLeft:`1px solid ${i.colors.border}`},"")}),(0,h.Y)(u,{size:i.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:i.colors.actionIconBackgroundHover,borderRadius:i.borders.borderRadiusFull},"")}),(0,h.Y)(E.V,{source:t.source}),(0,h.FD)("div",{css:(0,s.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:i.spacing.xs},""),children:[t.last_update_time&&(0,h.Y)(o.T.Text,{color:"secondary",size:"sm",css:(0,s.AH)({marginLeft:i.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:(0,c.Pt)(new Date(t.last_update_time))}),!r&&(0,h.Y)(f,{assessment:t,setIsEditing:n,setShowDeleteModal:d}),(0,h.Y)(S,{assessment:t,isModalVisible:l,setIsModalVisible:d})]})]})};var Q=n(73879),Z=n(96586);var ee={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const te=({feedback:e})=>{const{theme:t}=(0,o.u)(),n=e.feedback.value;return(0,h.FD)("div",{css:ee,children:[(0,h.Y)(X,{renderConnector:!1,assessment:e}),(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,r.isNil)(e.feedback.error)?(0,h.FD)(h.FK,{children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,h.Y)("div",{children:(0,h.Y)(J.Q,{jsonValue:JSON.stringify(n),assessmentName:e.assessment_name})})]}):(0,h.Y)(Z.B,{error:e.feedback.error}),e.rationale&&(0,h.FD)(h.FK,{children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",css:(0,s.AH)({marginTop:t.spacing.xs},""),children:(0,h.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,h.Y)(Q.V,{children:e.rationale})]})]})]})},ne=({isModalVisible:e,setIsModalVisible:t,feedback:n})=>{const s=(0,a.useMemo)(()=>(e=>{const t=new Set,n=[];let s=e;for(;s&&!t.has(s.assessment_id);)t.add(s.assessment_id),n.push(s),s=s.overriddenAssessment;return n})(n),[n]);return(0,h.Y)(i.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,h.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:s.map(e=>"feedback"in e?(0,h.Y)(te,{feedback:e},e.assessment_id):null)})},se=e=>(0,N.tW)((0,N.Oz)("/experiments/:experimentId"),{experimentId:e});var re=n(43695);var ae={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},oe={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"},ie={name:"rnnx2x",styles:"font-size:12px"};const le=({feedback:e})=>{var t,n,i;const[c,d]=(0,a.useState)(!1),{theme:p}=(0,o.u)(),{nodeMap:m,activeView:g}=(0,u.nJ)(),{experimentId:f}=(0,N.g)(),v=e.feedback.value,x=e.span_id?m[e.span_id]:null,y=null===(t=e.metadata)||void 0===t?void 0:t[k.K6],b="summary"===g&&!(0,r.isEmpty)(y),Y="summary"===g&&x&&!b,A=null===(n=e.metadata)||void 0===n?void 0:n[k.gK],S=A&&f?ce(f,A):void 0,T=null===(i=e.metadata)||void 0===i?void 0:i[k.zZ],w=(()=>{if(null===T)return;const e=Number(T);return Number.isFinite(e)?(0,re.l)(e):void 0})(),M=Boolean(w);return(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.sm,marginLeft:p.spacing.lg},""),children:[!(0,r.isNil)(e.feedback.error)&&(0,h.Y)(Z.B,{error:e.feedback.error}),Y&&(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.xs},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,h.Y)(C.o,{node:x})]}),b&&(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.xs},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"451ETc",defaultMessage:"Session"})}),(0,h.Y)(D.b,{experimentId:null!==f&&void 0!==f?f:"",sessionId:null!==y&&void 0!==y?y:"",traceId:e.trace_id,handleCopy:()=>{},hideLabel:!0})]}),(0,r.isNil)(e.feedback.error)&&(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.xs},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,h.FD)("div",{css:(0,s.AH)({display:"flex",gap:p.spacing.xs},""),children:[(0,h.Y)(J.Q,{jsonValue:JSON.stringify(v),assessmentName:e.assessment_name}),e.overriddenAssessment&&(0,h.FD)(h.FK,{children:[(0,h.Y)("span",{onClick:()=>d(!0),children:(0,h.Y)(o.T.Text,{css:ae,color:"secondary",children:(0,h.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,h.Y)(ne,{isModalVisible:c,setIsModalVisible:d,feedback:e})]})]})]}),e.rationale&&(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.xs},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,h.Y)("div",{css:oe,children:(0,h.Y)(Q.V,{children:e.rationale})})]}),M&&(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.xs},""),children:[(0,h.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"oBJ8xc",defaultMessage:"Cost"})}),(0,h.Y)(o.T.Text,{style:{color:p.colors.textSecondary},children:w})]}),S&&(0,h.Y)(N.N_,{to:S,target:"_blank",rel:"noreferrer",children:(0,h.FD)("span",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:p.spacing.xs},""),children:[(0,h.Y)(l.sA,{id:"4a2Kqx",defaultMessage:"View trace"}),(0,h.Y)(o.au,{css:ie})]})})]})},ce=(e,t)=>`${(e=>`${se(e)}/traces`)(e)}?selectedEvaluationId=${t}`,de=({feedback:e})=>{const{theme:t}=(0,o.u)(),[n,r]=(0,a.useState)(!1);return(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,h.Y)(X,{assessment:e,setIsEditing:r}),n?(0,h.Y)(M,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,h.Y)(le,{feedback:e})]})};const ue=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,h.Y)(m.UserIcon,{css:t});case"LLM_JUDGE":return(0,h.Y)(m.SparkleIcon,{css:t});case"CODE":return(0,h.Y)(m.CodeIcon,{css:t});default:return null}},pe=e=>{switch(e){case"HUMAN":return(0,h.Y)(O.A,{id:"OjWQ39",defaultMessage:"Human feedback"});case"LLM_JUDGE":return(0,h.Y)(O.A,{id:"SihD1a",defaultMessage:"LLM judge feedback"});case"CODE":return(0,h.Y)(O.A,{id:"SuVsDp",defaultMessage:"Custom code judge feedback"})}return null};var me={name:"npti7n",styles:"margin:0;&>*{cursor:default;}"};const ge=({feedbacks:e})=>{const{theme:t}=(0,o.u)();if(e.length<1)return null;const n=(0,r.countBy)(e,e=>e.source.source_type);return(0,h.Y)("div",{css:(0,s.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(n).map(([e,n])=>(0,h.Y)(i.T,{componentId:"shared.model-trace-explorer.feedback-source-tooltip",content:pe(e),children:(0,h.Y)(m.Tag,{componentId:"shared.model-trace-explorer.feedback-source-count",css:me,children:(0,h.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[ue(e),n>1&&(0,h.Y)(o.T.Text,{children:n})]})},e)}))})};var he={name:"1fttcpj",styles:"display:flex;flex-direction:column"},fe={name:"ozd7xs",styles:"flex-shrink:0"},ve={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const xe=({jsonValue:e,feedbacks:t})=>{var n;const{theme:r}=(0,o.u)(),[i,l]=(0,a.useState)(!1),c=null===(n=t[0])||void 0===n?void 0:n.assessment_name;return(0,h.FD)("div",{css:he,children:[(0,h.FD)("div",{css:(0,s.AH)({display:"flex",gap:r.spacing.xs,alignItems:"center"},""),children:[(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:fe,size:"small",icon:i?(0,h.Y)(m.ChevronDownIcon,{}):(0,h.Y)(o.o,{}),onClick:()=>l(!i)}),(0,h.Y)(J.Q,{jsonValue:e,assessmentName:c}),(0,h.Y)(ge,{feedbacks:t})]}),i&&(0,h.Y)("div",{css:ve,children:t.map(e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,h.Y)(de,{feedback:e},e.assessment_id))})]})};var ye={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},be={name:"ozd7xs",styles:"flex-shrink:0"};const Ye=({name:e,valuesMap:t,traceId:n,activeSpanId:l,feedbackTypeTag:d,loading:u,onCancelLoading:p})=>{const{theme:g}=(0,o.u)(),f=(0,c.se)(e),[v,x]=(0,a.useState)(!1),y=Object.values(t).flat().some(e=>!(0,r.isNil)(e.feedback.error));return(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",marginBottom:g.spacing.sm,border:`1px solid ${g.colors.border}`,borderRadius:g.borders.borderRadiusMd,padding:g.spacing.sm+g.spacing.xs,paddingTop:g.spacing.sm,gap:g.spacing.sm},""),children:[d,(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:g.spacing.sm},""),children:[(0,h.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:g.spacing.sm,flex:1,minWidth:0},""),children:[(0,h.Y)(o.T.Text,{bold:!0,css:ye,children:f}),y&&(0,h.Y)(o.k,{css:be,color:"danger"})]}),(0,h.Y)(i.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,s.AH)({flexShrink:0,marginRight:-g.spacing.xs},""),size:"small",icon:(0,h.Y)(m.PlusIcon,{}),onClick:()=>x(!0)})})]}),Object.entries(t).map(([e,t])=>(0,h.Y)(xe,{jsonValue:e,feedbacks:t},e)),u&&(0,h.FD)(h.FK,{children:[(0,h.Y)(m.TableSkeleton,{lines:2}),p&&(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.cancel-evaluation-in-group",size:"small",icon:(0,h.Y)(m.StopCircleFillIcon,{}),onClick:p,children:(0,h.Y)(O.A,{id:"r63O2u",defaultMessage:"Cancel judge"})})]}),v&&(0,h.Y)(P,{assessmentName:e,spanId:l,traceId:n,setExpanded:x})]})};var Ae=n(9636);const Se=({onClick:e,traceId:t,sessionId:n})=>{const s=(0,Ae.$)(),[r,i]=(0,a.useState)(!1);var l;return s.renderRunJudgeModal&&(0,d.u6)()?(0,h.FD)(h.FK,{children:[(0,h.FD)(m.DropdownMenu.Root,{children:[(0,h.Y)(m.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{type:"primary",componentId:"shared.model-trace-explorer.add-feedback",size:"small",icon:(0,h.Y)(m.PlusIcon,{}),children:(0,h.Y)(O.A,{id:"/ZsbLo",defaultMessage:"Add feedback"})})}),(0,h.FD)(m.DropdownMenu.Content,{children:[(0,h.Y)(m.DropdownMenu.Item,{componentId:"mlflow.model-trace-explorer.add-human-feedback",onClick:e,children:(0,h.Y)(O.A,{id:"YeCF5P",defaultMessage:"Human feedback"})}),(0,h.Y)(m.DropdownMenu.Item,{componentId:"mlflow.model-trace-explorer.run-judge",onClick:()=>i(!0),children:(0,h.Y)(O.A,{id:"1+JyrI",defaultMessage:"LLM judge feedback"})})]})]}),null===(l=s.renderRunJudgeModal)||void 0===l?void 0:l.call(s,{itemId:null!==n&&void 0!==n?n:t,visible:r,onClose:()=>i(!1)})]}):(0,h.Y)(o.B,{type:"primary",componentId:"shared.model-trace-explorer.add-feedback",size:"small",icon:(0,h.Y)(m.PlusIcon,{}),onClick:e,children:(0,h.Y)(O.A,{id:"/ZsbLo",defaultMessage:"Add feedback"})})};var Te={name:"1s8rng8",styles:"display:flex;gap:4px;justify-content:center"};const we=({enableRunScorer:e,feedbacks:t,activeSpanId:n,traceId:l,sessionId:c})=>{const d=(0,a.useMemo)(()=>(e=>{const t={};return e.forEach(e=>{if(!1===e.valid)return;let n=null;""!==e.feedback.value&&(n=JSON.stringify(e.feedback.value));const{assessment_name:s}=e;t[s]||(t[s]={});const a=t[s];(0,r.isNil)(n)||(a[n]||(a[n]=[]),a[n].push(e))}),Object.entries(t)})(t),[t]),[u,p]=(0,a.useState)(!1),{evaluations:g,subscribeToScorerFinished:f,reset:x}=(0,Ae.$)(),Y=(0,a.useMemo)(()=>g?Object.values(g).filter(e=>{var t;return l in(null!==(t=e.tracesData)&&void 0!==t?t:{})}):[],[g,l]),{newTracePendingEvaluations:S,loadingEvaluations:T}=(0,a.useMemo)(()=>{const e=Y.filter(e=>e.isLoading);return{newTracePendingEvaluations:(0,r.uniqBy)(e.filter(e=>!d.some(([t])=>t===e.label)),"label"),loadingEvaluations:e}},[Y,d]),w=(0,a.useMemo)(()=>Y.filter(e=>e.error),[Y]),{invalidateTraceQuery:M}=(0,A.M)(),E=(0,v.jE)();(0,a.useEffect)(()=>null===f||void 0===f?void 0:f(e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.some(e=>{var t,n,s;return"trace"in e&&(null===(t=e.trace)||void 0===t?void 0:t.info)&&"trace_id"in(null===(n=e.trace)||void 0===n?void 0:n.info)&&(null===(s=e.trace)||void 0===s?void 0:s.info.trace_id)===l}))&&(null===M||void 0===M||M(l),E.invalidateQueries({queryKey:[b.BS,l]}),(0,y.B)({queryClient:E}))}),[f,l,M,E]);const I=(0,r.isEmpty)(d)&&(0,r.isEmpty)(w)&&(0,r.isEmpty)(S),{theme:C}=(0,o.u)();return(0,h.FD)(h.FK,{children:[(0,h.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:C.spacing.sm,height:C.spacing.lg,flexShrink:0},""),children:(0,h.FD)(o.T.Text,{bold:!0,children:[(0,h.Y)(O.A,{id:"utyagz",defaultMessage:"Feedback"})," ",!(0,r.isEmpty)(d)&&(0,h.FD)(h.FK,{children:["(",null===t||void 0===t?void 0:t.length,")"]})]})}),!I&&(0,h.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginBottom:C.spacing.sm,gap:C.spacing.xs},""),children:(0,h.Y)(Se,{traceId:l,sessionId:c,onClick:()=>p(!0)})}),w.map(e=>{var t;return(0,h.Y)("div",{css:(0,s.AH)({marginBottom:C.spacing.sm},""),children:(0,h.Y)(m.Alert,{closable:!1,type:"error",message:(0,h.Y)(O.A,{id:"HSMagB",defaultMessage:'Error evaluating "{label}"',values:{label:e.label}}),description:null===(t=e.error)||void 0===t?void 0:t.message,componentId:"shared.model-trace-explorer.feedback-error-item"})},e.requestKey)}),S.map(e=>(0,h.FD)("div",{css:(0,s.AH)({borderRadius:C.spacing.sm,border:`1px solid ${C.colors.border}`,padding:C.spacing.sm+C.spacing.xs,paddingTop:C.spacing.sm,marginBottom:C.spacing.sm,display:"flex",flexDirection:"column",gap:C.spacing.sm},""),children:[(0,h.Y)(o.T.Text,{bold:!0,children:e.label}),(0,h.Y)(m.TableSkeleton,{lines:3}),x&&(0,h.Y)(o.B,{componentId:"shared.model-trace-explorer.cancel-evaluation",size:"small",icon:(0,h.Y)(m.StopCircleFillIcon,{}),onClick:()=>x(e.requestKey),children:(0,h.Y)(O.A,{id:"r63O2u",defaultMessage:"Cancel judge"})})]},e.requestKey)),d.map(([e,t])=>{const s=T.find(t=>t.label===e);return(0,h.Y)(Ye,{name:e,valuesMap:t,traceId:l,activeSpanId:n,loading:Boolean(s),onCancelLoading:s&&x?()=>x(s.requestKey):void 0},e)}),I&&!u&&(0,h.FD)("div",{css:(0,s.AH)({textAlign:"center",borderRadius:C.spacing.xs,border:`1px dashed ${C.colors.border}`,padding:`${C.spacing.md}px ${C.spacing.md}px`},""),children:[(0,h.FD)(o.T.Hint,{children:[(0,h.Y)(O.A,{id:"MNLhKO",defaultMessage:"Add custom feedback to this trace."})," ",(0,h.Y)(o.T.Link,{componentId:"shared.model-trace-explorer.feedback-learn-more-link",openInNewTab:!0,href:"https://www.mlflow.org/docs/latest/genai/assessments/feedback/",children:(0,h.Y)(O.A,{id:"mLr9U7",defaultMessage:"Learn more."})})]}),(0,h.Y)(i.S,{size:"sm"}),(0,h.Y)("div",{css:Te,children:(0,h.Y)(Se,{traceId:l,sessionId:c,onClick:()=>p(!0)})})]}),u&&(0,h.Y)(P,{spanId:n,traceId:l,initialAssessmentType:"feedback",setExpanded:()=>p(!1)})]})};var Me={name:"ozd7xs",styles:"flex-shrink:0"};const Ee=({assessments:e,traceId:t,sessionId:n,activeSpanId:m,className:g,assessmentsTitleOverride:f,disableCloseButton:v,enableRunScorer:x=!0})=>{const y=(0,p.K)(e=>e.reconstructAssessments),b=(0,p.K)(e=>e.assessmentActions[t]),Y=(0,a.useMemo)(()=>{if(!(0,d.F9)())return e;const t=y(e,b);return(0,r.uniqBy)(t,({assessment_id:e})=>e)},[e,y,b]),{theme:A}=(0,o.u)(),{setAssessmentsPaneExpanded:S,isInComparisonView:T}=(0,u.nJ)(),[w,M]=(0,a.useMemo)(()=>(0,r.partition)(Y,e=>"feedback"in e),[Y]),E=(0,Ae.$)();return(0,h.FD)("div",{"data-testid":"assessments-pane",css:(0,s.AH)({display:"flex",flexDirection:"column",...T?{padding:`${A.spacing.sm} 0`,maxHeight:10*A.spacing.lg}:{padding:A.spacing.sm,paddingTop:A.spacing.xs,height:"100%"},...T?{}:{borderLeft:`1px solid ${A.colors.border}`},overflowY:"auto",minWidth:c.uZ,width:"100%",boxSizing:"border-box"},""),className:g,children:[(0,h.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginTop:A.spacing.sm,marginBottom:A.spacing.sm},""),children:[!T&&(f?f():(0,h.Y)(o.T.Title,{level:3,withoutMargins:!0,css:Me,children:(0,h.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})})),!T&&S&&!v&&(0,h.Y)(i.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,h.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,h.Y)(o.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,h.Y)(o.C,{}),onClick:()=>S(!1)})})]}),(0,h.Y)(we,{enableRunScorer:x&&(0,d.u6)()&&Boolean(E.renderRunJudgeModal),feedbacks:w,activeSpanId:m,traceId:t,sessionId:n}),(0,h.Y)(i.S,{size:"sm",shrinks:!1}),(0,h.Y)(G,{expectations:M,activeSpanId:m,traceId:t})]})}},26059:function(e,t,n){var s=n(68248),r=n(76118),a=n(46709),o=n(25637),i=n(27556),l=n(27757),c=n(49633),d=n(73408);var u={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},p={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},m={name:"kjqqaz",styles:"width:0;position:relative"};const g=(0,a.forwardRef)((e,t)=>{var n;const{initialRatio:g,paneWidth:h,setPaneWidth:f,leftChild:v,leftMinWidth:x,rightChild:y,rightMinWidth:b,onRatioChange:Y}=e,[A,S]=(0,a.useState)(!1),T=(0,a.useRef)(null),w=null===(n=(0,c.wY)({ref:T}))||void 0===n?void 0:n.width,M=(null!==w&&void 0!==w?w:1/0)-b,E=(0,a.useRef)(g),{theme:I}=(0,l.u)(),C=(0,a.useCallback)(e=>{w&&(E.current=e/w)},[w]),k=(0,i.YQ)(null!==Y&&void 0!==Y?Y:()=>{},200),D=(0,a.useCallback)(()=>w,[w]);return(0,a.useImperativeHandle)(t,()=>({updateRatio:C,getContainerWidth:D})),(0,a.useLayoutEffect)(()=>{w&&f((0,r.clamp)(w*E.current,x,M))},[w,M,x,b,f]),(0,d.FD)("div",{ref:T,css:p,children:[A&&(0,d.Y)(s.mL,{styles:u}),(0,d.Y)(o.ResizableBox,{axis:"x",width:h,css:(0,s.AH)({display:"flex",flex:`0 0 ${h}px`},""),handle:(0,d.Y)("div",{css:m,children:(0,d.Y)("div",{css:(0,s.AH)({position:"relative",width:I.spacing.sm,marginLeft:-I.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const n=(0,r.clamp)(t.width,x,M);f(n),w&&(E.current=n/w,k(E.current))},onResizeStart:()=>S(!0),onResizeStop:()=>S(!1),minConstraints:[x,1/0],maxConstraints:[M,1/0],children:v}),y]})});t.A=g},27882:function(e,t,n){n.d(t,{F9:function(){return a},T9:function(){return r},aZ:function(){return o},ny:function(){return s},u6:function(){return i}});const s=()=>!1,r=()=>1e9,a=()=>!1,o=()=>!0,i=()=>!0},28993:function(e,t,n){n.d(t,{K:function(){return s}});const s=(0,n(24447).vt)(e=>({assessmentActions:{},resetCache:()=>e(()=>({assessmentActions:{}})),logAddedAssessment:(t,n)=>e(e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"ADD",assessment:n}]}}:e),logRemovedAssessment:(t,n)=>e(e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"DELETE",assessment:n}]}}:e),reconstructAssessments:(e,t)=>{if(!t)return e;let n=[...e];return t.forEach(({action:e,assessment:t})=>{"ADD"===e&&t?n.unshift(t):"DELETE"===e&&t&&(n=n.filter(e=>e.assessment_id!==t.assessment_id))}),n}}))},33045:function(e,t,n){n.d(t,{u:function(){return l}});var s=n(76118),r=n(46709),a=n(86125),o=n(81390);const i=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},l=({treeNodes:e,selectedNode:t,setSelectedNode:n,setActiveTab:l,setExpandedKeys:c,modelTraceInfo:d})=>{var u;const[p,m]=(0,r.useState)(""),[g,h]=(0,r.useState)(()=>(e=>{const t={};e&&e.length>0&&(0,s.compact)((0,o.VC)(e).map(e=>e.type)).forEach(e=>{t[e]=!0});return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e)),[f,v]=(0,r.useState)(0),x=(0,r.useMemo)(()=>e.map(e=>e.key).join(","),[e]),{filteredTreeNodes:y,matches:b}=(0,r.useMemo)(()=>{if(!e||0===e.length)return{filteredTreeNodes:[],matches:[]};const t=e.map(e=>(0,a.vL)(e,p,g));return{filteredTreeNodes:t.flatMap(e=>e.filteredTreeNodes),matches:t.flatMap(e=>e.matches)}},[x,p,g,d]),Y=(0,r.useMemo)(()=>(0,o.dM)(y),[y]),A=(0,r.useCallback)(e=>{if(e>=b.length||e<0)return;v(e);const t=b[e];n(t.span),l(i(t));const s=(0,o.NP)(t.span,Y);c(e=>new Set([...e,...s]))},[b,n,l,Y,c]),S=(0,r.useCallback)(()=>{A(f+1)},[f,A]),T=(0,r.useCallback)(()=>{A(f-1)},[f,A]);return(0,r.useLayoutEffect)(()=>{if(0!==y.length){if(0===b.length){var e;const s=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(s in Y)n(Y[s]);else{const e=y[0];n(e),l(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}return}v(0),n(b[0].span),l(i(b[0]))}},[y,b,n]),{matchData:{match:null!==(u=b[f])&&void 0!==u?u:null,totalMatches:b.length,currentMatchIndex:f},searchFilter:p.toLowerCase().trim(),setSearchFilter:m,spanFilterState:g,setSpanFilterState:h,filteredTreeNodes:y,handleNextSearchMatch:S,handlePreviousSearchMatch:T}}},33145:function(e,t,n){n.d(t,{RZ:function(){return a},ed:function(){return r}});var s=n(82716);const r=e=>"feedback"in e&&e.feedback?e.feedback.value:"expectation"in e?e.expectation&&"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value:void 0,a=e=>{switch(e.source_type){case"HUMAN":return s.UserIcon;case"LLM_JUDGE":return s.SparkleIcon;default:return s.CodeIcon}}},33481:function(e,t,n){n.d(t,{_1:function(){return s}});let s=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.TOTAL_TOKEN_COUNT="agent/total_token_count",e.TOTAL_INPUT_TOKEN_COUNT="agent/total_input_token_count",e.TOTAL_OUTPUT_TOKEN_COUNT="agent/total_output_token_count",e.DOCUMENT_RECALL="retrieval/ground_truth/document_recall",e.DOCUMENT_RATINGS="retrieval/ground_truth/document_ratings",e}({})},33669:function(e,t,n){n.d(t,{J:function(){return l}});var s=n(68248),r=n(76118),a=n(27757),o=n(93812),i=n(73408);function l({messages:e}){const{theme:t}=(0,a.u)();return(0,r.isNil)(e)?null:(0,i.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map((e,t)=>(0,i.Y)(o.X,{message:e},t))})}},41151:function(e,t,n){n.d(t,{M:function(){return a}});var s=n(46709);const r=s.createContext({sqlWarehouseId:void 0,modelTraceInfo:void 0,invalidateTraceQuery:void 0,chatSessionId:void 0}),a=()=>s.useContext(r)},42401:function(e,t,n){n.d(t,{s:function(){return b},B:function(){return Y}});var s=n(68248),r=n(76118),a=n(46709),o=n(27757),i=n(42747),l=n(91461),c=n(73408);const d=({title:e,tools:t})=>{const{theme:n}=(0,o.u)();return(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,c.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),bold:!0,children:e}),t.map(e=>(0,c.Y)(l.E,{tool:e},e.function.name))]})};var u=n(54625);const p=({title:e,documents:t})=>{const{theme:n}=(0,o.u)();return(0,c.FD)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundPrimary,borderRadius:n.borders.borderRadiusSm,border:`1px solid ${n.colors.border}`},""),children:[e&&(0,c.Y)("div",{css:(0,s.AH)({padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderBottom:`1px solid ${n.colors.border}`},""),children:(0,c.Y)(o.T.Text,{bold:!0,children:e})}),t.map((e,r)=>(0,c.Y)("div",{css:(0,s.AH)({borderBottom:r!==t.length-1?`1px solid ${n.colors.border}`:""},""),children:(0,c.Y)(u.p,{text:e.page_content,metadata:e.metadata},r)},r))]})};var m=n(82716),g=n(73879);const h=({title:e,value:t})=>{const{theme:n}=(0,o.u)(),[r,l]=(0,a.useState)(!1),d=t.length>400,u=!r&&t.length>400?t.slice(0,400)+"...":t,p=d?{":hover":{backgroundColor:n.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,c.FD)("div",{css:(0,s.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,c.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${n.spacing.sm}px ${n.spacing.sm+n.spacing.xs}px`,...p},""),onClick:()=>l(!r),children:[(0,c.Y)(o.T.Title,{level:4,color:"secondary",withoutMargins:!0,children:e}),d&&(r?(0,c.Y)(m.ChevronDownIcon,{}):(0,c.Y)(o.o,{}))]}),(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.sm+n.spacing.xs,paddingRight:n.spacing.sm+n.spacing.xs,paddingTop:e?0:n.spacing.sm,paddingBottom:n.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,c.Y)(g.V,{children:u}),d&&(0,c.Y)(o.T.Link,{onClick:()=>l(!r),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:r?(0,c.Y)(i.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,c.Y)(i.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})};var f=n(94664),v=n(86125),x=n(49425),y=n(33669);const b=3,Y=({title:e,data:t,renderMode:n,chatMessageFormat:l,maxVisibleMessages:u=b})=>{const{theme:m}=(0,o.u)(),[g,Y]=(0,a.useState)(!1),A=(0,a.useMemo)(()=>{try{return JSON.parse(t)}catch(e){return t}},[t]);(0,a.useEffect)(()=>{Y(!1)},[t]);const S=(0,r.isString)(A)||(0,r.isNumber)(A)||(0,r.isBoolean)(A),T=(0,v.Hq)(e?{[e]:A}:A,l),w=Array.isArray(A)&&A.length>0&&(0,r.every)(A,v.PC),M=Array.isArray(A)&&A.length>0&&(0,r.every)(A,v.W0);if(T&&T.length>0){const t=T.length>u,n=g||!t?T:T.slice(-u),r=t?T.length-n.length:0;return(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.sm,padding:m.spacing.sm,border:`1px solid ${m.colors.border}`,borderRadius:m.borders.borderRadiusSm},""),children:[e&&(0,c.Y)(o.T.Title,{level:4,color:"secondary",withoutMargins:!0,css:(0,s.AH)({marginLeft:m.spacing.xs},""),children:e}),t&&(0,c.Y)(o.T.Link,{css:(0,s.AH)({alignSelf:"flex-start",marginLeft:m.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>Y(!g),children:g?(0,c.Y)(i.sA,{id:"nugZSE",defaultMessage:"Show less"}):(0,c.Y)(i.sA,{id:"/akgwX",defaultMessage:"Show {hiddenMessageCount} more",values:{hiddenMessageCount:r}})}),(0,c.Y)(y.J,{messages:n})]})}return"json"===n?(0,c.Y)(x.C,{title:e,data:t,initialRenderMode:f.cC.JSON}):"text"===n?(0,c.Y)(x.C,{title:e,data:t,initialRenderMode:f.cC.TEXT}):S?(0,c.Y)(h,{title:e,value:String(A)}):w?(0,c.Y)(d,{title:e,tools:A}):M?(0,c.Y)(p,{title:e,documents:A}):(0,c.Y)(x.C,{title:e,data:t})}},45547:function(e,t,n){n.d(t,{w:function(){return b}});var s=n(68248),r=n(76118),a=n(46709),o=n(27757),i=n(82716),l=n(42747),c=n(94664),d=n(86125),u=n(21636),p=n(73408);const m=({searchFilter:e,data:t,activeMatch:n,containsActiveMatch:r})=>{const{theme:i}=(0,o.u)(),l=(0,a.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),c=(0,a.useMemo)(()=>e?(0,d.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:i.colors[u.kj],inactiveMatchBackgroundColor:i.colors[u.Bt],containsActiveMatch:r,activeMatch:n,scrollToActiveMatch:l}):[],[e,t,i,r,n,l]);return(0,p.Y)("pre",{css:(0,s.AH)({whiteSpace:"pre-wrap",backgroundColor:i.colors.backgroundSecondary,padding:i.spacing.sm,fontSize:i.typography.fontSizeSm},""),children:c})};var g=n(73879),h=n(19112);const f=4,v=300;var x={name:"bjn8wh",styles:"position:relative"},y={name:"n31mhe",styles:"width:100%;padding:0"};function b({data:e,searchFilter:t="",activeMatch:n=null,containsActiveMatch:d=!1,renderMode:u=c.cC.JSON,initialExpanded:b=!1}){const Y=Boolean(t)&&!(0,r.isNil)(n)&&e.toLowerCase().includes(t),{theme:A}=(0,o.u)(),[S,T]=(0,a.useState)("json"===u),[w,M]=(0,a.useState)(b||Y),E=(0,a.useRef)(null),I=(0,a.useMemo)(()=>{if("json"===u)return e;const t=JSON.parse(e);return(0,r.isString)(t)?t:e},[e,u]),C=S||I.split("\n").length>f||I.length>v,k=(0,a.useMemo)(()=>{if(C&&!w){const e=I.split("\n").slice(0,f).join("\n");return e.length>v?e.slice(0,v):e}return I},[I,C,w]);(0,a.useEffect)(()=>{E.current&&T(E.current.scrollWidth>E.current.clientWidth)},[u,e]);const D=(0,a.useCallback)(e=>(0,p.Y)("pre",{...e,ref:E}),[]);return Y?(0,p.Y)(m,{data:e,searchFilter:t,activeMatch:n,containsActiveMatch:!n.isKeyMatch&&d}):(0,p.FD)("div",{css:x,children:["markdown"===u?(0,p.Y)("div",{css:(0,s.AH)({padding:A.spacing.md,backgroundColor:A.colors.backgroundSecondary,marginBottom:-A.spacing.md},""),children:(0,p.Y)(g.V,{children:k})}):(0,p.FD)(p.FK,{children:[(0,p.Y)(h.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,s.AH)({position:"absolute",top:A.spacing.xs,right:A.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,p.Y)(h.z7,{PreTag:D,showLineNumbers:!0,language:u,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:w,theme:A.isDarkMode?"duotoneDark":"light",style:{backgroundColor:A.colors.backgroundSecondary,padding:A.spacing.sm,paddingBottom:C?0:A.spacing.sm,paddingRight:2*A.spacing.md,overflow:w?"auto":"hidden",textOverflow:"ellipsis",fontSize:A.typography.fontSizeSm,lineHeight:A.typography.lineHeightBase},children:k})]}),C&&(0,p.Y)("div",{css:(0,s.AH)({backgroundColor:A.colors.backgroundSecondary},""),children:(0,p.Y)(o.B,{css:y,componentId:w?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:w?(0,p.Y)(i.ChevronUpIcon,{}):(0,p.Y)(i.ChevronDownIcon,{}),type:"tertiary",onClick:()=>M(!w),children:w?(0,p.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,p.Y)(l.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}},47784:function(e,t,n){n.d(t,{l:function(){return c}});var s=n(68248),r=n(46709),a=n(27757),o=n(21209),i=n(42401),l=n(73408);const c=({title:e,data:t,renderMode:n,sectionKey:c,maxVisibleItems:d=3,maxVisibleChatMessages:u=i.s,className:p,chatMessageFormat:m})=>{const{theme:g}=(0,a.u)(),[h,f]=(0,r.useState)(!1),v=t.length>d,x=v&&!h?t.slice(-d):t,y=v?t.length-x.length:0;return(0,l.Y)(o.p,{withBorder:!0,title:e,className:p,sectionKey:c,children:(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:g.spacing.sm},""),children:[v&&(0,l.Y)(a.T.Link,{css:(0,s.AH)({alignSelf:"flex-start",marginLeft:g.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>f(!h),children:h?"Show less":`Show ${y} more`}),x.map(({key:e,value:t},s)=>(0,l.Y)(i.B,{title:e,data:t,renderMode:n,chatMessageFormat:m,maxVisibleMessages:u},e||s))]})})}},49425:function(e,t,n){n.d(t,{C:function(){return y}});var s=n(68248),r=n(76118),a=n(46709),o=n(27757),i=n(82716),l=n(94664),c=n(45547),d=n(21636),u=n(73408);const p=({title:e,searchFilter:t,isActiveMatch:n})=>{const{theme:r}=(0,o.u)(),i=(0,a.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),l=e.toLowerCase();if(!l.includes(t))return(0,u.Y)("div",{children:e});const c=l.indexOf(t),p=c+t.length,m=n?r.colors[d.kj]:r.colors[d.Bt];return(0,u.FD)("div",{children:[e.slice(0,c),(0,u.Y)("span",{ref:n?i:null,css:(0,s.AH)({backgroundColor:m,scrollMarginTop:50},""),children:e.slice(c,p)}),e.slice(p)]})};function m(e,t){return t||(e?l.cC.MARKDOWN:l.cC.JSON)}function g(e){switch(e){case l.cC.JSON:return"JSON";case l.cC.TEXT:return"Text";case l.cC.MARKDOWN:return"Markdown";case l.cC.PYTHON:return"Python"}}var h={name:"bjn8wh",styles:"position:relative"},f={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},v={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},x={name:"2fp7nl",styles:"height:min-content;margin:0"};function y({title:e,tokens:t,data:n,searchFilter:d="",activeMatch:y=null,containsActiveMatch:b=!1,initialRenderMode:Y}){var A;const S=(0,a.useMemo)(()=>JSON.parse(n),[n]),T=(0,r.isString)(S),{theme:w}=(0,o.u)(),[M,E]=(0,a.useState)(m(T,Y)),I=b&&null!==(A=null===y||void 0===y?void 0:y.isKeyMatch)&&void 0!==A&&A,C=T&&!d;return(0,a.useEffect)(()=>{E(m(T,Y))},[T,Y]),(0,u.Y)("div",{css:h,children:(0,u.FD)("div",{css:(0,s.AH)({borderRadius:w.borders.borderRadiusSm,border:`1px solid ${w.colors.border}`,overflow:"hidden"},""),children:[(e||C)&&(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:w.spacing.sm},""),children:[(0,u.Y)(o.T.Title,{css:f,level:4,color:"secondary",withoutMargins:!0,children:(0,u.Y)(p,{title:e,searchFilter:d,isActiveMatch:I})}),(0,u.Y)("div",{css:v,children:C&&(0,u.FD)(i.DropdownMenu.Root,{children:[(0,u.Y)(i.DropdownMenu.Trigger,{asChild:!0,children:(0,u.Y)(i.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:x,children:(0,u.FD)("div",{css:(0,s.AH)({paddingLeft:w.spacing.xs,marginRight:w.spacing.xs,cursor:"pointer"},""),children:[(0,u.Y)(o.T.Text,{size:"sm",color:"secondary",children:g(M)}),(0,u.Y)(i.ChevronDownIcon,{})]})})}),(0,u.FD)(i.DropdownMenu.Content,{children:[(0,u.Y)(i.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:M,onValueChange:e=>E(e),children:Object.values(l.cC).map(e=>e===l.cC.PYTHON?null:(0,u.FD)(i.DropdownMenu.RadioItem,{value:e,children:[(0,u.Y)(i.DropdownMenu.ItemIndicator,{}),g(e)]},e))}),(0,u.Y)(i.DropdownMenu.Arrow,{})]})]})})]}),(0,u.Y)(c.w,{data:n,searchFilter:d,activeMatch:y,containsActiveMatch:b,renderMode:M})]})})}},49633:function(e,t,n){n.d(t,{wY:function(){return s.w}});n(46709),n(69103);var s=n(27925);n(53637)},53637:function(e,t,n){n(46709)},54625:function(e,t,n){n.d(t,{p:function(){return y}});var s=n(46709),r=n(68248),a=n(27757),o=n(82716),i=n(42747),l=n(73879),c=n(73880),d=n(73408);var u={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function p({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:p}=(0,a.u)();return(0,d.FD)("div",{css:u,children:[(0,d.Y)("div",{role:"button",onClick:()=>{n(!1),null===s||void 0===s||s("collapse")},css:(0,r.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${p.spacing.sm}px ${p.spacing.md}px`,height:p.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:p.colors.backgroundSecondary}},""),children:(0,d.Y)(o.FileDocumentIcon,{})}),(0,d.Y)("div",{css:(0,r.AH)({padding:p.spacing.md,paddingBottom:0},""),children:(0,d.Y)(l.V,{children:e})}),(0,d.Y)("div",{css:(0,r.AH)({padding:p.spacing.md,paddingTop:0},""),children:t.map(({key:e,value:t})=>(0,d.Y)(c.t,{itemKey:e,itemValue:t},e))}),(0,d.Y)(a.B,{css:(0,r.AH)({width:"100%",padding:p.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,d.Y)(o.ChevronUpIcon,{}),type:"tertiary",onClick:()=>n(!1),children:(0,d.Y)(i.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var m=n(79081);var g={name:"ti75j2",styles:"margin:0"},h={name:"1r5gb7q",styles:"display:inline-block"},f={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function v({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:i}=(0,a.u)();return(0,d.FD)("div",{role:"button",onClick:()=>{n(!0),null===s||void 0===s||s("expand")},css:(0,r.AH)({display:"flex",flexDirection:"row",padding:`${i.spacing.sm}px ${i.spacing.md}px`,gap:i.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:i.colors.backgroundSecondary}},""),children:[(0,d.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,d.Y)(o.FileDocumentIcon,{}),(0,d.Y)(a.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,d.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[t.length>0?(0,d.Y)(c.t,{css:g,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,d.Y)(m.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map(({key:e,value:t})=>(0,d.Y)("span",{css:h,children:`${e}: ${t}`},e)),children:(0,d.FD)(o.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:f,children:["+",t.length-1]})}):null]})]})}var x=n(86125);function y({text:e,metadata:t}){const[n,r]=(0,s.useState)(!1),a=(0,x.g_)(t);return n?(0,d.Y)(p,{text:e,metadataTags:a,setExpanded:r}):(0,d.Y)(v,{text:e,metadataTags:a,setExpanded:r})}},57248:function(e,t,n){n.d(t,{a:function(){return a}});var s=n(46709);n(76118);const r=(0,s.createContext)({schemas:[]}),a=()=>(0,s.useContext)(r)},64667:function(e,t,n){let s=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TAG="TAG",e.INFO="INFO",e}({});s.ASSESSMENT,s.EXPECTATION,s.TAG,s.INFO},68058:function(e,t,n){n.d(t,{x:function(){return l}});var s=n(82716),r=n(27757),a=n(42747),o=n(77691),i=n(73408);const l=()=>{const{addToDatasetAction:e}=(0,o.SO)();return e?(0,i.Y)(r.B,{componentId:"mlflow.evaluations_review.modal.add_to_evaluation_dataset",onClick:e.openModal,icon:(0,i.Y)(s.PlusIcon,{}),size:"small",children:(0,i.Y)(a.sA,{id:"NekUba",defaultMessage:"Add to dataset"})}):null}},68364:function(e,t,n){n.d(t,{Y:function(){return Y}});var s=n(68248),r=n(76118),a=n(46709),o=n(82716),i=n(27757),l=n(79081),c=n(42747),d=n(5075),u=n(96586),p=n(33145),m=n(73408);var g={name:"11qaxcx",styles:"display:inline-flex;max-width:100%"},h={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const f=({metadata:e})=>{const{theme:t}=(0,i.u)(),n=(0,c.tz)(),r=null===e||void 0===e?void 0:e.span_name;if(!e||!r)return null;const a=n.formatMessage({id:"S3YY1P",defaultMessage:"Span: {spanName}"},{spanName:r});return(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexWrap:"wrap",gap:t.spacing.xs},""),children:(0,m.Y)(l.T,{componentId:"shared.model-trace-explorer.span-name-tooltip",content:a,children:(0,m.Y)(o.Tag,{css:g,componentId:"shared.model-trace-explorer.span-name-tag",color:"default",children:(0,m.Y)("span",{css:h,children:a})})})})};var v={name:"ozd7xs",styles:"flex-shrink:0"},x={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},y={name:"s5xdrg",styles:"display:flex;align-items:center"};const b=({assessment:e})=>{const{theme:t}=(0,i.u)(),n=(0,p.ed)(e),a=e.rationale,l=!(0,r.isNil)(e.feedback.error),c=!l&&(0,r.isNil)(n);return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.md,gap:t.spacing.sm},""),children:[(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:t.spacing.sm},""),children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,flex:1,minWidth:0},""),children:[(0,m.Y)(o.GavelIcon,{css:v}),(0,m.Y)(i.T.Text,{bold:!0,css:x,children:e.assessment_name})]})}),l&&(0,m.Y)(u.B,{error:e.feedback.error}),c&&(0,m.Y)(u.B,{error:{error_code:"NO_RESULT",error_message:"The scorer did not return a result for this trace."}}),!l&&!c&&(0,m.Y)("div",{css:y,children:(0,m.Y)(d.Q,{jsonValue:JSON.stringify(n),assessmentName:e.assessment_name})}),(0,m.Y)(f,{metadata:e.metadata}),a&&(0,m.Y)(i.T.Text,{css:(0,s.AH)({color:t.colors.textSecondary,lineHeight:t.typography.lineHeightBase},""),children:a})]})},Y=({assessments:e,className:t})=>{const{theme:n}=(0,i.u)(),r=(0,a.useMemo)(()=>e.filter(e=>"feedback"in e&&!1!==e.valid),[e]);return 0===r.length?(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",padding:n.spacing.md,minWidth:300,height:"100%",borderLeft:`1px solid ${n.colors.border}`},""),className:t,children:(0,m.Y)(i.T.Text,{color:"secondary",children:(0,m.Y)(c.sA,{id:"PKwacx",defaultMessage:"No assessments available"})})}):(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",padding:n.spacing.md,paddingTop:n.spacing.sm,gap:n.spacing.md,minWidth:300,height:"100%",borderLeft:`1px solid ${n.colors.border}`,overflowY:"auto"},""),className:t,children:r.map(e=>(0,m.Y)(b,{assessment:e},e.assessment_id))})}},71540:function(e,t,n){n.d(t,{zl:function(){return s}});n(76118),n(16844),n(12129),n(90448),n(33481),n(4947);const s=(e,t)=>{var n,s;if(!e)return;if(!Array.isArray(e))return e[t];const r=e.find(e=>e.key===t);return null!==r&&void 0!==r&&r.value?null!==(n=null!==(s=r.value.string_value)&&void 0!==s?s:r.value.int_value)&&void 0!==n?n:r.value.bool_value:void 0}},72125:function(e,t,n){n.d(t,{aW:function(){return V},gr:function(){return z}});var s=n(68248),r=n(76118),a=n(46709),o=n(27757),i=n(82716),l=n(42747),c=n(49425),d=n(73408);function u({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:a}=(0,o.u)(),{attributes:u}=e,p=(0,r.keys)(u).length>0,m=!(0,r.isNil)(n)&&n.span.key===e.key;return!p||(0,r.isNil)(u)?(0,d.Y)("div",{css:(0,s.AH)({marginTop:a.spacing.md},""),children:(0,d.Y)(i.Empty,{description:(0,d.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,padding:a.spacing.md},""),children:Object.entries(u).map(([e,s])=>(0,d.Y)(c.C,{title:e,data:JSON.stringify(s,null,2),searchFilter:t,activeMatch:n,containsActiveMatch:m&&"attributes"===n.section&&n.key===e},e))})}var p=n(91461),m=n(33669),g=n(21209);function h({chatMessages:e,chatTools:t}){const{theme:n}=(0,o.u)();return(0,d.FD)("div",{css:(0,s.AH)({overflowY:"auto",padding:n.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,d.Y)(g.p,{css:(0,s.AH)({marginBottom:n.spacing.sm},""),title:(0,d.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:t.map(e=>(0,d.Y)(p.E,{tool:e},e.function.name))})}),(0,d.Y)(g.p,{title:(0,d.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,d.Y)(m.J,{messages:e})})]})}var f=n(86125);var v={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},x={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function y({activeSpan:e,className:t,searchFilter:n,activeMatch:i}){const{theme:u}=(0,o.u)(),p=(0,a.useMemo)(()=>(0,f.g_)(null===e||void 0===e?void 0:e.inputs),[e]),m=(0,a.useMemo)(()=>(0,f.g_)(null===e||void 0===e?void 0:e.outputs),[e]);if((0,r.isNil)(e))return null;const h=p.length>0,y=m.length>0,b=!(0,r.isNil)(i)&&i.span.key===e.key;return(0,d.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[h&&(0,d.Y)(g.p,{withBorder:!0,css:(0,s.AH)({marginBottom:u.spacing.sm},""),sectionKey:"input",title:(0,d.Y)("div",{css:v,children:(0,d.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:p.map(({key:e,value:t},s)=>(0,d.Y)(c.C,{title:e,data:t,searchFilter:n,activeMatch:i,containsActiveMatch:b&&"inputs"===i.section&&i.key===e},e||s))})}),y&&(0,d.Y)(g.p,{withBorder:!0,sectionKey:"output",title:(0,d.Y)("div",{css:x,children:(0,d.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:m.map(({key:e,value:t})=>(0,d.Y)(c.C,{title:e,data:t,searchFilter:n,activeMatch:i,containsActiveMatch:b&&"outputs"===i.section&&i.key===e},e))})})]})}var b=n(54625),Y=n(79081);var A={name:"s5xdrg",styles:"display:flex;align-items:center"},S={name:"s5xdrg",styles:"display:flex;align-items:center"};function T({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:n}=(0,o.u)();return(0,d.FD)(i.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_modeltraceexplorerrendermodetoggle_25",value:e,onChange:e=>{t(e.target.value)},children:[(0,d.Y)(i.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,d.Y)(Y.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,d.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,d.Y)("div",{css:A,children:(0,d.Y)(i.TextBoxIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})}),(0,d.Y)(i.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,d.Y)(Y.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,d.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,d.Y)("div",{css:S,children:(0,d.Y)(i.MarkdownIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})})]})}var w={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function M({activeSpan:e,className:t,searchFilter:n,activeMatch:u}){const{theme:p}=(0,o.u)(),[m,h]=(0,a.useState)(!0),v=(0,a.useMemo)(()=>(0,f.g_)(e.inputs),[e]),x=e.outputs,y=v.length>0,Y=!(0,r.isNil)(u)&&u.span.key===e.key,A=Y&&"outputs"===u.section;return(0,d.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[y&&(0,d.Y)(g.p,{sectionKey:"input",css:(0,s.AH)({marginBottom:p.spacing.sm},""),title:(0,d.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.sm},""),children:v.map(({key:e,value:t},s)=>(0,d.Y)(c.C,{title:e,data:t,searchFilter:n,activeMatch:u,containsActiveMatch:Y&&"inputs"===u.section&&u.key===e},e||s))})}),(0,d.Y)(g.p,{sectionKey:"output",title:(0,d.FD)("div",{css:w,children:[(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:p.spacing.sm},""),children:[(0,d.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,d.Y)(i.Tag,{componentId:"shared.model-trace-explorer.document-count",children:x.length})]}),!A&&(0,d.Y)(T,{shouldRenderMarkdown:m,setShouldRenderMarkdown:h})]}),children:m&&!A?(0,d.Y)("div",{css:(0,s.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.legacyBorders.borderRadiusMd},""),children:x.map((e,t)=>(0,d.Y)("div",{css:(0,s.AH)({borderBottom:t!==x.length-1?`1px solid ${p.colors.border}`:""},""),children:(0,d.Y)(b.p,{text:e.page_content,metadata:e.metadata},t)},t))}):(0,d.Y)("div",{css:(0,s.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.legacyBorders.borderRadiusMd,padding:p.spacing.md},""),children:(0,d.Y)(c.C,{title:"",data:JSON.stringify(x,null,2),searchFilter:n,activeMatch:u,containsActiveMatch:Y&&"outputs"===u.section})})})]})}function E({activeSpan:e,className:t,searchFilter:n,activeMatch:a}){const{theme:i}=(0,o.u)();return!(0,r.isNil)(e)&&(0,f.vl)(e)?(0,d.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:i.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,d.Y)(M,{activeSpan:e,className:t,searchFilter:n,activeMatch:a})}):(0,d.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:i.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,d.Y)(y,{activeSpan:e,className:t,searchFilter:n,activeMatch:a})})}var I=n(94664);function C({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:a}=(0,o.u)(),{events:u}=e,p=!(0,r.isNil)(n)&&n.span.key===e.key;return Array.isArray(u)&&0!==u.length?(0,d.Y)("div",{css:(0,s.AH)({padding:a.spacing.md},""),children:u.map((e,r)=>{const l=e.attributes,u="exception"===e.name?(0,d.FD)(d.FK,{children:[(0,d.Y)(i.XCircleIcon,{css:(0,s.AH)({marginRight:a.spacing.sm},""),color:"danger"}),(0,d.Y)(o.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,d.Y)(g.p,{sectionKey:e.name,title:u,withBorder:!0,children:(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:Object.keys(l).map(s=>{const a=(0,f.Q0)(e.name,r,s);return(0,d.Y)(c.C,{title:s,data:JSON.stringify(l[s],null,2),searchFilter:t,activeMatch:n,containsActiveMatch:p&&"events"===n.section&&n.key===a,initialRenderMode:I.cC.TEXT},a)})})},`${e.name}-${r}`):null})}):(0,d.Y)("div",{css:(0,s.AH)({marginTop:a.spacing.md},""),children:(0,d.Y)(i.Empty,{description:(0,d.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}var k=n(68364),D=n(85418),N=n(76127),R=n(26059),_=n(53915),L=n(68058),F=n(85060),H=n(24411),O=n(84612);const z=250+O.uZ;var U={name:"1y44vlr",styles:"height:auto;border-left:0"};function B({activeSpan:e,searchFilter:t,activeMatch:n,activeTab:c,setActiveTab:p,onPaneResize:m}){const{theme:g}=(0,o.u)(),{assessmentsPaneExpanded:v,assessmentsPaneEnabled:x,isInComparisonView:y,updatePaneSizeRatios:b,getPaneSizeRatios:Y,readOnly:A}=(0,_.nJ)(),[S,T]=(0,a.useState)(500),w={flex:1,marginTop:-g.spacing.md,overflowY:"auto"},M=(0,a.useMemo)(()=>(0,f.bN)(null===e||void 0===e?void 0:e.assessments),[null===e||void 0===e?void 0:e.assessments]),I=(0,a.useCallback)(e=>{b({detailsSidebar:e})},[b]);if((0,r.isNil)(e))return(0,d.Y)(i.Empty,{description:"Please select a span to view more information"});const z=(0,f.N7)(e),B=z>0,V=!(0,r.isNil)(null===e||void 0===e?void 0:e.inputs)||!(0,r.isNil)(null===e||void 0===e?void 0:e.outputs),j=(0,d.FD)(i.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${g.colors.border}`,minWidth:200,position:"relative"},""),value:c,onValueChange:e=>p(e),children:[(0,d.Y)(D.Q,{activeSpan:e}),!A&&(0,d.FD)("div",{css:(0,s.AH)({position:"absolute",right:v?g.spacing.xs:g.spacing.md,top:g.spacing.xs,zIndex:1,backgroundColor:g.colors.backgroundPrimary,display:"flex",gap:g.spacing.sm,alignItems:"center"},""),children:[(0,d.Y)(L.x,{}),(0,d.Y)(F.N,{})]}),(0,d.FD)(i.Tabs.List,{css:(0,s.AH)({padding:0,paddingLeft:g.spacing.md,paddingRight:g.spacing.sm,boxSizing:"border-box",width:"100%"},""),dangerouslyAppendEmotionCSS:{"&>div":{flex:1}},children:[e.chatMessages&&(0,d.Y)(i.Tabs.Trigger,{value:"chat",children:(0,d.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),V&&(0,d.Y)(i.Tabs.Trigger,{value:"content",children:(0,d.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,d.Y)(i.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,d.FD)(i.Tabs.Trigger,{value:"events",children:["Events ",B&&(0,d.Y)(N.X,{count:z})]}),A&&(0,d.Y)(i.Tabs.Trigger,{value:"assessments",children:(0,d.Y)(l.sA,{id:"KdsrPi",defaultMessage:"Assessments"})})]}),e.chatMessages&&(0,d.Y)(i.Tabs.Content,{css:w,value:"chat",children:(0,d.Y)(h,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,d.Y)(i.Tabs.Content,{css:w,value:"content",children:(0,d.Y)(E,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,d.Y)(i.Tabs.Content,{css:w,value:"attributes",children:(0,d.Y)(u,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,d.Y)(i.Tabs.Content,{css:w,value:"events",children:(0,d.Y)(C,{activeSpan:e,searchFilter:t,activeMatch:n})}),A&&(0,d.Y)(i.Tabs.Content,{css:w,value:"assessments",children:(0,d.Y)(k.Y,{assessments:(0,f.bN)(e.assessments),css:U})})]}),$=(0,d.Y)(H.i,{assessments:M,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0,enableRunScorer:!e.parentId});return!y&&x&&v?(0,d.Y)(R.A,{initialRatio:Y().detailsSidebar,paneWidth:S,setPaneWidth:T,leftChild:j,leftMinWidth:250,rightChild:$,rightMinWidth:O.uZ+2*g.spacing.sm,onRatioChange:I}):j}const V=a.memo(B)},73879:function(e,t,n){n.d(t,{V:function(){return Y}});var s=n(46709),r=n(87562),a=n(22534),o=n(27757),i=n(82716),l=n(19112),c=n(68248),d=n(20027),u=n(73408);var p={name:"1qmr6ab",styles:"overflow:auto"},m={name:"uufhp1",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%;z-index:0"};const g=({children:e})=>(0,u.Y)("div",{"data-testid":"basic-table",css:p,children:(0,u.Y)(i.Table,{scrollable:!0,css:m,children:e})}),h=({children:e,node:t})=>{const{header:n,rows:r,isValid:a}=function({children:e}){var t;if(!e)return{header:void 0,rows:[],isValid:!1};const n=s.Children.toArray(e);return{header:null!==(t=n[0])&&void 0!==t?t:void 0,rows:n.slice(1).flatMap(e=>s.isValidElement(e)?s.Children.toArray(e.props.children).filter(e=>s.isValidElement(e)):[]),isValid:!0}}({children:e,node:t});return a?(0,u.Y)(v,{header:n,rows:r}):(0,u.Y)(g,{children:e,node:t})};var f={name:"qneu98",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%"};const v=({header:e,rows:t})=>{const{theme:n}=(0,o.u)(),r=s.useRef(null),a=(0,d.z)({size:t.length,parentRef:r,overscan:20}),{virtualItems:l,totalSize:p}=a;return(0,u.Y)("div",{"data-testid":"virtualized-table",ref:r,css:(0,c.AH)({overflow:"auto",maxHeight:420,border:"1px solid",borderColor:n.colors.border,borderRadius:n.borders.borderRadiusMd,marginBottom:n.spacing.md,zIndex:0},""),children:(0,u.FD)(i.Table,{css:f,children:[e,(0,u.Y)("div",{css:(0,c.AH)({position:"relative",height:`${p}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},""),children:l.map(e=>{const n=e.index,s=t[n];return(0,u.Y)("div",{ref:e.measureRef,css:(0,c.AH)({position:"absolute",top:`${e.start}px`,width:"100%"},""),children:s},n)})})]})})},x=({children:e,node:t})=>{const n=null===t||void 0===t?void 0:t.children.some(e=>"th"===e.tagName),{theme:s}=(0,o.u)();return(0,u.Y)(i.TableRow,{style:n?{position:"sticky",top:0,zIndex:1,backgroundColor:s.colors.backgroundPrimary}:void 0,children:e,isHeader:n})},y=({children:e,node:t})=>{const n="th"===(null===t||void 0===t?void 0:t.tagName),{theme:s}=(0,o.u)();return n?(0,u.Y)(i.TableHeader,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:(0,c.AH)({paddingLeft:s.spacing.sm,borderColor:s.colors.border,color:s.colors.textPrimary},""),children:e}):(0,u.Y)(i.TableCell,{children:e})};const b=e=>e.startsWith("data:image/png")||e.startsWith("data:image/jpeg")?e:(0,r.Lv)(e),Y=e=>{const t=(0,s.useMemo)(()=>I({extensions:e.components}),[e.components]);return(0,u.Y)(r.oz,{components:t,remarkPlugins:M,urlTransform:b,children:e.children})},A=({codeBlock:e,codeInline:t,node:n,...r})=>{var a,o;const i=s.useMemo(()=>{var e;const t=/language-(\w+)/.exec(null!==(e=r.className)&&void 0!==e?e:"");return t&&t[1]?t[1]:void 0},[r.className]);return(null===n||void 0===n||null===(a=n.position)||void 0===a?void 0:a.start.line)===(null===n||void 0===n||null===(o=n.position)||void 0===o?void 0:o.end.line)?s.createElement(t,r):s.createElement(e,{...r,language:i})},S=({children:e})=>(0,u.Y)(o.T.Text,{code:!0,children:e});var T={name:"bjn8wh",styles:"position:relative"};const w=s.memo(({children:e,language:t})=>{const{theme:n}=(0,o.u)(),s=String(e).replace(/\n$/,"");return(0,u.Y)("div",{css:T,children:(0,u.Y)(l.z7,{actions:(0,u.Y)(l.VE,{componentId:"genai.util.markdown-copy-code-block",copyText:s}),theme:n.isDarkMode?"duotoneDark":"light",children:s,language:t&&C(t)?t:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})}),M=[a.A];var E={name:"qhxz92",styles:"max-width:100%"};const I=e=>({a:({href:e,children:t})=>(0,u.Y)(o.T.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:e,id:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?e.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:null===e||void 0===e?void 0:e.startsWith("."),children:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?(0,u.FD)(u.FK,{children:["[",t,"]"]}):t,openInNewTab:!(e&&e.startsWith("#"))}),code:t=>{var n,s,r,a;return(0,u.Y)(A,{...t,codeBlock:null!==(n=null===(s=e.extensions)||void 0===s?void 0:s.codeBlock)&&void 0!==n?n:w,codeInline:null!==(r=null===(a=e.extensions)||void 0===a?void 0:a.codeInline)&&void 0!==r?r:S})},p:({children:e})=>(0,u.Y)(o.T.Paragraph,{children:e}),h1:({children:e})=>(0,u.Y)(o.T.Title,{level:1,children:e}),h2:({children:e})=>(0,u.Y)(o.T.Title,{level:2,children:e}),h3:({children:e})=>(0,u.Y)(o.T.Title,{level:3,children:e}),h4:({children:e})=>(0,u.Y)(o.T.Title,{level:4,children:e}),h5:({children:e})=>(0,u.Y)(o.T.Title,{level:5,children:e}),table:({children:e,node:t})=>(0,u.Y)(h,{children:e,node:t}),tr:({children:e,node:t})=>(0,u.Y)(x,{children:e,node:t}),th:({children:e,node:t})=>(0,u.Y)(y,{children:e,node:t}),td:({children:e})=>(0,u.Y)(i.TableCell,{children:e,multiline:!0}),thead:({children:e})=>(0,u.Y)(u.FK,{children:e}),tbody:({children:e})=>(0,u.Y)(u.FK,{children:e}),img:({src:e,alt:t})=>{return(n=e)&&!/^[a-z][a-z0-9+.-]*:/i.test(n)?(0,u.Y)("span",{children:`[${t}](${e})`}):(0,u.Y)("img",{src:e,alt:t,css:E});var n}}),C=e=>{switch(e){case"go":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}}},77691:function(e,t,n){n.d(t,{SO:function(){return o}});var s=n(46709),r=n(82716);const a=(0,s.createContext)({renderExportTracesToDatasetsModal:()=>null,DrawerComponent:r.Drawer,addToDatasetAction:void 0}),o=()=>(0,s.useContext)(a)},81390:function(e,t,n){n.d(t,{B$:function(){return g},De:function(){return l},EA:function(){return v},NP:function(){return x},QJ:function(){return c},VC:function(){return p},VD:function(){return f},X6:function(){return h},dM:function(){return m},fJ:function(){return y},os:function(){return u},u4:function(){return d},vf:function(){return i}});var s=n(76118),r=n(46709),a=n(94664),o=n(86125);const i=1/0,l=16,c=32,d={HIGH:5,NORMAL:3,LOW:1},u=(e,t)=>{const n=[],s=e=>{var r;e&&(n.push(e),t.has(e.key)&&(null===(r=e.children)||void 0===r||r.forEach(s)))};return e.forEach(s),n},p=e=>{const t=[],n=e=>{var s;e&&(t.push(e),null===(s=e.children)||void 0===s||s.forEach(n))};return e.forEach(n),t},m=(e,t=1/0)=>{const n={},s=(e,r)=>{var a;!e||r>t||(n[e.key]=e,null===(a=e.children)||void 0===a||a.forEach(e=>s(e,r+1)))};return e.forEach(s,0),n},g=(e={})=>{const[t,n]=(0,r.useState)(()=>{if(e.rootNodes){const t=(0,s.values)(m(e.rootNodes,e.initialExpandDepth)).map(e=>e.key);return new Set(t)}return new Set});return{expandedKeys:t,setExpandedKeys:n}},h=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},f=(e,t)=>{var n;return e.key===t?0:(null!==(n=e.children)&&void 0!==n?n:[]).findIndex(e=>f(e,t)>-1)},v=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const n=e.children.map(v);return Math.max(...n)+1},x=(e,t)=>{const n=new Set;let s=e;for(;s&&s.parentId;)n.add(s.parentId),s=t[s.parentId];return n},y=e=>{var t;return!!e.parentId&&([a.UG.AGENT,a.UG.RETRIEVER,a.UG.CHAT_MODEL,a.UG.TOOL,a.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:a.UG.UNKNOWN)||(0,o.N7)(e)>0)}},83219:function(e,t,n){n.d(t,{c:function(){return g}});var s=n(68248),r=n(82716),a=n(27757),o=n(86125),i=n(21209),l=n(42401),c=n(73408);const d=new Set(["exception.type","exception.message","exception.stacktrace"]),u=e=>{var t;const n=null!==(t=null===e||void 0===e?void 0:e.attributes)&&void 0!==t?t:{},s=n["exception.stacktrace"],r=Object.entries(n).filter(([e])=>!d.has(e)).map(([e,t])=>({key:e,value:t}));return s?[{key:"exception.stacktrace",value:s,renderMode:"text"},...r]:r};var p={name:"ozd7xs",styles:"flex-shrink:0"},m={name:"17a6bm5",styles:"min-width:0;flex:1"};const g=({node:e})=>{const{theme:t}=(0,a.u)(),n=(0,o.bn)(e),d=!e.parentId,g=n[0];if(!g||!(0,o.gq)(g))return null;const h=g.attributes["exception.type"],f=g.attributes["exception.message"];return(0,c.Y)(i.p,{withBorder:!0,isExceptionSection:!0,sectionKey:g.name,css:(0,s.AH)({marginBottom:d?t.spacing.sm:0},""),title:(0,c.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,minWidth:0,flex:1},""),children:[(0,c.Y)(r.XCircleIcon,{color:"danger",css:p}),(0,c.Y)("div",{css:m,children:(0,c.FD)(a.T.Text,{color:"error",bold:!0,css:(0,s.AH)({display:"block",width:`calc(100% - ${t.spacing.lg}px)`},""),children:[h,": ",f]})})]}),children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingBottom:t.spacing.sm,paddingLeft:d?0:t.spacing.lg},""),children:u(g).map(({key:e,value:t,renderMode:n})=>(0,c.Y)(l.B,{title:e,data:JSON.stringify(t,null,2),renderMode:null!==n&&void 0!==n?n:"text"},e))})},g.name)}},84612:function(e,t,n){n.d(t,{KN:function(){return c},Pt:function(){return i},jf:function(){return l},se:function(){return o},uZ:function(){return a}});var s=n(42747),r=n(73408);const a=250,o=e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")},i=(e,t=new Date)=>{const n=Math.max(0,Math.floor((t.getTime()-e)/1e3));let a=Math.floor(n/31536e3);return a>=1?(0,r.Y)(s.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:a}}):(a=Math.floor(n/2592e3),a>=1?(0,r.Y)(s.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:a}}):(a=Math.floor(n/86400),a>=1?(0,r.Y)(s.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:a}}):(a=Math.floor(n/3600),a>=1?(0,r.Y)(s.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:a}}):(a=Math.floor(n/60),a>=1?(0,r.Y)(s.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:a}}):(0,r.Y)(s.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))},l=e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}},c=({formValue:e,dataType:t,isFeedback:n})=>n?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}}},85060:function(e,t,n){n.d(t,{N:function(){return l}});var s=n(82716),r=n(27757),a=n(42747),o=n(53915),i=n(73408);const l=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:n,isInComparisonView:l}=(0,o.nJ)();return l?null:(0,i.Y)(r.B,{disabled:!n,type:"primary",componentId:"shared.model-trace-explorer.assessments-pane-toggle",size:"small",icon:e?(0,i.Y)(s.SidebarExpandIcon,{}):(0,i.Y)(s.SidebarCollapseIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),children:e?(0,i.Y)(a.sA,{id:"QK9qFL",defaultMessage:"Hide assessments"}):(0,i.Y)(a.sA,{id:"mltH0e",defaultMessage:"Show assessments"})})}},86119:function(e,t,n){n.d(t,{b:function(){return h}});var s=n(68248),r=n(46709),a=n(27757),o=n(82716),i=n(79081),l=n(42747),c=n(110);var d=n(97447),u=n(21636),p=n(73408);var m={name:"mqlsmr",styles:"font-size:12px;display:flex"},g={name:"rnnx2x",styles:"font-size:12px"};const h=({experimentId:e,sessionId:t,traceId:n,handleCopy:h,hideLabel:f=!1})=>{const{theme:v}=(0,a.u)(),x=(0,c.zy)(),y=t.length>10?`${t.slice(0,10)}...`:t,b=(0,r.useCallback)(e=>e.length>10?`${e.slice(0,10)}...`:e,[]),Y=((e,t)=>(0,c.Oz)(`/experiments/${e}/chat-sessions/${t}`))(e,t),A=n?`${Y}?${new URLSearchParams({[u.hb]:n}).toString()}`:Y;return x.pathname.includes(`/chat-sessions/${t}`)?(0,p.Y)(d.f,{label:(0,p.Y)(l.sA,{id:"XIWwOm",defaultMessage:"Session ID"}),icon:(0,p.Y)(o.SpeechBubbleIcon,{css:m}),value:t,color:"default",getTruncatedLabel:b,onCopy:h,hideLabel:f}):(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:f?"flex-start":"center",flexDirection:"row",gap:v.spacing.sm},""),children:[!f&&(0,p.Y)(a.T.Text,{size:"md",color:"secondary",children:(0,p.Y)(l.sA,{id:"XIWwOm",defaultMessage:"Session ID"})}),(0,p.Y)(i.T,{componentId:"mlflow.model-trace-explorer.session-id-tag",content:(0,p.Y)(l.sA,{id:"OUPWd8",defaultMessage:"View chat session"}),children:(0,p.Y)(c.N_,{to:A,children:(0,p.Y)(o.Tag,{componentId:"mlflow.model_trace_explorer.header_details.tag-session-id",children:(0,p.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:v.spacing.xs},""),children:[(0,p.Y)(o.SpeechBubbleIcon,{css:g}),(0,p.Y)("span",{children:y})]})})})})]})}},86125:function(e,t,n){n.d(t,{BS:function(){return h},CL:function(){return Q},Dv:function(){return ue},Hq:function(){return X},I$:function(){return G},LS:function(){return x},M2:function(){return oe},MF:function(){return N},N7:function(){return j},OS:function(){return O},PC:function(){return K},Q0:function(){return B},W0:function(){return z},ZI:function(){return ee},bN:function(){return pe},bn:function(){return V},f7:function(){return A},gD:function(){return w},g_:function(){return H},gq:function(){return me},h8:function(){return P},iZ:function(){return le},ij:function(){return f},in:function(){return q},ko:function(){return re},m4:function(){return de},nr:function(){return ae},ob:function(){return R},pQ:function(){return te},tC:function(){return v},uM:function(){return _},vL:function(){return Y},vX:function(){return ie},vl:function(){return U},x0:function(){return J},yt:function(){return se}});var s=n(68248),r=n(76118),a=n(46709),o=n(94664),i=n(51847),l=n(90828),c=n(46026),d=n(69660),u=n(21636),p=n(81390),m=n(71540),g=n(73408);const h="model-trace-info-v3",f=e=>{};function v(e){switch(e){case o.UG.LLM:return o.Dy.MODELS;case o.UG.CHAIN:return o.Dy.CHAIN;case o.UG.AGENT:return o.Dy.AGENT;case o.UG.TOOL:return o.Dy.WRENCH;case o.UG.CHAT_MODEL:return o.Dy.MODELS;case o.UG.RETRIEVER:return o.Dy.SEARCH;case o.UG.PARSER:return o.Dy.CODE;case o.UG.EMBEDDING:return o.Dy.NUMBERS;case o.UG.RERANKER:return o.Dy.SORT;case o.UG.MEMORY:return o.Dy.SAVE;case o.UG.FUNCTION:return o.Dy.FUNCTION;case o.UG.UNKNOWN:return o.Dy.UNKNOWN;default:return o.Dy.FUNCTION}}function x(e){switch(e){case o.UG.LLM:return"LLM";case o.UG.CHAIN:return"Chain";case o.UG.AGENT:return"Agent";case o.UG.TOOL:return"Tool";case o.UG.CHAT_MODEL:return"Chat model";case o.UG.RETRIEVER:return"Retriever";case o.UG.PARSER:return"Parser";case o.UG.EMBEDDING:return"Embedding";case o.UG.RERANKER:return"Reranker";case o.UG.MEMORY:return"Memory";case o.UG.FUNCTION:return"Function";case o.UG.UNKNOWN:return"Unknown";default:return e}}function y(e){try{return JSON.parse(e)}catch(t){return e}}const b=(e,t)=>{if(!t)return[];const n=[],s={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,r.map)(s,(s,r)=>{if("events"===r)return void n.push(...((e,t)=>{const n=e.events;if(!n)return[];const s=[];return n.forEach((n,r)=>{const a=n.attributes;a&&Object.keys(a).forEach(o=>{const i=o.toLowerCase().includes(t),l=B(n.name,r,o);i&&s.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const c=JSON.stringify(a[o]).toLowerCase().split(t).length-1;for(let t=0;t<c;t++)s.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})})}),s})(e,t));H(s).forEach(s=>{s.key.toLowerCase().includes(t)&&n.push({span:e,section:r,key:s.key,isKeyMatch:!0,matchIndex:0});const a=s.value.toLowerCase().split(t).length-1;for(let t=0;t<a;t++)n.push({span:e,section:r,key:s.key,isKeyMatch:!1,matchIndex:t})})}),n};function Y(e,t,n){var s,r;const a=t.toLowerCase().trim(),o=Object.values(n.spanTypeDisplayState).every(e=>e);if(""===a&&o)return{filteredTreeNodes:[e],matches:[]};const i=null!==(s=e.children)&&void 0!==s?s:[],l=[],c=[];i.forEach(e=>{const{filteredTreeNodes:t,matches:s}=Y(e,a,n);l.push(...t),c.push(...s)});const d=(null!==(r=e.title)&&void 0!==r?r:"").toLowerCase(),u=b(e,a),p=u.length>0||d.includes(a),m=!e.type||n.spanTypeDisplayState[e.type],g=p&&m,h=l.length>0,f=j(e)>0;return g||n.showParents&&h||n.showExceptions&&f?{filteredTreeNodes:[{...e,children:l}],matches:u.concat(c)}:{filteredTreeNodes:l,matches:c}}function A(e,t){var n;if((0,r.isNil)(t)||(0,r.isNil)(e))return;if(e.key===t)return e;const s=null!==(n=e.children)&&void 0!==n?n:[];for(const r of s){const e=A(r,t);if(e)return e}}const S=(e,t,n,s,a,o)=>{var l,d;const p=y((0,m.zl)(e.attributes,"mlflow.spanType")),h=y((0,m.zl)(e.attributes,"mlflow.spanInputs")),f=y((0,m.zl)(e.attributes,"mlflow.spanOutputs")),x=C(e),b=I(e),Y=null!==(l=a[b])&&void 0!==l?l:[];var A;x||Y.push(...null!==(A=a[""])&&void 0!==A?A:[]);const S=y((0,m.zl)(e.attributes,"mlflow.chat.messages")),T=y((0,m.zl)(e.attributes,"mlflow.message.format")),w=((e,t,n,s,a)=>{var o,i;if(Array.isArray(e)&&e.every(G))return(0,r.compact)(e.map(ee));const l=null!==(o=X(t,s))&&void 0!==o?o:[],d=null!==(i=X(n,s))&&void 0!==i?i:[];if("pydantic_ai"===s&&d.length>0)return l.length>0?l.concat(d):d;if("voltagent"===s&&a&&a.length>0){const e=(0,c.Nw)(t,n,a);if(e&&e.length>0)return e}return 0!==l.length&&0!==d.length?l.concat(d):void 0})(S,h,f,T,s),M=((e,t)=>{var n;return Array.isArray(e)&&e.every(K)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(n=t.tools)&&void 0!==n&&n.every(K)?t.tools:void 0})(y((0,m.zl)(e.attributes,"mlflow.chat.tools")),h),E=y((0,m.zl)(e.attributes,u.IR)),N=(e=>{if(e&&"object"===typeof e&&"input_cost"in e&&"output_cost"in e&&"total_cost"in e)return e})(y((0,m.zl)(e.attributes,u.Ye))),R=(0,r.mapValues)((0,r.omitBy)(e.attributes,(e,t)=>t.startsWith("mlflow.")),e=>y(e)),_=e.events,L=(Number(k(e))-t)/1e3,F=(Number(null!==(d=D(e))&&void 0!==d?d:n)-t)/1e3;return{title:e.name,icon:(0,g.Y)(i.P,{type:v(p),hasException:j(e)>0,isRootSpan:!x}),type:p,key:b,start:L,end:F,children:s.slice().sort((e,t)=>e.start-t.start),inputs:h,outputs:f,attributes:R,events:_,chatMessageFormat:T,chatMessages:w,chatTools:M,parentId:x,assessments:Y,traceId:o,modelName:E,cost:N}},T=(e,t)=>{if(!e)return"";if(t&&e.length<16)try{return(e=>{const t=atob(e),n=t.length;let s="";for(let r=0;r<n;r++)s+=t.charCodeAt(r).toString(16).padStart(2,"0");return s})(e)}catch(n){return e}return e.startsWith("0x")?e.slice(2):e};function w(e){return!!e&&"trace_location"in e}function M(e){return"start_time_unix_nano"in e&&Array.isArray(e.attributes)}function E(e){return"start_time_unix_nano"in e}function I(e){var t,n,s;return E(e)||M(e)?T(null!==(t=e.span_id)&&void 0!==t?t:"",!0):T(null!==(n=null===(s=e.context)||void 0===s?void 0:s.span_id)&&void 0!==n?n:"",!1)}function C(e){var t,n;return E(e)||M(e)?T(null!==(t=e.parent_span_id)&&void 0!==t?t:"",!0):T(null!==(n=e.parent_id)&&void 0!==n?n:"",!1)}function k(e){return E(e)||M(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function D(e){return E(e)||M(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function N(e){var t;return w(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function R(e){var t,n;if(!w(e.info))return null;const s=Number(null===(t=e.info)||void 0===t||null===(n=t.trace_metadata)||void 0===n?void 0:n["mlflow.trace.sizeBytes"]);return(0,r.isNil)(s)||isNaN(s)?null:s}function _(e){var t,n;const s=N(e),r=(null!==(t=null===(n=e.trace_data)||void 0===n?void 0:n.spans)&&void 0!==t?t:e.data.spans).map(ne),a={},l={};if(!r||0===r.length)return[];r.forEach(e=>{const t=I(e);a[t]=e,l[t]=[]}),r.forEach(e=>{var t;const n=I(e),s=C(e);null===(t=l[s])||void 0===t||t.push(n)});const c=Math.min(...r.map(e=>k(e))),d=Math.max(...r.map(e=>D(e))),u=L(e.info);function p(e){var t,n,r;const m=a[e],h=l[e].map(p);if(E(m)||M(m)||"parent_id"in m)return S(m,c,d,h,u,s);const f=null!==(t=m.span_type)&&void 0!==t?t:o.UG.UNKNOWN;return{title:m.name,icon:(0,g.Y)(i.P,{type:v(f)}),type:f,key:m.context.span_id,start:Number(m.start_time)-c,end:Number(null!==(n=m.end_time)&&void 0!==n?n:d)-c,children:h.slice().sort((e,t)=>e.start-t.start),inputs:m.inputs,outputs:m.outputs,attributes:m.attributes,events:m.events,parentId:null!==(r=m.parent_id)&&void 0!==r?r:m.parent_span_id,assessments:[],traceId:s}}const m=new Array;return r.forEach(e=>{const t=C(e);t&&a[t]||m.push(p(I(e)))}),m}const L=e=>{let t=[];var n;w(e)?t=null!==(n=e.assessments)&&void 0!==n?n:[]:t=F(e.tags);const s=(0,r.keyBy)(t,"assessment_id");Object.values(s).forEach(e=>{if(e.overrides){const t=s[e.overrides];e.overriddenAssessment=t}}),t=Object.values(s);const a=t.reduce((e,t)=>{var n;const s=null!==(n=t.span_id)&&void 0!==n?n:"";return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.keys(a).forEach(e=>{a[e].sort((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())}),a},F=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map(([e,t])=>({key:e,value:t}))).filter(({key:e})=>e.startsWith("mlflow.assessment.")).map(({value:e})=>JSON.parse(e))};const H=e=>(0,r.isNil)(e)?[]:Array.isArray(e)||(0,r.isString)(e)||(0,r.isNumber)(e)||(0,r.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map(([e,t])=>({key:e,value:JSON.stringify(t,null,2)})),O=({searchFilter:e,data:t,activeMatchBackgroundColor:n,inactiveMatchBackgroundColor:a,containsActiveMatch:o,activeMatch:i,scrollToActiveMatch:l})=>{const c=new RegExp(`(${(0,r.escapeRegExp)(e.trim())})`,"gi"),d=t.split(c),u=[];let p=0;for(let r=0;r<d.length;r++)if(d[r].toLowerCase().includes(e.toLowerCase().trim())){const e=o&&i.matchIndex===p,t=e?n:a,c=(0,g.Y)("span",{ref:e?l:null,css:(0,s.AH)({backgroundColor:t,scrollMarginTop:50},""),children:d[r]},r);p++,u.push(c)}else u.push(d[r]);return u},z=e=>(0,r.has)(e,"page_content"),U=e=>e.type===o.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,r.every)(e.outputs,z),B=(e,t,n)=>`${e}-${t}-${n}`,V=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter(e=>"exception"===e.name)},j=e=>V(e).length,$=e=>!(0,r.isNil)(e)&&(!(!(0,r.isNil)(e.type)&&!(0,r.isString)(e.type))&&(!(!(0,r.isNil)(e.description)&&!(0,r.isString)(e.description))&&!(!(0,r.isNil)(e.enum)&&!Array.isArray(e.enum)))),K=e=>{var t;if((0,r.isNil)(e)||"function"!==e.type||!(0,r.has)(e,"function.name"))return!1;const n=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,r.isNil)(n)){const e=n.required;if(!(0,r.isNil)(e)&&(!Array.isArray(e)||!e.every(r.isString)))return!1;const t=n.properties;if(!(0,r.isNil)(t)&&!Object.values(t).every($))return!1}return!0},P=e=>{var t,n;return e&&(0,r.isString)(e.id)&&(0,r.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,r.isString)(null===(n=e.function)||void 0===n?void 0:n.name)},W=e=>!(!(0,r.isNil)(e)&&!(0,r.isString)(e))||!!(0,r.isArray)(e)&&e.every(e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,r.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,r.isNil)(t)&&(0,r.isString)(t.url)&&((0,r.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:n}=e;return!(0,r.isNil)(n)&&(0,r.isString)(n.data)&&((0,r.isNil)(n.format)||["wav","mp3"].includes(n.format));default:return!1}})(e)),G=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(P))return!1}return(!e.parts||!(0,r.isNil)(e.content))&&("reasoning"===e.type||!!W(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role))},J=e=>Array.isArray(e)&&e.length>0&&e.every(e=>{return(0,r.has)(e,"message")&&(t=e.message,!!G(t)&&((0,r.isNil)(t.content)||(0,r.isString)(t.content)));var t}),q=e=>e&&J(e.choices),X=(e,t)=>{var n,s,a,o,i,l,u,p,m,g,h,f,v,x,y,b,Y;try{if(Array.isArray(e)&&e.length>0&&e.every(G))return(0,r.compact)(e.map(ee));switch(t){case"langchain":const t=null!==(n=(0,c.HD)(e))&&void 0!==n?n:(0,c.oI)(e);if(t)return t;break;case"llamaindex":const r=null!==(s=(0,c.Hy)(e))&&void 0!==s?s:(0,c.W3)(e);if(r)return r;break;case"openai":const A=null!==(a=null!==(o=null!==(i=null!==(l=(0,c.a8)(e))&&void 0!==l?l:(0,c.bS)(e))&&void 0!==i?i:(0,c.n_)(e))&&void 0!==o?o:(0,c.AG)(e))&&void 0!==a?a:(0,d.x1)(e);if(A)return A;break;case"dspy":const S=null!==(u=(0,c.iU)(e))&&void 0!==u?u:(0,c.Pn)(e);if(S)return S;break;case"gemini":const T=null!==(p=(0,c.DE)(e))&&void 0!==p?p:(0,c.Sy)(e);if(T)return T;break;case"anthropic":const w=null!==(m=(0,c.KF)(e))&&void 0!==m?m:(0,c.pL)(e);if(w)return w;break;case"mistral":const M=null!==(g=(0,c.Kn)(e))&&void 0!==g?g:(0,c.v_)(e);if(M)return M;break;case"openai-agent":const E=null!==(h=(0,c.xW)(e))&&void 0!==h?h:(0,c.m$)(e);if(E)return E;break;case"autogen":const I=null!==(f=(0,c.nW)(e))&&void 0!==f?f:(0,c.u6)(e);if(I)return I;break;case"bedrock":const C=null!==(v=(0,c.Yv)(e))&&void 0!==v?v:(0,c.f1)(e);if(C)return C;break;case"vercel_ai":const k=null!==(x=(0,c.fJ)(e))&&void 0!==x?x:(0,c.QA)(e);if(k)return k;break;case"pydantic_ai":const D=null!==(y=(0,c.Ii)(e))&&void 0!==y?y:(0,c.TY)(e);if(D)return D;break;case"voltagent":const N=null!==(b=(0,c.o0)(e))&&void 0!==b?b:(0,c.LO)(e);if(N)return N;break;default:const R=null!==(Y=(0,c.a8)(e))&&void 0!==Y?Y:(0,c.bS)(e);if(R)return R}return Array.isArray(e)&&e.length>0&&e.every(c.oi)?(0,r.compact)(e.map(c.pN)):null}catch(A){return null}},Q=e=>{var t;let n=null===(t=e.function)||void 0===t?void 0:t.arguments;try{n=JSON.stringify(JSON.parse(n),null,2)}catch(s){}return{id:e.id,function:{arguments:n,name:e.function.name}}},Z=e=>{if((0,r.isNil)(e)||(0,r.isString)(e))return e;return e.map(e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const n=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return n?`![](${n})`:"[image]";case"input_audio":return"[audio]"}}).filter(e=>void 0!==e).join("\n\n")},ee=e=>{var t;return"reasoning"===e.type?null:{...e,content:Z(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(Q)}},te=e=>{if((0,r.isNil)(e))return"content";if(j(e)>0)return"events";if(e.chatMessages)return"chat";return!(0,r.isNil)(e.inputs)||!(0,r.isNil)(e.outputs)?"content":"attributes"},ne=e=>{var t;const n=e=>Array.isArray(e)?e.reduce((e,t)=>{return t.key&&t.value?{...e,[t.key]:(n=t.value,(0,r.isObject)(n)?"string_value"in n?n.string_value:"bool_value"in n?n.bool_value:"int_value"in n?n.int_value:"double_value"in n?n.double_value:n:n)}:e;var n},{}):e;return{...e,...e.attributes&&{attributes:n(e.attributes)},...e.events&&{events:null===(t=e.events)||void 0===t?void 0:t.map(e=>({...e,attributes:n(e.attributes)}))}}},se=e=>(0,a.useMemo)(()=>{if(!e)return[];return(0,p.VC)([e]).filter(p.fJ)},[e]),re=e=>{var t;return Boolean(e&&w(e)&&"UC_SCHEMA"===(null===(t=e.trace_location)||void 0===t?void 0:t.type))},ae=e=>{var t,n,s,r;return"MLFLOW_EXPERIMENT"===e.type?null===(t=e.mlflow_experiment)||void 0===t?void 0:t.experiment_id:"INFERENCE_TABLE"===e.type?null===(n=e.inference_table)||void 0===n?void 0:n.full_table_name:"UC_SCHEMA"===e.type?`${null===(s=e.uc_schema)||void 0===s?void 0:s.catalog_name}.${null===(r=e.uc_schema)||void 0===r?void 0:r.schema_name}`:void 0},oe=e=>{const[t,n]=e.split(".");return t&&n?{type:"UC_SCHEMA",uc_schema:{catalog_name:t,schema_name:n}}:{type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}}},ie=e=>{if(!e.trace_location)return e.trace_id;const t=ae(e.trace_location);return t?`trace:/${t}/${e.trace_id}`:e.trace_id},le=e=>{if(!ce(e))return;const[,t,n]=e.split("/");return{trace_id:n,trace_location:t}},ce=e=>e.startsWith("trace:/"),de=e=>{var t,n;return(0,l.pt)(null!==(t=null===e||void 0===e||null===(n=e.trace_metadata)||void 0===n?void 0:n[u.Uu])&&void 0!==t?t:"{}")},ue=e=>{var t,n;return(0,l.pt)(null!==(t=null===e||void 0===e||null===(n=e.trace_metadata)||void 0===n?void 0:n[u.ak])&&void 0!==t?t:"{}")},pe=e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.filter(e=>!(e=>{var t;return!(0,r.isEmpty)(null===(t=e.metadata)||void 0===t?void 0:t[u.K6])})(e)))&&void 0!==t?t:[]},me=e=>{var t;const n=(null===e||void 0===e?void 0:e.attributes)&&"exception.stacktrace"in e.attributes,s="string"===typeof(null===(t=e.attributes)||void 0===t?void 0:t["exception.stacktrace"]);return Boolean((null===e||void 0===e?void 0:e.attributes)&&"string"===typeof e.attributes["exception.type"]&&"string"===typeof e.attributes["exception.message"]&&(!n||s))}},90448:function(e,t,n){n.d(t,{fu:function(){return i}});n(76118);var s=n(42747);n(16844),n(9858);let r=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.RETRIEVAL_GROUNDEDNESS="retrieval_groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.RETRIEVAL_RELEVANCE="retrieval_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.RETRIEVAL_SUFFICIENCY="retrieval_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GUIDELINES="guidelines",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.CONVERSATIONAL_GUIDELINES="conversational_guidelines",e}({});r.OVERALL_ASSESSMENT,r.CORRECTNESS,r.GLOBAL_GUIDELINE_ADHERENCE,r.GUIDELINE_ADHERENCE,r.GUIDELINES,r.CONVERSATIONAL_GUIDELINES,r.RELEVANCE_TO_QUERY,r.CONTEXT_SUFFICIENCY,r.RETRIEVAL_SUFFICIENCY,r.CHUNK_RELEVANCE,r.RETRIEVAL_RELEVANCE,r.GROUNDEDNESS,r.RETRIEVAL_GROUNDEDNESS,r.SAFETY,r.OVERALL_ASSESSMENT,r.CORRECTNESS,r.GROUNDEDNESS,r.RETRIEVAL_GROUNDEDNESS,r.RELEVANCE_TO_QUERY,r.SAFETY,r.CHUNK_RELEVANCE,r.RETRIEVAL_RELEVANCE,r.CONTEXT_SUFFICIENCY,r.RETRIEVAL_SUFFICIENCY,r.GUIDELINE_ADHERENCE,r.GUIDELINES,r.CONVERSATIONAL_GUIDELINES;let a=function(e){return e.YES="yes",e.NO="no",e.UNKNOWN="unknown",e}({});(0,s.zR)({id:"WiaEQ3",defaultMessage:"Model output"});const o="expected_facts";(0,s.zR)({id:"CX8ytv",defaultMessage:"Expected output"}),(0,s.zR)({id:"N1G2a5",defaultMessage:"Expected facts"}),r.OVERALL_ASSESSMENT,(0,s.zR)({id:"uoJWOm",defaultMessage:"Overall"}),r.CORRECTNESS,(0,s.zR)({id:"7+XQ3q",defaultMessage:"Correctness"}),r.GROUNDEDNESS,(0,s.zR)({id:"Ws58cc",defaultMessage:"Groundedness"}),r.RETRIEVAL_GROUNDEDNESS,(0,s.zR)({id:"wY58OE",defaultMessage:"Retrieval groundedness"}),r.CONTEXT_SUFFICIENCY,(0,s.zR)({id:"GRaplV",defaultMessage:"Context sufficiency"}),r.RETRIEVAL_SUFFICIENCY,(0,s.zR)({id:"mdzFsD",defaultMessage:"Retrieval sufficiency"}),r.RELEVANCE_TO_QUERY,(0,s.zR)({id:"Yhydp3",defaultMessage:"Relevance"}),r.SAFETY,(0,s.zR)({id:"jMUqD1",defaultMessage:"Safety"}),r.CHUNK_RELEVANCE,(0,s.zR)({id:"qnMgLj",defaultMessage:"Chunk relevance"}),r.RETRIEVAL_RELEVANCE,(0,s.zR)({id:"opUoF8",defaultMessage:"Retrieval relevance"}),r.GUIDELINE_ADHERENCE,(0,s.zR)({id:"xV6NWF",defaultMessage:"Guideline adherence"}),r.GUIDELINES,(0,s.zR)({id:"ls3868",defaultMessage:"Guidelines"}),r.GLOBAL_GUIDELINE_ADHERENCE,(0,s.zR)({id:"tUAhDM",defaultMessage:"Global guideline adherence"}),r.CONVERSATIONAL_GUIDELINES,(0,s.zR)({id:"AeRhuI",defaultMessage:"Conversational guidelines"}),r.CORRECTNESS,(0,s.zR)({id:"i7UTwK",defaultMessage:"Correctness assessment is missing. This is likely because you have not provided an expected response (ground truth) or grading notes."}),r.GROUNDEDNESS,(0,s.zR)({id:"jPW0Lj",defaultMessage:"Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),r.RETRIEVAL_GROUNDEDNESS,(0,s.zR)({id:"TXPJuE",defaultMessage:"Retrieval Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),r.CONTEXT_SUFFICIENCY,(0,s.zR)({id:"g0tloS",defaultMessage:"Context sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."}),r.RETRIEVAL_SUFFICIENCY,(0,s.zR)({id:"ffIouW",defaultMessage:"Retrieval sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."}),r.OVERALL_ASSESSMENT,(0,s.zR)({id:"hW5ehW",defaultMessage:"The overall assessment passes when all of the judges pass."}),r.CORRECTNESS,(0,s.zR)({id:"Y6gWro",defaultMessage:"The correctness LLM judge gives a binary evaluation and written rationale on whether the agent's generated response is factually accurate and semantically similar to the provided ground-truth response or grading notes."}),r.GROUNDEDNESS,(0,s.zR)({id:"+Wd9fs",defaultMessage:"The groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),r.RETRIEVAL_GROUNDEDNESS,(0,s.zR)({id:"6Q/0BO",defaultMessage:"The retrieval groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),r.RELEVANCE_TO_QUERY,(0,s.zR)({id:"oDwj2g",defaultMessage:"The relevance_to_query LLM judge determines whether the response is relevant to the input request."}),r.SAFETY,(0,s.zR)({id:"/gqx4n",defaultMessage:"The safety LLM judge returns a binary rating and a written rationale on whether the generated response has harmful or toxic content."}),r.CHUNK_RELEVANCE,(0,s.zR)({id:"aUOkOC",defaultMessage:"The chunk-relevance-precision LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),r.RETRIEVAL_RELEVANCE,(0,s.zR)({id:"rBydei",defaultMessage:"The retrieval-relevance LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),r.CONTEXT_SUFFICIENCY,(0,s.zR)({id:"bkWot5",defaultMessage:"The context sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),r.RETRIEVAL_SUFFICIENCY,(0,s.zR)({id:"fwxkdN",defaultMessage:"The retrieval sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),r.GUIDELINE_ADHERENCE,(0,s.zR)({id:"4Tg5Vr",defaultMessage:"The guideline adherence LLM judge determines whether the response adheres to the guidelines provided."}),r.GUIDELINES,(0,s.zR)({id:"98v9a0",defaultMessage:"The guidelines LLM judge determines whether the response adheres to the guidelines provided. All responses must adhere to guidelines."}),r.GLOBAL_GUIDELINE_ADHERENCE,(0,s.zR)({id:"zZ9sIi",defaultMessage:"The global guideline adherence LLM judge determines whether the response adheres to the global guidelines provided. All responses must adhere to global guidelines."}),r.CONVERSATIONAL_GUIDELINES,(0,s.zR)({id:"lDQtCN",defaultMessage:"The conversational guidelines LLM judge evaluates whether the assistant's responses throughout a conversation comply with the provided guidelines."}),r.OVERALL_ASSESSMENT,a.YES,(0,s.zR)({id:"Za9+Cg",defaultMessage:"Pass"}),a.NO,(0,s.zR)({id:"j77+aP",defaultMessage:"Fail"}),r.CHUNK_RELEVANCE,a.YES,(0,s.zR)({id:"B1Upnc",defaultMessage:"Relevant"}),a.NO,(0,s.zR)({id:"M+HfWb",defaultMessage:"Irrelevant"}),r.RETRIEVAL_RELEVANCE,a.YES,(0,s.zR)({id:"++039K",defaultMessage:"Relevant"}),a.NO,(0,s.zR)({id:"akmaST",defaultMessage:"Irrelevant"}),r.CONTEXT_SUFFICIENCY,a.YES,(0,s.zR)({id:"7S/ozs",defaultMessage:"Context sufficient"}),a.NO,(0,s.zR)({id:"aAAHaS",defaultMessage:"Context insufficient"}),r.RETRIEVAL_SUFFICIENCY,a.YES,(0,s.zR)({id:"rBIGDf",defaultMessage:"Sufficient"}),a.NO,(0,s.zR)({id:"lhFnAG",defaultMessage:"Insufficient"}),r.RELEVANCE_TO_QUERY,a.YES,(0,s.zR)({id:"rNkAcB",defaultMessage:"Relevant"}),a.NO,(0,s.zR)({id:"0M7VVC",defaultMessage:"Irrelevant"}),r.GROUNDEDNESS,a.YES,(0,s.zR)({id:"/2InJv",defaultMessage:"Grounded"}),a.NO,(0,s.zR)({id:"ZfsnMj",defaultMessage:"Not grounded"}),r.RETRIEVAL_GROUNDEDNESS,a.YES,(0,s.zR)({id:"e515YD",defaultMessage:"Grounded"}),a.NO,(0,s.zR)({id:"uSVfB9",defaultMessage:"Not grounded"}),r.CORRECTNESS,a.YES,(0,s.zR)({id:"eSxQmg",defaultMessage:"Correct"}),a.NO,(0,s.zR)({id:"LhxSrc",defaultMessage:"Incorrect"}),r.SAFETY,a.YES,(0,s.zR)({id:"DMOaoR",defaultMessage:"Safe"}),a.NO,(0,s.zR)({id:"CX/MSu",defaultMessage:"Unsafe"}),r.GUIDELINE_ADHERENCE,a.YES,(0,s.zR)({id:"ZNYFUr",defaultMessage:"Adheres to guidelines"}),a.NO,(0,s.zR)({id:"hIBLi9",defaultMessage:"Violates guidelines"}),r.GUIDELINES,a.YES,(0,s.zR)({id:"luV/3W",defaultMessage:"Adheres to guidelines"}),a.NO,(0,s.zR)({id:"WmgIQ+",defaultMessage:"Violates guidelines"}),r.GLOBAL_GUIDELINE_ADHERENCE,a.YES,(0,s.zR)({id:"mtYPI8",defaultMessage:"Adheres to global guidelines"}),a.NO,(0,s.zR)({id:"rZyNgx",defaultMessage:"Violates global guidelines"}),r.CONVERSATIONAL_GUIDELINES,a.YES,(0,s.zR)({id:"iCdWsS",defaultMessage:"Adheres to guidelines"}),a.NO,(0,s.zR)({id:"MJILab",defaultMessage:"Violates guidelines"});function i(e,t){let n=e;const s=n.startsWith("#");s&&(n=e.slice(1));return`${s?"#":""}${n}${Math.round(255*Math.min(Math.max(t,0),1)).toString(16).toUpperCase()}`}r.GUIDELINE_ADHERENCE,r.GUIDELINES,r.GLOBAL_GUIDELINE_ADHERENCE,r.RELEVANCE_TO_QUERY,r.CONTEXT_SUFFICIENCY,r.RETRIEVAL_SUFFICIENCY,r.CORRECTNESS,r.GROUNDEDNESS,r.RETRIEVAL_GROUNDEDNESS,r.SAFETY,r.CHUNK_RELEVANCE},90828:function(e,t,n){n.d(t,{Y7:function(){return i},nt:function(){return r},oD:function(){return a},pt:function(){return o}});var s=n(76118);const r="mlflow.",a=e=>!e.startsWith(r)&&!e.startsWith("_mlflow_"),o=e=>{try{return JSON.parse(e)}catch(t){return}},i=(e,t)=>{const n=(0,s.truncate)(e,{length:t});return(0,s.takeWhile)(n,e=>"\n"!==e).join("")}},91461:function(e,t,n){n.d(t,{E:function(){return d}});var s=n(68248),r=n(46709),a=n(27757),o=n(82716),i=n(42747),l=n(73408);function c({paramName:e,paramProperties:t,isRequired:n}){const{theme:r}=(0,a.u)(),{type:o,description:c,enum:d}=t,u=o||c||d,p=u?{borderTopLeftRadius:r.borders.borderRadiusMd,borderTopRightRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${r.colors.border}`}:{borderRadius:r.borders.borderRadiusMd};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusMd,border:`1px solid ${r.colors.border}`},""),children:[(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:r.colors.backgroundSecondary,padding:`${r.spacing.sm}px ${r.spacing.md}px`,gap:r.spacing.sm,...p},""),children:[(0,l.Y)(a.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),n&&(0,l.Y)(a.T.Text,{withoutMargins:!0,color:"error",children:(0,l.Y)(i.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),u&&(0,l.FD)("div",{css:(0,s.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:r.spacing.md,padding:`${r.spacing.sm}px ${r.spacing.md}px`},""),children:[o&&(0,l.FD)(l.FK,{children:[(0,l.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(i.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,l.Y)(a.T.Text,{withoutMargins:!0,code:!0,children:o})]}),c&&(0,l.FD)(l.FK,{children:[(0,l.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(i.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,l.Y)(a.T.Text,{withoutMargins:!0,children:c})]}),d&&(0,l.FD)(l.FK,{children:[(0,l.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(i.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm,flexWrap:"wrap"},""),children:d.map(e=>(0,l.Y)(a.T.Text,{withoutMargins:!0,code:!0,children:e},e))})]})]})]})}function d({tool:e}){var t,n,i;const{theme:d}=(0,a.u)(),[u,p]=(0,r.useState)(!1),m=e.function.description,g=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,h=null!==(n=null===(i=e.function.parameters)||void 0===i?void 0:i.required)&&void 0!==n?n:[],f=m||g,v=f?{":hover":{backgroundColor:d.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:d.borders.borderRadiusMd,border:`1px solid ${d.colors.border}`,backgroundColor:d.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,l.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",gap:d.spacing.sm,alignItems:"center",borderBottom:f&&u?`1px solid ${d.colors.border}`:"none",padding:d.spacing.sm,...v},""),onClick:()=>p(!u),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[f&&(u?(0,l.Y)(o.ChevronDownIcon,{}):(0,l.Y)(a.o,{})),(0,l.Y)(a.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),f&&u&&(0,l.FD)("div",{css:(0,s.AH)({padding:d.spacing.sm},""),children:[m&&(0,l.Y)(a.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:d.spacing.sm,padding:`0px ${d.spacing.xs}px`},children:e.function.description}),g&&(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:d.spacing.sm},""),children:Object.keys(g).map(e=>(0,l.Y)(c,{paramName:e,paramProperties:g[e],isRequired:h.includes(e)},e))})]})]})}},93812:function(e,t,n){n.d(t,{X:function(){return M}});var s=n(68248),r=n(76118),a=n(46709),o=n(27757),i=n(82716),l=n(42747),c=n(73879),d=n(79081),u=n(94664),p=n(51847),m=n(73408);const g=e=>{switch(e){case"system":return(0,m.Y)(p.P,{type:u.Dy.SYSTEM});case"user":return(0,m.Y)(p.P,{type:u.Dy.USER});case"tool":case"function":return(0,m.Y)(p.P,{type:u.Dy.WRENCH});default:return(0,m.Y)(p.P,{type:u.Dy.MODELS})}},h=e=>{switch(e.role){case"system":return(0,m.Y)(l.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,m.Y)(l.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,m.Y)(l.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,m.Y)(l.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,m.Y)(l.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var f={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},v={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const x=({isExpandable:e,expanded:t,setExpanded:n,message:r})=>{const{theme:a}=(0,o.u)(),c=e?{":hover":{backgroundColor:a.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,m.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:a.spacing.sm,gap:a.spacing.sm,...c},""),onClick:()=>n(!t),children:[e&&(t?(0,m.Y)(i.ChevronDownIcon,{}):(0,m.Y)(o.o,{})),g(r.role),r.tool_call_id?(0,m.Y)(o.T.Text,{color:"secondary",css:f,children:(0,m.Y)(l.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginRight:a.spacing.xs},""),bold:!0,children:h(r)}),toolCallId:(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:r.tool_call_id,children:(0,m.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:a.spacing.xs},""),children:(0,m.Y)(o.T.Text,{css:v,code:!0,children:r.tool_call_id})})})}})}):(0,m.Y)(o.T.Text,{bold:!0,children:h(r)})]})};var y=n(65854),b=n(45547);var Y={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function A({toolCall:e}){const{theme:t}=(0,o.u)();return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,m.Y)(o.T.Text,{color:"secondary",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,m.Y)(l.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,m.FD)(i.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,s.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,m.Y)(i.FunctionIcon,{}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:e.id,children:(0,m.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,m.Y)(o.T.Text,{css:Y,code:!0,color:"secondary",children:e.id})})})}})}),(0,m.Y)(b.w,{data:e.function.arguments})]},e.id)}const S=e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}};function T({content:e,shouldDisplayCodeSnippet:t}){const{theme:n}=(0,o.u)();return e?t?(0,m.Y)(b.w,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:u.cC.JSON}):(0,m.Y)("div",{css:(0,s.AH)({padding:n.spacing.sm,paddingTop:0,marginBottom:-n.typography.fontSizeBase},""),children:(0,m.Y)(c.V,{children:e})}):null}function w({reasoning:e}){const{theme:t}=(0,o.u)(),[n,r]=(0,a.useState)(!1);return(0,m.FD)("div",{css:(0,s.AH)({margin:t.spacing.sm,marginTop:0,border:`1px solid ${t.colors.borderDecorative}`,borderRadius:t.borders.borderRadiusMd,backgroundColor:t.colors.backgroundSecondary,overflow:"hidden"},""),children:[(0,m.FD)("button",{type:"button",onClick:()=>r(!n),css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs,width:"100%",padding:t.spacing.sm,backgroundColor:"transparent",border:"none",cursor:"pointer",textAlign:"left","&:hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:[n?(0,m.Y)(i.ChevronDownIcon,{css:(0,s.AH)({color:t.colors.textSecondary},"")}):(0,m.Y)(o.o,{css:(0,s.AH)({color:t.colors.textSecondary},"")}),(0,m.Y)(i.LightbulbIcon,{css:(0,s.AH)({color:t.colors.textValidationWarning},"")}),(0,m.Y)(o.T.Text,{bold:!0,css:(0,s.AH)({color:t.colors.textSecondary},""),children:(0,m.Y)(l.sA,{id:"x7NsCC",defaultMessage:"Reasoning"})})]}),n&&(0,m.Y)("div",{css:(0,s.AH)({padding:t.spacing.sm,paddingTop:0,borderTop:`1px solid ${t.colors.borderDecorative}`,marginBottom:-t.typography.fontSizeBase},""),children:(0,m.Y)(c.V,{children:e})})]})}function M({message:e,className:t}){var n;const{theme:c}=(0,o.u)(),[d,u]=(0,a.useState)(!1),{content:p,isJson:g}=S(null!==(n=e.content)&&void 0!==n?n:""),h=g&&("tool"===e.role||"function"===e.role),f=!h&&p.length>y.w,v=f&&!d?`${p.slice(0,y.w)}...`:p;return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:c.borders.borderRadiusSm,border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,m.Y)(x,{isExpandable:f,expanded:d,setExpanded:u,message:e}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:[e.reasoning&&(0,m.Y)(w,{reasoning:e.reasoning}),!(0,r.isNil)(e.tool_calls)&&e.tool_calls.map(e=>(0,m.Y)(A,{toolCall:e},e.id)),(0,m.Y)(T,{content:v,shouldDisplayCodeSnippet:h})]}),f&&(0,m.Y)(o.B,{componentId:d?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:d?(0,m.Y)(i.ChevronUpIcon,{}):(0,m.Y)(i.ChevronDownIcon,{}),type:"tertiary",onClick:()=>u(!d),css:(0,s.AH)({display:"flex",width:"100%",padding:c.spacing.md,borderRadius:"0px !important"},""),children:d?(0,m.Y)(l.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,m.Y)(l.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}},94664:function(e,t,n){n.d(t,{Dy:function(){return r},UG:function(){return s},cC:function(){return a}});let s=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),r=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e.SAVE="save",e}({}),a=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e.PYTHON="python",e}({})},94777:function(e,t,n){n.d(t,{o:function(){return d}});var s=n(68248),r=n(27757),a=n(94664),o=n(86125),i=n(51847),l=n(53915),c=n(73408);const d=({node:e})=>{var t;const{theme:n}=(0,r.u)(),{setSelectedNode:d,setActiveView:u,setShowTimelineTreeGantt:p}=(0,l.nJ)(),m=(0,o.N7)(e)>0;return(0,c.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",marginRight:n.spacing.xs,gap:n.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:m?n.colors.actionDangerDefaultTextDefault:n.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{d(e),u("detail"),p(!1)},children:[(0,c.Y)(i.P,{hasException:m,type:(0,o.tC)(null!==(t=e.type)&&void 0!==t?t:a.UG.UNKNOWN)}),(0,c.Y)(r.T.Text,{color:m?"error":"primary",css:(0,s.AH)({marginLeft:n.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})}},96586:function(e,t,n){n.d(t,{B:function(){return p}});var s=n(68248),r=n(46709),a=n(82716),o=n(27757),i=n(79081),l=n(42747),c=n(94664),d=n(49425),u=n(73408);const p=({error:e})=>{const{theme:t}=(0,o.u)(),[n,p]=(0,r.useState)(!1);return(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,u.Y)(a.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,u.Y)("span",{children:e.error_message}),e.stack_trace&&(0,u.Y)(o.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>p(!0),children:(0,u.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,u.Y)(i.d,{title:(0,u.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:n,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>p(!1),children:(0,u.Y)(d.C,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:c.cC.TEXT})})]})}},97407:function(e,t,n){n(59930),n(46709)},97447:function(e,t,n){n.d(t,{f:function(){return c}});var s=n(68248),r=n(82716),a=n(27757),o=n(79081),i=n(73408);var l={name:"e0dnmk",styles:"cursor:pointer"};const c=({label:e,value:t,displayValue:n=t,icon:c,color:d,getTruncatedLabel:u,onCopy:p,hideLabel:m=!1})=>{const{theme:g}=(0,a.u)();return(0,i.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:m?"flex-start":"center",flexDirection:"row",gap:g.spacing.sm},""),children:[!m&&(0,i.Y)(a.T.Text,{size:"md",color:"secondary",children:e}),(0,i.Y)(o.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:t,maxWidth:400,children:(0,i.Y)(r.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",color:d,onClick:()=>{navigator.clipboard.writeText(t),p()},css:l,children:(0,i.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:g.spacing.xs},""),children:[c&&(0,i.Y)("span",{children:c}),(0,i.Y)("span",{children:u(n)})]})})})]})}}}]);