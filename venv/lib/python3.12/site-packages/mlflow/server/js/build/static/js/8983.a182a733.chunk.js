"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[8983],{110:function(e,t,n){n.d(t,{N_:function(){return f},Oz:function(){return h},g:function(){return p},tW:function(){return r.tW},zy:function(){return g}});var s=n(46709),o=n(27637),r=n(55113),i=n(58024),a=n(73408);const l="workspace",d=()=>{if("undefined"===typeof window)return null;try{return window.localStorage.getItem("mlflow.activeWorkspace")}catch{return null}},c=["/settings"],u=e=>{const t=e.split("?")[0].split("#")[0];return c.some(e=>t===e||t.startsWith(e+"/"))},m=e=>{if("string"!==typeof e||0===e.length)return e;if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e))return e;const t=e.startsWith("#")?"#":"",n=t?e.slice(1):e;if(!(""!==t||n.startsWith("/")))return e;let s=n,o="";const r=s.indexOf("#");r>=0&&(s=s.slice(0,r));const i=s.indexOf("?");i>=0&&(o=s.slice(i+1),s=s.slice(0,i));const a=new URLSearchParams(o).has(l);if(u(s||"/"))return(e=>{const t=e.startsWith("#")?"#":"";let n=t?e.slice(1):e,s="",o="";const r=n.indexOf("#");r>=0&&(o=n.slice(r),n=n.slice(0,r));const i=n.indexOf("?");i>=0&&(s=n.slice(i+1),n=n.slice(0,i));const a=new URLSearchParams(s);a.delete(l);const d=a.toString();return`${t}${n}${d?"?"+d:""}${o}`})(e);if(a)return e;const c=d();return c?((e,t)=>{const n=e.startsWith("#")?"#":"";let s=n?e.slice(1):e,o="",r="";const i=s.indexOf("#");i>=0&&(r=s.slice(i),s=s.slice(0,i));const a=s.indexOf("?");a>=0&&(o=s.slice(a+1),s=s.slice(0,a));const d=new URLSearchParams(o);return d.set(l,t),`${n}${s}?${d.toString()}${r}`})(e,c):e},p=i.g,g=i.zy,f=s.forwardRef(function(e,t){const{to:n,disableWorkspacePrefix:s,...r}=e,i=s?n:(e=>{if("string"===typeof e)return m(e);if("object"===typeof e&&null!==e){const t="pathname"in e?e.pathname:void 0;if("string"!==typeof t)return e;if(u(t)){if(e.search){const t=new URLSearchParams(e.search);t.delete(l);const n=t.toString();return{...e,search:n?`?${n}`:void 0}}return e}const n=d();if(!n)return e;const s=e.search||"",o=new URLSearchParams(s.startsWith("?")?s.slice(1):s);return o.set(l,n),{...e,search:`?${o.toString()}`}}return e})(n);return(0,a.Y)(o.N_,{ref:t,to:i,...r})}),h=e=>e},3241:function(e,t,n){var s=n(68248),o=n(46709),r=n(27556),i=n(82716),a=n(27757),l=n(66916),d=n(73408);var c={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};t.A=({searchFilter:e,setSearchFilter:t,matchData:n,handleNextSearchMatch:u,handlePreviousSearchMatch:m})=>{const[p,g]=(0,o.useState)(e),f=(0,r.YQ)(t,350),{theme:h}=(0,a.u)();return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:h.spacing.sm},""),children:[(0,d.Y)(l.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:p,onClear:()=>{t(""),g("")},onChange:e=>{g(e.target.value),f(e.target.value.toLowerCase())},prefix:(0,d.Y)(l.S,{}),css:c}),n.match&&(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",marginLeft:h.spacing.xs,marginRight:h.spacing.sm,alignItems:"center"},""),children:[(0,d.FD)(a.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginRight:h.spacing.sm},""),children:[n.currentMatchIndex+1," / ",n.totalMatches]}),(0,d.Y)(a.B,{"data-testid":"prev-search-match",icon:(0,d.Y)(i.ChevronUpIcon,{}),onClick:m,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,d.Y)(a.B,{"data-testid":"next-search-match",icon:(0,d.Y)(i.ChevronDownIcon,{}),onClick:u,componentId:"shared.model-trace-explorer.next-search-match"})]})]})}},4947:function(e,t,n){n.d(t,{$W:function(){return f},A5:function(){return F},Al:function(){return R},FW:function(){return h},Gq:function(){return A},LV:function(){return y},My:function(){return N},Pn:function(){return v},RC:function(){return I},Rb:function(){return T},Rl:function(){return u},Te:function(){return p},VC:function(){return M},XQ:function(){return m},XS:function(){return L},YO:function(){return S},d6:function(){return x},im:function(){return w},jN:function(){return E},k0:function(){return C},li:function(){return b},mq:function(){return _},rc:function(){return Y},tP:function(){return d},tj:function(){return g},yX:function(){return c}});var s=n(76118),o=n(46709),r=n(33481),i=n(64667),a=n(93241),l=n(71540);const d="user",c="session",u="response",m="trace_id",p="request_time",g="execution_duration",f="state",h="source",v="tags",y="trace_name",x="request",b="run_name",w="logged_model",S="tokens",Y="custom_metadata",A="span.name",T="span.type",I="span.status",C="span.content",M="prompt",E="simulation_goal",_="simulation_persona",N=[g,p,c],R=[g,p],k=[r._1.CHUNK_RELEVANCE,r._1.TOTAL_INPUT_TOKEN_COUNT,r._1.TOTAL_OUTPUT_TOKEN_COUNT,r._1.TOTAL_TOKEN_COUNT,r._1.DOCUMENT_RECALL,r._1.DOCUMENT_RATINGS],D="_assessment_column";function F(e){return e+D}function O(e){return e+"_expectation_column"}const L=(e,t,n,r,Y,A)=>(0,o.useMemo)(()=>{const o=null!==A&&void 0!==A?A:(0,l.ZS)(t);let T=[];if(o)T=[{id:x,label:e.formatMessage({id:"Ey+oLI",defaultMessage:"Request"}),type:i.$6.INPUT,group:i.w8.INFO,filterOrder:0}];else{let e=new Set,n=new Set;t.forEach(t=>{const{inputs:s}=t;e=new Set([...e,...Object.keys(s||{})]),n=new Set([...n,...Object.keys(t.traceInfo||{})])}),T=[...e].map(e=>({id:e,label:e,type:i.$6.INPUT}))}const I=n.map(e=>({id:F(e.name),label:e.displayName,type:i.$6.ASSESSMENT,assessmentInfo:e,group:i.w8.ASSESSMENT})).filter(e=>!e.assessmentInfo.isRetrievalAssessment&&!k.includes(e.assessmentInfo.name));let C;const N={};if(o){C=[{id:m,label:e.formatMessage({id:"cv/bGM",defaultMessage:"Trace ID"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:y,label:e.formatMessage({id:"fq8v6G",defaultMessage:"Trace name"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:u,label:e.formatMessage({id:"BU8Jni",defaultMessage:"Response"}),type:i.$6.TRACE_INFO,group:i.w8.INFO,filterOrder:0},{id:d,label:e.formatMessage({id:"JcRo6a",defaultMessage:"User"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:c,label:e.formatMessage({id:"womPSY",defaultMessage:"Session"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:g,label:e.formatMessage({id:"FnG9dP",defaultMessage:"Execution time"}),filterLabel:e.formatMessage({id:"rRhMQt",defaultMessage:"Execution time (ms)"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:p,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:f,label:e.formatMessage({id:"ySuIn+",defaultMessage:"State"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:h,label:e.formatMessage({id:"vM/qUz",defaultMessage:"Source"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:w,label:e.formatMessage({id:"ofr72S",defaultMessage:"Version"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:M,label:e.formatMessage({id:"LOJumx",defaultMessage:"Prompt"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},{id:S,label:e.formatMessage({id:"q/zoT3",defaultMessage:"Tokens"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},(0,s.isNil)(r)&&{id:b,label:e.formatMessage({id:"dVh69l",defaultMessage:"Run name"}),type:i.$6.TRACE_INFO,group:i.w8.INFO},!(0,a.ij)()&&{id:v,label:e.formatMessage({id:"M3c7bs",defaultMessage:"Tags"}),type:i.$6.TRACE_INFO,group:i.w8.TAG}];const n=[...t,...Y||[]],o={};let x=!1,A=!1;const T=(0,a.I0)();if(n.forEach(e=>{var t;const n=null===(t=e.traceInfo)||void 0===t?void 0:t.trace_metadata;n&&(T&&(n["mlflow.simulation.goal"]&&(x=!0),n["mlflow.simulation.persona"]&&(A=!0)),Object.keys(n).forEach(e=>{e.startsWith(l.nt)||o[e]||(o[e]={id:(0,l.c7)(e),label:e,type:i.$6.TRACE_INFO,group:i.w8.INFO})}));const s=e.targets;s&&Object.keys(s).forEach(e=>{N[e]||(N[e]={id:O(e),label:e,type:i.$6.EXPECTATION,group:i.w8.EXPECTATION,expectationName:e})})}),C=[...C,...Object.values(o)],x&&C.push({id:E,label:e.formatMessage({id:"9AfxK7",defaultMessage:"Goal"}),type:i.$6.TRACE_INFO,group:i.w8.INFO}),A&&C.push({id:_,label:e.formatMessage({id:"G4CVdi",defaultMessage:"Persona"}),type:i.$6.TRACE_INFO,group:i.w8.INFO}),(0,a.ij)()){const e={};n.map(e=>{var t;return null===(t=e.traceInfo)||void 0===t?void 0:t.tags}).forEach(t=>{Object.keys(t||{}).forEach(t=>{t.startsWith(l.nt)||e[t]||(e[t]={id:(0,l.kZ)(t),label:t,type:i.$6.TRACE_INFO,group:i.w8.TAG})})});const t=Object.values(e);C=[...C,...t]}}else C=t.some(e=>!(0,s.isNil)(e.requestTime))?[{id:p,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:i.$6.INTERNAL_MONITOR_REQUEST_TIME}]:[];return[...T,...C,...I,...Object.values(N)].filter(e=>Boolean(e))},[t,e,n,r,Y,A])},5075:function(e,t,n){n.d(t,{Q:function(){return u}});var s=n(68248),o=(n(46709),n(82716)),r=n(27757),i=n(79081),a=n(42747),l=n(73408);const d={user_frustration:{none:{color:"lime",icon:o.CheckCircleIcon,label:(0,l.Y)(a.sA,{id:"Sm0bXt",defaultMessage:"None"})},resolved:{color:"lemon",icon:o.CheckCircleIcon,label:(0,l.Y)(a.sA,{id:"q90WPh",defaultMessage:"Resolved"})},unresolved:{color:"coral",icon:o.XCircleIcon,label:(0,l.Y)(a.sA,{id:"OcYzCN",defaultMessage:"Unresolved"})}}};var c={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const u=({jsonValue:e,className:t,prefix:n,skipIcons:u=!1,overrideColor:m,assessmentName:p})=>{const{theme:g}=(0,r.u)();if(!e||'""'===e)return null;let f;try{f=JSON.parse(e)}catch(b){f=e}let h="default",v=JSON.stringify(f,null,2);const y=((e,t,n,o)=>{if(!e)return;const r=d[e];if(!r)return;const i=r[String(null!==t&&void 0!==t?t:"")];if(!i)return;const a=i.icon;return{color:i.color,children:(0,l.FD)(l.FK,{children:[!o&&(0,l.Y)(a,{css:(0,s.AH)({marginRight:n.spacing.xs},"")}),i.label]})}})(p,f,g,u);y?(h=y.color,v=y.children):"yes"===f?(h="lime",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.CheckCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(a.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===f?(h="coral",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.XCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(a.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof f?v=f:null===f?(h="coral",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(r.k,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(a.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===f?(h="lime",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.CheckCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(a.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===f&&(h="coral",v=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.XCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(a.sA,{id:"4U/RVz",defaultMessage:"False"})]}));const x=(0,l.FD)(l.FK,{children:[n,v]});return(0,l.Y)(i.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:x,children:(0,l.Y)(o.Tag,{css:(0,s.AH)({display:"inline-flex",maxWidth:"100%",minWidth:g.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:null!==m&&void 0!==m?m:h,className:t,children:(0,l.FD)("span",{css:c,children:[n,v]})})})}},8531:function(e,t,n){n.d(t,{a:function(){return $}});var s=n(68248),o=n(46709),r=n(27757),i=n(42747),a=n(81390),l=n(82716),d=n(79081),c=n(86125),u=n(51847),m=n(73408);const p=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:n}=(0,r.u)();return(0,m.FD)(r.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,m.Y)(r.aw.Trigger,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,m.Y)(l.FilterIcon,{}),size:"small",children:(0,m.Y)(i.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,m.Y)(r.aw.Content,{align:"start",children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.xs},""),children:[(0,m.Y)(r.T.Text,{bold:!0,children:(0,m.Y)(i.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,m.Y)(r.T.Text,{color:"secondary",children:(0,m.Y)(i.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map(([o,i])=>{const a=(0,m.Y)(u.P,{type:(0,c.tC)(o)});return(0,m.FD)(l.Checkbox,{componentId:"shared.model-trace-explorer.toggle-span-filter",style:{width:"100%"},isChecked:i,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[o]:!i}}),children:[a,(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),children:(0,c.LS)(o)})]},o)}),(0,m.Y)(r.T.Text,{color:"secondary",children:(0,m.Y)(i.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,m.FD)(l.Checkbox,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_timeline_tree_timelinetreefilterbutton_83",style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,m.Y)(i.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,m.Y)(l.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,m.Y)(i.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,m.FD)(l.Checkbox,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_timeline_tree_timelinetreefilterbutton_111",style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,m.Y)(i.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,m.Y)(l.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,m.Y)(i.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},g=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:n,setSpanFilterState:o})=>{const{theme:a}=(0,r.u)();return(0,m.FD)("div",{css:(0,s.AH)({padding:`${a.spacing.xs}px ${a.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${a.colors.border}`,boxSizing:"border-box",paddingLeft:a.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,m.Y)(r.T.Text,{bold:!0,children:(0,m.Y)(i.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm},""),children:[(0,m.Y)(p,{spanFilterState:n,setSpanFilterState:o}),(0,m.FD)(l.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,m.Y)(l.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,m.Y)(i.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,m.Y)(l.ListBorderIcon,{})}),value:!1}),(0,m.Y)(l.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,m.Y)(i.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,m.Y)(l.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},f=({active:e})=>{const{theme:t}=(0,r.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:"100%",bottom:0,width:a.De/2+1,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${n}`,borderRight:`1px solid ${n}`,zIndex:a.u4.LOW},"")})},h=({active:e})=>{const{theme:t}=(0,r.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:"50%",top:0,width:a.De/2,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${n}`,borderLeft:`1px solid ${n}`,zIndex:e?a.u4.NORMAL:a.u4.LOW},"")})},v=({active:e})=>{const{theme:t}=(0,r.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",width:a.De/2,left:"50%",height:a.QJ,borderLeft:`1px solid ${n}`,boxSizing:"border-box",zIndex:e?a.u4.NORMAL:a.u4.LOW},"")})},y=({isActiveSpan:e,isInActiveChain:t,linesToRender:n,hasChildren:o,isExpanded:r})=>0===n.length?(0,m.Y)("div",{css:(0,s.AH)({width:0,height:a.QJ,boxSizing:"border-box",position:"relative"},""),children:o&&(0,m.Y)(f,{active:t&&!e})}):(0,m.Y)(m.FK,{children:n.map(({shouldRender:i,isActive:l},d)=>(0,m.FD)("div",{css:(0,s.AH)({width:a.De,height:a.QJ,boxSizing:"border-box",position:"relative"},""),children:[i&&(0,m.Y)(v,{active:l}),d===n.length-1&&(0,m.FD)(m.FK,{children:[(0,m.Y)(h,{active:t}),o&&r&&(0,m.Y)(f,{active:t&&!e})]})]},d))});var x=n(94664);var b={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const w=({span:e,children:t})=>{var n;const{theme:o}=(0,r.u)(),l=(0,c.tC)(null!==(n=e.type)&&void 0!==n?n:x.UG.UNKNOWN),p=o.isDarkMode?o.colors.grey800:o.colors.grey100,g=o.isDarkMode?o.colors.grey500:o.colors.grey350;return(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,m.FD)("div",{css:b,children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:o.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,m.Y)(u.P,{type:l,isInTooltip:!0}),(0,m.Y)("span",{css:(0,s.AH)({color:p},""),children:e.title}),(0,m.Y)("span",{css:(0,s.AH)({marginLeft:o.spacing.xs,color:g,fontSize:o.typography.fontSizeSm},""),children:(0,a.X6)(e.end-e.start)})]}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",color:p},""),children:[(0,m.Y)(i.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",(0,a.X6)(e.start)," | ",(0,m.Y)(i.sA,{id:"q90jVU",defaultMessage:"End:"})," ",(0,a.X6)(e.end)]})]}),side:"right",maxWidth:700,children:t})};var S=n(53915);var Y={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},A={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const T=({node:e,selectedKey:t,expandedKeys:n,setExpandedKeys:o,traceStartTime:i,traceEndTime:d,onSelect:u,linesToRender:p})=>{var g,f;const h=n.has(e.key),{theme:v}=(0,r.u)(),x=(null!==(g=e.children)&&void 0!==g?g:[]).length>0,{setAssessmentsPaneExpanded:b}=(0,S.nJ)(),I=t===e.key,C=(0,a.VD)(e,String(t)),M=C>-1,E=(0,c.N7)(e)>0,_=I?v.colors.actionDefaultBackgroundHover:"transparent";return(0,m.FD)(m.FK,{children:[(0,m.Y)(w,{span:e,children:(0,m.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:_,":hover":{backgroundColor:v.colors.actionDefaultBackgroundHover},":active":{backgroundColor:v.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===u||void 0===u||u(e)},children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${v.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,m.FD)("div",{css:Y,children:[x?(0,m.Y)(r.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:v.spacing.xs},""),icon:h?(0,m.Y)(l.ChevronDownIcon,{}):(0,m.Y)(r.o,{}),onClick:t=>{t.stopPropagation();const s=new Set(n);h?s.delete(e.key):s.add(e.key),o(s)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,m.Y)("div",{css:(0,s.AH)({width:24,marginRight:v.spacing.xs},"")}),(0,m.Y)(y,{isActiveSpan:I,isInActiveChain:M,linesToRender:p,hasChildren:x,isExpanded:h}),(0,m.Y)("span",{css:(0,s.AH)({flexShrink:0,marginRight:v.spacing.xs,borderRadius:v.borders.borderRadiusSm,border:`1px solid ${C>-1?v.colors.blue500:v.colors.backgroundSecondary}`,zIndex:a.u4.NORMAL},""),children:e.icon}),(0,m.Y)(r.T.Text,{color:E?"error":"primary",css:A,children:e.title}),e.assessments.length>0&&(0,m.FD)(l.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,s.AH)({margin:0,borderRadius:v.borders.borderRadiusSm},""),onClick:()=>null===b||void 0===b?void 0:b(!0),children:[(0,m.Y)(l.GavelIcon,{}),(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginLeft:v.spacing.xs},""),children:e.assessments.length})]})]})})})}),h&&(null===(f=e.children)||void 0===f?void 0:f.map((s,r)=>{var a,l;return(0,m.Y)(T,{node:s,expandedKeys:n,setExpandedKeys:o,selectedKey:t,traceStartTime:i,traceEndTime:d,onSelect:u,linesToRender:p.concat({shouldRender:r<(null!==(a=null===(l=e.children)||void 0===l?void 0:l.length)&&void 0!==a?a:0)-1,isActive:r<C})},s.key)}))]})};var I=n(49633);var C={name:"s5xdrg",styles:"display:flex;align-items:center"},M={name:"1aunqn6",styles:"display:none;align-items:center"},E={name:"s5xdrg",styles:"display:flex;align-items:center"},_={name:"1aunqn6",styles:"display:none;align-items:center"};const N=({node:e,selectedKey:t,leftOffset:n,width:i,onSelect:d,expandedKeys:c,setExpandedKeys:u})=>{var p;const{theme:g}=(0,r.u)(),f=(0,o.useRef)(null),h=(0,o.useRef)(null),v=t===e.key?g.colors.actionDefaultBackgroundHover:"transparent",y=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,x=c.has(e.key);return(0,o.useLayoutEffect)(()=>{const e=f.current,t=h.current;if(!e||!t)return;e.style.display="inline-flex",t.style.display="inline-flex";const n=Math.max(e.offsetWidth,t.offsetWidth)<i-2*g.spacing.sm;var s;s=n,e.style.display=s?"inline-flex":"none",t.style.display=s?"none":"inline-flex"},[g.spacing.sm,i,x,e.title,e.icon]),(0,m.Y)(w,{span:e,children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:g.spacing.xs,paddingRight:g.spacing.sm,paddingTop:g.spacing.xs,paddingBottom:g.spacing.xs,backgroundColor:v,alignItems:"center",":hover":{backgroundColor:g.colors.actionDefaultBackgroundHover},":active":{backgroundColor:g.colors.actionDefaultBackgroundPress},zIndex:a.u4.NORMAL},""),onClick:()=>null===d||void 0===d?void 0:d(e),children:[y?(0,m.Y)(r.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:g.spacing.xs},""),icon:x?(0,m.Y)(l.ChevronDownIcon,{}):(0,m.Y)(r.o,{}),onClick:t=>{t.stopPropagation();const n=new Set(c);x?n.delete(e.key):n.add(e.key),u(n)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,m.Y)("div",{css:(0,s.AH)({width:g.spacing.lg,marginRight:g.spacing.xs},"")}),(0,m.Y)("div",{css:(0,s.AH)({width:n,flexShrink:0},"")}),(0,m.Y)("div",{css:(0,s.AH)({position:"relative",width:i,height:g.typography.lineHeightLg,backgroundColor:g.isDarkMode?g.colors.blue600:g.colors.blue300,border:`1px solid ${g.isDarkMode?g.colors.blue400:g.colors.blue500}`,borderRadius:g.borders.borderRadiusSm,flexShrink:0,display:"flex",alignItems:"center"},""),children:(0,m.Y)(r.T.Text,{color:"primary",css:C,children:(0,m.FD)("span",{ref:f,css:M,children:[e.icon&&(0,m.Y)("span",{css:(0,s.AH)({flexShrink:0,"& > div":{height:g.general.buttonInnerHeight,borderTopRightRadius:0,borderBottomRightRadius:0}},""),children:e.icon}),(0,m.Y)("span",{css:(0,s.AH)({marginLeft:g.spacing.xs,color:g.colors.textPrimary},""),children:e.title})]})})}),(0,m.Y)("div",{css:(0,s.AH)({flex:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-flex",alignItems:"center",gap:g.spacing.xs,marginLeft:g.spacing.sm},""),children:(0,m.FD)("div",{css:(0,s.AH)({display:"inline-flex",alignItems:"center",backgroundColor:g.colors.backgroundSecondary,border:`1px solid ${g.colors.border}`,borderRadius:g.borders.borderRadiusSm,paddingRight:g.spacing.xs},""),children:[(0,m.Y)(r.T.Text,{color:"primary",css:E,children:(0,m.FD)("span",{ref:h,css:_,children:[e.icon&&(0,m.Y)("span",{css:(0,s.AH)({flexShrink:0,marginLeft:0,borderRight:`1px solid ${g.colors.border}`,"& > div":{height:g.general.buttonInnerHeight,borderTopRightRadius:0,borderBottomRightRadius:0}},""),children:e.icon}),(0,m.Y)("span",{css:(0,s.AH)({color:g.colors.textPrimary,marginLeft:g.spacing.xs},""),children:e.title})]})}),(0,m.Y)(r.T.Text,{color:"secondary",children:(0,m.Y)("span",{css:(0,s.AH)({marginLeft:g.spacing.xs},""),children:(0,a.X6)(e.end-e.start)})})]})})]},e.key)})};var R={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},k={name:"bjn8wh",styles:"position:relative"},D={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const F=({nodes:e,selectedKey:t,onSelect:n,traceStartTime:i,traceEndTime:l,expandedKeys:d,setExpandedKeys:c})=>{var u,p;const{theme:g}=(0,r.u)(),f=(0,o.useRef)(null),h=null!==(u=null===(p=(0,I.wY)({ref:f}))||void 0===p?void 0:p.width)&&void 0!==u?u:0,v=(0,o.useMemo)(()=>function(e,t,n,s=60){const o=t-e;if(o<=0||n<=0)return[];const r=Math.floor(n/s);if(r<1)return[];const i=o/r,a=Math.pow(10,Math.floor(Math.log10(i))),l=i/a;let d;d=l<=1?1:l<=2?2:l<=5?5:10;const c=d*a,u=t+2*c,m=[];for(let p=Math.ceil(e/c)*c;p<=u;p+=c)m.push(Number(p.toFixed(10)));return m}(i,l,h),[l,i,h]),y=Math.min(...v),x=(v[v.length-1]+v[v.length-2])/2,b=v.slice(0,-1),w=e=>function(e,t,n,s){return(e-t)/(n-t)*s}(e,y,x,h);return(0,m.FD)("div",{css:R,children:[(0,m.Y)("div",{ref:f,css:(0,s.AH)({display:"flex",width:"100%",flexDirection:"row",height:g.typography.lineHeightBase,paddingLeft:32,paddingRight:g.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:g.colors.backgroundPrimary,zIndex:a.u4.HIGH},""),children:(0,m.Y)("div",{"data-testid":"time-marker-area",css:k,children:b.map(e=>(0,m.Y)(r.T.Text,{css:(0,s.AH)({position:"absolute",transform:"translateX(-50%)",left:w(e),whiteSpace:"nowrap"},""),children:(0,a.X6)(e)},e))})}),(0,m.Y)("div",{css:(0,s.AH)({flex:1,pointerEvents:"none",zIndex:a.u4.LOW},""),children:(0,m.Y)("div",{css:D,children:b.map(e=>(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:w(e)+32,borderRight:`1px solid ${g.colors.border}`,height:"100%"},"")},e))})}),e.map(e=>{const s=w(e.start),o=w(e.end)-s;return(0,m.Y)(N,{selectedKey:t,onSelect:n,node:e,leftOffset:s,width:o,expandedKeys:d,setExpandedKeys:c},e.key)})]})};var O={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},L={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},H={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},V={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const $=({rootNodes:e,selectedNode:t,setSelectedNode:n,traceStartTime:l,traceEndTime:d,expandedKeys:c,setExpandedKeys:u,spanFilterState:p,setSpanFilterState:f,className:h})=>{const{theme:v}=(0,r.u)(),y=(0,o.useCallback)(e=>{null===n||void 0===n||n(e)},[n]),{showTimelineTreeGantt:x,setShowTimelineTreeGantt:b}=(0,S.nJ)(),w=(0,o.useMemo)(()=>(0,a.os)(e,c),[e,c]),Y=(0,o.useMemo)(()=>{var n;return(0,m.Y)("div",{css:O,children:x?(0,m.Y)(F,{nodes:w,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",onSelect:y,traceStartTime:l,traceEndTime:d,expandedKeys:c,setExpandedKeys:u}):e.map(e=>{var n;return(0,m.Y)(T,{node:e,expandedKeys:c,setExpandedKeys:u,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",traceStartTime:l,traceEndTime:d,onSelect:y,linesToRender:[]},e.key)})})},[x,w,null===t||void 0===t?void 0:t.key,y,l,d,e,c,u]);return(0,m.Y)("div",{css:(0,s.AH)({height:"100%",borderRadius:v.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:h,children:(0,m.Y)("div",{css:L,children:(0,m.FD)("div",{css:H,children:[(0,m.Y)(g,{showTimelineInfo:x,setShowTimelineInfo:b,spanFilterState:p,setSpanFilterState:f}),e.length>0?(0,m.Y)("div",{css:V,children:Y}):(0,m.Y)("div",{css:(0,s.AH)({flex:1,display:"flex",justifyContent:"center",padding:v.spacing.md,paddingTop:v.spacing.lg},""),children:(0,m.Y)(i.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})}},9636:function(e,t,n){n.d(t,{$:function(){return a},F:function(){return i}});var s=n(46709),o=n(73408);const r=s.createContext({renderRunJudgeModal:void 0,evaluations:void 0,subscribeToScorerFinished:void 0,reset:void 0}),i=({children:e,renderRunJudgeModal:t,evaluations:n,subscribeToScorerFinished:i,reset:a,scope:l})=>{const d=(0,s.useMemo)(()=>({renderRunJudgeModal:t,evaluations:n,subscribeToScorerFinished:i,reset:a,scope:l}),[t,n,i,a,l]);return(0,o.Y)(r.Provider,{value:d,children:e})},a=()=>s.useContext(r)},9858:function(e,t,n){n.d(t,{CY:function(){return g},G8:function(){return i},IX:function(){return a},OV:function(){return l},QO:function(){return v},VJ:function(){return c},W_:function(){return d},YH:function(){return r},wG:function(){return h},x2:function(){return f}});var s=n(76118),o=n(90448);const r={up:"#02B30214",down:"#F000400F"},i="#64172B",a="#077A9D",l="#FFAB00",d="#99DDB4",c="#FCA4A1",u="#02B30214",m={user_frustration:{name:"user_frustration",valueColors:{none:{bar:d,tag:u,icon:e=>e.isDarkMode?e.colors.green400:e.colors.green600,text:e=>e.isDarkMode?e.colors.green400:e.colors.green600},resolved:{bar:e=>e.colors.yellow400,tag:e=>e.isDarkMode?(0,o.fu)(e.colors.yellow800,.6):e.colors.yellow200,icon:e=>e.isDarkMode?e.colors.yellow400:e.colors.yellow600,text:e=>e.isDarkMode?e.colors.yellow400:e.colors.yellow600},unresolved:{bar:c,tag:e=>e.isDarkMode?(0,o.fu)(e.colors.red800,.6):e.colors.red200,icon:e=>e.isDarkMode?e.colors.red400:e.colors.red600,text:e=>e.isDarkMode?e.colors.red400:e.colors.red600}}}},p=(e,t,n)=>{const s=m[e.name];if(!s)return;const o=String(null!==t&&void 0!==t?t:""),r=s.valueColors[o];return r?{bar:"function"===typeof r.bar?r.bar(n):r.bar,tag:"function"===typeof r.tag?r.tag(n):r.tag,icon:"function"===typeof r.icon?r.icon(n):r.icon,text:"function"===typeof r.text?r.text(n):r.text}:void 0},g=(e,t,n)=>{const s=p(t,null===n||void 0===n?void 0:n.stringValue,e);if(null!==s&&void 0!==s&&s.icon)return s.icon;if("pass-fail"===t.dtype){if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES)return e.isDarkMode?e.colors.green400:e.colors.green600;if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO)return e.isDarkMode?e.colors.red400:e.colors.red600}return null!==n&&void 0!==n&&n.errorMessage?e.colors.textValidationWarning:e.colors.grey400},f=(e,t,n,r=!1)=>{const i=p(t,null===n||void 0===n?void 0:n.stringValue,e);if(null!==i&&void 0!==i&&i.tag)return i.tag;if("pass-fail"===t.dtype){if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES)return u;if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO)return e.isDarkMode?(0,o.fu)(e.colors.red800,.6):e.colors.red200;if(!r&&null!==n&&void 0!==n&&n.errorMessage)return""}else if("boolean"===t.dtype)return(0,s.isNil)(null===n||void 0===n?void 0:n.booleanValue)?"":n.booleanValue?u:e.isDarkMode?e.colors.red800:e.colors.red200;return""},h=(e,t,n)=>{if(null!==n&&void 0!==n&&n.errorMessage)return e.colors.textValidationWarning;const r=p(t,null===n||void 0===n?void 0:n.stringValue,e);return null!==r&&void 0!==r&&r.text?r.text:"pass-fail"===t.dtype?(null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES?e.isDarkMode?e.colors.green400:e.colors.green600:(null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO?e.isDarkMode?e.colors.red400:e.colors.red600:e.colors.textSecondary:"boolean"===t.dtype?(0,s.isNil)(null===n||void 0===n?void 0:n.booleanValue)?e.colors.textSecondary:e.colors.textPrimary:"unknown"===t.dtype?e.colors.textSecondary:e.colors.textPrimary},v=(e,t,n,r)=>{if(r)return"#f09065";const i=p(t,n,e);return null!==i&&void 0!==i&&i.bar?i.bar:"pass-fail"===t.dtype?n===o.gZ.YES?d:n===o.gZ.NO?c:e.isDarkMode?e.colors.grey800:e.colors.grey200:"boolean"===t.dtype?(0,s.isNil)(n)?e.isDarkMode?e.colors.grey800:e.colors.grey200:n?d:c:e.isDarkMode?e.colors.grey800:e.colors.grey200}},12129:function(e,t,n){n.d(t,{$U:function(){return o},fi:function(){return r},ko:function(){return i}});var s=n(16844);const o=e=>({type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}}),r=e=>{const[t,n]=e.split(".");return{type:"UC_SCHEMA",uc_schema:{catalog_name:t,schema_name:n}}},i=e=>{var t;return Boolean(e&&(0,s.gD)(e)&&"UC_SCHEMA"===(null===(t=e.trace_location)||void 0===t?void 0:t.type))}},13433:function(e,t,n){n.d(t,{G3:function(){return u},N5:function(){return c},TJ:function(){return v},UA:function(){return p},_A:function(){return h},aG:function(){return l},bU:function(){return d}});var s=n(59930),o=n.n(s),r=n(76118),i=n(33120),a=n(86125);const l=({traceId:e,assessmentId:t})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"DELETE"),d=({payload:e})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`),"POST",e),c=({traceId:e})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e}`)),u=({traceId:e,assessmentId:t,payload:n})=>(0,i.ff)((0,i.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"PATCH",n),m=async({traceIds:e,traceLocation:t})=>{const n=(0,r.isString)(t)?t:(0,a.nr)(t),s=(0,i.we)(`ajax-api/4.0/mlflow/traces/${n}/batchGet`),o=new URLSearchParams;for(const r of e)o.append("trace_ids",r);const l=`${s}?${o.toString()}`;return await(0,i.ff)(l,"GET")},p=({traceId:e})=>{const t=(0,i.we)("ajax-api/3.0/mlflow/traces/get"),n=new URLSearchParams;n.append("trace_id",e),n.append("allow_partial","true");const s=`${t}?${n.toString()}`;return(0,i.ff)(s,"GET")},g=e=>{const t=(0,i.we)("ajax-api/3.0/mlflow/get-trace-artifact"),n=new URLSearchParams;n.append("request_id",e);const s=`${t}?${n.toString()}`;return(0,i.ff)(s,"GET")},f=e=>{const t=(0,i.we)(`ajax-api/3.0/mlflow/traces/${e}`);return(0,i.ff)(t,"GET")},h={searchTracesV4:async({signal:e,orderBy:t,locations:n,filter:s,pageSize:o})=>{var r;const a={locations:n,filter:s,max_results:null!==o&&void 0!==o?o:1e3,order_by:t},l=await(0,i.ff)((0,i.we)("ajax-api/4.0/mlflow/traces/search"),"POST",a,e);return null!==(r=null===l||void 0===l?void 0:l.trace_infos)&&void 0!==r?r:[]},getBatchTracesV4:m,getTraceV4:async(e,t)=>{let n,s;if("string"===typeof e){const t=(0,a.iZ)(e);o()(null===t||void 0===t?void 0:t.trace_id,"Could not parse trace ID from serialized trace identifier"),o()(null===t||void 0===t?void 0:t.trace_location,"Could not parse trace location from serialized trace identifier"),n=t.trace_id,s=(0,a.M2)(t.trace_location)}else o()(e.trace_id,"Trace ID is required"),o()(e.trace_location,"Trace location is required"),n=e.trace_id,s=e.trace_location;const i=await m({traceIds:[n],traceLocation:s}),l=(0,r.first)(i.traces.map(e=>({info:e.trace_info,data:{spans:e.spans}})));return o()(l,"No trace found in response"),l},getTraceInfoV4:({traceId:e,traceLocation:t})=>{const n=(0,r.isString)(t)?t:(0,a.nr)(t),s=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${n}/${e}/info`)}?${(new URLSearchParams).toString()}`;return(0,i.ff)(s)},createAssessmentV4:({payload:{assessment:e},traceLocation:t})=>{o()(t,"Trace location is required for creating assessment via V4 API");const n=(0,r.isString)(t)?t:(0,a.nr)(t);o()(n,"Trace location could not be resolved");const s=e,l=new URLSearchParams,d=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${n}/${e.trace_id}/assessments`)}?${l.toString()}`;return(0,i.ff)(d,"POST",s)},updateAssessmentV4:({traceId:e,assessmentId:t,payload:n,traceLocation:s})=>{const{assessment:l,update_mask:d}=n;o()(s,"Trace location is required for updating assessment via V4 API");const c=(0,r.isString)(s)?s:(0,a.nr)(s);o()(c,"Trace location could not be resolved");const u=new URLSearchParams;u.append("update_mask",d);const m=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${c}/${e}/assessments/${t}`)}?${u.toString()}`;return(0,i.ff)(m,"PATCH",l)},deleteAssessmentV4:({traceId:e,sqlWarehouseId:t,assessmentId:n,traceLocation:s})=>{const l=new URLSearchParams;o()(s,"Trace location is required for deleting assessment via V4 API");const d=(0,r.isString)(s)?s:(0,a.nr)(s);o()(d,"Trace location could not be resolved");const c=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${d}/${e}/assessments/${n}`)}?${l.toString()}`;return(0,i.ff)(c,"DELETE")},setTraceTagV4:async({traceLocation:e,tag:t,traceId:n})=>{const s=(0,a.nr)(e),o=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${s}/${n}/tags`)}?${(new URLSearchParams).toString()}`;return(0,i.ff)(o,"PATCH",t)},deleteTraceTagV4:async({tagKey:e,traceId:t,traceLocation:n})=>{const s=(0,a.nr)(n),o=`${(0,i.we)(`ajax-api/4.0/mlflow/traces/${s}/${t}/tags/${encodeURIComponent(e)}`)}?${(new URLSearchParams).toString()}`;return(0,i.ff)(o,"DELETE")}},v={setTraceTagV3:async({tag:e,traceId:t})=>{const n=(0,i.we)(`ajax-api/3.0/mlflow/traces/${t}/tags`);return(0,i.ff)(n,"PATCH",e)},deleteTraceTagV3:async({tagKey:e,traceId:t})=>{const n=(0,i.we)(`ajax-api/3.0/mlflow/traces/${t}/tags`),s=new URLSearchParams;s.append("key",e);const o=`${n}?${s.toString()}`;return(0,i.ff)(o,"DELETE")},getTraceV3Info:f,getTraceV3Data:g,getTraceV3:async e=>{var t;const[n,s]=await Promise.all([f(e),g(e)]);return{info:null===n||void 0===n||null===(t=n.trace)||void 0===t?void 0:t.trace_info,data:s}}}},15376:function(e,t,n){n.d(t,{sR:function(){return d},wJ:function(){return r},xm:function(){return i}});n(76118);var s=n(16844),o=n(93241);const r="mlflow.simulation.goal",i="mlflow.simulation.persona",a=e=>{var t,n;return null!==(t=null===(n=e.trace_metadata)||void 0===n?void 0:n[s.n2])&&void 0!==t?t:null},l=(e,t)=>{if(t&&(0,o.I0)()){var n,s;const t=null===(n=e.trace_metadata)||void 0===n?void 0:n[r],o=null===(s=e.trace_metadata)||void 0===s?void 0:s[i];if(t&&o)return`metadata:${t}:${o}`}const l=a(e);return l?`session:${l}`:`unmatched:${e.trace_id}`},d=(e,t,n)=>{const s={},o=[],d=new Set;e.forEach(e=>{var t;const d=null===(t=e.currentRunValue)||void 0===t?void 0:t.traceInfo;if(!d)return;const c=l(d,n),u=a(d);if(u||c.startsWith("metadata:")){if(!s[c]){var m,p;const e=null===(m=d.trace_metadata)||void 0===m?void 0:m[r],t=null===(p=d.trace_metadata)||void 0===p?void 0:p[i];s[c]={sessionId:u||c,matchKey:c,currentTraces:[],otherTraces:[],goal:e,persona:t}}s[c].currentTraces.push(d)}else o.push(e)}),n&&e.forEach(e=>{var t;const c=null===(t=e.otherRunValue)||void 0===t?void 0:t.traceInfo;if(!c)return;const u=c.trace_id;if(d.has(u))return;d.add(u);const m=l(c,n),p=a(c);var g;if(p||m.startsWith("metadata:"))if(s[m])s[m].otherTraces.push(c),p&&p!==s[m].sessionId&&(s[m].otherSessionId=p);else{var f,h;const e=null===(f=c.trace_metadata)||void 0===f?void 0:f[r],t=null===(h=c.trace_metadata)||void 0===h?void 0:h[i];s[m]={sessionId:p||m,matchKey:m,currentTraces:[],otherTraces:[c],goal:e,persona:t}}else null!==(g=e.currentRunValue)&&void 0!==g&&g.traceInfo||o.push(e)});const c=[],u={};return Object.values(s).forEach(s=>{const{sessionId:o,otherSessionId:r,currentTraces:i,otherTraces:a,goal:l,persona:d}=s;if(0===i.length&&0===a.length)return;const m=i.toSorted((e,t)=>{var n,s;const o=null!==(n=e.request_time)&&void 0!==n?n:"",r=null!==(s=t.request_time)&&void 0!==s?s:"";return o.localeCompare(r)}),p=a.toSorted((e,t)=>{var n,s;const o=null!==(n=e.request_time)&&void 0!==n?n:"",r=null!==(s=t.request_time)&&void 0!==s?s:"";return o.localeCompare(r)});if(c.push({type:"sessionHeader",sessionId:o,otherSessionId:r,traces:m,otherTraces:n?p:void 0,goal:l,persona:d}),t.has(o)&&!n){const t=new Map(m.map((e,t)=>[e.trace_id,t]));e.filter(e=>{var n,s;const o=null===(n=e.currentRunValue)||void 0===n||null===(s=n.traceInfo)||void 0===s?void 0:s.trace_id;return o&&t.has(o)}).toSorted((e,n)=>{var s,o,r,i,a,l,d,c;return(null!==(s=t.get(null!==(o=null===(r=e.currentRunValue)||void 0===r||null===(i=r.traceInfo)||void 0===i?void 0:i.trace_id)&&void 0!==o?o:""))&&void 0!==s?s:0)-(null!==(a=t.get(null!==(l=null===(d=n.currentRunValue)||void 0===d||null===(c=d.traceInfo)||void 0===c?void 0:c.trace_id)&&void 0!==l?l:""))&&void 0!==a?a:0)}).forEach((e,t)=>{var n,s;c.push({type:"trace",data:e});const o=null===(n=e.currentRunValue)||void 0===n||null===(s=n.traceInfo)||void 0===s?void 0:s.trace_id;o&&(u[o]=t+1)})}}),o.forEach(e=>{c.push({type:"trace",data:e})}),{groupedRows:c,traceIdToTurnMap:u}}},15756:function(e,t,n){n.d(t,{GQ:function(){return vr},rc:function(){return Q.rc},tj:function(){return Q.tj},tl:function(){return J.tl},sp:function(){return zi},_p:function(){return Ai},sG:function(){return U},w_:function(){return bi},o8:function(){return o.o8},tU:function(){return $t},js:function(){return Fr},dD:function(){return J.dD},d6:function(){return Q.d6},Te:function(){return Q.Te},Rl:function(){return Q.Rl},TH:function(){return zr},yX:function(){return Q.yX},Gq:function(){return Q.Gq},RC:function(){return Q.RC},$W:function(){return Q.$W},Pn:function(){return Q.Pn},YO:function(){return Q.YO},XQ:function(){return Q.XQ},w8:function(){return J.w8},$6:function(){return J.$6},$U:function(){return Zo.$U},pR:function(){return K.pR},XJ:function(){return ce},zl:function(){return W.zl},h:function(){return W.h},Mq:function(){return W.Mq},d9:function(){return W.d9},BL:function(){return jr},kO:function(){return qr},I0:function(){return K.I0},R7:function(){return Ii},Xz:function(){return Lr},Ie:function(){return Ur},Wx:function(){return Ki},KW:function(){return Kr},Zn:function(){return Wr},K0:function(){return Ir},GY:function(){return k}});var s=n(76118),o=n(33481);const r=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[o.bz.IS_OVERALL_ASSESSMENT])},i=e=>{var t;return(0,s.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[o.bz.CHUNK_INDEX])},a=e=>Array.isArray(e)&&e.every(e=>(0,s.isPlainObject)(e)&&"doc_uri"in e&&"content"in e),l=e=>Object.values(e||{}).find(a),d=(e,t,n)=>{const r=l(e)||[],i=l(t);return r.map((e,t)=>{const r=null===i||void 0===i?void 0:i[t],a=(n||[]).filter(e=>(e.metadata||{})[o.bz.CHUNK_INDEX]===t),l=(0,s.groupBy)(a,"name");return Object.keys(l).forEach(e=>{l[e]=(0,s.orderBy)(l[e],"timestamp","desc")}),{docUrl:e.doc_uri,content:e.content,retrievalAssessmentsByName:l,target:null===r||void 0===r?void 0:r.content}})};function c(e){if(!e)return;const{columns:t,data:n,filename:o}=e;if(!t||!Array.isArray(t))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "columns" array`);if(!n||!Array.isArray(n))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "data" array`);const r=t.map((e,t)=>null!==e&&void 0!==e?e:`column_${t}`);return n.map(e=>(0,s.zipObject)(r,e))}var u=n(9858),m=n(46709),p=n(58024),g=n(27637),f=n(73408);const h="workspace",v=()=>{if("undefined"===typeof window)return null;try{return window.localStorage.getItem("mlflow.activeWorkspace")}catch{return null}},y=["/settings"],x=e=>{const t=e.split("?")[0].split("#")[0];return y.some(e=>t===e||t.startsWith(e+"/"))},b=e=>{if("string"!==typeof e||0===e.length)return e;if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e))return e;const t=e.startsWith("#")?"#":"",n=t?e.slice(1):e;if(!(""!==t||n.startsWith("/")))return e;let s=n,o="";const r=s.indexOf("#");r>=0&&(s=s.slice(0,r));const i=s.indexOf("?");i>=0&&(o=s.slice(i+1),s=s.slice(0,i));const a=new URLSearchParams(o).has(h);if(x(s||"/"))return(e=>{const t=e.startsWith("#")?"#":"";let n=t?e.slice(1):e,s="",o="";const r=n.indexOf("#");r>=0&&(o=n.slice(r),n=n.slice(0,r));const i=n.indexOf("?");i>=0&&(s=n.slice(i+1),n=n.slice(0,i));const a=new URLSearchParams(s);a.delete(h);const l=a.toString();return`${t}${n}${l?"?"+l:""}${o}`})(e);if(a)return e;const l=v();return l?((e,t)=>{const n=e.startsWith("#")?"#":"";let s=n?e.slice(1):e,o="",r="";const i=s.indexOf("#");i>=0&&(r=s.slice(i),s=s.slice(0,i));const a=s.indexOf("?");a>=0&&(o=s.slice(a+1),s=s.slice(0,a));const l=new URLSearchParams(o);return l.set(h,t),`${n}${s}?${l.toString()}${r}`})(e,l):e},w=e=>{if("string"===typeof e)return b(e);if("object"===typeof e&&null!==e){const t="pathname"in e?e.pathname:void 0;if("string"!==typeof t)return e;if(x(t)){if(e.search){const t=new URLSearchParams(e.search);t.delete(h);const n=t.toString();return{...e,search:n?`?${n}`:void 0}}return e}const n=v();if(!n)return e;const s=e.search||"",o=new URLSearchParams(s.startsWith("?")?s.slice(1):s);return o.set(h,n),{...e,search:`?${o.toString()}`}}return e},S=p.zy,Y=g.ok,A=m.forwardRef(function(e,t){const{to:n,disableWorkspacePrefix:s,...o}=e,r=s?n:w(n);return(0,f.Y)(g.N_,{ref:t,to:r,...o})}),T="assessmentFilter";function I(e){if("undefined"!==e)return"true"===e||"false"!==e&&e}function C(e,t){if("pass-fail"===e.dtype){if("undefined"===t)return;return t}return"boolean"===e.dtype?"true"===t||"false"!==t&&void 0:t}function M(e){return void 0===e||null===e?"undefined":`${e}`}var E=n(90448);const _="sort",N=()=>{const[e,t]=Y();return[(0,m.useMemo)(()=>{const t=e.get(_);if(!t)return;const[n,s,o]=t.split("::");return n&&s&&o?{key:n,type:s,asc:"true"===o}:void 0},[e]),(0,m.useCallback)((e,n=!1)=>{t(t=>(t.delete(_),e&&t.set(_,[e.key,e.type,e.asc].join("::")),t),{replace:n})},[t])]};var R=n(27882);const k=(e,t)=>{const n=(0,R.GK)(),[s,o]=N(),[r,i]=(0,m.useState)(t&&e.find(e=>e.id===t.key)?t:void 0);return[(0,m.useMemo)(()=>{let o;if(o=n?s&&e.find(e=>e.id===s.key)?s:t:r,o&&e.find(e=>e.id===o.key))return o},[n,s,t,r,e]),(0,m.useCallback)(e=>{n?o(e,!1):i(e)},[n,o,i])]};var D=n(68248),F=n(27757),O=n(82716),L=n(66916),H=n(79081),V=n(42747),$=n(16844);const B=(0,m.createContext)({table:void 0,setTable:()=>{},selectedRowIds:[],setSelectedRowIds:()=>{},isGroupedBySession:!1}),U=({children:e,experimentId:t,isGroupedBySession:n=!1})=>{const[o,r]=(0,m.useState)(),[i,a]=(0,m.useState)([]),[l,d]=(0,m.useState)(!1),[c,u]=(0,m.useState)(void 0),{renderExportTracesToDatasetsModal:p}=(0,$.SO)(),g=(0,m.useCallback)(e=>{u(e),d(!(0,s.isUndefined)(e))},[]),h=(0,m.useMemo)(()=>({table:o,setTable:r,selectedRowIds:i,setSelectedRowIds:a,isGroupedBySession:n,showAddToEvaluationDatasetModal:g}),[o,i,n,g]);return(0,f.FD)(B.Provider,{value:h,children:[e,null===p||void 0===p?void 0:p({selectedTraceInfos:c?(0,s.compact)(c.map(e=>e.traceInfo)):[],experimentId:null!==t&&void 0!==t?t:"",visible:l,setVisible:d})]})};var z=n(25862);const j=({traceIds:e,onClose:t})=>{const{theme:n}=(0,F.u)(),{data:o,isLoading:r}=(0,$.y5)(e,undefined),i=(0,m.useMemo)(()=>(0,s.compact)(o),[o]);return(0,f.Y)(z.q.Root,{open:!0,modal:!0,onOpenChange:e=>{e||null===t||void 0===t||t()},children:(0,f.Y)(z.q.Content,{componentId:"mlflow.evaluations_review.modal",width:"90vw",title:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:(0,f.Y)(F.T.Title,{level:2,withoutMargins:!0,children:(0,f.Y)(V.sA,{id:"FbFEvH",defaultMessage:"Comparing {count} traces",values:{count:e.length}})})}),expandContentToFullHeight:!0,css:[{"&>div":{overflow:"hidden"},"&>div:first-of-type":{paddingLeft:n.spacing.md}},""],children:r||!i||0===i.length?(0,f.Y)($.Fn,{}):(0,f.Y)($.rH,{modelTraces:i,css:(0,D.AH)({marginLeft:-n.spacing.lg,marginRight:-n.spacing.lg},"")})})})},P=({experimentIds:e,visible:t,selectedTraces:n,handleClose:s,deleteTraces:o})=>{const r=(0,V.tz)(),[i,a]=(0,m.useState)(""),[l,d]=(0,m.useState)(!1),c=n.map(e=>e.evaluationId);return(0,f.FD)(H.d,{componentId:"eval-tab.delete_traces-modal",title:(0,f.Y)(V.sA,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:c.length}}),visible:t,onCancel:s,okText:(0,f.Y)(V.sA,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:c.length}}),onOk:()=>{(async()=>{try{var t;await o(null!==(t=e[0])&&void 0!==t?t:"",c),s()}catch(n){a(r.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}d(!1)})(),d(!0)},okButtonProps:{loading:l,danger:!0},children:[i&&(0,f.Y)(F.T.Paragraph,{color:"error",children:i}),(0,f.Y)(F.T.Paragraph,{children:(0,f.Y)(F.T.Text,{bold:!0,children:(0,f.Y)(V.sA,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:c.length}})})}),(0,f.Y)(F.T.Paragraph,{children:(0,f.Y)(V.sA,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})};var K=n(93241),W=n(71540);const q=e=>{const{traceActions:t,experimentId:n,selectedTraces:o,traceInfos:r,setRowSelection:i,sqlWarehouseId:a}=e,{table:l,selectedRowIds:d}=(0,m.useContext)(B),c=(0,m.useMemo)(()=>(0,W.Co)(d.map(e=>{const t=null===r||void 0===r?void 0:r.find(t=>(0,W.h2)(t)===e);if(t)return{evaluationId:t.trace_id,requestId:t.client_request_id||t.trace_id,inputsId:t.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:t}}).filter(e=>!(0,s.isNil)(e))),[d,r]),u=o||c;return(0,f.Y)(G,{experimentId:n,selectedTraces:u,traceActions:t,setRowSelection:null!==i&&void 0!==i?i:null===l||void 0===l?void 0:l.setRowSelection,sqlWarehouseId:a})},G=e=>{var t,n,o;const{experimentId:r,selectedTraces:i,traceActions:a,setRowSelection:l,sqlWarehouseId:d}=e,c=(0,V.tz)(),[u,p]=(0,m.useState)(!1),[g,h]=(0,m.useState)(!1),v=(0,$.eA)(),{showAddToEvaluationDatasetModal:y}=(0,m.useContext)(B),x=(0,m.useCallback)(()=>{1===i.length&&i[0].traceInfo&&null!==a&&void 0!==a&&a.editTags&&a.editTags.showEditTagsModalForTrace(i[0].traceInfo)},[i,a]),b=(0,m.useCallback)(()=>{p(!0)},[]),w=(0,m.useCallback)(()=>{h(!0)},[]),S=(0,m.useCallback)(()=>{h(!1)},[]),Y=(0,m.useCallback)(async(e,t)=>{var n,s;await(null===a||void 0===a||null===(n=a.deleteTracesAction)||void 0===n||null===(s=n.deleteTraces)||void 0===s?void 0:s.call(n,e,t)),null===l||void 0===l||l({})},[l,a]),A=Boolean(null===a||void 0===a?void 0:a.exportToEvals),T=(0,K.ij)()&&Boolean(null===a||void 0===a?void 0:a.editTags),I=Boolean(null===a||void 0===a?void 0:a.deleteTracesAction),C=i.length>1,M=0===i.length,E=!A&&!T&&!I,_=i.length>=2&&i.length<4;if(E)return null;const N=(0,f.Y)(F.B,{componentId:"mlflow.genai-traces-table.actions-dropdown",disabled:M,type:"primary",endIcon:(0,f.Y)(O.ChevronDownIcon,{}),children:c.formatMessage({id:"PwQiIn",defaultMessage:"Actions{count}"},{count:M?"":` (${i.length})`})});return(0,f.FD)(f.FK,{children:[(0,f.FD)(O.DropdownMenu.Root,{children:[M?(0,f.Y)(H.T,{componentId:"mlflow.genai-traces-table.actions-disabled-tooltip",content:c.formatMessage({id:"HbgpOU",defaultMessage:"Select one or more traces to add to an evaluation or edit the traces."}),children:(0,f.Y)("div",{children:(0,f.Y)(O.DropdownMenu.Trigger,{disabled:!0,asChild:!0,children:N})})}):(0,f.Y)(O.DropdownMenu.Trigger,{asChild:!0,children:N}),(0,f.FD)(O.DropdownMenu.Content,{children:[v&&(0,f.FD)(f.FK,{children:[(0,f.Y)(O.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.compare-traces",onClick:w,disabled:!_,children:c.formatMessage({id:"HrDWRj",defaultMessage:"Compare"})}),(0,f.Y)(O.DropdownMenu.Separator,{})]}),A&&(0,f.Y)(f.FK,{children:(0,f.FD)(O.DropdownMenu.Group,{children:[(0,f.Y)(O.DropdownMenu.Label,{children:c.formatMessage({id:"xiFkTH",defaultMessage:"Use for evaluation"})}),(0,f.Y)(O.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.export-to-datasets",onClick:()=>{null===y||void 0===y||y(i)},children:c.formatMessage({id:"QcEYpD",defaultMessage:"Add to evaluation dataset"})})]})}),(T||I)&&(0,f.FD)(f.FK,{children:[A&&(0,f.Y)(O.DropdownMenu.Separator,{}),(0,f.FD)(O.DropdownMenu.Group,{children:[(0,f.Y)(O.DropdownMenu.Label,{children:c.formatMessage({id:"gerwuf",defaultMessage:"Edit"})}),T&&(0,f.Y)(O.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.edit-tags",onClick:x,disabled:C,children:c.formatMessage({id:"A7jptW",defaultMessage:"Edit tags"})}),I&&(0,f.Y)(O.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.delete-traces",onClick:b,disabled:null===a||void 0===a||null===(t=a.deleteTracesAction)||void 0===t?void 0:t.isDisabled,disabledReason:null===a||void 0===a||null===(n=a.deleteTracesAction)||void 0===n?void 0:n.disabledReason,children:c.formatMessage({id:"G6CJOv",defaultMessage:"Delete traces"})})]})]})]})]}),null===a||void 0===a||null===(o=a.editTags)||void 0===o?void 0:o.EditTagsModal,u&&(null===a||void 0===a?void 0:a.deleteTracesAction)&&(0,f.Y)(P,{experimentIds:[r],visible:u,selectedTraces:i,handleClose:()=>p(!1),deleteTraces:Y}),g&&(0,f.Y)(j,{traceIds:(0,s.compact)(i.map(e=>{var t,n;return null!==(t=e.fullTraceId)&&void 0!==t?t:null===(n=e.traceInfo)||void 0===n?void 0:n.trace_id})),onClose:S})]})};var Q=n(4947),J=n(64667),Z=n(15376);const X=[J.w8.INFO,J.w8.ASSESSMENT,J.w8.EXPECTATION,J.w8.TAG],ee=[Q.XQ,Q.d6,Q.Rl,Q.yX,Q.tP,Q.LV,Q.im,Q.YO],te=[o._1.OVERALL_ASSESSMENT],ne=Object.fromEntries(X.map((e,t)=>[e,t])),se=Object.fromEntries(ee.map((e,t)=>[e,t])),oe=Object.fromEntries(te.map((e,t)=>[e,t]));function re(e,t,n){return[...e].sort((e,s)=>{var o,r;if(n){if(e.id===Q.yX)return-1;if(s.id===Q.yX)return 1}if(n){const t=e.id===Q.jN||e.id===Q.mq,n=s.id===Q.jN||s.id===Q.mq;if(t&&!n)return-1;if(!t&&n)return 1;if(e.id===Q.jN&&s.id===Q.mq)return-1;if(e.id===Q.mq&&s.id===Q.jN)return 1}if(t){if(e.id===Q.d6)return-1;if(s.id===Q.d6)return 1}const i=null!==(o=e.group)&&void 0!==o?o:J.w8.INFO,a=null!==(r=s.group)&&void 0!==r?r:J.w8.INFO,l=ne[i]-ne[a];if(0!==l)return l;if(i===J.w8.INFO){var d,c;const t=null!==(d=se[e.id])&&void 0!==d?d:1/0,n=null!==(c=se[s.id])&&void 0!==c?c:1/0;return t!==n?t-n:e.label.localeCompare(s.label)}if(i===J.w8.ASSESSMENT){var u,m;const t=null!==(u=oe[e.id])&&void 0!==u?u:1/0,n=null!==(m=oe[s.id])&&void 0!==m?m:1/0;return t!==n?t-n:e.label.localeCompare(s.label)}return J.w8.EXPECTATION,e.label.localeCompare(s.label)})}const ie=(e,t)=>e.sort((e,n)=>{const s=e=>{var n;const s=null===(n=t.find(t=>t.id===e.id))||void 0===n?void 0:n.type;return s===J.$6.INPUT?1:e.id===Q.LV?2:s===J.$6.TRACE_INFO?3:s===J.$6.INTERNAL_MONITOR_REQUEST_TIME?4:s===J.$6.ASSESSMENT?5:999},r=s(e)-s(n);if(0!==r)return r;const i=t.find(t=>t.id===e.id),a=t.find(e=>e.id===n.id);return(null===i||void 0===i?void 0:i.type)===J.$6.ASSESSMENT&&(null===a||void 0===a?void 0:a.type)===J.$6.ASSESSMENT?i.id===o._1.OVERALL_ASSESSMENT?-1:a.id===o._1.OVERALL_ASSESSMENT?1:(i.label||"").localeCompare(a.label||""):0}),ae=(e,t)=>{var n,s,o,r;switch(t){case Q.Te:case Q.tj:case Q.Pn:case Q.$W:return e[t];case Q.FW:return e.tags;case Q.XQ:return e.trace_id;case Q.yX:return null===(n=e.tags)||void 0===n?void 0:n["mlflow.trace.session"];case Q.VC:return null===(s=e.tags)||void 0===s?void 0:s["mlflow.linkedPrompts"];case Q.jN:return null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.simulation.goal"];case Q.mq:return null===(r=e.trace_metadata)||void 0===r?void 0:r["mlflow.simulation.persona"];default:return null}};function le(e){const t=new Map,n=new Map;return null===e||void 0===e||e.forEach(e=>{let s=(0,W.ZS)([e])?(0,W.h)(e.traceInfo):e.inputsId;if(t.has(s)){const t=(n.get(e.inputsId)||0)+1;n.set(e.inputsId,t),s=`${e.inputsId}_${t}`}t.set(s,e)}),t}function de(e,t){if((0,s.isNil)(t))return e.map(e=>({currentRunValue:e}));const n=le(t),o=le(e),r=new Set([...o.keys(),...n.keys()]);return Array.from(r).map(e=>({currentRunValue:o.get(e),otherRunValue:n.get(e)}))}function ce(e,t,n){if(0===e.length)return[];let s=!1,o=!1;for(const c of e){var r,i;if(!s&&null!==(r=c.trace_metadata)&&void 0!==r&&r[Z.wJ]&&(s=!0),!o&&null!==(i=c.trace_metadata)&&void 0!==i&&i[Z.xm]&&(o=!0),s&&o)break}if(!s&&!o)return[];const a=[],l=t.find(e=>e.id===Q.jN),d=t.find(e=>e.id===Q.mq);return s&&l&&!n.some(e=>e.id===Q.jN)&&a.push(l),o&&d&&!n.some(e=>e.id===Q.mq)&&a.push(d),a}var ue=n(90061),me=n(49460),pe=n(76256),ge=n(49708);const fe=()=>{const{theme:e}=(0,F.u)();return(0,f.FD)("span",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:"12px",height:"12px"},color:e.colors.textValidationWarning},""),children:[(0,f.Y)(F.k,{css:(0,D.AH)({color:e.colors.textValidationWarning},"")}),(0,f.Y)(V.sA,{id:"HdEgbb",defaultMessage:"Error"})," "]})};var he={name:"rhxkjj",styles:"height:20px"};const ve=({isComparing:e})=>{const{theme:t}=(0,F.u)();return(0,f.Y)("span",{css:he,children:e&&(0,f.Y)("span",{css:(0,D.AH)({fontStyle:"italic",color:t.colors.textSecondary},""),children:"null"})})},ye=e=>{const{first:t,second:n,gap:s,borderRadius:o,marginY:r}=e,{theme:i}=(0,F.u)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:s||i.spacing.sm,borderRadius:o||i.legacyBorders.borderRadiusMd,marginTop:r||"auto",marginBottom:r||"auto"},""),children:[t,n]})};var xe=n(28816),be=n(67689);const we=e=>{const t=(e=>{const t="mlflow-request-header-",n=xe.parse(e);return n&&0!==Object.keys(n).length?Object.keys(n).filter(e=>e.startsWith(t)).reduce((e,t)=>({...e,[t.substring(22)]:n[t]}),{}):{}})(e),n=(()=>{if(!(0,be.Bg)())return null;if("undefined"===typeof window)return null;try{return window.localStorage.getItem("mlflow.activeWorkspace")}catch{return null}})();return{...t,...n?{"X-MLFLOW-WORKSPACE":n}:{}}},Se=e=>e,Ye=async(e,t={})=>{const{method:n,headers:s,body:o,...r}=t;let i="";"undefined"!==typeof document&&"string"===typeof document.cookie&&(i=document.cookie||"");const a={...r,method:n||"GET",headers:{...we(i),...o?{"Content-Type":"application/json"}:{},...s},...o&&{body:(e=>{if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)})(o)}},l=await fetch(e,a);if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);return l.json()},Ae=async(e,t,n,s)=>Ye(e,{method:t,body:n,signal:s});var Te=n(19926);const Ie=e=>{var t,n;const{experimentId:s,currentTraceInfo:o,otherTraceInfo:r,isComparing:i}=e,a=null===o||void 0===o||null===(t=o.trace_metadata)||void 0===t?void 0:t["mlflow.modelId"],l=null===r||void 0===r||null===(n=r.trace_metadata)||void 0===n?void 0:n["mlflow.modelId"];return(0,f.Y)(ye,{first:a?(0,f.Y)(_e,{experimentId:s,modelId:a,isComparing:i}):(0,f.Y)(ve,{isComparing:i}),second:i&&(l?(0,f.Y)(_e,{experimentId:s,modelId:l,isComparing:i}):(0,f.Y)(ve,{isComparing:i}))})};var Ce={name:"1puasmx",styles:"width:fit-content;max-width:100%;margin-right:0;cursor:pointer"},Me={name:"1it2kpr",styles:"max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ee={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const _e=e=>{var t;const{experimentId:n,modelId:s,isComparing:o}=e,{theme:r}=(0,F.u)(),{data:i,isLoading:a,error:l}=Ne({loggedModelId:s}),d=null===i||void 0===i||null===(t=i.info)||void 0===t?void 0:t.name;return a?(0,f.Y)(O.ParagraphSkeleton,{}):l?(0,f.Y)(fe,{}):d?(0,f.Y)(H.T,{componentId:"mlflow.eval-runs.model-version-cell-tooltip",content:d,children:(0,f.Y)(O.Tag,{componentId:"mlflow.eval-runs.model-version-cell",id:"model-version-cell",css:Ce,children:(0,f.Y)(A,{to:Te.A.getLoggedModelPageRoute(n,s),target:"_blank",css:Me,title:d,children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs,maxWidth:"100%"},""),children:[(0,f.Y)(O.ModelsIcon,{css:(0,D.AH)({color:r.colors.textPrimary,fontSize:16},"")}),(0,f.Y)(F.T.Text,{css:Ee,children:d})]})})})}):(0,f.Y)(ve,{isComparing:o})},Ne=({loggedModelId:e})=>{const{data:t,isLoading:n,isFetching:o,refetch:r,error:i}=(0,ge.I)({queryKey:["loggedModelName",e],queryFn:async()=>await Ae(`ajax-api/2.0/mlflow/logged-models/${e}`,"GET"),cacheTime:1/0,staleTime:1/0,refetchOnMount:!1,retry:1,enabled:!(0,s.isNil)(e)});return{isLoading:n,isFetching:o,data:null===t||void 0===t?void 0:t.model,refetch:r,error:i}};var Re={name:"pzwiqy",styles:"display:flex;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const ke=e=>{var t,n,s;const{experimentId:o,runUuid:r}=e,{data:i,isLoading:a,error:l}=De(o,r),d=null===i||void 0===i||null===(t=i.runs)||void 0===t||null===(n=t[0])||void 0===n||null===(s=n.info)||void 0===s?void 0:s.run_name;return a?(0,f.Y)(O.ParagraphSkeleton,{}):l?(0,f.Y)(fe,{}):d?(0,f.Y)(A,{css:Re,to:Te.A.getRunPageRoute(o,r),title:d,children:d}):(0,f.Y)(ve,{})},De=(e,t)=>(0,ge.I)({queryKey:["runName",e,t],cacheTime:1/0,staleTime:1/0,retry:1,refetchOnMount:!1,queryFn:async()=>{const n=`run_id IN ('${t}')`;return await Ae("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e],filter:n})}}),Fe=({sessionId:e,experimentId:t,traceId:n,children:s})=>{const o=Te.A.getExperimentChatSessionPageRoute(t,e),r=n?`${o}?${new URLSearchParams({[$.hb]:n}).toString()}`:o;return(0,f.Y)(A,{to:r,children:s})};var Oe=function(e){return e.NOTEBOOK="NOTEBOOK",e.JOB="JOB",e.PROJECT="PROJECT",e.LOCAL="LOCAL",e.UNKNOWN="UNKNOWN",e}(Oe||{});const Le=({sourceType:e,className:t})=>e===Oe.NOTEBOOK?(0,f.Y)(O.NotebookIcon,{className:t}):e===Oe.LOCAL?(0,f.Y)(O.HomeIcon,{className:t}):e===Oe.PROJECT?(0,f.Y)(O.FolderBranchIcon,{className:t}):e===Oe.JOB?(0,f.Y)(O.WorkflowsIcon,{className:t}):null;var He={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Ve=e=>{var t;const n=e.traceInfo.tags,{theme:s}=(0,F.u)();if(!n)return(0,f.Y)(ve,{isComparing:e.isComparing});const o=null===(t=e.traceInfo.trace_metadata)||void 0===t?void 0:t[Te.A.sourceTypeTag],r=Te.A.renderSourceFromMetadata(e.traceInfo);return r&&o?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center",...e.disableLinks&&{"& a":{pointerEvents:"none",color:"inherit",textDecoration:"none",cursor:"default"}}},""),children:[(0,f.Y)(Le,{sourceType:o,css:(0,D.AH)({color:s.colors.textSecondary},"")}),(0,f.Y)("span",{css:He,children:r})]}):(0,f.Y)(ve,{isComparing:e.isComparing})},$e={STATE_UNSPECIFIED:null,IN_PROGRESS:(0,V.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,V.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,V.zR)({id:"igK5Su",defaultMessage:"Error"})},Be=(e,t)=>"IN_PROGRESS"===e?(0,f.Y)(L.C,{css:(0,D.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,f.Y)(O.CheckCircleIcon,{css:(0,D.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,f.Y)(O.XCircleIcon,{css:(0,D.AH)({color:t.colors.textValidationDanger},"")}):null,Ue=({original:e,isComparing:t})=>{const{theme:n}=(0,F.u)(),s=(0,V.tz)(),o=$e[(null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED"];return o?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[Be((null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED",n),o?s.formatMessage(o):""]}):(0,f.Y)(ve,{isComparing:t})};var ze=n(12998);const{Paragraph:je}=F.T;var Pe={name:"s5xdrg",styles:"display:flex;align-items:center"},Ke={name:"1ff36h2",styles:"flex-grow:1"};const We=m.memo(e=>{const{theme:t}=(0,F.u)();return(0,f.Y)(H.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,f.FD)("div",{css:Pe,children:[(0,f.Y)(je,{css:Ke,children:(0,f.Y)("pre",{css:(0,D.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,f.Y)("div",{css:(0,D.AH)({marginBottom:t.spacing.md},""),children:(0,f.Y)(ze.ad,{componentId:"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button",copyText:e.tagValue})})]})})});function qe(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const Ge=({isClosable:e=!1,onClose:t,tag:n,enableFullViewModal:s=!1,charLimit:o=30,maxWidth:r=300,className:i})=>{const a=(0,V.tz)(),[l,d]=(0,m.useState)(!1),{shouldTruncateKey:c,shouldTruncateValue:u}=function(e,t=30){const{key:n,value:s}=e,o=n.length+s.length,r=n.length>s.length,i=r?s.length:n.length;return o<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:i>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:r,shouldTruncateValue:!r}}(n,o),p=s&&(c||u),g=a.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,f.FD)("div",{children:[(0,f.Y)(O.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:n.key,className:i,children:(0,f.Y)(H.T,{componentId:"web-shared.genai-traces-table.key-value-tag.full-view-tooltip",content:p?(0,f.Y)("span",{children:g}):void 0,children:(0,f.FD)("span",{css:(0,D.AH)({maxWidth:r,display:"inline-flex"},""),onClick:()=>p?d(!0):void 0,children:[(0,f.Y)(F.T.Text,{bold:!0,title:n.key,css:qe(c),children:n.key}),n.value&&(0,f.FD)(F.T.Text,{title:n.value,css:qe(u),children:[": ",n.value]})]})})}),(0,f.Y)("div",{children:l&&(0,f.Y)(We,{tagKey:n.key,tagValue:n.value,isKeyValueTagFullViewModalVisible:l,setIsKeyValueTagFullViewModalVisible:d})})]})};var Qe={name:"1wcfv52",styles:"margin-right:0"},Je={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const Ze=({onAddEditTags:e,tags:t,baseComponentId:n})=>{const{theme:s}=(0,F.u)(),o=(null===t||void 0===t?void 0:t.filter(({key:e})=>e&&!e.startsWith(W.nt)))||[],r=o.length>0;return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:s.spacing.xs,rowGap:s.spacing.xs},""),children:[o.map(e=>(0,f.Y)(Ge,{tag:e,css:Qe,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key)),e&&(0,f.Y)(F.B,{componentId:"mlflow.tags_cell_renderer.traces_table.edit_tag",size:"small",icon:r?(0,f.Y)(O.PencilIcon,{}):void 0,onClick:e,children:r?void 0:(0,f.Y)(V.sA,{id:"vHNP+J",defaultMessage:"Add tags"}),css:Je,type:"tertiary"})]})};const Xe=e=>{const{currentTraceInfo:t,otherTraceInfo:n,isComparing:s}=e,o=t?(0,$.m4)(t):void 0,r=n?(0,$.m4)(n):void 0;return(0,f.Y)(ye,{first:(0,f.Y)(pt,{inputTokens:null===o||void 0===o?void 0:o.input_tokens,outputTokens:null===o||void 0===o?void 0:o.output_tokens,totalTokens:null===o||void 0===o?void 0:o.total_tokens,cachedInputTokens:null===o||void 0===o?void 0:o.cache_read_input_tokens,cacheCreationInputTokens:null===o||void 0===o?void 0:o.cache_creation_input_tokens,isComparing:s}),second:s&&(0,f.Y)(pt,{inputTokens:null===r||void 0===r?void 0:r.input_tokens,outputTokens:null===r||void 0===r?void 0:r.output_tokens,totalTokens:null===r||void 0===r?void 0:r.total_tokens,cachedInputTokens:null===r||void 0===r?void 0:r.cache_read_input_tokens,cacheCreationInputTokens:null===r||void 0===r?void 0:r.cache_creation_input_tokens,isComparing:s})})};var et={name:"58t467",styles:"width:fit-content;max-width:100%"},tt={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},nt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},st={name:"ho1qnd",styles:"display:flex;flex-direction:row"},ot={name:"i9sky5",styles:"width:35%"},rt={name:"ho1qnd",styles:"display:flex;flex-direction:row"},it={name:"i9sky5",styles:"width:35%"},at={name:"ho1qnd",styles:"display:flex;flex-direction:row"},lt={name:"i9sky5",styles:"width:35%"},dt={name:"ho1qnd",styles:"display:flex;flex-direction:row"},ct={name:"i9sky5",styles:"width:35%"},ut={name:"ho1qnd",styles:"display:flex;flex-direction:row"},mt={name:"i9sky5",styles:"width:35%"};const pt=({inputTokens:e,outputTokens:t,totalTokens:n,cachedInputTokens:s,cacheCreationInputTokens:o,isComparing:r})=>{const i=(0,V.tz)();return n?(0,f.Y)(O.HoverCard,{trigger:(0,f.Y)(O.Tag,{css:et,componentId:"mlflow.genai-traces-table.tokens",children:(0,f.Y)("span",{css:tt,children:n})}),content:(0,f.FD)("div",{css:nt,children:[n&&(0,f.FD)("div",{css:st,children:[(0,f.Y)("div",{css:ot,children:(0,f.Y)(F.T.Text,{children:i.formatMessage({id:"83wDn8",defaultMessage:"Total"})})}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Text,{color:"secondary",children:n})})]}),e&&(0,f.FD)("div",{css:rt,children:[(0,f.Y)("div",{css:it,children:(0,f.Y)(F.T.Text,{children:i.formatMessage({id:"Y7DzTT",defaultMessage:"Input"})})}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Text,{color:"secondary",children:e})})]}),t&&(0,f.FD)("div",{css:at,children:[(0,f.Y)("div",{css:lt,children:(0,f.Y)(F.T.Text,{children:i.formatMessage({id:"tGqJL4",defaultMessage:"Output"})})}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Text,{color:"secondary",children:t})})]}),null!==s&&void 0!==s&&s>0&&(0,f.FD)("div",{css:dt,children:[(0,f.Y)("div",{css:ct,children:(0,f.Y)(F.T.Text,{children:i.formatMessage({id:"NQYTBb",defaultMessage:"Cached"})})}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Text,{color:"secondary",children:s})})]}),null!==o&&void 0!==o&&o>0&&(0,f.FD)("div",{css:ut,children:[(0,f.Y)("div",{css:mt,children:(0,f.Y)(F.T.Text,{children:i.formatMessage({id:"UawNBQ",defaultMessage:"Cache write"})})}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Text,{color:"secondary",children:o})})]})]})}):(0,f.Y)(ve,{isComparing:r})},gt="Error";function ft(e){return Boolean((null===e||void 0===e?void 0:e.errorCode)||(null===e||void 0===e?void 0:e.errorMessage))}function ht(e){const t=e.split("/");return 1===t.length?{metricName:e,assessmentName:e}:2===t.length?{metricName:t[0],assessmentName:t[1]}:{metricName:t[1],assessmentName:t.slice(2).join("/")}}const vt=[E.gZ.YES,E.gZ.NO];function yt(e,t,n){var o;const r={},i={[E._1.OVERALL_ASSESSMENT]:"pass-fail"},a=new Set;[...t,...n||[]].forEach(e=>{var t;const n=Object.entries(e.responseAssessmentsByName||{}),o=e.overallAssessments.map(e=>[E._1.OVERALL_ASSESSMENT,[e]]),r=[];null===(t=e.retrievalChunks)||void 0===t||t.forEach(e=>{for(const[t,n]of Object.entries(e.retrievalAssessmentsByName||{}))r.push([t,n])});for(const[l,d]of[...n,...o,...r]){let e;a.add(l);for(const t of d)if(e=(0,s.isNil)(t.stringValue)?(0,s.isNil)(t.numericValue)?(0,s.isNil)(t.booleanValue)?void 0:"boolean":"numeric":"pass-fail",void 0!==e)break;i[l]||(l in E.c9&&(e="pass-fail"),i[l]=e);for(const t of d)if("pass-fail"===e&&!(0,s.isNil)(t.stringValue)&&!vt.includes(t.stringValue)){i[l]="string";break}void 0!==e&&e!==i[l]&&(i[l]="string")}});for(const s of a)i[s]||(i[s]="unknown");[...t,...n||[]].forEach(t=>{var n;const o=Object.entries(t.responseAssessmentsByName||{}),a=t.overallAssessments.map(e=>[E._1.OVERALL_ASSESSMENT,[e]]),l=[];null===(n=t.retrievalChunks)||void 0===n||n.forEach(e=>{for(const[t,n]of Object.entries(e.retrievalAssessmentsByName||{}))l.push([t,n])});const d=Object.keys(i);for(const h of d){const t=[...o.filter(([e])=>e===h),...a.filter(([e])=>e===h),...l.filter(([e])=>e===h)].flatMap(([e,t])=>t),n=t[0],d=ft(n),v=t.some(e=>{var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t[$.K6]});if((0,s.isNil)(r[h])){var c,u,m;let s,o,a=!1;const g=void 0!==E.c9[h];if(g)s=e.formatMessage(E.c9[h]),o=h,a=!1;else{var p;const{metricName:e,assessmentName:t}=ht(h);s=t||"-",o=e,"CODE"===(null===n||void 0===n||null===(p=n.source)||void 0===p?void 0:p.sourceType)&&(a=!0)}const f=i[h]||"string",y=(0,E.FN)(E.pZ[h]),x=h in E.jr?e.formatMessage(E.jr[h]):"",b=h in E.mS?e.formatMessage(E.mS[h]):"HUMAN"===(null===n||void 0===n||null===(c=n.source)||void 0===c?void 0:c.sourceType)?e.formatMessage({id:"z94r4F",defaultMessage:"This assessment is produced by a human judge."}):e.formatMessage({id:"lQ2nDn",defaultMessage:"This assessment is produced by a custom metric."}),w=new Set;0===t.length&&w.add(void 0);for(const e of t){let t=e?(0,E.Zh)(e):void 0;null===t&&(t=void 0),w.add(t)}r[h]={name:h,displayName:s,isKnown:g,metricName:o,isCustomMetric:a,source:null===n||void 0===n?void 0:n.source,dtype:f,uniqueValues:w,isOverall:h===E._1.OVERALL_ASSESSMENT,docsLink:y,missingTooltip:x,description:b,isEditable:"AI_JUDGE"===(null===n||void 0===n||null===(u=n.source)||void 0===u?void 0:u.sourceType)||"HUMAN"===(null===n||void 0===n||null===(m=n.source)||void 0===m?void 0:m.sourceType),isRetrievalAssessment:l.some(([e])=>e===h),containsErrors:d,isSessionLevelAssessment:v}}else{const e=r[h];0===t.length&&e.uniqueValues.add(void 0);for(const n of t){let t=n?(0,E.Zh)(n):void 0;(0,s.isNil)(t)&&(t=void 0),e.uniqueValues.add(t)}var g,f;if(!e.isEditable)e.isEditable="AI_JUDGE"===(null===n||void 0===n||null===(g=n.source)||void 0===g?void 0:g.sourceType)||"HUMAN"===(null===n||void 0===n||null===(f=n.source)||void 0===f?void 0:f.sourceType);e.isRetrievalAssessment=e.isRetrievalAssessment||l.some(([e])=>e===h),e.containsErrors=e.containsErrors||d,e.isSessionLevelAssessment=e.isSessionLevelAssessment||v}}});const l=(null===(o=r[E._1.OVERALL_ASSESSMENT])||void 0===o?void 0:o.uniqueValues)||new Set;return l.has(E.gZ.YES)||l.has(E.gZ.NO)||delete r[E._1.OVERALL_ASSESSMENT],xt(Object.values(r))}function xt(e){return e.sort((e,t)=>{const n=E.kp.indexOf(e.name),s=E.kp.indexOf(t.name);return-1!==n&&-1!==s?n-s:-1!==n?-1:-1!==s?1:e.name.localeCompare(t.name)})}function bt(e,t){if("numeric"!==e.dtype)return;return function(e){if(0===e.length)return;const t=[],n=Math.min(...e),s=Math.max(...e),o=Math.max(.01,(s-n)/10);let r=0;if(n===s)t.push({lower:n,upper:s,count:e.length});else for(let i=n;i<s;i+=o)t.push({lower:i,upper:Math.min(i+o,s),count:0});t.sort((e,t)=>e.lower-t.lower);for(const i of e){const e=t.find(e=>i>=e.lower&&(i<e.upper||i===e.upper&&i===s));e&&(e.count++,r=Math.max(r,e.count))}return{min:n,max:s,maxCount:r,counts:t}}(t.flatMap(t=>{const n=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name];return null===n||void 0===n?void 0:n.map(e=>(0,E.Zh)(e)).filter(e=>void 0!==e&&"number"===typeof e)}).filter(e=>!(0,s.isNil)(e)))}function wt(e,t){if("numeric"===e.dtype)return;const n=new Map;return t.forEach(t=>{const s=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name],o=s&&s.length>0?Et(e,s):[{value:void 0,count:1}],r=e.containsErrors?[gt,...e.uniqueValues]:e.uniqueValues;for(const e of r){const t=o.find(t=>t.value===e),s=t?t.count:0;n.set(e,(n.get(e)||0)+s)}}),n}function St(e,t){if("numeric"!==e.dtype)return;const n=[];return t.forEach(t=>{const o=e.isOverall?(0,s.first)(t.overallAssessments):(0,s.first)(t.responseAssessmentsByName[e.name]);if(o){const e=(0,E.Zh)(o);(0,s.isNil)(e)||n.push(Number(e))}}),n}function Yt(e,t){let n=0;return t.forEach(t=>{var o;if((0,s.isNil)(t))return;const r=(0,s.first)(t.overallAssessments);(null===r||void 0===r||null===(o=r.rootCauseAssessment)||void 0===o?void 0:o.assessmentName)===e.name&&n++}),n}function At(e,t,n){const o=t.map(e=>e.currentRunValue).filter(e=>!(0,s.isNil)(e)),r=t.map(e=>e.otherRunValue).filter(e=>!(0,s.isNil)(e)),i=wt(e,o),a=wt(e,r),l=bt(e,o),d=n.filter(t=>t.assessmentName===e.name);return{assessmentInfo:e,currentCounts:i,otherCounts:a,currentNumericValues:St(e,o),otherNumericValues:St(e,r),currentNumericAggregate:l,currentNumRootCause:Yt(e,o),otherNumRootCause:Yt(e,r),assessmentFilters:d}}function Tt(e,t=new Map){if("pass-fail"===e.dtype||"boolean"===e.dtype){let n=0,o=0;for(const[r,i]of t)Ut(e,r)&&(o+=i),(0,s.isNil)(r)||r===gt||(n+=i);return n>0?o/n:0}return 0}function It(e,t,n,s,o,r,i){let a=0;const l=s===gt||void 0===s;for(const[u,m]of o)void 0!==u&&u!==gt&&(a+=m);const d=o.get(s)||0,c=!l&&a>0?d/a:0;return{value:o.get(s)||0,fraction:c,isSelected:n.some(e=>e.filterValue===s&&e.assessmentName===t.name&&e.run===r),toggleFilter:()=>i(t.name,s,r,undefined),tooltip:l?e.formatMessage({id:"joh88n",defaultMessage:'{numValue} for run "{runName}"'},{numValue:d,runName:r}):e.formatMessage({id:"jjidVr",defaultMessage:'{numValue}/{numEvals} for run "{runName}"'},{numValue:d,numEvals:a,runName:r})}}function Ct(e){const t=function(e){const t=Array.from(e.uniqueValues);if("pass-fail"===e.dtype){t.includes(E.gZ.YES)||t.push(E.gZ.YES),t.includes(E.gZ.NO)||t.push(E.gZ.NO);const e=[E.gZ.YES,E.gZ.NO];return t.sort((t,n)=>e.indexOf(t)-e.indexOf(n))}if("boolean"===e.dtype)return t.sort((e,t)=>!0===e?-1:1);return t.sort()}(e);return e.containsErrors&&t.push(gt),t}function Mt(e,t,n,o){return"pass-fail"===n.dtype?o===E.gZ.YES?e.formatMessage({id:"nDVJ/n",defaultMessage:"Pass"}):o===E.gZ.NO?e.formatMessage({id:"7Dhfxy",defaultMessage:"Fail"}):o===gt?e.formatMessage({id:"gPWxlB",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):"boolean"===n.dtype?!0===o?e.formatMessage({id:"1Ujhc3",defaultMessage:"True"}):!1===o?e.formatMessage({id:"nvjkTA",defaultMessage:"False"}):o===gt?e.formatMessage({id:"oM11pD",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):(0,s.isNil)(o)?"null":`${o}`}function Et(e,t){const n=t.filter(t=>t.name===e.name);let s=new Set;for(const a of n){const e=(0,E.Zh)(a);s.add(e)}n.sort((e,t)=>(t.timestamp||0)-(e.timestamp||0));const o=n.filter(e=>ft(e)),r=n.filter(e=>!ft(e));s=new Set;for(const a of r){const e=(0,E.Zh)(a);s.add(e)}const i=[];for(const a of s){const e=n.filter(e=>(0,E.Zh)(e)===a),t=e.length;i.push({value:a,count:t,latestAssessment:e[0]})}return o.length>0&&i.push({value:gt,count:o.length,latestAssessment:o[0]}),i}function _t(e,t=1){return Number((100*e).toFixed(t)).toString()}function Nt(e,t=3){if((0,s.isNil)(e))return"null";const n=Math.pow(10,t);return(Math.round(e*n)/n).toString()}function Rt(e,t,n=!0){if("numeric"===e.dtype){return"up"===(t>0?"up":"down")?`+${Nt(t,2)}`:`-${Nt(t,2)}`}{const e=t>=0?"up":"down";return n?"up"===e?`+${_t(t,0)}%`:`-${_t(-1*t,0)}%`:"up"===e?`+${t}`:`-${t}`}}function kt(e,t=new Date){const n=Math.max(0,Math.floor((t-e)/1e3));let s=Math.floor(n/31536e3);return s>=1?(0,f.Y)(V.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:s}}):(s=Math.floor(n/2592e3),s>=1?(0,f.Y)(V.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:s}}):(s=Math.floor(n/86400),s>=1?(0,f.Y)(V.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:s}}):(s=Math.floor(n/3600),s>=1?(0,f.Y)(V.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:s}}):(s=Math.floor(n/60),s>=1?(0,f.Y)(V.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:s}}):(0,f.Y)(V.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))}function Dt(e){return e.replace(/([!"#$%&'()*+,\.\/:;\s<=>?@[\\\]^`{|}~])/g,"\\$1")}var Ft={name:"v9dpuc",styles:"background-color:var(--trace-search-highlight-bg, rgba(255, 212, 0, 0.35));padding:0;margin:0"};function Ot(e,t){if(!e||null===t||void 0===t||!t.trim())return e;const n=t.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");const s=new RegExp(`(${n})`,"gi"),o=e.split(s);return o.length<=1?e:(0,f.Y)(f.FK,{children:o.map((e,t)=>t%2===1?(0,f.Y)("mark",{css:Ft,children:e},t):(0,f.Y)(m.Fragment,{children:e},t))})}function Lt(e,t){return function(e,t,n=[],s){let o=Number(e);if(isNaN(o)||!isFinite(o))return{value:"",numericValue:void 0,unit:"",divisor:1};let r=0,i=1;for(;o>=t&&r<n.length-1;)o/=t,i*=t,r+=1;return{value:Ht(o,s),numericValue:o,unit:n[r],divisor:i}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function Ht(e,t=3){return Math.round(e)!==e?e.toFixed(t):e.toString()}const Vt=m.createContext({makeHTML:e=>e}),$t=({children:e,makeHtml:t})=>(0,f.Y)(Vt.Provider,{value:{makeHTML:t},children:e}),Bt=()=>m.useContext(Vt);const Ut=(e,t)=>{if(!(0,s.isNil)(t))if("pass-fail"===e.dtype){if(t===E.gZ.YES)return!0;if(t===E.gZ.NO)return!1}else if("boolean"===e.dtype)return!0===t};var zt={name:"1jwcxx3",styles:"font-style:italic"},jt={name:"1jwcxx3",styles:"font-style:italic"};var Pt={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Kt={name:"1ykowef",styles:"margin-bottom:0"},Wt={name:"6jwybp",styles:"height:16px"},qt={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Gt=({assessment:e,onEdit:t,active:n=!1,disableJudgeTypeIcon:o,showRationaleInTooltip:r=!1,showPassFailText:i=!1,hideAssessmentName:a=!1,iconOnly:l=!1,disableTooltip:d=!1,isRootCauseAssessment:c,assessmentInfo:p,type:g,count:h})=>{var v,y;const{theme:x}=(0,F.u)(),b=(0,V.tz)(),w=e?(0,E.Zh)(e):void 0,S=(0,m.useMemo)(()=>Ut(p,w),[w,p]),Y=(0,u.CY)(x,p,e),A=(0,u.wG)(x,p,e);let T;(null!==e&&void 0!==e&&e.errorMessage||void 0===S&&e&&E.jr[e.name])&&(T=e.errorMessage||b.formatMessage(E.jr[e.name]));const I=e?E.c9[e.name]:void 0,C=(0,m.useMemo)(()=>I?b.formatMessage(I):null===e||void 0===e?void 0:e.name,[e,I,b]),M=(0,m.useMemo)(()=>e?(0,E.FN)(E.pZ[e.name]):void 0,[e]),{makeHTML:_}=Bt(),N=(0,m.useMemo)(()=>{const t=null===e||void 0===e?void 0:e.rationale;return(0,s.isString)(t)?_(t):void 0},[e,_]),R=(0,m.useMemo)(()=>!(0,s.isNil)(e)&&(0,E.w_)(e),[e]),{tagText:k,icon:$,fullTagText:B}=(0,m.useMemo)(()=>function(e,t,n,o,r,i,a){let l,d="",c=(0,f.Y)(f.FK,{});const m={tagText:(0,f.Y)(V.sA,{id:"AX7L9r",defaultMessage:"Error"}),icon:(0,f.Y)(F.k,{css:(0,D.AH)({color:e.colors.textValidationWarning},"")})},p={tagText:(0,f.Y)("span",{css:zt,children:(0,f.Y)(V.sA,{id:"H2UIIZ",defaultMessage:"null"})}),icon:(0,f.Y)(F.W,{css:(0,D.AH)({color:e.colors.grey400},"")})},g=i?(0,E.Zh)(i):void 0;if(Boolean(null===i||void 0===i?void 0:i.errorMessage))return m;if("pass-fail"===o.dtype||"boolean"===o.dtype){const r=Ut(o,g);let l="";if("pass-fail"===o.dtype)if(!0===r)l=t.formatMessage({id:"Kya8N3",defaultMessage:"Pass"});else{if(!1!==r)return p;l=t.formatMessage({id:"bz4brG",defaultMessage:"Fail"})}else if(!0===r)l=t.formatMessage({id:"lo5Me/",defaultMessage:"True"});else{if(!1!==r)return p;l=t.formatMessage({id:"OZXWas",defaultMessage:"False"})}const m=(0,u.CY)(e,o,i);if(c=!0===r?(0,f.Y)(O.CheckCircleIcon,{css:(0,D.AH)({color:m},"")}):!1===r?a?(0,f.Y)(L.X,{css:(0,D.AH)({color:m},"")}):(0,f.Y)(O.XCircleIcon,{css:(0,D.AH)({color:m},"")}):(0,f.Y)(F.W,{css:(0,D.AH)({color:m},"")}),"assessment-value"===n){const e=E.yQ[o.name];if(e){var h;const t=g&&null!==(h=e[g.toString()])&&void 0!==h?h:e[E.gZ.YES];t&&(d=(0,f.Y)(V.sA,{...t,values:{value:g}}))}else d=(0,f.FD)(f.FK,{children:[o.displayName,": ",g]})}else"value"===n&&(d=(0,s.isNil)(r)?(0,f.Y)("span",{css:jt,children:l}):l)}else if("numeric"===o.dtype){const e=(0,s.isNil)(g)?g:Nt(g);if("assessment-value"===n)d=(0,f.FD)(f.FK,{children:[o.displayName,": ",e]}),l=(0,f.FD)(f.FK,{children:[o.displayName,": ",g]});else{if((0,s.isNil)(e))return p;d=`${e}`,l=`${g}`}}else{if((0,s.isNil)(g))return p;const e=(0,f.Y)(f.FK,{children:String(g)});d="assessment-value"===n?(0,s.isNil)(g)?(0,f.Y)(f.FK,{children:o.displayName}):(0,f.FD)(f.FK,{children:[o.displayName,": ",e]}):e}return{tagText:d,icon:c,fullTagText:l}}(x,b,g,p,0,e,c),[x,b,g,p,e,c,R]),U=(0,f.FD)(f.FK,{children:[k,h&&h>1?` (${h})`:""]});if("HUMAN"===(null===(v=p.source)||void 0===v?void 0:v.sourceType)&&!(null!==e&&void 0!==e&&null!==(y=e.source)&&void 0!==y&&y.sourceId))return(0,f.Y)(f.FK,{});const z=(0,f.Y)("div",{children:(0,f.Y)(Qt,{iconOnly:l,hideAssessmentName:a,tagContent:U,active:n,icon:$,iconColor:Y,textColor:A,sourceIcon:p.isCustomMetric?(0,f.Y)(O.BracketsXIcon,{}):e&&R?(0,f.Y)(O.UserIcon,{}):(0,f.Y)(O.SparkleDoubleIcon,{}),backgroundColor:(0,u.x2)(x,p,e),disableSourceTypeIcon:o&&!R,hasBeenEditedByHuman:R,onEdit:t})});return(0,f.Y)(f.FK,{children:d?z:(0,f.Y)(O.HoverCard,{side:"bottom",content:(0,f.FD)("div",{css:(0,D.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:x.spacing.sm},""),children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:x.spacing.xs},""),children:[(0,f.FD)("div",{css:Pt,children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:x.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(F.T.Title,{css:Kt,children:C}),(0,f.Y)(Qt,{iconOnly:l,hideAssessmentName:a,tagContent:B||U,active:n,icon:$,iconColor:Y,textColor:A,sourceIcon:p.isCustomMetric?(0,f.Y)(O.BracketsXIcon,{}):e&&(0,E.w_)(e)?(0,f.Y)(O.UserIcon,{}):(0,f.Y)(O.SparkleDoubleIcon,{}),backgroundColor:(0,u.x2)(x,p,e),disableSourceTypeIcon:o,hasBeenEditedByHuman:R})]}),M&&(0,f.Y)("a",{href:M,target:"_blank",rel:"noreferrer",css:Wt,children:(0,f.Y)(H.I,{})})]}),c&&(0,f.Y)(F.T.Hint,{children:b.formatMessage({id:"QEL+JO",defaultMessage:"This assessment is the root cause of the overall evaluation failure."})})]}),r&&e&&N&&(0,f.Y)("div",{children:(0,f.Y)(f.FK,{children:(0,f.Y)("span",{css:qt,dangerouslySetInnerHTML:{__html:N}})})}),T&&(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:x.spacing.xs},""),children:(0,f.Y)("span",{css:(0,D.AH)({color:x.colors.textValidationWarning,fontStyle:"italic"},""),children:T})})]}),trigger:z})})},Qt=({iconOnly:e,hideAssessmentName:t,tagContent:n,active:s,sourceIcon:o,icon:r,iconColor:i,textColor:a,backgroundColor:l,disableSourceTypeIcon:d,hasBeenEditedByHuman:c,onEdit:u})=>{const{theme:m}=(0,F.u)(),p=e?18:12;return(0,f.FD)("div",{css:(0,D.AH)({display:"inline-flex",height:e?p:20,width:e?p:t?"fit-content":"",justifyContent:"space-between",alignItems:"center",padding:e?"0":u?"0 0 0 8px":"0 8px",gap:m.spacing.sm,borderRadius:e?"50%":m.legacyBorders.borderRadiusMd,backgroundColor:l,boxShadow:`inset 0 0 1px 1px ${s?m.colors.borderAccessible:"transparent"}`,fontSize:m.typography.fontSizeSm,svg:{width:p,height:p},whiteSpace:"nowrap"},""),children:[r,n&&(0,f.Y)("span",{css:(0,D.AH)({color:a},""),children:n}),!0!==d?(0,f.Y)("span",{css:(0,D.AH)({color:i},""),children:o}):(0,f.Y)(f.FK,{}),u&&(0,f.Y)(F.B,{componentId:"mlflow.evaluations_review.edit_assessment_button",onClick:u,size:"small",icon:(0,f.Y)(O.PencilIcon,{css:(0,D.AH)({":hover":{color:m.colors.actionDefaultTextHover}},"")})})]})};var Jt={name:"1wr4ndu",styles:"width:12px;height:12px;border-radius:6px;flex-shrink:0;border:1px solid rgba(0, 0, 0, 0.1);cursor:default;position:relative"},Zt={name:"mvtt3w",styles:"clip:rect(0px, 0px, 0px, 0px);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px"};const Xt=m.memo(({color:e,hidden:t})=>(0,f.Y)("label",{css:Jt,style:{backgroundColor:e,display:t?"none":""},children:(0,f.Y)("span",{css:Zt,children:e})}));function en(e,t,n){return e?t.formatDate(e,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",...n}):""}var tn={name:"6dhm9o",styles:"visibility:hidden"};const nn=(e,t,n,o,r)=>{var i,a,l,d,c,u,m,p,g,h,v,y,x,b;const w=o.name,S={currentValue:(0,s.first)(null===(i=r.currentRunValue)||void 0===i?void 0:i.responseAssessmentsByName[w]),otherValue:(0,s.first)(null===(a=r.otherRunValue)||void 0===a?void 0:a.responseAssessmentsByName[w])},Y=Et(o,(null===(l=r.currentRunValue)||void 0===l?void 0:l.responseAssessmentsByName[w])||[]),A=(null===(d=r.currentRunValue)||void 0===d||null===(c=d.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===w,T=(null===(m=r.otherRunValue)||void 0===m||null===(p=m.overallAssessments[0])||void 0===p||null===(g=p.rootCauseAssessment)||void 0===g?void 0:g.assessmentName)===w,I=S.currentValue?(0,E.Zh)(S.currentValue):void 0,C=S.otherValue?(0,E.Zh)(S.otherValue):void 0,M=function(e,t,n){if("pass-fail"===e.dtype)return t===n?"equal":t===E.gZ.YES?"greater":t===E.gZ.NO?"less":(0,s.isNil)(n)?"equal":"less";if("boolean"===e.dtype)return t===n?"equal":!0===t?"greater":!1===t?"less":(0,s.isNil)(n)?"equal":"less";if("string"===e.dtype){if(t===n)return"equal";if(null===t)return"less";if(null===n)return"greater";const e=t,o=n;return(0,s.isNil)(e)?"less":(0,s.isNil)(o)||1===e.toString().localeCompare(o.toString())?"greater":"less"}if("numeric"===e.dtype){if(t===n)return"equal";if(null===t)return"less";if(null===n)return"greater";return t>n?"greater":"less"}return"equal"}(o,(0,s.isNil)(I)?void 0:I,(0,s.isNil)(C)?void 0:C),_=C!==I,N=E.jr[w];return(0,f.Y)("div",{css:(0,D.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center",marginTop:"auto",marginBottom:"auto"},""),children:n?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,borderRadius:e.legacyBorders.borderRadiusMd,marginTop:"auto",marginBottom:"auto"},""),children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(Gt,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:S.currentValue,isRootCauseAssessment:A,assessmentInfo:o,type:"value"},`tag_${null===(h=r.currentRunValue)||void 0===h?void 0:h.evaluationId}_${null===(v=S.currentValue)||void 0===v?void 0:v.name}`),_&&(0,f.Y)(O.ArrowRightIcon,{css:(0,D.AH)({transform:"greater"===M?"rotate(-45deg)":"rotate(45deg)",color:e.colors.textSecondary},"")})]}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(Gt,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:S.otherValue,isRootCauseAssessment:T,assessmentInfo:o,type:"value"},`tag_${null===(y=r.otherRunValue)||void 0===y?void 0:y.evaluationId}_${null===(x=S.currentValue)||void 0===x?void 0:x.name}`),_&&(0,f.Y)(O.ArrowRightIcon,{css:tn})]})]}):S.currentValue?(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:Y.map(e=>{const t=e.latestAssessment,n=e.count;return(0,f.Y)(Gt,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:t,isRootCauseAssessment:A,assessmentInfo:o,type:"value",count:n},`tag_${e.latestAssessment.name}_${e.value}`)})}):(0,f.Y)(Gt,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,isRootCauseAssessment:A,assessmentInfo:o,assessment:{name:w,rationale:N?t.formatMessage(N):t.formatMessage({id:"gOUJ0f",defaultMessage:"No assessment for this evaluation"}),source:{sourceId:"",sourceType:"AI_JUDGE",metadata:{}},stringValue:null,booleanValue:null,rootCauseAssessment:null,numericValue:null,timestamp:null,metadata:{}},type:"value"},`tag_${w}_${null===(b=r.currentRunValue)||void 0===b?void 0:b.evaluationId}`)})},sn=({isComparing:e,assessmentInfo:t,comparisonEntry:n})=>{const{theme:s}=(0,F.u)(),o=(0,V.tz)(),{isGroupedBySession:r}=(0,m.useContext)(B);return r&&t.isSessionLevelAssessment?(0,f.Y)(ve,{}):nn(s,o,e,t,n)};var on={name:"36bnqj",styles:"display:flex;flex:1"},rn={name:"36bnqj",styles:"display:flex;flex:1"};var an={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},ln={name:"1jwcxx3",styles:"font-style:italic"},dn={name:"zjik7",styles:"display:flex"},cn={name:"1suksrg",styles:"width:12px;height:12px"},un={name:"zjik7",styles:"display:flex"},mn={name:"1suksrg",styles:"width:12px;height:12px"};var pn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},gn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},fn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},hn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},vn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},yn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},xn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},bn={name:"58t467",styles:"width:fit-content;max-width:100%"},wn={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Sn={name:"58t467",styles:"width:fit-content;max-width:100%"},Yn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},An={name:"58t467",styles:"width:fit-content;max-width:100%"},Tn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},In={name:"58t467",styles:"width:fit-content;max-width:100%"},Cn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Mn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},En={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},_n={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Nn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Rn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},kn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Dn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Fn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},On={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ln={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Hn=120,Vn=120;const $n=e=>{let t=e;try{var n,o;const a=JSON.parse(e).response.choices;var r,i;if(Array.isArray(a)&&!(0,s.isNil)(null===(n=a[0])||void 0===n||null===(o=n.message)||void 0===o?void 0:o.content))t=null===(r=a[0])||void 0===r||null===(i=r.message)||void 0===i?void 0:i.content;else t=(0,E.ng)(e)}catch{t=(0,E.ng)(e)}return t},Bn=(e,{evaluationInputs:t,isComparing:n,theme:o,intl:r,experimentId:i,onChangeEvaluationId:a,onTraceTagsEdit:l})=>{const d={header:e.label,id:e.id,accessorFn:e=>e};switch(e.type){case J.$6.INPUT:return{...d,sortingFn:(t,n)=>{var s,o,r,i,a,l,d,c;const u=t.getValue(e.id),m=n.getValue(e.id),p={request:(null===(s=u.currentRunValue)||void 0===s?void 0:s.inputs[e.id])||(null===(o=u.otherRunValue)||void 0===o?void 0:o.inputs[e.id])||"",evalId:(null===(r=u.currentRunValue)||void 0===r?void 0:r.evaluationId)||(null===(i=u.otherRunValue)||void 0===i?void 0:i.evaluationId)||""},g={request:(null===(a=m.currentRunValue)||void 0===a?void 0:a.inputs[e.id])||(null===(l=m.otherRunValue)||void 0===l?void 0:l.inputs[e.id])||"",evalId:(null===(d=m.currentRunValue)||void 0===d?void 0:d.evaluationId)||(null===(c=m.otherRunValue)||void 0===c?void 0:c.evaluationId)||""};return JSON.stringify(p).localeCompare(JSON.stringify(g))},size:300/t.length,minSize:120,cell:t=>{var s,r,i;return((e,t,n,s,o,r)=>{var i,a,l,d,c,m,p,g,h,v;const y=t.getValue(),x=(null===(i=y.currentRunValue)||void 0===i?void 0:i.evaluationId)||(null===(a=y.otherRunValue)||void 0===a?void 0:a.evaluationId),b=null===(l=y.currentRunValue)||void 0===l||null===(d=l.traceInfo)||void 0===d||null===(c=d.trace_metadata)||void 0===c?void 0:c[W.kQ],w=null===(m=y.otherRunValue)||void 0===m||null===(p=m.traceInfo)||void 0===p||null===(g=p.trace_metadata)||void 0===g?void 0:g[W.kQ],S=r&&b?r(b):u.IX,Y=r&&w?r(w):u.OV,A=y.currentRunValue?(0,E.Qq)(y.currentRunValue,o):void 0,T=y.otherRunValue?(0,E.Qq)(y.otherRunValue,o):void 0,I=A||T,C=null===t||void 0===t||null===(h=t.table)||void 0===h||null===(v=h.options)||void 0===v?void 0:v.meta,M=null===C||void 0===C?void 0:C.searchQuery,_=I&&M?Ot(String(I),M):I;return(0,f.FD)("div",{css:(0,D.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"space-between",gap:s.spacing.sm},""),children:[(0,f.Y)(F.T.Link,{css:an,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>{var t;return e(x,null===(t=y.currentRunValue)||void 0===t?void 0:t.traceInfo)},children:_||(0,f.Y)("span",{css:ln,children:"null"})}),n&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:s.spacing.md},""),children:[(0,f.Y)("div",{css:dn,children:b?(0,f.Y)(Xt,{color:S}):(0,f.Y)("div",{css:cn})}),(0,f.Y)("div",{css:un,children:w?(0,f.Y)(Xt,{color:Y}):(0,f.Y)("div",{css:mn})})]})]})})(a,t,n,o,e.id,null===t||void 0===t||null===(s=t.table)||void 0===s||null===(r=s.options)||void 0===r||null===(i=r.meta)||void 0===i?void 0:i.getRunColor)}};case J.$6.ASSESSMENT:return{...d,accessorFn:t=>({isComparing:n,assessmentInfo:e.assessmentInfo,comparisonEntry:t}),sortingFn:(t,n)=>{const{comparisonEntry:o}=t.getValue(e.id),{comparisonEntry:r}=n.getValue(e.id);if(e.assessmentInfo){var i,a,l,d,c,u,m,p;const t={currentValue:null===(i=o.currentRunValue)||void 0===i||null===(a=i.responseAssessmentsByName[e.assessmentInfo.name])||void 0===a?void 0:a[0],otherValue:null===(l=o.otherRunValue)||void 0===l||null===(d=l.responseAssessmentsByName[e.assessmentInfo.name])||void 0===d?void 0:d[0]},n={currentValue:null===(c=r.currentRunValue)||void 0===c||null===(u=c.responseAssessmentsByName[e.assessmentInfo.name])||void 0===u?void 0:u[0],otherValue:null===(m=r.otherRunValue)||void 0===m||null===(p=m.responseAssessmentsByName[e.assessmentInfo.name])||void 0===p?void 0:p[0]};return function(e,t,n){const o=t.currentValue?(0,E.Zh)(t.currentValue):void 0,r=n.currentValue?(0,E.Zh)(n.currentValue):void 0,i=t.otherValue?(0,E.Zh)(t.otherValue):void 0,a=n.otherValue?(0,E.Zh)(n.otherValue):void 0;if("pass-fail"===e.dtype){const e=i===E.gZ.YES&&o===E.gZ.NO,s=a===E.gZ.YES&&r===E.gZ.NO,l=i===E.gZ.NO&&o===E.gZ.YES,d=a===E.gZ.NO&&r===E.gZ.YES,c=i===E.gZ.NO&&o===E.gZ.NO,u=a===E.gZ.NO&&r===E.gZ.NO,m=i===E.gZ.YES&&o===E.gZ.YES,p=a===E.gZ.YES&&r===E.gZ.YES;return e&&!s?-1:!e&&s?1:c&&!u?-1:!c&&u?1:l&&!d?-1:!l&&d?1:m&&!p?-1:!m&&p?1:function(e,t){if(!e&&t)return 1;if(e&&!t)return-1;if(!e||!t)return 0;const n=e.stringValue===E.gZ.YES||e.stringValue!==E.gZ.NO&&void 0,s=t.stringValue===E.gZ.YES||t.stringValue!==E.gZ.NO&&void 0;if(n===s)return 0;if(void 0===n)return 1;if(void 0===s)return-1;return n?1:-1}(t.currentValue,n.currentValue)}return o===r?0:(0,s.isNil)(o)||(0,s.isNil)(r)?(0,s.isNil)(o)?-1:1:o>r?1:-1}(e.assessmentInfo,t,n)}return 0},maxSize:200,size:n?Vn:Hn,minSize:n?Vn:Hn,cell:e=>{const{isComparing:t,assessmentInfo:n,comparisonEntry:s}=e.getValue();return(0,f.Y)(sn,{isComparing:t,assessmentInfo:n,comparisonEntry:s})}};case J.$6.EXPECTATION:return{...d,accessorFn:t=>({isComparing:n,expectationName:e.expectationName,comparisonEntry:t}),maxSize:200,size:n?Vn:Hn,minSize:n?Vn:Hn,cell:e=>{const{isComparing:t,expectationName:n,comparisonEntry:s}=e.getValue();return((e,t,n,s,o)=>{var r,i,a,l;const d=null===(r=o.currentRunValue)||void 0===r||null===(i=r.targets)||void 0===i?void 0:i[s],c=null===(a=o.otherRunValue)||void 0===a||null===(l=a.targets)||void 0===l?void 0:l[s],u=d?(0,f.Y)($.SH,{parsedValue:d,singleLine:!0}):(0,f.Y)(ve,{isComparing:n}),m=c?(0,f.Y)($.SH,{parsedValue:c,singleLine:!0}):(0,f.Y)(ve,{isComparing:n});return n?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,f.Y)("div",{css:on,children:u}),(0,f.Y)("div",{css:rn,children:m})]}):u})(o,0,t,n,s)}};case J.$6.TRACE_INFO:return{...d,accessorFn:e=>({isComparing:n,comparisonEntry:e}),sortingFn:(t,n)=>{var s,o;const{comparisonEntry:r}=t.getValue(e.id),{comparisonEntry:i}=n.getValue(e.id);return((e,t,n)=>{var s,o;if(!Q.My.includes(n))return 0;const r=String(null!==(s=ae(e,n))&&void 0!==s?s:""),i=String(null!==(o=ae(t,n))&&void 0!==o?o:"");return r.localeCompare(i,void 0,{numeric:!0})})(null===r||void 0===r||null===(s=r.currentRunValue)||void 0===s?void 0:s.traceInfo,null===i||void 0===i||null===(o=i.currentRunValue)||void 0===o?void 0:o.traceInfo,e.id)},size:e.id===Q.Rl?300:100,minSize:e.id===Q.Rl?120:100,cell:t=>{var n,d,c;const{isComparing:u,comparisonEntry:m}=t.getValue(),{traceIdToTurnMap:p,searchQuery:g}=null!==(n=null===(d=t.table)||void 0===d||null===(c=d.options)||void 0===c?void 0:c.meta)&&void 0!==n?n:{};return((e,t,n,o,r,i,a,l,d,c)=>{var u,m;const p=null===(u=o.currentRunValue)||void 0===u?void 0:u.traceInfo,g=t?null===(m=o.otherRunValue)||void 0===m?void 0:m.traceInfo:void 0;if(n===Q.Te){const e=null!==p&&void 0!==p&&p.request_time?new Date(p.request_time):void 0,n=null!==g&&void 0!==g&&g.request_time?new Date(g.request_time):void 0;return(0,f.Y)(ye,{first:e?(0,f.Y)(H.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,f.Y)("span",{css:pn,children:en(e,i,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})})}):(0,f.Y)(ve,{isComparing:t}),second:t&&(n?(0,f.Y)(H.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time",content:n.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,f.Y)("span",{css:gn,children:kt(n)})}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.$W)return(0,f.Y)(ye,{first:(0,f.Y)(Ue,{original:p,isComparing:t}),second:t&&(g?(0,f.Y)(Ue,{original:g,isComparing:t}):(0,f.Y)(ve,{isComparing:t}))});if(n===Q.FW)return(0,f.Y)(ye,{first:p?(0,f.Y)(Ve,{traceInfo:p,isComparing:t}):(0,f.Y)(ve,{isComparing:t}),second:t&&(g?(0,f.Y)(Ve,{traceInfo:g,isComparing:t}):(0,f.Y)(ve,{isComparing:t}))});if(n===Q.Pn){const e=Object.entries((null===p||void 0===p?void 0:p.tags)||{}).map(([e,t])=>({key:e,value:t})),n=Object.entries((null===g||void 0===g?void 0:g.tags)||{}).map(([e,t])=>({key:e,value:t})),s=!g&&p?()=>null===l||void 0===l?void 0:l(p):void 0;return(0,f.Y)(ye,{first:(0,f.Y)(Ze,{baseComponentId:"tags-cell-renderer",tags:e,onAddEditTags:s}),second:t&&(g?(0,f.Y)(Ze,{baseComponentId:"tags-cell-renderer-other",tags:n}):(0,f.Y)(ve,{isComparing:t}))})}if((0,K.ij)()&&n.startsWith(Q.Pn)){var h,v;const e=(0,W.PO)(n);if(!e)return(0,f.Y)(ve,{isComparing:t});const s=null===p||void 0===p||null===(h=p.tags)||void 0===h?void 0:h[e],o=null===g||void 0===g||null===(v=g.tags)||void 0===v?void 0:v[e];return(0,f.Y)(ye,{first:s?(0,f.Y)("span",{title:s,css:fn,children:s}):(0,f.Y)(ve,{isComparing:t}),second:t&&(o?(0,f.Y)("span",{title:s,css:hn,children:o}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.LV){var y,x,b,w,S;const e=null===(y=o.currentRunValue)||void 0===y?void 0:y.evaluationId,n=null===p||void 0===p||null===(x=p.tags)||void 0===x?void 0:x["mlflow.traceName"],s=null===g||void 0===g||null===(b=g.tags)||void 0===b?void 0:b["mlflow.traceName"];return(0,f.Y)(ye,{first:n?t?(0,f.Y)("div",{children:null===p||void 0===p||null===(S=p.tags)||void 0===S?void 0:S["mlflow.traceName"]}):(0,f.Y)(F.T.Link,{css:vn,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>{var t;return e&&r(e,null===(t=o.currentRunValue)||void 0===t?void 0:t.traceInfo)},children:null===p||void 0===p||null===(w=p.tags)||void 0===w?void 0:w["mlflow.traceName"]}):(0,f.Y)(ve,{isComparing:t}),second:t&&(s?(0,f.Y)("div",{children:s}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.li){var Y;const t=null===p||void 0===p||null===(Y=p.trace_metadata)||void 0===Y?void 0:Y[W.kQ];return t?(0,f.Y)(ke,{experimentId:e,runUuid:t}):(0,f.Y)(ve,{})}if(n===Q.tP){var A,T,I,C;const e=(null===p||void 0===p||null===(A=p.trace_metadata)||void 0===A?void 0:A["mlflow.trace.user"])||(null===p||void 0===p||null===(T=p.tags)||void 0===T?void 0:T["mlflow.user"]),n=(null===g||void 0===g||null===(I=g.trace_metadata)||void 0===I?void 0:I["mlflow.trace.user"])||(null===g||void 0===g||null===(C=g.tags)||void 0===C?void 0:C["mlflow.user"]);return(0,f.Y)(ye,{first:e?(0,f.FD)("span",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),title:e,children:[(0,f.Y)(O.UserIcon,{css:(0,D.AH)({color:a.colors.textSecondary,fontSize:16},"")}),(0,f.Y)("span",{css:yn,children:e})]}):(0,f.Y)(ve,{isComparing:t}),second:t&&(n?(0,f.FD)("span",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),title:n,children:[(0,f.Y)(O.UserIcon,{css:(0,D.AH)({color:a.colors.textSecondary,fontSize:16},"")}),(0,f.Y)("span",{css:xn,children:n})]}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.XQ){const e=null===p||void 0===p?void 0:p.trace_id,n=null===g||void 0===g?void 0:g.trace_id,s=e&&c?Ot(e,c):e,o=n&&c?Ot(n,c):n;return(0,f.Y)(ye,{first:e?(0,f.Y)(O.Tag,{css:bn,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",onClick:()=>r(e,p),children:(0,f.Y)("span",{css:wn,children:s})}):(0,f.Y)(ve,{isComparing:t}),second:t&&(n?(0,f.Y)(O.Tag,{css:Sn,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:n,onClick:()=>r(n,g),children:(0,f.Y)("span",{css:Yn,children:o})}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.yX){var M,_;const n=null===p||void 0===p||null===(M=p.trace_metadata)||void 0===M?void 0:M["mlflow.trace.session"],o=null===g||void 0===g||null===(_=g.trace_metadata)||void 0===_?void 0:_["mlflow.trace.session"],r=null===p||void 0===p?void 0:p.trace_id,i=null===g||void 0===g?void 0:g.trace_id,a=null===d||void 0===d?void 0:d[null!==r&&void 0!==r?r:""],l=null===d||void 0===d?void 0:d[null!==i&&void 0!==i?i:""];return(0,f.Y)(ye,{first:n?(0,f.Y)(Fe,{sessionId:n,experimentId:e,traceId:r,children:(0,f.Y)(O.Tag,{css:An,componentId:"mlflow.genai-traces-table.session",title:n,children:(0,f.Y)("span",{css:Tn,children:(0,s.isNil)(a)?n:(0,f.Y)(V.sA,{id:"8ikgws",defaultMessage:"Turn {turnNumber}",values:{turnNumber:a}})})})}):(0,f.Y)(ve,{isComparing:t}),second:t&&(o?(0,f.Y)(Fe,{sessionId:o,experimentId:e,traceId:i,children:(0,f.Y)(O.Tag,{css:In,componentId:"mlflow.genai-traces-table.session",title:o,children:(0,f.Y)("span",{css:Cn,children:(0,s.isNil)(l)?n:(0,f.Y)(V.sA,{id:"8ikgws",defaultMessage:"Turn {turnNumber}",values:{turnNumber:l}})})})}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.Rl){const e=p?$n((0,W.Mq)(p)):"",n=g?$n((0,W.Mq)(g)):"",s=e&&c?Ot(e,c):e,o=n&&c?Ot(n,c):n;return(0,f.Y)(ye,{first:s?(0,f.Y)("div",{css:Mn,title:e,children:s}):(0,f.Y)(ve,{isComparing:t}),second:t&&(o?(0,f.Y)("div",{css:En,title:n,children:o}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.im)return(0,f.Y)(Ie,{experimentId:e,currentTraceInfo:p,otherTraceInfo:g,isComparing:t});if(n===Q.YO)return(0,f.Y)(Xe,{currentTraceInfo:p,otherTraceInfo:g,isComparing:t});if(n.startsWith(Q.rc)){var N,R;const e=(0,W.v8)(n);if(!e)return(0,f.Y)(ve,{isComparing:t});const s=null===p||void 0===p||null===(N=p.trace_metadata)||void 0===N?void 0:N[e],o=null===g||void 0===g||null===(R=g.trace_metadata)||void 0===R?void 0:R[e];return(0,f.Y)(ye,{first:s?(0,f.Y)("div",{css:_n,title:s,children:s}):(0,f.Y)(ve,{isComparing:t}),second:t&&(o?(0,f.Y)("div",{css:Nn,title:o,children:o}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.tj){const e=e=>{var t;if(void 0===e)return;const n=parseFloat(e),o=null===e||void 0===e||null===(t=e.replace)||void 0===t?void 0:t.call(e,/[0-9.]/g,"").trim().toLowerCase();return(0,s.isNil)(n)||isNaN(n)?void 0:[n.toFixed(3).replace(/\.?0+$/,""),o].filter(Boolean).join("")},n=e(null===p||void 0===p?void 0:p[Q.tj]),o=e(null===g||void 0===g?void 0:g[Q.tj]);return(0,f.Y)(ye,{first:(0,s.isNil)(n)?(0,f.Y)(ve,{isComparing:t}):(0,f.Y)("div",{css:Rn,title:n,children:n}),second:t&&((0,s.isNil)(o)?(0,f.Y)(ve,{isComparing:t}):(0,f.Y)("div",{css:kn,title:o,children:o}))})}if(n===Q.VC){var k,L;const e=e=>{if(!e)return null;try{const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0)return t.map(e=>`${e.name}/${e.version}`).join(", ")}catch(t){return e}return null},n=null===p||void 0===p||null===(k=p.tags)||void 0===k?void 0:k["mlflow.linkedPrompts"],s=null===g||void 0===g||null===(L=g.tags)||void 0===L?void 0:L["mlflow.linkedPrompts"],o=e(n),r=e(s);return(0,f.Y)(ye,{first:o?(0,f.Y)("div",{css:Dn,title:o,children:o}):(0,f.Y)(ve,{isComparing:t}),second:t&&(r?(0,f.Y)("div",{css:Fn,title:r,children:r}):(0,f.Y)(ve,{isComparing:t}))})}if(n===Q.jN||n===Q.mq)return(0,f.Y)(ve,{isComparing:t});const $=p?(0,E.ng)(ae(p,n)):"",B=g?(0,E.ng)(ae(g,n)):"";return(0,f.Y)(ye,{first:$?(0,f.Y)("div",{css:On,title:$,children:$}):(0,f.Y)(ve,{isComparing:t}),second:t&&(B?(0,f.Y)("div",{css:Ln,title:B,children:B}):(0,f.Y)(ve,{isComparing:t}))})})(i,u,e.id,m,a,r,o,l,p,g)}};case J.$6.INTERNAL_MONITOR_REQUEST_TIME:return{...d,accessorFn:e=>{var t;return null===(t=e.currentRunValue)||void 0===t?void 0:t.requestTime},sortingFn:(t,n)=>{const s=t.getValue(e.id),o=n.getValue(e.id);return JSON.stringify(s).localeCompare(JSON.stringify(o))},size:100,minSize:100,cell:e=>{const t=e.getValue();if(!t)return null;const n=new Date(t);return(0,f.Y)(H.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:n.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,f.Y)("span",{children:kt(n)})})}};default:return d}};var Un=n(43617);const zn=m.memo(({rows:e,isComparing:t,enableRowSelection:n,virtualItems:s,virtualizerTotalSize:o,virtualizerMeasureElement:r,selectedColumns:i,rowSelectionChangeHandler:a})=>(0,f.Y)("div",{style:{height:`${o}px`,position:"relative",display:"grid"},children:s.map(s=>{const o=e[s.index],l=o.original.currentRunValue&&!t;return(0,f.Y)("div",{"data-index":s.index,ref:e=>r(e),style:{position:"absolute",transform:`translate3d(0, ${s.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,f.Y)(Kn,{row:o,exportableTrace:l,enableRowSelection:n,isSelected:n?o.getIsSelected():void 0,isComparing:t,selectedColumns:i,rowSelectionChangeHandler:a})},s.key)})})),jn=m.memo(zn);var Pn={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const Kn=m.memo(({row:e,exportableTrace:t,enableRowSelection:n,isComparing:s,isSelected:o,selectedColumns:r,rowSelectionChangeHandler:i})=>{const a=e.getVisibleCells(),l=(0,V.tz)(),d=i?t=>i(e,t):e.getToggleSelectedHandler();return(0,f.Y)(f.FK,{children:(0,f.FD)(O.TableRow,{children:[(0,f.Y)("div",{css:Pn,children:n&&(0,f.Y)(H.T,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip",content:s?l.formatMessage({id:"dqfOjO",defaultMessage:"You cannot select rows when comparing runs"}):t?null:l.formatMessage({id:"V0/LoE",defaultMessage:"This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse."}),children:(0,f.Y)(O.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell",checked:o&&t,onChange:d,isDisabled:s||!t})})}),a.map(e=>(0,f.Y)(Wn,{cell:e},e.id))]})})}),Wn=m.memo(({cell:e})=>{const{theme:t}=(0,F.u)();return(0,f.Y)(O.TableCell,{style:{flex:`1 1 var(--col-${Dt(e.column.id)}-size)`},css:(0,D.AH)({display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${t.spacing.xs}px 0px`,width:"100%"}},""),children:(0,Un.Kv)(e.column.columnDef.cell,e.getContext())},e.id)});function qn(e,t){var n,s;return null!==(n=null===(s=e.assessments)||void 0===s?void 0:s.filter(e=>e.assessment_name===t&&!(0,$.rX)(e)&&!1!==e.valid))&&void 0!==n?n:[]}var Gn={name:"13bs64s",styles:"font-size:12px;margin-right:4px"};const Qn=({assessmentInfo:e,traces:t,onExpandSession:n})=>{const{theme:s}=(0,F.u)(),o=(0,V.tz)(),{passCount:r,totalCount:i,errorCount:a}=function(e,t){let n=0,s=0,o=0;for(const i of e){const e=qn(i,t.name);for(const i of e){var r;if(!("feedback"in i))continue;if(null!==(r=i.feedback.error)&&void 0!==r&&r.error_message){o++;continue}const e=i.feedback.value,a=Ut(t,e);void 0!==a&&(s++,a&&n++)}}return{passCount:n,totalCount:s,errorCount:o}}(t,e);if(i>0||a>0){const e=()=>{null===n||void 0===n||n()},t=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),null===n||void 0===n||n())},l=(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs,minWidth:0,width:i>0?"100%":"fit-content",cursor:n?"pointer":void 0,borderRadius:s.borders.borderRadiusSm,"&:hover":n?{backgroundColor:s.colors.actionTertiaryBackgroundHover}:void 0},""),onClick:n?e:void 0,onKeyDown:n?t:void 0,role:n?"button":void 0,tabIndex:n?0:void 0,children:[i>0&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flex:1,minWidth:0,height:s.spacing.sm,borderRadius:s.borders.borderRadiusMd,overflow:"hidden"},""),children:[r>0&&(0,f.Y)("div",{css:(0,D.AH)({flex:r,backgroundColor:u.W_},"")}),r<i&&(0,f.Y)("div",{css:(0,D.AH)({flex:i-r,backgroundColor:u.VJ},"")})]}),(0,f.Y)("span",{css:(0,D.AH)({display:"flex",alignItems:"center",flexShrink:0,fontSize:s.typography.fontSizeSm,color:s.colors.textPrimary,whiteSpace:"nowrap",width:50},""),children:i>0?(0,f.FD)(f.FK,{children:[(0,f.FD)(F.T.Text,{bold:!0,size:"sm",children:[r,"/",i]}),a>0&&(0,f.Y)(F.k,{css:(0,D.AH)({fontSize:12,marginLeft:4,color:s.colors.textValidationWarning},"")})]}):(0,f.FD)("span",{css:(0,D.AH)({display:"flex",alignItems:"center",color:s.colors.textValidationWarning},""),children:[(0,f.Y)(F.k,{css:Gn}),(0,f.Y)(F.T.Text,{size:"sm",color:"warning",children:(0,f.Y)(V.sA,{id:"UGqg24",defaultMessage:"Error"})})]})})]}),d=()=>{const e=o.formatMessage({id:"NRNNnk",defaultMessage:"Click to expand"});if(a>0){return`${o.formatMessage({id:"OLZyxe",defaultMessage:"{errorCount, plural, one {# error} other {# errors}}"},{errorCount:a})} \xb7 ${e}`}return e};return n?(0,f.Y)(H.T,{componentId:"mlflow.genai-traces-table.session-header.pass-fail-aggregated",content:d(),children:l}):a>0?(0,f.Y)(H.T,{componentId:"mlflow.genai-traces-table.session-header.error-count",content:o.formatMessage({id:"iBIflN",defaultMessage:"{errorCount, plural, one {# error} other {# errors}}"},{errorCount:a}),children:l}):l}return(0,f.Y)(ve,{})},Jn=e=>{const t=Number.isInteger(e)?e.toString():e.toFixed(2).replace(/\.?0+$/,"");return(0,f.Y)(V.sA,{id:"/yjgDc",defaultMessage:"{formattedAverage} (AVG)",values:{formattedAverage:t}})},Zn=({assessmentInfo:e,traces:t})=>{const{average:n,count:s}=function(e,t){let n=0,s=0;for(const o of e){const e=qn(o,t);for(const t of e){if(!("feedback"in t))continue;const e=t.feedback.value;"number"!==typeof e||isNaN(e)||(n+=e,s++)}}return{average:s>0?n/s:null,count:s}}(t,e.name);return null===n?(0,f.Y)(ve,{}):(0,f.Y)(H.T,{componentId:"mlflow.genai-traces-table.session-numeric-assessment",content:(0,f.Y)(V.sA,{id:"9qUuQ6",defaultMessage:"Average of {count} values",values:{count:s}}),children:(0,f.Y)(O.Tag,{componentId:"mlflow.genai-traces-table.average-values-tag",children:(0,f.Y)(F.T.Text,{size:"sm",children:Jn(n)})})})};var Xn={name:"1ll9bqd",styles:"cursor:default"},es={name:"1ww443i",styles:"max-width:200px"};const ts=({assessmentInfo:e,traces:t})=>{const{valueCounts:n,totalCount:s}=function(e,t){const n=new Map;let s=0;for(const r of e){const e=qn(r,t);for(const t of e){if(!("feedback"in t))continue;const e=t.feedback.value;var o;"string"===typeof e&&(n.set(e,(null!==(o=n.get(e))&&void 0!==o?o:0)+1),s++)}}return{valueCounts:n,totalCount:s}}(t,e.name),{theme:o}=(0,F.u)(),r=n.size,i=Array.from(n.entries()).sort((e,t)=>t[1]-e[1]);return 0===s?(0,f.Y)(ve,{}):(0,f.Y)(O.HoverCard,{trigger:(0,f.Y)(O.Tag,{css:Xn,componentId:"mlflow.genai-traces-table.session-string-tag",children:(0,f.Y)(V.sA,{id:"J/srtP",defaultMessage:"{count} {count, plural, one {value} other {values}}",values:{count:r}})}),content:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:o.spacing.xs},""),children:i.map(([e,t])=>(0,f.FD)("div",{css:(0,D.AH)({display:"flex",justifyContent:"space-between",gap:o.spacing.md},""),children:[(0,f.Y)(F.T.Text,{ellipsis:!0,css:es,children:e}),(0,f.Y)(F.T.Text,{color:"secondary",children:t})]},e))})})};var ns=n(42822);var ss={name:"qhxz92",styles:"max-width:100%"},os={name:"qhxz92",styles:"max-width:100%"},rs={name:"b45igo",styles:"overflow:hidden;min-width:0;max-width:100%"},is={name:"qhxz92",styles:"max-width:100%"},as={name:"b45igo",styles:"overflow:hidden;min-width:0;max-width:100%"},ls={name:"qhxz92",styles:"max-width:100%"},ds={name:"19yl8zz",styles:"flex:1;min-width:0;overflow:hidden"},cs={name:"3htxh7",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0"},us={name:"3htxh7",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0"},ms={name:"zjik7",styles:"display:flex"},ps={name:"1suksrg",styles:"width:12px;height:12px"},gs={name:"zjik7",styles:"display:flex"},fs={name:"1suksrg",styles:"width:12px;height:12px"},hs={name:"3htxh7",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0"},vs={name:"3htxh7",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0"},ys={name:"3htxh7",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0"},xs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},bs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ws={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ss={name:"3htxh7",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0"},Ys={name:"3htxh7",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0"},As={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},Ts={name:"1qohhow",styles:"display:flex;overflow:hidden;min-width:0;flex:1"};const Is=({column:e,sessionId:t,otherSessionId:n,traces:o,otherTraces:r,goal:i,persona:a,experimentId:l,isComparing:d,getRunColor:c,runUuid:m,compareToRunUuid:p,onExpandSession:g,searchQuery:h})=>{var v,y,x,b;const{theme:w}=(0,F.u)(),S=(0,V.tz)(),Y=o[0],A=null===r||void 0===r?void 0:r[0],T=m||(null===Y||void 0===Y||null===(v=Y.trace_metadata)||void 0===v?void 0:v[W.kQ]),I=p||(null===A||void 0===A||null===(y=A.trace_metadata)||void 0===y?void 0:y[W.kQ]),C=c&&T?c(T):u.IX,M=c&&I?c(I):u.OV;let E=null;if(e.id===Q.yX){const e=n||(null!==r&&void 0!==r&&r[0]?(e=>{var t,n;return null!==(t=null===(n=e.trace_metadata)||void 0===n?void 0:n[$.n2])&&void 0!==t?t:null})(r[0]):null);if(d&&(d&&e&&e!==t))E=(0,f.Y)(ye,{first:t?(0,f.Y)(Fe,{sessionId:t,experimentId:l,children:(0,f.FD)(O.Tag,{componentId:"mlflow.genai-traces-table.session-header-session-id",title:t,css:ss,children:[(0,f.Y)(O.SpeechBubbleIcon,{css:(0,D.AH)({fontSize:w.typography.fontSizeBase,marginRight:w.spacing.xs},"")}),(0,f.Y)(F.T.Text,{ellipsis:!0,children:t})]})}):(0,f.Y)(ve,{isComparing:!0}),second:(0,f.Y)(Fe,{sessionId:e,experimentId:l,children:(0,f.FD)(O.Tag,{componentId:"mlflow.genai-traces-table.session-header-session-id-other",title:e,css:os,children:[(0,f.Y)(O.SpeechBubbleIcon,{css:(0,D.AH)({fontSize:w.typography.fontSizeBase,marginRight:w.spacing.xs},"")}),(0,f.Y)(F.T.Text,{ellipsis:!0,children:e})]})})});else if(d){const n=t||e;E=n?(0,f.Y)("div",{css:rs,children:(0,f.Y)(Fe,{sessionId:n,experimentId:l,children:(0,f.FD)(O.Tag,{componentId:"mlflow.genai-traces-table.session-header-session-id",title:n,css:is,children:[(0,f.Y)(O.SpeechBubbleIcon,{css:(0,D.AH)({fontSize:w.typography.fontSizeBase,marginRight:w.spacing.xs},"")}),(0,f.Y)(F.T.Text,{ellipsis:!0,children:n})]})})}):(0,f.Y)(ve,{})}else E=(0,f.Y)("div",{css:as,children:(0,f.Y)(Fe,{sessionId:t,experimentId:l,children:(0,f.FD)(O.Tag,{componentId:"mlflow.genai-traces-table.session-header-session-id",title:t,css:ls,children:[(0,f.Y)(O.SpeechBubbleIcon,{css:(0,D.AH)({fontSize:w.typography.fontSizeBase,marginRight:w.spacing.xs},"")}),(0,f.Y)(F.T.Text,{ellipsis:!0,children:t})]})})})}else if(e.id===Q.d6){const e=Y?(0,W.h)(Y):void 0,n=A?(0,W.h)(A):void 0,s=e&&h?Ot(e,h):e,o=n&&h?Ot(n,h):n;E=d?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",overflow:"hidden",alignItems:"center",gap:w.spacing.sm},""),children:[(0,f.Y)("div",{css:ds,children:(0,f.Y)(ye,{first:s?(0,f.Y)("div",{css:cs,title:"string"===typeof e?e:void 0,children:s}):(0,f.Y)(ve,{isComparing:!0}),second:o?(0,f.Y)("div",{css:us,title:"string"===typeof n?n:void 0,children:o}):(0,f.Y)(ve,{isComparing:!0})})}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:w.spacing.md,flexShrink:0},""),children:[(0,f.Y)("div",{css:ms,children:Y?(0,f.Y)(Xt,{color:C}):(0,f.Y)("div",{css:ps})}),(0,f.Y)("div",{css:gs,children:A?(0,f.Y)(Xt,{color:M}):(0,f.Y)("div",{css:fs})})]})]}):s?(0,f.Y)(Fe,{sessionId:t,experimentId:l,children:(0,f.Y)("span",{css:(0,D.AH)({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minWidth:0,color:w.colors.actionPrimaryBackgroundDefault,cursor:"pointer","&:hover":{textDecoration:"underline"}},""),title:"string"===typeof e?e:void 0,children:s})}):(0,f.Y)(ve,{})}else if(e.id===Q.Te){const e=null===Y||void 0===Y?void 0:Y[Q.Te],t=e?new Date(e):null,n=null===A||void 0===A?void 0:A[Q.Te],s=n?new Date(n):null,o={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};E=d?(0,f.Y)(ye,{first:t?(0,f.Y)(H.T,{componentId:"mlflow.genai-traces-table.session-header-request-time",content:t.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,f.Y)(F.T.Text,{ellipsis:!0,children:en(t,S,o)})}):(0,f.Y)(ve,{isComparing:!0}),second:s?(0,f.Y)(H.T,{componentId:"mlflow.genai-traces-table.session-header-request-time-other",content:s.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,f.Y)(F.T.Text,{ellipsis:!0,children:en(s,S,o)})}):(0,f.Y)(ve,{isComparing:!0})}):t?(0,f.Y)(H.T,{componentId:"mlflow.genai-traces-table.session-header-request-time",content:t.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,f.Y)(F.T.Text,{ellipsis:!0,children:en(t,S,o)})}):(0,f.Y)(ve,{})}else if(e.id===Q.$W){const e=o[o.length-1],t=null===r||void 0===r?void 0:r[r.length-1];E=d?(0,f.Y)(ye,{first:e?(0,f.Y)(Ue,{original:e,isComparing:!0}):(0,f.Y)(ve,{isComparing:!0}),second:t?(0,f.Y)(Ue,{original:t,isComparing:!0}):(0,f.Y)(ve,{isComparing:!0})}):e?(0,f.Y)(Ue,{original:e,isComparing:!1}):(0,f.Y)(ve,{})}else if(e.id===Q.tP){var _,N;const e=null===Y||void 0===Y||null===(_=Y.trace_metadata)||void 0===_?void 0:_[$.E3],t=null===A||void 0===A||null===(N=A.trace_metadata)||void 0===N?void 0:N[$.E3];E=d?(0,f.Y)(ye,{first:e?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:w.spacing.xs,overflow:"hidden",minWidth:0},""),title:e,children:[(0,f.Y)(O.UserIcon,{css:(0,D.AH)({color:w.colors.textSecondary,fontSize:16,flexShrink:0},"")}),(0,f.Y)(F.T.Text,{ellipsis:!0,children:e})]}):(0,f.Y)(ve,{isComparing:!0}),second:t?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:w.spacing.xs,overflow:"hidden",minWidth:0},""),title:t,children:[(0,f.Y)(O.UserIcon,{css:(0,D.AH)({color:w.colors.textSecondary,fontSize:16,flexShrink:0},"")}),(0,f.Y)(F.T.Text,{ellipsis:!0,children:t})]}):(0,f.Y)(ve,{isComparing:!0})}):e?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:w.spacing.xs,overflow:"hidden",minWidth:0},""),title:e,children:[(0,f.Y)(O.UserIcon,{css:(0,D.AH)({color:w.colors.textSecondary,fontSize:16,flexShrink:0},"")}),(0,f.Y)(F.T.Text,{ellipsis:!0,children:e})]}):(0,f.Y)(ve,{})}else if(e.id===Q.Rl){const e=o[o.length-1],t=null===r||void 0===r?void 0:r[r.length-1],n=e?$n((0,W.Mq)(e)):void 0,s=t?$n((0,W.Mq)(t)):void 0,i=n&&h?Ot(n,h):n,a=s&&h?Ot(s,h):s;E=d?(0,f.Y)(ye,{first:i?(0,f.Y)("div",{css:hs,title:"string"===typeof n?n:void 0,children:i}):(0,f.Y)(ve,{isComparing:!0}),second:a?(0,f.Y)("div",{css:vs,title:"string"===typeof s?s:void 0,children:a}):(0,f.Y)(ve,{isComparing:!0})}):i?(0,f.Y)("div",{css:ys,title:"string"===typeof n?n:void 0,children:i}):(0,f.Y)(ve,{})}else if(e.id===Q.YO){const e=e=>{let t=0,n=0,s=0;return e.forEach(e=>{var o;const r=null===(o=e.trace_metadata)||void 0===o?void 0:o[$.Uu];try{const e=r?JSON.parse(r):{};t+=e.total_tokens||0,n+=e.input_tokens||0,s+=e.output_tokens||0}catch{}}),{totalTokens:t,totalInputTokens:n,totalOutputTokens:s}},t=o.length>0?e(o):null,n=r&&r.length>0?e(r):null;E=d?(0,f.Y)(ye,{first:t?(0,f.Y)(pt,{inputTokens:t.totalInputTokens,outputTokens:t.totalOutputTokens,totalTokens:t.totalTokens,isComparing:!1}):(0,f.Y)(ve,{isComparing:!0}),second:n?(0,f.Y)(pt,{inputTokens:n.totalInputTokens,outputTokens:n.totalOutputTokens,totalTokens:n.totalTokens,isComparing:!1}):(0,f.Y)(ve,{isComparing:!0})}):t?(0,f.Y)(pt,{inputTokens:t.totalInputTokens,outputTokens:t.totalOutputTokens,totalTokens:t.totalTokens,isComparing:!1}):(0,f.Y)(ve,{})}else if(e.id===Q.tj){const e=o.length>0?(0,ns.bV)(o):null,t=r&&r.length>0?(0,ns.bV)(r):null;E=d?(0,f.Y)(ye,{first:e?(0,f.Y)("div",{css:xs,title:e,children:e}):(0,f.Y)(ve,{isComparing:!0}),second:t?(0,f.Y)("div",{css:bs,title:t,children:t}):(0,f.Y)(ve,{isComparing:!0})}):e?(0,f.Y)("div",{css:ws,title:e,children:e}):(0,f.Y)(ve,{})}else if(e.id===Q.jN)E=i?(0,f.Y)("div",{css:Ss,title:i,children:i}):(0,f.Y)(ve,{});else if(e.id===Q.mq)E=a?(0,f.Y)("div",{css:Ys,title:a,children:a}):(0,f.Y)(ve,{});else if(e.type===J.$6.ASSESSMENT&&e.assessmentInfo&&null!==(x=e.assessmentInfo)&&void 0!==x&&x.isSessionLevelAssessment){const t=e.assessmentInfo,n=e=>{const n=e.flatMap(e=>{var t;return(0,s.compact)(null===(t=e.assessments)||void 0===t?void 0:t.filter(e=>{var t;return Boolean(null===(t=e.metadata)||void 0===t?void 0:t[$.K6])&&(0,$.mc)(e)}))}).map(W.$T);return Et(t,n)},i=e=>(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:w.spacing.sm},""),children:e.map(e=>(0,f.Y)(Gt,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:e.latestAssessment,isRootCauseAssessment:!1,assessmentInfo:t,type:"value",count:e.count},`tag_${e.latestAssessment.name}_${e.value}`))}),a=o.length>0?n(o):[],l=r&&r.length>0?n(r):[];E=d?(0,f.Y)(ye,{first:a.length>0?i(a):(0,f.Y)(ve,{isComparing:!0}),second:l.length>0?i(l):(0,f.Y)(ve,{isComparing:!0})}):a.length>0?i(a):(0,f.Y)(ve,{})}else if(e.type===J.$6.ASSESSMENT&&e.assessmentInfo&&(null===(b=e.assessmentInfo)||void 0===b||!b.isSessionLevelAssessment)){const t=e.assessmentInfo,{dtype:n}=t,s=e=>"pass-fail"===n||"boolean"===n?(0,f.Y)(Qn,{assessmentInfo:t,traces:e,onExpandSession:g}):"numeric"===n?(0,f.Y)(Zn,{assessmentInfo:t,traces:e}):"string"===n||"unknown"===n?(0,f.Y)(ts,{assessmentInfo:t,traces:e}):(0,f.Y)(ve,{isComparing:d});E=d?(0,f.Y)(ye,{first:o.length>0?s(o):(0,f.Y)(ve,{isComparing:!0}),second:r&&r.length>0?s(r):(0,f.Y)(ve,{isComparing:!0})}):o.length>0?s(o):(0,f.Y)(ve,{})}return(0,f.Y)(O.TableCell,{wrapContent:!1,style:{flex:`1 1 var(--col-${Dt(e.id)}-size)`},css:As,children:(0,f.Y)("div",{css:Ts,children:E})},e.id)};const Cs=m.memo(function({rows:e,groupedRows:t,isComparing:n,enableRowSelection:s,virtualItems:o,virtualizerTotalSize:r,virtualizerMeasureElement:i,selectedColumns:a,experimentId:l,expandedSessions:d,toggleSessionExpanded:c,getRunColor:u,runUuid:p,compareToRunUuid:g,rowSelectionChangeHandler:h,searchQuery:v}){const y=(0,m.useMemo)(()=>{const t=new Map;return e.forEach(e=>{t.set(e.original,e)}),t},[e]);return(0,f.Y)("div",{style:{height:`${r}px`,position:"relative",display:"grid"},children:o.map(e=>{const o=t[e.index];if(!o)return null;if("sessionHeader"===o.type)return(0,f.Y)("div",{"data-index":e.index,ref:e=>i(e),style:{position:"absolute",transform:`translate3d(0, ${e.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,f.Y)(Es,{sessionId:o.sessionId,otherSessionId:o.otherSessionId,traceCount:o.traces.length,traces:o.traces,otherTraces:o.otherTraces,goal:o.goal,persona:o.persona,selectedColumns:a,experimentId:l,isExpanded:d.has(o.sessionId),isComparing:n,toggleSessionExpanded:c,searchQuery:v,getRunColor:u,runUuid:p,compareToRunUuid:g})},`session-header-${o.sessionId}-${e.index}`);const r=y.get(o.data);if(!r)return null;const m=r.original.currentRunValue&&!n;return(0,f.Y)("div",{"data-index":e.index,ref:e=>i(e),style:{position:"absolute",transform:`translate3d(0, ${e.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,f.Y)(Kn,{row:r,exportableTrace:m,enableRowSelection:s,isSelected:s?r.getIsSelected():void 0,isComparing:n,selectedColumns:a,rowSelectionChangeHandler:h})},e.key)})})});var Ms={name:"s5xdrg",styles:"display:flex;align-items:center"};const Es=m.memo(function({sessionId:e,otherSessionId:t,traces:n,otherTraces:s,goal:o,persona:r,selectedColumns:i,experimentId:a,isExpanded:l,isComparing:d,toggleSessionExpanded:c,getRunColor:u,runUuid:p,compareToRunUuid:g,searchQuery:h}){const v=(0,m.useCallback)(()=>{c(e)},[c,e]);return(0,f.FD)(O.TableRow,{isHeader:!0,children:[(0,f.Y)("div",{css:Ms,children:!d&&(0,f.Y)(F.B,{componentId:"mlflow.genai-traces-table.session-header.toggle-expanded",size:"small",icon:l?(0,f.Y)(O.ChevronDownIcon,{}):(0,f.Y)(F.o,{}),onClick:v})}),i.map(i=>(0,f.Y)(Is,{column:i,sessionId:e,otherSessionId:t,traces:n,otherTraces:s,goal:o,persona:r,experimentId:a,isComparing:d,getRunColor:u,runUuid:p,compareToRunUuid:g,onExpandSession:d?void 0:v,searchQuery:h},i.id))]})}),_s=m.memo(Cs);const Ns=({overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:o,compareToRunUuid:r})=>{const i=(0,V.tz)(),{theme:a}=(0,F.u)(),l=(0,m.useMemo)(()=>function(e,t,n,s,o,r,i){var a,l;if(Object.values(t).every(e=>0===e.currentNumRootCause&&0===(e.otherNumRootCause||0)))return[];const d=Object.values(t).filter(e=>e.currentNumRootCause>0||(e.otherNumRootCause||0)>0).sort((e,t)=>t.currentNumRootCause-e.currentNumRootCause),c=Math.max((null===(a=d[0])||void 0===a?void 0:a.currentNumRootCause)||0,(null===(l=d[0])||void 0===l?void 0:l.otherNumRootCause)||0);return d.map(t=>{var a;const l=null===(a=E.yQ[t.assessmentInfo.name])||void 0===a?void 0:a[E.gZ.NO],d=l?e.formatMessage(l):t.assessmentInfo.name,u=t.currentCounts,m=(null===u||void 0===u?void 0:u.get(E.gZ.YES))||0,p=(null===u||void 0===u?void 0:u.get(E.gZ.NO))||0,g=(null===u||void 0===u?void 0:u.get(void 0))||0,h=t.currentNumRootCause,v=m+p+g,y=t.otherCounts;let x;if(void 0!==t.otherCounts){x=((null===y||void 0===y?void 0:y.get(E.gZ.YES))||0)+((null===y||void 0===y?void 0:y.get(E.gZ.NO))||0)+((null===y||void 0===y?void 0:y.get(void 0))||0)}const b=t.otherNumRootCause||0,w=b/(x||1),S=_t(h/v),Y=_t(w);return{assessment:t.assessmentInfo.name,title:d,currentInfo:{count:h,fraction:h/c,tooltip:e.formatMessage({id:"a6bpXQ",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run "{currentRun}".'},{numRootCause:h,numEvals:v,percentage:S,assessment:t.assessmentInfo.name,currentRun:r}),toggleFilter:()=>s(t.assessmentInfo.name,"failing_root_cause","current"),isSelected:n.some(e=>"rca"===e.filterType&&"current"===e.run&&e.assessmentName===t.assessmentInfo.name),percentage:S},otherInfo:o?{count:b,fraction:b/c,tooltip:e.formatMessage({id:"iDqqcA",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run "{otherRunDisplayName}".'},{numRootCause:b,numEvals:x,percentage:Y,assessment:t.assessmentInfo.name,otherRunDisplayName:i}),toggleFilter:()=>s(t.assessmentInfo.name,"rca","other"),isSelected:n.some(e=>"rca"===e.filterType&&"other"===e.run&&e.assessmentName===t.assessmentInfo.name),percentage:Y}:void 0,icon:(0,f.Y)(L.X,{})}})}(i,t,n,s,Boolean(r),o,r),[i,t,n,s,r,o]);return 0===l.length?(0,f.Y)(f.FK,{}):(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:[(0,f.Y)("div",{css:(0,D.AH)({fontWeight:a.typography.typographyBoldFontWeight},""),children:i.formatMessage({id:"etvfuH",defaultMessage:"Root Cause Analysis"})}),(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:(0,f.Y)(ks,{overallAssessmentInfo:e,rcaData:l,run:"current",runColor:r?u.IX:void 0})}),r&&(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:a.spacing.xs},""),children:(0,f.Y)(ks,{overallAssessmentInfo:e,rcaData:l,run:"other",runColor:u.OV})})]})};var Rs={name:"zjik7",styles:"display:flex"};const ks=({rcaData:e,run:t,runColor:n,overallAssessmentInfo:s})=>{const{theme:o}=(0,F.u)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center"},""),children:[n&&(0,f.Y)("div",{css:Rs,children:(0,f.Y)(Xt,{color:n})}),(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexWrap:"wrap",gap:o.spacing.xs},""),children:e.map((e,n)=>{const r="current"===t?e.currentInfo:e.otherInfo;if(!r)return(0,f.Y)(f.FK,{});const i=(0,u.x2)(o,s,{stringValue:"no"});return(0,f.Y)(H.T,{content:r.tooltip,componentId:"mlflow.evaluations_review.rca_pill",children:(0,f.Y)(f.FK,{children:(0,f.FD)("div",{style:{border:r.isSelected?`1px solid ${o.colors.grey400}`:""},css:(0,D.AH)({color:o.colors.textSecondary,borderRadius:o.general.borderRadiusBase,padding:`0 ${o.spacing.xs}px`,height:"20px",display:"flex",backgroundColor:r.isSelected?(0,E.fu)(i,1):(0,E.fu)(i,.5),gap:o.spacing.xs,fontSize:o.typography.fontSizeSm},""),children:[r.count,(0,f.Y)("div",{children:e.title.toLocaleLowerCase()})]},n)})},n)})})]})};var Ds={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Fs=({assessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:r,compareToRunUuid:i})=>{var a,l;const{theme:d}=(0,F.u)(),c=(0,V.tz)();return(0,f.Y)(f.FK,{children:(0,f.FD)("div",{css:(0,D.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:d.spacing.sm},""),children:[(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs,paddingBottom:d.spacing.sm,borderBottom:`1px solid ${d.colors.border}`},""),children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:d.spacing.xs,alignItems:"center"},""),children:["numeric"===e.dtype?(0,f.Y)(O.NumbersIcon,{}):"boolean"===e.dtype?(0,f.Y)(O.BinaryIcon,{}):(0,f.Y)(f.FK,{}),(0,f.Y)(F.T.Title,{level:4,css:(0,D.AH)({marginBottom:0,marginRight:d.spacing.xs},""),children:e.displayName}),"AI_JUDGE"===(null===(a=e.source)||void 0===a?void 0:a.sourceType)&&(0,f.Y)(O.Tag,{color:"turquoise",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,f.Y)(O.SparkleDoubleIcon,{css:(0,D.AH)({color:d.colors.textSecondary},"")}),(0,f.Y)(F.T.Hint,{children:c.formatMessage({id:"ov1whU",defaultMessage:"AI Judge"})})]})}),"HUMAN"===(null===(l=e.source)||void 0===l?void 0:l.sourceType)&&(0,f.Y)(O.Tag,{color:"coral",componentId:"mlflow.experiment.evaluations.human-judge-tag",children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,f.Y)(O.UserIcon,{}),(0,f.Y)(F.T.Hint,{children:c.formatMessage({id:"BdV0qk",defaultMessage:"Human judge"})})]})}),e.isCustomMetric&&(0,f.Y)(O.Tag,{color:"indigo",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,f.Y)(F.T.Hint,{children:(0,f.Y)(O.BracketsXIcon,{})}),(0,f.Y)(F.T.Hint,{children:e.metricName})]})})]}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Hint,{children:e.name})})]})}),(0,f.Y)("div",{children:(0,f.Y)("span",{css:Ds,children:e.description})}),e.name===o._1.OVERALL_ASSESSMENT&&r?(0,f.Y)("div",{children:(0,f.Y)(Ns,{overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:r,compareToRunUuid:i})}):(0,f.Y)(f.FK,{})]})})};var Os={name:"1yqwqbb",styles:"max-height:200px;overflow-y:auto;width:200px;min-width:200px"};const Ls=m.memo(({theme:e,intl:t,assessmentInfo:n,assessmentAggregates:s,allAssessmentFilters:o,toggleAssessmentFilter:r,currentRunDisplayName:i,compareToRunDisplayName:a})=>{const l=(0,m.useMemo)(()=>function(e,t,n,s,o,r,i,a){const l=void 0!==r.otherCounts,d=[];for(const c of Ct(n)){const m=r.currentCounts?It(e,n,s,c,r.currentCounts,i||W.kf,o):void 0,p=l&&a?It(e,n,s,c,r.otherCounts||new Map,a,o):void 0,g=c===gt||void 0===c,f=l&&m&&p?g?m.value-((null===p||void 0===p?void 0:p.value)||0):m.fraction-((null===p||void 0===p?void 0:p.fraction)||0):void 0;m&&(!g||0!==m.value||f&&0!==f)&&d.push({name:Mt(e,0,n,c),current:m,other:p,backgroundColor:(0,u.QO)(t,n,c,c===gt),scoreChange:f})}return d}(t,e,n,o,r,s,i,a),[t,e,n,o,r,s,i,a]),d=(0,m.useMemo)(()=>"pass-fail"===n.dtype||"boolean"===n.dtype?l:l.map((e,t)=>({...e,originalIndex:t})).sort((e,t)=>{const n="null"===e.name||e.name===gt,s="null"===t.name||t.name===gt;if(n&&!s)return 1;if(s&&!n)return-1;if(!n&&!s){var o,r;const n=((null===(o=t.current)||void 0===o?void 0:o.value)||0)-((null===(r=e.current)||void 0===r?void 0:r.value)||0);if(0!==n)return n}return e.originalIndex-t.originalIndex}),[l,n]),c=d.length>4?d.slice(0,3):d,p=d.length>4?d.slice(3):[],g=p.length>0,h=e.colors.actionDefaultBackgroundHover,v=e.colors.actionDefaultBackgroundPress;return(0,f.Y)("table",{children:(0,f.FD)("tbody",{children:[c.map(t=>(0,f.Y)($s,{barData:t,theme:e,hoverBarColor:h,selectedBarColor:v,assessmentInfo:n},t.name)),g&&(0,f.Y)("tr",{children:(0,f.Y)("td",{colSpan:2,children:(0,f.FD)(F.aw.Root,{componentId:"categorical-aggregate-chart-more-items",children:[(0,f.Y)(F.aw.Trigger,{asChild:!0,children:(0,f.Y)("div",{css:(0,D.AH)({cursor:"pointer",padding:`${e.spacing.xs}px`,color:e.colors.actionLinkDefault,fontSize:e.typography.fontSizeSm,fontWeight:"normal",":hover":{backgroundColor:h},borderRadius:e.general.borderRadiusBase},""),children:t.formatMessage({id:"WELl8J",defaultMessage:"+{count} more"},{count:p.length})})}),(0,f.Y)(F.aw.Content,{align:"start",side:"bottom",css:Os,children:(0,f.Y)("table",{children:(0,f.Y)("tbody",{children:p.map(t=>(0,f.Y)($s,{barData:t,theme:e,hoverBarColor:h,selectedBarColor:v,assessmentInfo:n},t.name))})})})]})})})]})})});var Hs={name:"5m5bfc",styles:"display:flex;flex-direction:column;gap:2px;width:100%"},Vs={name:"12n4oo4",styles:"flex:1;width:100%;position:relative"};const $s=({barData:e,theme:t,hoverBarColor:n,selectedBarColor:o,assessmentInfo:r})=>{const i=e.name===gt,a="null"===e.name;return i||a?(0,f.FD)("tr",{css:(0,D.AH)({cursor:"pointer",":hover":{backgroundColor:n},color:i?t.colors.textValidationWarning:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm},""),onClick:e.current.toggleFilter,children:[(0,f.Y)("td",{css:(0,D.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:e.name===gt?"normal":"italic"},""),children:(0,f.Y)("span",{css:(0,D.AH)({lineHeight:`${t.typography.fontSizeSm}px`},""),children:e.name})}),(0,f.Y)("td",{css:(0,D.AH)({textAlign:"right",verticalAlign:"center",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:"normal"},""),children:(0,f.Y)("span",{css:(0,D.AH)({display:"inline-block",verticalAlign:"center",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,s.isNil)(e.scoreChange)?e.current.value:Rt(r,e.scoreChange,!1)})})]},e.name):(0,f.FD)("tr",{css:(0,D.AH)({cursor:"pointer",":hover":{backgroundColor:n}},""),onClick:e.current.toggleFilter,children:[(0,f.Y)("td",{css:(0,D.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,f.FD)("div",{css:Hs,children:[(0,f.Y)("span",{css:(0,D.AH)({fontWeight:"normal",fontSize:"10px",lineHeight:"10px",color:t.colors.textSecondary},""),children:e.name}),(0,f.Y)("div",{css:Vs,children:(0,f.Y)("div",{style:{width:e.current.value>0?100*e.current.fraction+"%":"2px",borderRadius:"2px"},css:(0,D.AH)({position:"relative",flexShrink:1,transition:"width 0.3s",backgroundColor:e.backgroundColor,height:"10px",display:"flex",alignItems:"center"},"")})})]})}),(0,f.Y)("td",{css:(0,D.AH)({textAlign:"right",verticalAlign:"bottom",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,f.Y)("span",{css:(0,D.AH)({color:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm,display:"inline-block",verticalAlign:"bottom",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,s.isNil)(e.scoreChange)?(l=e.current.fraction,_t(l,0)+"%"):Rt(r,e.scoreChange)})})]},e.name);var l};var Bs={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Us={name:"1a4tfjy",styles:"display:flex;justify-content:center;flex-direction:row"},zs={name:"1fttcpj",styles:"display:flex;flex-direction:column"},js={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Ps={name:"18ubt2d",styles:"width:25%"},Ks={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Ws={name:"18ubt2d",styles:"width:25%"};const qs=m.memo(({numericAggregate:e})=>{const{theme:t}=(0,F.u)(),n=(0,V.tz)();return(0,f.FD)("div",{css:Bs,children:[(0,f.Y)("div",{css:Us,children:e.counts.map((s,o)=>(0,f.Y)(O.HoverCard,{content:(0,f.FD)("div",{css:zs,children:[(0,f.FD)("div",{css:js,children:[(0,f.Y)("div",{css:Ps,children:(0,f.Y)(F.T.Text,{children:n.formatMessage({id:"kAVQ2/",defaultMessage:"Range"})})}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Text,{color:"secondary",children:Nt(s.lower,2)===Nt(s.upper,2)?Nt(s.lower,2):`${Nt(s.lower,2)} - ${Nt(s.upper,2)}`})})]}),(0,f.FD)("div",{css:Ks,children:[(0,f.Y)("div",{css:Ws,children:(0,f.Y)(F.T.Text,{children:n.formatMessage({id:"ClYb2e",defaultMessage:"Count"})})}),(0,f.Y)("div",{children:(0,f.Y)(F.T.Text,{color:"secondary",children:s.count})})]})]}),trigger:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flex:1,flexDirection:"column-reverse",height:"60px",width:"10px",":hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:(0,f.Y)("div",{css:(0,D.AH)({height:s.count/e.maxCount*100+"%",minHeight:"1px",width:"80%",verticalAlign:"bottom",backgroundColor:t.colors.blue400,borderTopRightRadius:t.general.borderRadiusBase,borderTopLeftRadius:t.general.borderRadiusBase},"")})},"bar-"+o)},"hover-card-"+o))}),e.min===e.max?(0,f.Y)("div",{css:(0,D.AH)({display:"flex",justifyContent:"center",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:Nt(e.min,2)}):(0,f.FD)("div",{css:(0,D.AH)({display:"flex",justifyContent:"space-between",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:[(0,f.Y)("div",{children:Nt(e.min,2)}),(0,f.Y)("div",{children:Nt(e.max,2)})]})]})}),Gs=m.memo(({theme:e,intl:t,assessmentInfo:n,assessmentAggregates:o,allAssessmentFilters:r,toggleAssessmentFilter:i,currentRunDisplayName:a,compareToRunDisplayName:l,collapsedHeader:d})=>{const c=(0,m.useMemo)(()=>"pass-fail"===n.dtype?t.formatMessage({id:"Yd5ANL",defaultMessage:"PASS"}):"boolean"===n.dtype?t.formatMessage({id:"icBP3T",defaultMessage:"TRUE"}):"string"===n.dtype?t.formatMessage({id:"Jdr//R",defaultMessage:"STRING"}):"numeric"===n.dtype?t.formatMessage({id:"wDFPtr",defaultMessage:"AVG"}):void 0,[n,t]),{displayScore:p,displayScoreChange:g,changeDirection:h}=(0,m.useMemo)(()=>function(e,t,n){if("numeric"===t.dtype){const e=n.currentNumericValues,t=n.otherNumericValues;let s=NaN,o=NaN;e&&(s=e.reduce((e,t)=>e+t,0)/e.length),t&&(o=t.reduce((e,t)=>e+t,0)/t.length);const r=t?s-o:void 0,i=r?r>0?"up":"down":"none";return{displayScore:Nt(s,2),displayScoreChange:r?"up"===i?`+${Nt(Math.abs(r),2)}`:"down"===i?`-${Nt(Math.abs(r),2)}`:"+0":void 0,changeDirection:i,aggregateType:"average"}}if("pass-fail"===t.dtype||"boolean"===t.dtype){const e=0,s=Tt(t,n.currentCounts),o=_t(s,e)+"%",r=n.otherCounts?s-Tt(t,n.otherCounts):void 0,i=r?r>0?"up":"down":"none";return{displayScore:o,displayScoreChange:r?("up"===i||"none"===i?"+":"")+_t(r,e)+"%":void 0,changeDirection:i,aggregateType:"percentage-true"}}if("string"===t.dtype){const n=t.uniqueValues.size;return{displayScore:1!==n?e.formatMessage({id:"+dbgRR",defaultMessage:"{numUniqueValues} values"},{numUniqueValues:n}):e.formatMessage({id:"lKyc9r",defaultMessage:"1 value"}),displayScoreChange:"",changeDirection:"none",aggregateType:"categorical"}}return{displayScore:"N/A",displayScoreChange:"N/A",changeDirection:"none",aggregateType:"categorical"}}(t,n,o),[t,n,o]);return"unknown"===n.dtype?null:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",paddingTop:e.spacing.xs},""),children:[(0,f.Y)("div",{css:(0,D.AH)({fontWeight:400,fontSize:"10px",color:e.colors.textPlaceholder},""),children:c}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:e.spacing.xs},""),children:[(0,f.Y)("div",{css:(0,D.AH)({fontSize:e.typography.fontSizeLg,color:e.colors.textPrimary,fontWeight:e.typography.typographyBoldFontWeight},""),children:p}),!(0,s.isNil)(g)&&l&&(0,f.Y)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",height:"20px",gap:e.spacing.xs,padding:`2px ${e.spacing.xs}px`,fontSize:e.typography.fontSizeMd,fontWeight:"normal",borderRadius:e.general.borderRadiusBase,color:u.G8,backgroundColor:"none"===h?"":"up"===h?u.YH.up:"down"===h?u.YH.down:(0,E.fu)(e.colors.textSecondary,.1)},""),children:g})]})]}),!d&&((0,s.isNil)(o.currentNumericAggregate)?(0,f.Y)(Ls,{theme:e,intl:t,assessmentInfo:n,assessmentAggregates:o,allAssessmentFilters:r,toggleAssessmentFilter:i,currentRunDisplayName:a,compareToRunDisplayName:l}):(0,f.Y)(qs,{numericAggregate:o.currentNumericAggregate}))]})});var Qs={name:"10sid5d",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;word-break:normal;overflow-wrap:normal"},Js={name:"190se29",styles:"padding-top:0px !important;position:absolute;left:0;right:0;bottom:0;z-index:101;padding:0;pointer-events:none"},Zs={name:"14n7h35",styles:"position:absolute;left:50%;top:100%;transform:translate(-50%, -50%);z-index:102;display:flex;align-items:center;justify-content:center;width:22px;height:22px;pointer-events:auto;cursor:pointer"};const Xs=m.memo(({enableRowSelection:e,enableGrouping:t,selectedAssessmentInfos:n,assessmentNameToAggregates:o,assessmentFilters:r,toggleAssessmentFilter:i,runDisplayName:a,compareToRunUuid:l,compareToRunDisplayName:d,disableAssessmentTooltips:c,collapsedHeader:u,setCollapsedHeader:p,isComparing:g,headerGroups:h,allRowSelected:v,someRowSelected:y,toggleAllRowsSelectedHandler:x,setColumnSizing:b})=>{const{theme:w}=(0,F.u)(),S=(0,V.tz)(),[Y,A]=(0,m.useState)(!1),T=t?{position:"relative","&::before":{content:'""',position:"absolute",top:"32px",left:0,right:0,borderTop:`1px solid ${w.colors.border}`}}:{};return(0,f.Y)(f.FK,{children:h.map((m,I)=>(0,f.FD)(O.TableRow,{isHeader:!0,css:(0,D.AH)({position:"sticky",top:40*I,zIndex:100,...t&&{"& > *":{borderBottom:0===I?"none":void 0}},...I===h.length-1&&{borderBottom:`1px solid ${Y?w.colors.blue500:w.colors.border}`,transition:"border-color 0.2s","& > *":{borderBottom:"none"}}},""),children:[e&&(0,f.Y)("div",{css:0===n.length&&1===I?{}:T,children:(0,f.Y)(O.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell",checked:v,indeterminate:y,onChange:x(),checkboxLabel:S.formatMessage({id:"bO1IlR",defaultMessage:"Select all"}),noCheckbox:0===I,isDisabled:g})}),m.headers.map(e=>{if(e.isPlaceholder)return null;const m=n.find(t=>(0,Q.A5)(t.name)===e.id),p=e.isPlaceholder?null:(0,f.Y)("div",{css:Qs,title:String((0,Un.Kv)(e.column.columnDef.header,e.getContext())),children:(0,Un.Kv)(e.column.columnDef.header,e.getContext())}),g=m&&!c?(0,f.Y)(O.HoverCard,{content:(0,f.Y)(f.FK,{children:(0,f.Y)(Fs,{assessmentInfo:m,assessmentNameToAggregates:o,allAssessmentFilters:r,toggleAssessmentFilter:i,runUuid:a,compareToRunUuid:l?d:void 0})}),trigger:p},e.id):(0,s.isNil)(p)?null:p;return(0,f.Y)(O.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576",css:(0,D.AH)({"> span:first-of-type":{width:"100%",height:"100%",marginTop:"auto",marginBottom:"auto"},...0===n.length&&1===I?{}:T},""),style:{flex:`${e.colSpan} 1 var(--header-${Dt(null===e||void 0===e?void 0:e.column.id)}-size)`},header:e,column:e.column,setColumnSizing:b,children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:w.spacing.xs},""),children:[g,(0,f.Y)("div",{css:(0,D.AH)({borderTop:!t&&n.length>0?`1px solid ${w.colors.border}`:"",width:"100%"},""),children:m&&(0,f.Y)(Gs,{theme:w,intl:S,assessmentInfo:m,assessmentAggregates:o[m.name],allAssessmentFilters:r,toggleAssessmentFilter:i,currentRunDisplayName:a,compareToRunDisplayName:l?d:void 0,collapsedHeader:u})})]})},e.column.id)}),I===h.length-1&&(0,f.FD)("div",{css:Js,children:[(0,f.Y)("div",{css:(0,D.AH)({position:"absolute",left:"50%",top:"100%",width:"24px",height:"12px",background:w.colors.backgroundPrimary,transform:"translate(-50%, -50%)",zIndex:101},"")}),(0,f.Y)("div",{css:Zs,onClick:()=>p(!u),onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1),children:(0,f.Y)("div",{css:(0,D.AH)({width:"22px",height:"22px",borderRadius:"50%",background:w.colors.backgroundPrimary,border:`2px solid ${w.colors.border}`,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, box-shadow 0.2s",":hover":{borderColor:w.colors.blue500,boxShadow:"0 2px 12px 0 rgba(0,0,0,0.18)"},opacity:Y?1:.5},""),children:(0,f.Y)(O.ChevronDownIcon,{css:(0,D.AH)({transform:u?"none":"rotate(180deg)",transition:"transform 0.2s, opacity 0.2s",color:w.colors.textSecondary},"")})})})]})]},m.id))})}),eo=e=>{const{theme:t}=(0,F.u)(),n=(0,V.tz)(),{groupId:s,visibleCount:o,totalCount:r,enableGrouping:i}=e.column.columnDef.meta;if(!i)return J.RF[s];const a=J.RF[s];return(0,f.FD)("div",{css:(0,D.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",gap:t.spacing.sm},""),children:[(0,f.Y)("div",{children:a}),s===J.w8.INFO?null:o===r?(0,f.FD)("div",{css:(0,D.AH)({color:t.colors.textSecondary,fontWeight:"normal"},""),children:["(",o,"/",r,")"]}):(0,f.Y)(O.HoverCard,{trigger:(0,f.FD)("div",{css:(0,D.AH)({color:t.colors.textSecondary,":hover":{textDecoration:"underline"},fontWeight:"normal"},""),children:["(",o,"/",r,")"]}),content:n.formatMessage({id:"pDCDkJ",defaultMessage:"Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more."},{visibleCount:o,totalCount:r,groupName:a}),align:"start"})]})};var to={name:"49aokf",styles:"display:contents"};const no=({history:e,alwaysExpanded:t=!1})=>{const{theme:n}=(0,F.u)(),o=(0,V.tz)(),[r,i]=(0,m.useState)(new Date);(0,m.useEffect)(()=>{const e=setInterval(()=>{i(new Date)},5e3);return()=>{clearInterval(e)}},[]);const a=(0,m.useMemo)(()=>e.reduce((t,n,s)=>{const o=e[s+1];return o?[...t,[n,o]]:t},[]),[e]),{makeHTML:l}=Bt(),d=(0,m.useMemo)(()=>{var t;const n=null===(t=(0,s.first)(e))||void 0===t?void 0:t.rationale;return(0,s.isString)(n)?l(n):null},[e,l]);var c,u,p;if(!a.length)return null!==(c=(0,s.first)(e))&&void 0!==c&&c.rationale?(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:(0,f.Y)("span",{css:to,dangerouslySetInnerHTML:{__html:null!==d&&void 0!==d?d:""}})}):null!==(u=(0,s.first)(e))&&void 0!==u&&u.errorMessage?(0,f.Y)(f.FK,{children:(0,f.Y)(F.T.Text,{color:"error",children:null===(p=(0,s.first)(e))||void 0===p?void 0:p.errorMessage})}):(0,f.Y)(f.FK,{children:!t&&(0,f.FD)("div",{children:[(0,f.Y)(H.S,{size:"sm"}),(0,f.Y)(F.T.Hint,{children:(0,f.Y)(V.sA,{id:"Jj2kRy",defaultMessage:"No details for assessment"})})]})});const g=e=>{const t=(0,E.Zh)(e),n=E.yQ[e.name];if(n&&!(0,s.isNil)(t)){var o;const e=null!==(o=n[t.toString()])&&void 0!==o?o:n.default;if(e)return(0,f.Y)(V.sA,{...e,values:{value:t}})}return t};return(0,f.FD)(f.FK,{children:[(0,f.Y)(H.S,{size:"sm"}),a.map(([e,s],i)=>{var a,l;const d=g(s),c=g(e),u=d===c,m=(0,E.CH)(e)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):kt(e.timestamp,r);return(0,f.FD)("div",{css:(0,D.AH)({marginBottom:t?void 0:n.spacing.md},""),children:[(0,f.FD)(F.T.Hint,{css:(0,D.AH)({marginBottom:n.spacing.xs},""),children:[d&&c&&(0,f.FD)(f.FK,{children:[(0,f.Y)("code",{children:g(s)})," \u2192 ",(0,f.Y)("code",{children:g(e)})," "]}),u?(0,f.Y)(V.sA,{id:"2/B9Zg",defaultMessage:"added {when} by {user}",values:{when:m,user:null===(a=e.source)||void 0===a?void 0:a.sourceId}}):(0,f.Y)(V.sA,{id:"4TDvGX",defaultMessage:"edited {when} by {user}",values:{when:m,user:null===(l=e.source)||void 0===l?void 0:l.sourceId}})]}),e.rationale&&(0,f.Y)(F.T.Text,{children:e.rationale})]},`${e.timestamp}-${i}`)})]})},so=({assessmentHistory:e,children:t,disable:n=!1})=>{const o=(0,V.tz)(),r=(0,m.useMemo)(()=>e.some(E.hG),[e]),[i,a]=(0,m.useState)(new Date);(0,m.useEffect)(()=>{const e=setInterval(()=>{a(new Date)},5e3);return()=>{clearInterval(e)}},[]);return(0,f.Y)(H.T,{componentId:"web-shared.genai-traces-table.evaluations-review-assessment.tooltip",content:n?void 0:(0,f.Y)("span",{children:(()=>{const t=(0,s.first)(e);if(!t)return;if((0,E.w_)(t)){var n,a;const s=e[1],r=s?null===(n=(0,E.Zh)(s))||void 0===n?void 0:n.toString():void 0,c=(0,E.CH)(t)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):kt(t.timestamp,i);if(r){var l,d;const e=null===(l=E.yQ[t.name])||void 0===l?void 0:l[r],n=e?o.formatMessage(e):r;return(0,f.Y)(V.sA,{id:"kHN/4I",defaultMessage:"Edited {timeSince} by {source}. Original value: {value}",values:{timeSince:c,source:null===t||void 0===t||null===(d=t.source)||void 0===d?void 0:d.sourceId,value:n}})}return(0,f.Y)(V.sA,{id:"m8ztHR",defaultMessage:"Edited {timeSince} by {source}.",values:{timeSince:c,source:null===t||void 0===t||null===(a=t.source)||void 0===a?void 0:a.sourceId}})}return r?(0,f.Y)(V.sA,{id:"4uE8hl",defaultMessage:"Overall assessment added by LLM-as-a-judge"}):null!==t&&void 0!==t&&t.errorMessage?null===t||void 0===t?void 0:t.errorMessage:(0,f.Y)(V.sA,{id:"gn1eO9",defaultMessage:"Assessment added by LLM-as-a-judge"})})()}),side:"top",children:t})},oo=({editedAssessment:e,valueSuggestions:t,onSave:n,onCancel:s,readOnly:o=!1})=>{var r;const{theme:i}=(0,F.u)(),a=(0,V.tz)(),[l,d]=(0,m.useState)(()=>(null===e||void 0===e?void 0:e.rationale)||void 0),[c,u]=(0,m.useState)(""),[p,g]=(0,m.useState)(()=>{if(e){var n;const o=null===(n=(0,E.Zh)(e))||void 0===n?void 0:n.toString();var s;return o?null!==(s=t.find(e=>e.key===o))&&void 0!==s?s:{key:o,label:o}:{key:e.name,label:e.name}}return{key:"",label:""}}),[h,v]=(0,m.useState)(!1),y=(0,m.useMemo)(()=>t.filter(e=>e.label.toLowerCase().includes(c.toLowerCase())),[c,t]),x=h?t:y,b=c||x.length>0,w=(0,O.useComboboxState)({componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124",allItems:t,items:x,setItems:()=>{},setInputValue:e=>{v(!1),u(e)},multiSelect:!1,allowNewValue:!0,itemToString:e=>e?e.label:"",formValue:p,initialSelectedItem:p,initialInputValue:null!==(r=null===p||void 0===p?void 0:p.label)&&void 0!==r?r:"",formOnChange:e=>{(null===p||void 0===p?void 0:p.label)!==e&&g("string"!==typeof e?e:{key:null!==c&&void 0!==c?c:"",label:null!==c&&void 0!==c?c:""})},onIsOpenChange(e){e&&v(!0)}}),S=a.formatMessage({id:"bCdY2j",defaultMessage:'Add "{label}"'},{label:c});return(0,f.FD)("div",{children:[(0,f.FD)(O.TypeaheadComboboxRoot,{comboboxState:w,children:[(0,f.Y)(O.TypeaheadComboboxInput,{readOnly:o,css:(0,D.AH)({width:300,backgroundColor:i.colors.backgroundPrimary},""),placeholder:a.formatMessage({id:"nxzK82",defaultMessage:"Select or type an assessment"}),onKeyUp:e=>{-1===w.highlightedIndex&&"Enter"===e.key&&w.closeMenu()},comboboxState:w,formOnChange:e=>{g(e)}}),b&&(0,f.Y)(O.TypeaheadComboboxMenu,{comboboxState:w,emptyText:S,matchTriggerWidth:!0,children:x.map((e,t)=>(0,f.Y)(O.TypeaheadComboboxMenuItem,{item:e,index:t,comboboxState:w,isDisabled:(null===e||void 0===e?void 0:e.disabled)||!1,children:e.label},`${e.key}-${t}`))})]}),(0,f.Y)(H.S,{size:"sm"}),(0,f.Y)("div",{css:(0,D.AH)({backgroundColor:i.colors.backgroundPrimary,borderRadius:i.general.borderRadiusBase},""),children:(0,f.Y)(L.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160",autoSize:!0,value:null!==l&&void 0!==l?l:"",onChange:e=>d(e.target.value),placeholder:a.formatMessage({id:"r/mP0/",defaultMessage:"Add rationale (optional)"})})}),(0,f.Y)(H.S,{size:"sm"}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:i.spacing.xs},""),children:[(0,f.Y)(F.B,{size:"small",type:"primary",componentId:"mlflow.evaluations_review.confirm_edited_assessment_button",onClick:()=>{var t,s;if(!p)return;const o=null!==(t=null!==(s=p.rootAssessmentName)&&void 0!==s?s:null===e||void 0===e?void 0:e.name)&&void 0!==t?t:p.key,r=o===p.key||p.key;n({value:r,rationale:l,assessmentName:o})},disabled:!(null!==p&&void 0!==p&&p.key),children:(0,f.Y)(V.sA,{id:"/k6j6v",defaultMessage:"Confirm"})}),(0,f.Y)(F.B,{size:"small",type:"tertiary",componentId:"mlflow.evaluations_review.cancel_edited_assessment_button",onClick:s,children:(0,f.Y)(V.sA,{id:"5e1r3Y",defaultMessage:"Cancel"})})]})]})},ro=(e,t)=>{const n=(0,V.tz)(),[s,o]=(0,m.useState)(void 0),[r,i]=(0,m.useState)(!1),[a,l]=(0,m.useState)([]),d=(0,m.useCallback)((s,r)=>{o(r),i(s),l((0,E.rU)(n,r,e,t))},[n,t,e]),c=(0,m.useCallback)(e=>d(!0,e),[d]);return{suggestions:a,editingAssessment:s,showUpsertForm:r,addAssessment:(0,m.useCallback)(()=>d(!0,void 0),[d]),editAssessment:c,closeForm:(0,m.useCallback)(()=>{o(void 0),i(!1)},[])}};var io={name:"49aokf",styles:"display:contents"};const ao=({assessmentsType:e,assessmentName:t,assessmentHistory:n,rootCauseAssessment:o,onUpsertAssessment:r,allowEditing:i=!1,options:a,inputs:l,assessmentInfo:d,assessmentInfos:c})=>{const{theme:u}=(0,F.u)(),p=(0,V.tz)(),g="overall"===e,{suggestions:h,editingAssessment:v,showUpsertForm:y,editAssessment:x,closeForm:b}=ro(n,c);(0,m.useEffect)(()=>{b()},[l,b]);const w=(0,s.first)(n),S=E.c9[t],Y=S?p.formatMessage(S):t,A=Boolean(w&&(0,E.Zh)(w)),T=Boolean(w&&(0,E.CH)(w)),I=i&&(A||T),{makeHTML:C}=Bt(),M=(0,m.useMemo)(()=>{var e;const t=null===w||void 0===w||null===(e=w.rootCauseAssessment)||void 0===e?void 0:e.suggestedActions;return(0,s.isString)(t)?C(t):null},[w,C]);return(0,f.FD)("div",{css:(0,D.AH)({display:"block",marginBottom:g?void 0:u.spacing.md},""),children:[!y&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[t!==E._1.OVERALL_ASSESSMENT&&(0,f.Y)("div",{css:(0,D.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:(0,f.Y)(Gt,{assessment:w,"aria-label":Y,disableJudgeTypeIcon:(0,E.xO)(w),onEdit:I?()=>{const e=(0,s.first)(n);e&&x(e)}:void 0,assessmentInfo:d,type:"assessment-value"})}),(0,f.Y)(no,{history:n,alwaysExpanded:g}),o&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginTop:u.spacing.xs},""),children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.BugIcon,{color:"danger"}),(0,f.Y)(F.T.Text,{bold:!0,children:(0,f.Y)(V.sA,{id:"M8pHqP",defaultMessage:"Root cause failure:"})}),(0,f.Y)(Gt,{assessment:o,isRootCauseAssessment:!0,"aria-label":Y,assessmentInfo:d,type:"assessment-value"})]}),(0,f.Y)(no,{history:[o],alwaysExpanded:g}),M&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.AssistantIcon,{color:"ai"}),(0,f.Y)(F.T.Text,{bold:!0,children:(0,f.Y)(V.sA,{id:"vCUglz",defaultMessage:"Suggested actions"})})]}),(0,f.Y)("span",{css:io,dangerouslySetInnerHTML:{__html:M}})]})]})]}),y&&(0,f.Y)(f.FK,{children:(0,f.Y)(oo,{editedAssessment:v,valueSuggestions:h,onCancel:b,onSave:({value:e,rationale:t,assessmentName:n})=>{var s;const o=g?E._1.OVERALL_ASSESSMENT:"",i=(0,E.aj)({name:null!==(s=null!==n&&void 0!==n?n:null===v||void 0===v?void 0:v.name)&&void 0!==s?s:o,isOverallAssessment:g,value:e,rationale:t});r(i),b()}},null===v||void 0===v?void 0:v.name)})]},t)};var lo={name:"eivff4",styles:"display:none"};const co=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:r=!1,options:i,inputs:a,assessmentInfos:l})=>{const{theme:d}=(0,F.u)(),c="overall"===e,u=t.filter(([e,t])=>t.length>0),{suggestions:p,editingAssessment:g,showUpsertForm:h,addAssessment:v,closeForm:y}=ro(u.flatMap(([e,t])=>t),l);(0,m.useEffect)(()=>{y()},[a,y]);const x=Object.keys(u).length>0,b=o&&(r||!x);return(0,f.FD)(f.FK,{children:[(0,f.FD)("div",{css:(0,D.AH)({display:"block",flexWrap:"wrap",gap:d.spacing.xs},""),children:[u.map(([t,r])=>{const d=l.find(e=>e.name===t);return d?(0,f.Y)(ao,{assessmentsType:e,assessmentName:t,assessmentHistory:r,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o,options:i,inputs:a,assessmentInfo:d,assessmentInfos:l},t):(0,f.Y)("div",{css:lo},t)}),b&&(0,f.Y)(F.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:v,icon:(0,f.Y)(O.PlusIcon,{}),size:"small",children:(0,f.Y)(V.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),h&&(0,f.FD)(f.FK,{children:[(0,f.Y)(H.S,{size:"sm"}),(0,f.Y)(oo,{valueSuggestions:p,onCancel:y,onSave:({value:e,rationale:t,assessmentName:n})=>{var o;const r=c?E._1.OVERALL_ASSESSMENT:n||"",i=(0,E.aj)({name:null!==(o=null!==n&&void 0!==n?n:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:r,isOverallAssessment:c,value:e,rationale:t});s(i),y()}})]})]})};var uo={name:"49aokf",styles:"display:contents"};const mo=({assessmentsType:e,assessmentsByName:t,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:r=!1,options:i,inputs:a,assessmentInfos:l})=>{const{theme:d}=(0,F.u)(),c=(0,V.tz)(),u="overall"===e,{suggestions:p,editingAssessment:g,showUpsertForm:h,addAssessment:v,editAssessment:y,closeForm:x}=ro(t.flatMap(([e,t])=>t),l);(0,m.useEffect)(()=>{x()},[a,x]);const b=t.filter(([e,t])=>t.length>0),w=Object.keys(b).length>0,S=o&&(r||!w);return(0,f.FD)(f.FK,{children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexWrap:"wrap",gap:d.spacing.xs,alignItems:"center"},""),children:[b.map(([e,t])=>{const n=(0,s.first)(t),r=l.find(t=>t.name===e);if(!r)return(0,f.Y)(f.FK,{});const i=E.c9[e],a=i?c.formatMessage(i):e,d=Boolean(n&&(0,E.Zh)(n)),u=Boolean(n&&(0,E.CH)(n)),m=o&&(d||u)&&r.isEditable;return(0,f.Y)("div",{css:uo,children:(0,f.Y)(so,{assessmentHistory:t,children:(0,f.Y)(Gt,{assessment:n,"aria-label":a,active:(null===g||void 0===g?void 0:g.name)===e&&h,disableJudgeTypeIcon:(0,E.xO)(n),onEdit:m?()=>{const e=(0,s.first)(t);e&&y(e)}:void 0,assessmentInfo:r,type:"assessment-value"})})},e)}),S&&(0,f.Y)(F.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:v,icon:(0,f.Y)(O.PlusIcon,{}),size:"small",children:(0,f.Y)(V.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),h&&(0,f.FD)(f.FK,{children:[(0,f.Y)(H.S,{size:"sm"}),(0,f.Y)(oo,{editedAssessment:g,valueSuggestions:p,onCancel:x,onSave:({value:e,rationale:t,assessmentName:s})=>{var o;const r=u?E._1.OVERALL_ASSESSMENT:s||"",i=(0,E.aj)({name:null!==(o=null!==s&&void 0!==s?s:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:r,isOverallAssessment:u,value:e,rationale:t});n(i),x()}},null===g||void 0===g?void 0:g.name)]})]})},po=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:r=!1,alwaysExpanded:i=!1,options:a,inputs:l,assessmentInfos:d})=>{const[c,u]=(0,m.useState)(!1),p=i||c,g=t.filter(([e,t])=>t.length>0);let h=t;"overall"!==e&&(h=t.filter(([e,t])=>e!==E._1.OVERALL_ASSESSMENT));const v=Object.keys(g).length>0;return(0,f.FD)(f.FK,{children:[p&&(0,f.Y)(co,{assessmentsType:e,assessmentsByName:h,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o,allowMoreThanOne:r,options:a,inputs:l,assessmentInfos:d}),!p&&(0,f.Y)(mo,{assessmentsType:e,assessmentsByName:h,onUpsertAssessment:s,allowEditing:o,allowMoreThanOne:r,options:a,inputs:l,assessmentInfos:d}),v&&!i&&(0,f.FD)(f.FK,{children:[(0,f.Y)(H.S,{size:"sm"}),(0,f.Y)(F.B,{size:"small",type:"tertiary",componentId:"overall"===e?"mlflow.evaluations_review.see_assessment_details_overall_button":"response"===e?"mlflow.evaluations_review.see_assessment_details_response_button":"mlflow.evaluations_review.see_assessment_details_retrieval_button",icon:p?(0,f.Y)(O.ChevronUpIcon,{}):(0,f.Y)(F.o,{}),onClick:()=>u(e=>!e),children:p?(0,f.Y)(V.sA,{id:"G7V4y3",defaultMessage:"Hide details"}):(0,f.Y)(V.sA,{id:"pfyUes",defaultMessage:"See details"})})]})]})},go=({toBeReviewed:e,containsOverallAssessment:t,isNextResultAvailable:n,overridingExistingReview:s,hasPendingAssessments:o,onClickNext:r,onSave:i,onCancelOverride:a})=>e?o?(0,f.Y)(F.B,{type:"primary",componentId:"mlflow.evaluations_review.save_pending_assessments_button",onClick:i,children:(0,f.Y)(V.sA,{id:"m1Nb7W",defaultMessage:"Save"})}):s?(0,f.Y)(F.B,{componentId:"mlflow.evaluations_review.cancel_override_assessments_button",onClick:a,children:(0,f.Y)(V.sA,{id:"e9qVjz",defaultMessage:"Cancel"})}):(0,f.Y)(F.B,{type:"primary",componentId:"mlflow.evaluations_review.mark_as_reviewed_button",onClick:i,disabled:!t,children:(0,f.Y)(V.sA,{id:"Ls2ris",defaultMessage:"Mark as reviewed"})}):(0,f.Y)(F.B,{type:"primary",componentId:"mlflow.evaluations_review.next_evaluation_result_button",onClick:r,endIcon:(0,f.Y)(F.o,{}),disabled:!n,children:(0,f.Y)(V.sA,{id:"CBnbqy",defaultMessage:"Next"})}),fo=()=>{const{theme:e}=(0,F.u)();return(0,f.Y)("div",{css:(0,D.AH)({width:"1.5px",backgroundColor:e.colors.border},"")})};var ho={name:"82a6rk",styles:"flex:1"},vo={name:"82a6rk",styles:"flex:1"};const yo=({evaluationResult:e,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:i,overridingExistingReview:a=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{var m;const{theme:p}=(0,F.u)(),g=(0,V.tz)();if(!e)return null;const h=(0,s.first)(e.overallAssessments),v=null===h||void 0===h||null===(m=h.rootCauseAssessment)||void 0===m?void 0:m.assessmentName,y=v?(0,s.first)(null===e||void 0===e?void 0:e.responseAssessmentsByName[v]):void 0,x=!c&&(!(0,E.vP)(e)||a),b=g.formatMessage({id:"d44IPd",defaultMessage:"Reopen review"}),w=[[E._1.OVERALL_ASSESSMENT,e.overallAssessments]],S=u.find(e=>e.name===E._1.OVERALL_ASSESSMENT);return(0,f.FD)("div",{css:ho,children:[(0,f.FD)("div",{css:(0,D.AH)({paddingLeft:p.spacing.md,paddingRight:p.spacing.md},""),children:[(0,f.FD)("div",{css:(0,D.AH)({backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,paddingBottom:0,display:"flex",flexDirection:"column",gap:p.spacing.sm},""),children:[S&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:p.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.SparkleDoubleIcon,{color:"ai"}),(0,f.Y)(F.T.Text,{bold:!0,children:(0,f.Y)(V.sA,{id:"ML+mQa",defaultMessage:"Overall assessment:"})}),(0,f.Y)(Gt,{assessment:h,"aria-label":E._1.OVERALL_ASSESSMENT,disableJudgeTypeIcon:(0,E.xO)(h),assessmentInfo:S,type:"assessment-value"})]}),(0,f.Y)(po,{assessmentsType:"overall",assessmentsByName:w,rootCauseAssessment:y,onUpsertAssessment:t,allowEditing:x,alwaysExpanded:!0,options:[E._1.OVERALL_ASSESSMENT],assessmentInfos:u}),(0,f.FD)("div",{css:(0,D.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,padding:p.spacing.sm},""),children:[(0,f.Y)(F.T.Text,{bold:!0,children:(0,f.Y)(V.sA,{id:"5jXYY4",defaultMessage:"Detailed assessments"})}),(0,f.Y)(H.S,{size:"sm"}),(0,f.Y)(po,{assessmentsType:"response",assessmentsByName:(0,E.Xe)(e.responseAssessmentsByName),onUpsertAssessment:t,allowEditing:x,allowMoreThanOne:!0,options:E.PB,assessmentInfos:u})]})]}),(0,f.FD)("div",{css:(0,D.AH)({position:"sticky",backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,top:0,display:"flex",justifyContent:"space-between",gap:p.spacing.sm,zIndex:p.options.zIndexBase},""),children:[(0,f.Y)("div",{children:!x&&!c&&(0,f.FD)("div",{css:(0,D.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,display:"flex",alignItems:"center",gap:p.spacing.sm,padding:`${p.spacing.xs}px ${p.spacing.sm}px`},""),children:[(0,f.Y)(O.CheckCircleIcon,{css:(0,D.AH)({color:p.colors.textValidationSuccess},"")}),(0,f.Y)(F.T.Hint,{children:(0,f.Y)(V.sA,{id:"zLTdCZ",defaultMessage:"Reviewed"})}),(0,f.Y)(H.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149",content:b,children:(0,f.Y)(F.B,{"aria-label":b,componentId:"mlflow.evaluations_review.reopen_review_button",size:"small",icon:(0,f.Y)(O.PencilIcon,{}),onClick:()=>d(!0)})})]})}),(0,f.Y)("div",{css:vo}),l.length>0&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:p.spacing.sm},""),children:[(0,f.Y)(V.sA,{id:"MB3kda",defaultMessage:"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}",values:{pendingCount:l.length}}),(0,f.Y)(F.B,{componentId:"mlflow.evaluations_review.discard_pending_assessments_button",onClick:r,children:(0,f.Y)(V.sA,{id:"eIWfRN",defaultMessage:"Discard"})})]}),(0,f.Y)(go,{onSave:async()=>{await n(),d(!1)},containsOverallAssessment:Boolean(h),isNextResultAvailable:Boolean(i),onClickNext:o,toBeReviewed:x,hasPendingAssessments:l.length>0,overridingExistingReview:a,onCancelOverride:()=>d(!1)})]})]}),(0,f.Y)(H.S,{size:"md"})]})},xo=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:i,overridingExistingReview:a=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{const{theme:m}=(0,F.u)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",gap:m.spacing.sm},""),children:[e&&(0,f.Y)(yo,{evaluationResult:e,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:i,overridingExistingReview:a,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:c,assessmentInfos:u}),t&&(0,f.FD)(f.FK,{children:[(0,f.Y)(fo,{}),(0,f.Y)(yo,{evaluationResult:t,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:i,overridingExistingReview:a,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:!0,assessmentInfos:u})]})]})},bo=({requestId:e,onClose:t,trace:n})=>{const{theme:o}=(0,F.u)(),r=(0,f.Y)(F.T.Title,{level:2,withoutMargins:!0,children:e});return(0,f.Y)(O.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||t()},children:(0,f.Y)(O.Drawer.Content,{componentId:"mlflow.evaluations_review.trace_data_drawer",width:"85vw",title:r,expandContentToFullHeight:!0,children:(()=>{const e=n.data.spans.length>0;return(0,s.isNil)(n)||!e?(0,f.FD)(f.FK,{children:[(0,f.Y)(H.S,{size:"lg"}),(0,f.Y)(O.Empty,{description:null,title:(0,f.Y)(V.sA,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]}):(0,f.Y)("div",{css:(0,D.AH)({height:"100%",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg,marginBottom:-o.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,f.Y)($.a8,{modelTrace:n})})})()})})};var wo={name:"82a6rk",styles:"flex:1"};const So=({experimentId:e,runDisplayName:t,evaluationResult:n,exportToEvalsInstanceEnabled:o=!1,traceQueryResult:r,getTrace:i})=>{var a,l;const d=(0,V.tz)(),{theme:c}=(0,F.u)(),[u,p]=(0,m.useState)(null),g=null===(a=n.traceInfo)||void 0===a||null===(l=a.trace_metadata)||void 0===l?void 0:l["databricks.tracingserver.dropped_spans_size_bytes"];let h;if(!(0,s.isNil)(g)){const e=2,t=Lt(Number(g),e);h=`${t.value} ${t.unit}`}return(0,f.FD)("div",{css:wo,children:[(0,f.FD)("div",{css:(0,D.AH)({paddingLeft:c.spacing.md,paddingRight:c.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",gap:c.spacing.sm},""),children:[(0,f.Y)(F.T.Title,{level:4,children:t}),n.requestId&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:c.spacing.sm},""),children:[o&&i&&(0,f.Y)(q,{experimentId:e,selectedTraces:[n],traceInfos:void 0}),(0,f.Y)(H.T,{delayDuration:0,componentId:"mlflow.evaluations_review.see_detailed_trace_view_tooltip",content:g?`The trace spans were not stored due to their large size: ${h}`:void 0,side:"left",children:(0,f.Y)(F.B,{componentId:"mlflow.evaluations_review.see_detailed_trace_view_button",onClick:()=>p(n.requestId),loading:r.isLoading,disabled:!(0,s.isNil)(g),children:(0,f.Y)(V.sA,{id:"HUC492",defaultMessage:"See detailed trace view"})})})]}),u&&((0,s.isNil)(r.data)?(0,f.Y)(f.FK,{children:d.formatMessage({id:"EZfSbs",defaultMessage:"No trace data available"})}):(0,f.Y)(bo,{onClose:()=>{p(null)},requestId:u,trace:r.data}))]}),(0,f.Y)(H.S,{size:"md"})]})},Yo=({experimentId:e,runDisplayName:t,otherRunDisplayName:n,evaluationResult:s,otherEvaluationResult:o,exportToEvalsInstanceEnabled:r=!1,traceQueryResult:i,compareToTraceQueryResult:a})=>{const{theme:l}=(0,F.u)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[(0,f.Y)(So,{experimentId:e,runDisplayName:t,evaluationResult:s,exportToEvalsInstanceEnabled:r,traceQueryResult:i}),n&&o&&(0,f.FD)(f.FK,{children:[(0,f.Y)(fo,{}),(0,f.Y)(So,{experimentId:e,runDisplayName:n,evaluationResult:o,exportToEvalsInstanceEnabled:r,traceQueryResult:a})]})]})},Ao=({value:e})=>{const t=(0,m.useMemo)(()=>{if("object"===typeof e&&null!==e)return JSON.stringify(e,null,2);if("string"===typeof e)try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return null}return null},[e]);return(0,f.Y)("div",{css:(0,D.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:t?"monospace":void 0},""),children:t||String(e)})};var To={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Io={name:"1nko30q",styles:"margin-bottom:0 !important"},Co={name:"49aokf",styles:"display:contents"};const Mo=({fieldName:e,title:t,value:n,showCopyIcon:o})=>{const{theme:r}=(0,F.u)(),{makeHTML:i}=Bt(),a=(0,m.useMemo)(()=>(0,s.isString)(n)?i(n):null,[n,i]),l=(0,m.useMemo)(()=>(0,s.isString)(n)?null:(0,E.ng)(n),[n]);return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,flex:1,border:`1px solid ${r.colors.border}`,padding:r.spacing.md,borderRadius:r.general.borderRadiusBase,marginBottom:r.spacing.md},""),children:[(0,f.FD)("div",{css:To,children:[(0,f.Y)(F.T.Text,{bold:!0,children:t}),o&&(0,f.Y)(ze.ad,{copyText:(0,E.ng)(n),componentId:"mlflow.evaluations_review.textbox.copy"})]}),(0,f.Y)(F.T.Paragraph,{css:Io,children:(0,s.isString)(n)?(0,f.Y)("span",{css:Co,dangerouslySetInnerHTML:{__html:null!==a&&void 0!==a?a:""}}):e===E.UN&&Array.isArray(n)?(0,f.Y)("ul",{children:n.map((e,t)=>(0,f.Y)("li",{children:(0,f.Y)(Ao,{value:e},t)},t))}):(0,f.Y)(Ao,{value:l})})]})},Eo=({evaluationResult:e})=>{const{theme:t}=(0,F.u)(),{inputs:n}=e,s=Object.entries(n),o=0===s.length;return(0,f.FD)("div",{css:(0,D.AH)({width:"100%",paddingLeft:t.spacing.md,paddingRight:t.spacing.md},""),children:[(0,f.Y)(F.T.Text,{bold:!0,children:(0,f.Y)(V.sA,{id:"MQ4Voz",defaultMessage:"{count, plural, one {Input} other {Inputs}}",values:{count:s.length}})}),(0,f.Y)(H.S,{size:"sm"}),o&&(0,f.Y)(F.T.Paragraph,{children:(0,f.Y)(V.sA,{id:"gPhm1b",defaultMessage:"No inputs logged"})}),s.map(([e,t])=>(0,f.Y)(Mo,{fieldName:e,title:e,value:t},e))]})},_o=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:n}=(0,F.u)(),s=(null===e||void 0===e?void 0:e.inputsId)===(null===t||void 0===t?void 0:t.inputsId);return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",gap:n.spacing.sm},""),children:[e&&(0,f.Y)(Eo,{evaluationResult:e}),!s&&t&&(0,f.Y)(Eo,{evaluationResult:t})]})};var No={name:"82a6rk",styles:"flex:1"},Ro={name:"82a6rk",styles:"flex:1"};const ko=({evaluationResult:e})=>{const{theme:t}=(0,F.u)(),{outputs:n,targets:s}=e,o=Object.entries(n).filter(([,e])=>!(0,E.Wp)(e)),r=Object.entries(s).filter(([,e])=>!(0,E.Wp)(e)),i=0===o.length&&0===r.length;return(0,f.FD)("div",{css:(0,D.AH)({paddingLeft:t.spacing.md,paddingRight:t.spacing.md,width:"100%"},""),children:[(0,f.Y)(F.T.Text,{bold:!0,children:(0,f.Y)(V.sA,{id:"x6rkyu",defaultMessage:"Response"})}),(0,f.Y)(H.S,{size:"sm"}),i&&(0,f.Y)(F.T.Paragraph,{children:(0,f.Y)(V.sA,{id:"YvxyMH",defaultMessage:"No responses or targets logged"})}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:t.spacing.md,alignItems:"flex-start"},""),children:[o.length>0&&(0,f.Y)("div",{css:No,children:o.map(([e,t])=>{const n=E.eB[e],s=n?(0,f.Y)(V.sA,{...n}):e;return(0,f.Y)(Mo,{fieldName:e,title:s,value:t,showCopyIcon:!0},e)})}),r.length>0&&(0,f.Y)("div",{css:Ro,children:r.map(([e,t])=>{const n=E.Au[e],s=n?(0,f.Y)(V.sA,{...n}):e;return(0,f.Y)(Mo,{fieldName:e,title:s,value:t,showCopyIcon:!0},e)})})]})]})},Do=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:n}=(0,F.u)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",gap:n.spacing.sm},""),children:[e&&(0,f.Y)(ko,{evaluationResult:e}),t&&(0,f.FD)(f.FK,{children:[(0,f.Y)(fo,{}),(0,f.Y)(ko,{evaluationResult:t})]})]})},Fo=({assessment:e,chunkRelevanceAssessmentInfo:t})=>{const{theme:n}=(0,F.u)();return e||t?(0,f.Y)("div",{css:(0,D.AH)({paddingLeft:n.spacing.sm,paddingRight:n.spacing.sm,paddingTop:1,paddingBottom:1,backgroundColor:t?(0,u.x2)(n,t,e):"",borderRadius:n.general.borderRadiusBase,svg:{width:12,height:12}},""),children:e?(0,f.Y)(f.FK,{children:(0,E.w_)(e)?(0,f.Y)(O.UserIcon,{}):(0,f.Y)(O.SparkleDoubleIcon,{})}):(0,f.Y)(O.QuestionMarkIcon,{})}):(0,f.Y)(f.FK,{})};function Oo(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}}var Lo={name:"s5xdrg",styles:"display:flex;align-items:center"};const Ho=({chunk:e,index:t})=>(0,f.FD)("div",{css:Lo,children:[(0,f.FD)(O.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30",children:["#",t+1]}),Oo(e.docUrl)?(0,f.Y)(F.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32",href:e.docUrl,ellipsis:!0,openInNewTab:!0,strong:!0,children:e.docUrl}):(0,f.Y)(F.T.Title,{level:4,withoutMargins:!0,ellipsis:!0,children:e.docUrl})]});var Vo={name:"1vgo6ev",styles:"flex:2;display:flex;flex-direction:column;width:0"},$o={name:"49aokf",styles:"display:contents"};const Bo=({evaluationResult:e,onUpsertAssessment:t,overridingExistingReview:n=!1,isReadOnly:o=!1,assessmentInfos:r,traceQueryResult:i})=>{const{theme:a}=(0,F.u)(),l=(0,V.tz)(),[d,c]=(0,m.useState)(0),{makeHTML:u}=Bt(),p=(0,m.useMemo)(()=>!(0,s.isNil)(e.retrievalChunks)&&e.retrievalChunks.length>0?e.retrievalChunks:(0,W.nr)(e.responseAssessmentsByName,i.data),[e.responseAssessmentsByName,e.retrievalChunks,i.data]),g=(0,m.useMemo)(()=>{var e;return u(null===p||void 0===p||null===(e=p[d])||void 0===e?void 0:e.content)},[p,d,u]),h=0===(p||[]).length,v=!o&&(!(0,E.vP)(e)||n),y=null===p||void 0===p?void 0:p[d],x=l.formatMessage({id:"iPTAj8",defaultMessage:"Retrieval"});return(0,f.FD)("div",{css:(0,D.AH)({paddingLeft:a.spacing.md,paddingRight:a.spacing.md,width:"100%",display:"flex",flexDirection:"column"},""),role:"region","aria-label":x,children:[(0,f.Y)(F.T.Text,{bold:!0,children:x}),(0,s.isNil)(p)&&i.isFetching?(0,f.Y)(O.TableSkeleton,{lines:3}):h?(0,f.Y)(F.T.Text,{children:(0,f.Y)("i",{children:(0,f.Y)(V.sA,{id:"d00egE",defaultMessage:"No span with type RETRIEVER found in trace."})})}):(0,f.FD)("div",{css:(0,D.AH)({minHeight:400,maxHeight:600,overflow:"hidden",display:"flex",marginTop:a.spacing.sm,border:`1px solid ${a.colors.border}`,borderRadius:a.general.borderRadiusBase},""),children:[(0,f.FD)("div",{css:(0,D.AH)({flex:1,flexShrink:1,maxWidth:300,minWidth:200,overflow:"auto",padding:a.spacing.sm,borderRight:`1px solid ${a.colors.border}`},""),role:"listbox",children:[h&&(0,f.Y)(F.T.Paragraph,{children:(0,f.Y)(V.sA,{id:"0Bee6A",defaultMessage:"No retrieval logged"})}),(p||[]).map((e,t)=>{var n,o;const i=r.find(e=>e.name===E._1.CHUNK_RELEVANCE);return(0,f.FD)("div",{role:"option","aria-label":null===(n=e.content)||void 0===n?void 0:n.slice(0,255),"aria-selected":t===d,css:(0,D.AH)({backgroundColor:t===d?a.colors.actionIconBackgroundHover:"transparent","&:hover":{backgroundColor:a.colors.actionIconBackgroundHover},padding:`${a.spacing.sm}px ${a.spacing.md}px`,overflow:"hidden",display:"flex",gap:a.spacing.sm,alignItems:"center",cursor:"pointer",width:"100%"},""),onClick:()=>{c(t)},children:[(0,f.Y)(Fo,{chunkRelevanceAssessmentInfo:i,assessment:(0,s.first)(null===e||void 0===e||null===(o=e.retrievalAssessmentsByName)||void 0===o?void 0:o[E._1.CHUNK_RELEVANCE])}),(0,f.Y)(F.T.Text,{ellipsis:!0,css:(0,D.AH)({flex:1,lineHeight:a.typography.lineHeightLg},""),children:e.content})]},[e.docUrl,t].join("-"))})]}),y&&(0,f.FD)("div",{css:Vo,children:[(0,f.FD)("div",{css:(0,D.AH)({padding:a.spacing.md,borderBottom:`1px solid ${a.colors.border}`},""),children:[(0,f.Y)(Ho,{chunk:y,index:d}),(0,f.Y)(H.S,{size:"md"}),(0,f.Y)(po,{assessmentsType:"retrieval",assessmentsByName:(0,E.Xe)(y.retrievalAssessmentsByName||{}),onUpsertAssessment:e=>{e.metadata||(e.metadata={}),e.metadata[E.bz.CHUNK_INDEX]=d,t(e)},allowEditing:v,allowMoreThanOne:!0,options:E.ER,inputs:[d],assessmentInfos:r})]}),(0,f.Y)("div",{css:(0,D.AH)({padding:a.spacing.md,overflow:"auto"},""),children:(0,f.Y)(F.T.Paragraph,{children:(0,f.Y)("span",{css:$o,dangerouslySetInnerHTML:{__html:null!==g&&void 0!==g?g:""}})})})]})]})]})},Uo=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:n,overridingExistingReview:s=!1,isReadOnly:o=!1,assessmentInfos:r,traceQueryResult:i,compareToTraceQueryResult:a})=>{const{theme:l}=(0,F.u)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[e&&(0,f.Y)(Bo,{evaluationResult:e,onUpsertAssessment:n,overridingExistingReview:s,isReadOnly:o,assessmentInfos:r,traceQueryResult:i}),t&&(0,f.FD)(f.FK,{children:[(0,f.Y)(fo,{}),(0,f.Y)(Bo,{evaluationResult:t,onUpsertAssessment:n,overridingExistingReview:s,isReadOnly:o,assessmentInfos:r,traceQueryResult:a})]})]})};var zo={name:"1cwfdr7",styles:"flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const jo=({evaluationResult:e})=>{const{theme:t}=(0,F.u)();return(0,f.Y)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,overflow:"hidden"},""),children:(0,f.Y)(F.T.Title,{level:2,withoutMargins:!0,css:zo,children:(0,E.sw)(e)})})},Po=({experimentId:e,evaluationResult:t,otherEvaluationResult:n,onSavePendingAssessments:o,onClickNext:r,runDisplayName:i,compareToRunDisplayName:a,isNextAvailable:l=!1,isReadOnly:d=!1,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g})=>{(0,V.tz)();const{pendingAssessments:h,draftEvaluationResult:v,upsertAssessment:y,resetPendingAssessments:x}=(e=>{const[t,n]=(0,m.useReducer)((e,t)=>{switch(t.type){case"resetPendingAssessments":return[];case"upsertAssessment":const n=e.find(e=>e.name===t.payload.name&&(0,E.Pp)(e)===(0,E.Pp)(t.payload));return n?e.map(e=>e===n?""===(0,E.Zh)(e)&&t.payload.stringValue?{...t.payload,stringValue:"",name:t.payload.stringValue}:t.payload:e):[t.payload,...e]}},[]),o=(0,m.useMemo)(()=>{if(!e)return[];const n=t.find(E.hG);return n?[n,...e.overallAssessments]:e.overallAssessments},[e,t]),r=(0,m.useMemo)(()=>{if(!e)return{};const n=(0,s.uniq)([...Object.keys(e.responseAssessmentsByName),...t.filter(e=>!(0,E.hG)(e)&&!(0,E.II)(e)).map(e=>e.name)]);return Object.fromEntries(n.map(n=>{const s=t.filter(e=>e.name===n);return[n,[...s,...e.responseAssessmentsByName[n]||[]]]}))},[e,t]),i=(0,m.useMemo)(()=>{var n;const o=t.filter(E.II);return null===(n=e.retrievalChunks)||void 0===n?void 0:n.map((e,t)=>{var n;const r=o.filter(e=>{var n;return(null===(n=e.metadata)||void 0===n?void 0:n[E.bz.CHUNK_INDEX])===t}),i=(0,s.flatMap)(null!==(n=e.retrievalAssessmentsByName)&&void 0!==n?n:{}),a=(0,s.groupBy)([...r,...i],"name");return Object.keys(a).forEach(e=>{a[e]=(0,s.orderBy)(a[e],"timestamp","desc")}),{...e,retrievalAssessmentsByName:a}})},[t,e]),a=(0,m.useMemo)(()=>({...e,overallAssessments:o,responseAssessmentsByName:r,retrievalChunks:i}),[e,o,r,i]),l=(0,m.useCallback)(e=>n({type:"upsertAssessment",payload:e}),[]),d=(0,m.useCallback)(()=>n({type:"resetPendingAssessments"}),[]);return{pendingAssessments:t,draftEvaluationResult:a,upsertAssessment:l,resetPendingAssessments:d}})(t),[b,w]=(h.length,(0,m.useState)(!1)),S=Boolean(t.errorCode),Y=Boolean(t.errorMessage),A=S||Y,[T,I]=(0,m.useState)(!1);return(0,f.FD)(f.FK,{children:[A?(0,f.FD)(f.FK,{children:[(0,f.Y)(O.Alert,{action:Y&&(0,f.Y)(F.B,{componentId:`mlflow.evaluations_review.evaluation_error_alert.show_${T?"less":"more"}_button`,onClick:()=>I(e=>!e),children:T?(0,f.Y)(V.sA,{id:"qVQYZH",defaultMessage:"Show less"}):(0,f.Y)(V.sA,{id:"U4s/77",defaultMessage:"Show more"})}),closable:!1,componentId:"mlflow.evaluations_review.evaluation_error_alert",message:S?`${t.errorCode}`:"UNKNOWN_ERROR",description:T&&`${t.errorMessage}`,type:"error"}),(0,f.Y)(H.S,{size:"md"})]}):null,(0,f.Y)(Yo,{experimentId:e,runDisplayName:i,otherRunDisplayName:a,evaluationResult:t,otherEvaluationResult:n,exportToEvalsInstanceEnabled:c,traceQueryResult:p,compareToTraceQueryResult:g}),(0,f.Y)(xo,{evaluationResult:v,otherEvaluationResult:n,onUpsertAssessment:y,onClickNext:r,onSavePendingAssessments:async()=>{await(null===o||void 0===o?void 0:o(t,h)),x()},isNextAvailable:l,overridingExistingReview:b,setOverridingExistingReview:w,pendingAssessments:h,onResetPendingAssessments:x,isReadOnly:d,assessmentInfos:u}),(0,f.Y)(_o,{evaluationResult:t,otherEvaluationResult:n}),(0,f.Y)(Do,{evaluationResult:t,otherEvaluationResult:n}),(0,f.Y)(Uo,{evaluationResult:v,otherEvaluationResult:n,onUpsertAssessment:y,overridingExistingReview:b,isReadOnly:d,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g}),(0,f.Y)(H.S,{size:"lg"})]})};var Ko={name:"ujpwkd",styles:"display:flex;position:relative;overflow:scroll"},Wo={name:"1tc6xju",styles:"flex:1;overflow:auto"};const qo=({experimentId:e,evaluation:t,otherEvaluation:n,className:s,runUuid:o,isReadOnly:r=!1,selectNextEval:i,isNextAvailable:a,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g,saveAssessmentsQuery:h})=>{const{theme:v}=(0,F.u)(),y=(0,m.useCallback)(async(e,t)=>{if(!e||r||!o||!h)return;const n=t.slice();if((0,E.ik)(e,t)){const t=(0,E.YZ)(e);t&&n.unshift(t)}return h.savePendingAssessments(o,e.evaluationId,n)},[o,r,h]),x=(0,m.useRef)(null);return(0,m.useEffect)(()=>{var e;null===(e=x.current)||void 0===e||e.scrollTo(0,0)},[t.evaluationId]),(0,f.FD)("div",{css:Ko,className:s,children:[(0,f.Y)("div",{css:Wo,ref:x,children:(0,f.Y)(Po,{experimentId:e,evaluationResult:t,otherEvaluationResult:n,onSavePendingAssessments:y,onClickNext:i,isNextAvailable:a,isReadOnly:r||!o,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g},t.evaluationId)}),(null===h||void 0===h?void 0:h.isSaving)&&(0,f.Y)("div",{css:(0,D.AH)({inset:0,position:"absolute",backgroundColor:v.colors.overlayOverlay,display:"flex",justifyContent:"center",alignItems:"center",zIndex:v.options.zIndexBase+1},""),children:(0,f.Y)(F.S,{size:"large",inheritColor:!0,css:(0,D.AH)({color:v.colors.backgroundPrimary},"")})})]})},Go=()=>{var e;return{enableRunEvaluationWriteFeatures:null!==(e=(0,K.UK)())&&void 0!==e&&e}},Qo=(0,m.createContext)(Go()),Jo=({config:e={},children:t})=>{const n=Go(),o=(0,s.merge)({},n,e);return(0,f.Y)(Qo.Provider,{value:o,children:t})};var Zo=n(12129);function Xo(e,t,n){const o=(0,m.useMemo)(()=>{var e;if(t)return(0,$.gD)(t)?(0,W.mF)(t):null!==(e=t.request_id)&&void 0!==e?e:""},[t]),r=(0,m.useCallback)(t=>!e||(0,s.isNil)(o)?Promise.resolve(void 0):e(o,t),[e,o]),i=(0,m.useRef)(0);(0,m.useEffect)(()=>{i.current=0},[o]);return(0,ge.I)({queryKey:["getTrace",o],queryFn:()=>r(t),enabled:!(0,s.isNil)(e)&&!(0,s.isNil)(o),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0,refetchInterval:!!n&&(e=>{var t,n,s,o;const r=e&&(0,$.gD)(e.info)?e.info:void 0;if("ERROR"===(null===r||void 0===r?void 0:r.state))return!1;if(!r||"IN_PROGRESS"===r.state)return 1e3;const a=null===(t=r.trace_metadata)||void 0===t?void 0:t["mlflow.trace.sizeStats"];if(!a)return!1;return JSON.parse(a).num_spans===(null!==(n=null===e||void 0===e||null===(s=e.data)||void 0===s||null===(o=s.spans)||void 0===o?void 0:o.length)&&void 0!==n?n:0)?(i.current=0,!1):(i.current+=1,i.current>=60?(i.current=0,!1):1e3)})})}const er=(e,t)=>!(!(0,$.ho)(e)||(null===t||void 0===t?void 0:t.fullTraceId)!==e)||(null===t||void 0===t?void 0:t.evaluationId)===e;var tr={name:"inxa61",styles:"flex:1;overflow:hidden"};const nr=m.memo(({experimentId:e,runUuid:t,evaluations:n,selectedEvaluationId:o,onChangeEvaluationId:r,runDisplayName:i,otherRunDisplayName:a,exportToEvalsInstanceEnabled:l=!1,assessmentInfos:d,getTrace:c,saveAssessmentsQuery:u})=>{var p,g,h,v,y,x,b;const{theme:w}=(0,F.u)(),[S,Y]=(0,m.useState)(!1),A=(0,m.useCallback)(()=>{r(void 0)},[r]),T=(0,m.useCallback)(e=>er(o,e.currentRunValue)||er(o,e.otherRunValue),[o]),I=(0,m.useMemo)(()=>n?(null===n||void 0===n?void 0:n.findIndex(T))-1:void 0,[n,T]),C=(0,m.useMemo)(()=>void 0!==I&&I>=0,[I]),M=(0,m.useMemo)(()=>n?(null===n||void 0===n?void 0:n.findIndex(T))+1:void 0,[n,T]),E=(0,m.useMemo)(()=>void 0!==M&&M<n.length,[M,n]),_=(0,m.useCallback)(()=>{var e,t,s,o;if(null===n||void 0===I)return;const i=(null===(e=n[I])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(s=n[I])||void 0===s||null===(o=s.otherRunValue)||void 0===o?void 0:o.evaluationId);r(i)},[n,I,r]),{renderExportTracesToDatasetsModal:N}=(0,$.SO)(),R=(0,m.useCallback)(()=>{var e,t,s,o;if(null===n||void 0===M)return;const i=(null===(e=n[M])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(s=n[M])||void 0===s||null===(o=s.otherRunValue)||void 0===o?void 0:o.evaluationId);r(i)},[n,M,r]),k=(0,m.useMemo)(()=>null===n||void 0===n?void 0:n.find(T),[n,T]),L=(0,m.useMemo)(()=>M&&n?null===n||void 0===n?void 0:n[M]:void 0,[n,M]),H=(0,m.useMemo)(()=>I&&n?null===n||void 0===n?void 0:n[I]:void 0,[n,I]),V=(0,m.useContext)(Qo)||Go(),B=(0,W.ZZ)(null===k||void 0===k||null===(p=k.currentRunValue)||void 0===p?void 0:p.traceInfo)===W.Cf,U=Xo(c,null===k||void 0===k||null===(g=k.currentRunValue)||void 0===g?void 0:g.traceInfo,B),z=Xo(c,null===k||void 0===k||null===(h=k.otherRunValue)||void 0===h?void 0:h.traceInfo,B),j=(0,m.useMemo)(()=>Boolean(n)&&!k&&Boolean(o),[n,k,o]),P=((e,t)=>{const n=(0,m.useMemo)(()=>{if(t)return(e=>{if(!(0,$.ho)(e))return;const[,t,n]=e.split("/");return{trace_id:n,trace_location:t.includes(".")?(0,Zo.fi)(t):(0,Zo.$U)(t)}})(t)},[t]);return(0,ge.I)({queryKey:["getTrace",t],queryFn:()=>null===e||void 0===e?void 0:e(t,n),enabled:!(0,s.isNil)(e)&&!(0,s.isNil)(t),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0})})(c,j?o:void 0);Xo(c,null===L||void 0===L||null===(v=L.currentRunValue)||void 0===v?void 0:v.traceInfo),Xo(c,null===H||void 0===H||null===(y=H.currentRunValue)||void 0===y?void 0:y.traceInfo);const K=Boolean(null===k||void 0===k?void 0:k.currentRunValue)!==Boolean(null===k||void 0===k?void 0:k.otherRunValue),q=j?P:er(o,null===k||void 0===k?void 0:k.currentRunValue)?U:z;if((0,s.isNil)(k)&&!j)return(0,f.Y)(f.FK,{});const G=()=>{if(j){var e,t;if(P.isLoading)return(0,f.Y)(O.GenericSkeleton,{css:(0,D.AH)({width:200,height:w.general.heightBase},"")});if(null!==(e=P.data)&&void 0!==e&&e.info&&(0,$.gD)(null===(t=P.data)||void 0===t?void 0:t.info)){var n;const e=(0,W.ih)(null===(n=P.data)||void 0===n?void 0:n.info);return(0,f.Y)(jo,{evaluationResult:e})}}return null!==k&&void 0!==k&&k.currentRunValue?(0,f.Y)(jo,{evaluationResult:k.currentRunValue}):null!==k&&void 0!==k&&k.otherRunValue?(0,f.Y)(jo,{evaluationResult:k.otherRunValue}):null},Q=null===k||void 0===k||null===(x=k.currentRunValue)||void 0===x?void 0:x.traceInfo,J=(0,f.FD)(f.FK,{children:[!(0,$.Z9)()&&!q.data&&q.isFetching&&(0,f.Y)(O.GenericSkeleton,{label:"Loading trace...",style:{width:"calc(100% - 45px)",height:"calc(100% - 100px)",position:"absolute",paddingRight:500,zIndex:2100,backgroundColor:w.colors.backgroundPrimary}}),(j&&null!==P&&void 0!==P&&P.data||K)&&!(0,s.isNil)(q.data)?(0,f.Y)("div",{css:(0,D.AH)({height:"calc(100% - 34px)",marginLeft:-w.spacing.lg,marginRight:-w.spacing.lg},""),children:(0,f.Y)(or,{traceData:q.data,showLoadingState:(0,$.Z9)()&&q.isFetching})}):(null===k||void 0===k?void 0:k.currentRunValue)&&((0,$.Z9)()&&q.isFetching?(0,f.Y)("div",{css:(0,D.AH)({marginLeft:-w.spacing.lg,marginRight:-w.spacing.lg},""),children:(0,f.Y)($.Fn,{})}):(0,f.Y)("div",{css:(0,$.Z9)()?{overflow:"auto",height:"100%"}:{display:"contents"},children:(0,f.Y)(qo,{experimentId:e,evaluation:k.currentRunValue,otherEvaluation:k.otherRunValue,selectNextEval:R,isNextAvailable:E,css:tr,runUuid:t,isReadOnly:!V.enableRunEvaluationWriteFeatures,runDisplayName:i,compareToRunDisplayName:a,exportToEvalsInstanceEnabled:l,assessmentInfos:d,traceQueryResult:U,compareToTraceQueryResult:z,saveAssessmentsQuery:u})}))]});return(0,$.Z9)()?(0,f.Y)($.RI,{handleClose:A,isNextAvailable:E,isPreviousAvailable:C,selectNextEval:R,selectPreviousEval:_,renderModalTitle:G,isLoading:q.isFetching,experimentId:e,traceInfo:Q,children:J}):(0,f.FD)(sr,{handleClose:A,isNextAvailable:E,isPreviousAvailable:C,selectNextEval:R,selectPreviousEval:_,renderModalTitle:G,isLoading:q.isFetching,children:[J,null===N||void 0===N?void 0:N({experimentId:e,visible:S,setVisible:Y,selectedTraceInfos:null!==k&&void 0!==k&&null!==(b=k.currentRunValue)&&void 0!==b&&b.traceInfo?[k.currentRunValue.traceInfo]:[]})]})}),sr=({selectPreviousEval:e,selectNextEval:t,isPreviousAvailable:n,isNextAvailable:s,renderModalTitle:o,handleClose:r,children:i,isLoading:a})=>{const{theme:l,classNamePrefix:d}=(0,F.u)();return(0,f.Y)("div",{onKeyDown:n=>{"ArrowLeft"===n.key?e():"ArrowRight"===n.key&&t()},children:(0,f.FD)(H.d,{componentId:"mlflow.evaluations_review.modal",visible:!0,title:o(),onCancel:r,size:"wide",verticalSizing:"maxed_out",css:(0,D.AH)({width:"100% !important",padding:"0 4rem !important",[`& .${d}-modal-body`]:{flex:1,paddingTop:0},[`& .${d}-modal-header`]:{paddingBottom:l.spacing.sm}},""),footer:null,children:[i,(0,f.Y)("div",{css:(0,D.AH)({display:"flex",justifyContent:"flex-end",position:"fixed",top:"50%",left:0,zIndex:2e3,opacity:".75",width:"5rem","&:hover":{opacity:"1.0"}},""),children:(0,f.Y)("div",{css:(0,D.AH)({backgroundColor:l.colors.backgroundPrimary,borderRadius:l.legacyBorders.borderRadiusMd,marginRight:l.spacing.sm},""),children:(0,f.Y)(F.B,{disabled:!n,componentId:"mlflow.evaluations_review.modal.previous_eval",icon:(0,f.Y)(F.n,{}),onClick:()=>e()})})}),(0,f.Y)("div",{css:(0,D.AH)({display:"flex",justifyContent:"flex-start",position:"fixed",top:"50%",right:0,zIndex:2e3,width:"5rem",opacity:".75","&:hover":{opacity:"1.0"}},""),children:(0,f.Y)("div",{css:(0,D.AH)({backgroundColor:l.colors.backgroundPrimary,borderRadius:l.legacyBorders.borderRadiusMd,marginLeft:l.spacing.sm},""),children:(0,f.Y)(F.B,{disabled:!s,componentId:"mlflow.evaluations_review.modal.next_eval",icon:(0,f.Y)(F.o,{}),onClick:e=>t()})})})]})})},or=({traceData:e,showLoadingState:t})=>(0,f.Y)($.a8,{modelTrace:e}),rr=m.memo(({experimentId:e,selectedColumns:t,evaluations:n,selectedEvaluationId:o,selectedAssessmentInfos:r,assessmentInfos:i,assessmentFilters:a,tableSort:l,onChangeEvaluationId:d,getRunColor:c,runUuid:u,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:h,rowSelection:v,setRowSelection:y,exportToEvalsInstanceEnabled:x=!1,getTrace:b,toggleAssessmentFilter:w,saveAssessmentsQuery:S,disableAssessmentTooltips:Y,onTraceTagsEdit:A,enableRowSelection:T,enableGrouping:I=!1,allColumns:C,displayLoadingOverlay:M,isGroupedBySession:E,searchQuery:_})=>{const N=(0,V.tz)(),{theme:R}=(0,F.u)(),[k,H]=(0,m.useState)(!1),U=(0,m.useRef)(null),[z,P]=(0,m.useState)(new Set),K=m.useCallback(e=>{P(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},[]),q=!(0,s.isNil)(g),G=(0,m.useMemo)(()=>t.filter(e=>e.type===J.$6.INPUT),[t]),X=(0,m.useMemo)(()=>re(t,q,E),[t,q,E]),{columns:ee}=(0,m.useMemo)(()=>{if(!I){const n=t.map(t=>Bn(t,{evaluationInputs:G,isComparing:q,theme:R,intl:N,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:A}));return{columns:ie(n,t)}}const n=new Map;X.forEach(t=>{const s=t.group||J.w8.INFO;n.has(s)||n.set(s,[]),(n.get(s)||[]).push(Bn(t,{evaluationInputs:G,isComparing:q,theme:R,intl:N,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:A}))});const s=Array.from(n.entries()).map(([e,t])=>({header:eo,meta:{groupId:e,visibleCount:t.length,totalCount:C.filter(t=>t.group===e).length,enableGrouping:I},id:`${e}-group`,columns:t}));return{columns:s}},[X,t,G,q,d,R,N,e,A,I,C]),{setTable:te,setSelectedRowIds:ne}=m.useContext(B),{groupedRows:se,traceIdToTurnMap:oe}=(0,m.useMemo)(()=>E?(0,Z.sR)(n,z,q):{groupedRows:[],traceIdToTurnMap:{}},[E,n,z,q]),ae=(0,pe.L)("js/packages/web-shared/src/genai-traces-table/GenAiTracesTableBody.tsx",{data:n,columns:ee,getCoreRowModel:(0,ue.HT)(),getSortedRowModel:(0,ue.h5)(),enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:T,enableMultiSort:!0,state:{rowSelection:v},meta:{getRunColor:c,traceIdToTurnMap:oe,searchQuery:_},onRowSelectionChange:y,getRowId:e=>(0,W.On)(e.currentRunValue)}),le=(0,m.useCallback)((e,t)=>{var n;const s=e.getToggleSelectedHandler(),o=Boolean(null===t||void 0===t?void 0:t.shiftKey),r=null!==(n=ae.getState().rowSelection)&&void 0!==n?n:{},i=e.getIsSelected(),a=i&&1===Object.keys(r).length&&r[e.id];if(!o||!U.current)return s(t),void(U.current=a?null:e.id);const l=ae.getRowModel().rows,d=l.findIndex(e=>e.id===U.current),c=l.findIndex(t=>t.id===e.id);if(-1===d||-1===c)return s(t),void(U.current=a?null:e.id);const[u,m]=d<=c?[d,c]:[c,d],p={...r};for(let g=u;g<=m;g+=1){const e=l[g];e.getCanSelect()&&(i?delete p[e.id]:p[e.id]=!0)}ae.setRowSelection(p),U.current=0===Object.keys(p).length?null:e.id},[ae]),de=void 0!==v&&ae.getIsAllRowsSelected(),ce=ae.getIsSomeRowsSelected();(0,m.useEffect)(()=>(te(ae),()=>te(void 0)),[ae,te]),(0,m.useEffect)(()=>{T&&ne(ae.getSelectedRowModel().rows.map(e=>e.id))},[ae,v,ne,T]);const ge=N.formatMessage({id:"+mAXPc",defaultMessage:"No traces found. Try clearing your active filters to see more traces."}),fe=(0,f.Y)(O.Empty,{description:ge,image:(0,f.Y)(L.S,{})});(0,m.useEffect)(()=>{l&&!Q.Al.includes(l.key)?l.key===Q.yX?ae.setSorting([{id:l.key,desc:!l.asc},{id:Q.Te,desc:!1}]):ae.setSorting([{id:l.key,desc:!l.asc}]):ae.setSorting([])},[l,ae]);const{rows:he}=ae.getRowModel(),ve=m.useRef(null),ye=E?se.length:he.length,xe=(0,me.Te)({count:ye,estimateSize:()=>120,getScrollElement:()=>ve.current,measureElement:"undefined"!==typeof window&&-1===navigator.userAgent.indexOf("Firefox")?e=>null===e||void 0===e?void 0:e.getBoundingClientRect().height:void 0,overscan:10}),be=xe.getVirtualItems(),we=xe.getTotalSize(),Se=ae.getHeaderGroups(),Ye=ae.getState().columnSizingInfo,{columnSizeVars:Ae,tableWidth:Te}=(0,m.useMemo)(()=>{const e={};Se.forEach(t=>{t.headers.forEach(t=>{e[`--header-${Dt(t.column.id)}-size`]=t.getSize()+"px"})});let t=0;if(he.length>0){he[0].getVisibleCells().forEach(n=>{e[`--col-${Dt(n.column.id)}-size`]=n.column.getSize()+"px",t+=n.column.getSize()})}return{columnSizeVars:e,tableWidth:t+"px"}},[Se,he,Ye]),Ie=(0,m.useMemo)(()=>{const e={};for(const t of r)e[t.name]=At(t,n,a);return e},[r,n,a]),Ce=(0,m.useMemo)(()=>{if(!(0,$.eA)())return null;const e=(e,t)=>!(!(0,$.ho)(e)||(null===t||void 0===t?void 0:t.fullTraceId)!==e)||(null===t||void 0===t?void 0:t.evaluationId)===e;if(o){var t,s;const r=n.find(t=>e(o,t.currentRunValue)||e(o,t.otherRunValue));if(null!==r&&void 0!==r&&null!==(t=r.otherRunValue)&&void 0!==t&&t.fullTraceId&&null!==r&&void 0!==r&&null!==(s=r.currentRunValue)&&void 0!==s&&s.fullTraceId)return[r.currentRunValue.fullTraceId,r.otherRunValue.fullTraceId]}return null},[o,n]);return(0,f.FD)(f.FK,{children:[(0,f.Y)("div",{className:"container",ref:ve,css:(0,D.AH)({height:"100%",position:"relative",overflowY:"auto",overflowX:"auto",minWidth:"100%",width:Te},""),children:(0,f.FD)(O.Table,{css:(0,D.AH)({width:"100%",...Ae},""),empty:0===ae.getRowModel().rows.length?fe:void 0,someRowsSelected:T?ce||de:void 0,children:[(0,f.Y)(Xs,{headerGroups:ae.getHeaderGroups(),enableRowSelection:T,enableGrouping:I,selectedAssessmentInfos:r,assessmentNameToAggregates:Ie,assessmentFilters:a,toggleAssessmentFilter:w,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:h,disableAssessmentTooltips:Y,collapsedHeader:k,setCollapsedHeader:H,isComparing:q,allRowSelected:de,someRowSelected:ce,toggleAllRowsSelectedHandler:ae.getToggleAllRowsSelectedHandler,setColumnSizing:ae.setColumnSizing}),E?(0,f.Y)(_s,{rows:he,groupedRows:se,isComparing:q,enableRowSelection:T,virtualItems:be,virtualizerTotalSize:we,virtualizerMeasureElement:xe.measureElement,rowSelectionState:v,selectedColumns:X,expandedSessions:z,toggleSessionExpanded:K,experimentId:e,getRunColor:c,runUuid:u,compareToRunUuid:g,rowSelectionChangeHandler:le,searchQuery:_}):(0,f.Y)(jn,{rows:he,isComparing:q,enableRowSelection:T,virtualItems:be,virtualizerTotalSize:we,virtualizerMeasureElement:xe.measureElement,rowSelectionState:v,selectedColumns:t,rowSelectionChangeHandler:le})]})}),M&&(0,f.Y)("div",{css:(0,D.AH)({position:"absolute",inset:0,backgroundColor:R.colors.backgroundPrimary,opacity:.75,pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center"},""),children:(0,f.Y)(F.S,{size:"large"})}),Ce&&(0,$.eA)()?(0,f.Y)(j,{traceIds:Ce,onClose:()=>d(void 0)}):o&&(0,f.Y)(nr,{experimentId:e,runUuid:u,runDisplayName:p,otherRunDisplayName:h,evaluations:he.map(e=>e.original),selectedEvaluationId:o,onChangeEvaluationId:d,exportToEvalsInstanceEnabled:x,assessmentInfos:i,getTrace:b,saveAssessmentsQuery:S})]})});function ir({searchQuery:e,setSearchQuery:t,placeholder:n}){const s=(0,V.tz)(),[o,r]=(0,m.useState)(e);return(0,m.useEffect)(()=>{r(e)},[e]),(0,m.useEffect)(()=>{const e=setTimeout(()=>{t(o)},400);return()=>clearTimeout(e)},[o,t]),(0,f.Y)(O.TableFilterInput,{componentId:"mlflow.evaluations_review.table_ui.filter_input",placeholder:null!==n&&void 0!==n?n:s.formatMessage({id:"M65Hoy",defaultMessage:"Search traces by id, request, or response"}),value:o,onChange:e=>r(e.target.value)})}const ar=({columns:e,selectedColumns:t,setSelectedColumns:n,setSelectedColumnsWithHiddenColumns:s})=>{const o=(0,V.tz)(),{theme:r}=(0,F.u)();return(0,f.FD)(O.DialogCombobox,{componentId:"mlflow.evaluations_overview.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,f.Y)(O.DialogComboboxCustomButtonTriggerWrapper,{children:(0,f.Y)(F.B,{endIcon:(0,f.Y)(O.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.ColumnsIcon,{}),o.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,f.Y)(O.DialogComboboxContent,{children:(0,f.Y)(O.DialogComboboxOptionList,{children:e.map(e=>(0,f.Y)(O.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some(t=>t.id===e.id),onChange:()=>(e=>{if(s)return s([e]);n&&n(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e)},e.id))})})]})};var lr={name:"9q39xd",styles:"min-width:32px"};const dr=m.memo(({tableSort:e,columns:t=[],onChange:n,enableGrouping:s,isMetadataLoading:o,metadataError:r})=>{const i=(0,V.tz)(),{theme:a}=(0,F.u)(),[l,d]=(0,m.useState)(!1),c=(0,m.useMemo)(()=>{const e=[],n=i.formatMessage({id:"Kkuttk",defaultMessage:"Assessment"});if(s){const n=re(t);for(const t of n)if(t.type===J.$6.ASSESSMENT){const n=t.assessmentInfo.displayName;e.push({label:n,key:t.id,type:J.$6.ASSESSMENT,group:J.w8.ASSESSMENT})}else if(t.type===J.$6.INPUT)e.push({label:t.label,key:t.id,type:J.$6.INPUT,group:J.w8.INFO});else if(t.type===J.$6.TRACE_INFO){const n=t.id===Q.yX?i.formatMessage({id:"mrGpVQ",defaultMessage:"Session time"}):t.label;Q.My.includes(t.id)&&e.push({label:n,key:t.id,type:J.$6.TRACE_INFO,group:J.w8.INFO})}return e}for(const s of t.filter(e=>e.type===J.$6.ASSESSMENT)){const t=s.assessmentInfo.displayName;e.push({label:`${n} \ufe65 ${t}`,key:s.id,type:J.$6.ASSESSMENT})}const o=i.formatMessage({id:"2plDKs",defaultMessage:"Input"});for(const s of t.filter(e=>e.type===J.$6.INPUT))e.push({label:`${o} \ufe65 ${s.label}`,key:s.id,type:J.$6.INPUT});for(const s of t.filter(e=>(e.type===J.$6.TRACE_INFO||e.type===J.$6.INTERNAL_MONITOR_REQUEST_TIME)&&Q.My.includes(e.id)))e.push({label:s.label,key:s.id,type:J.$6.TRACE_INFO});return e},[t,i,s]),u=(0,m.useMemo)(()=>{const t=c.find(t=>t.key===(null===e||void 0===e?void 0:e.key));let n=null===t||void 0===t?void 0:t.label;if(!n){var s;const t=null===e||void 0===e||null===(s=e.key)||void 0===s?void 0:s.match(/^.+\.`(.+)`$/);t&&(n=t[1])}const o=i.formatMessage({id:"sKaamx",defaultMessage:"Sort"});return n?`${o}: ${n}`:o},[c,i,e]);return(0,f.FD)(O.DropdownMenu.Root,{open:l,onOpenChange:d,modal:!1,children:[(0,f.Y)(O.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,f.Y)(F.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:e?e.asc?(0,f.Y)(O.SortAscendingIcon,{}):(0,f.Y)(O.SortDescendingIcon,{}):(0,f.Y)(O.SortUnsortedIcon,{}),css:lr,"aria-label":u,endIcon:(0,f.Y)(O.ChevronDownIcon,{}),children:u})}),(0,f.Y)(O.DropdownMenu.Content,{minWidth:250,children:r?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:a.spacing.xs,padding:`${a.spacing.md}px`,color:a.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,f.Y)(F.k,{}),(0,f.Y)(V.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):o?(0,f.Y)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:a.spacing.xs,padding:`${a.spacing.lg}px`,color:a.colors.textSecondary},""),"data-testid":"sort-dropdown-loading",children:(0,f.Y)(F.S,{size:"small"})}):s?(0,f.Y)(ur,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{n(e,t),d(!1)}}):(0,f.Y)(gr,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{n(e,t),d(!1)}})})]})});var cr={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const ur=({sortOptions:e,tableSort:t,onOptionSelected:n})=>{const{theme:s}=(0,F.u)(),o=(0,m.useRef)(null),r=(0,m.useRef)(null),[i,a]=(0,m.useState)(""),l=(0,m.useMemo)(()=>e.filter(e=>e.label.toLowerCase().includes(i.toLowerCase())),[e,i]),d=(0,m.useMemo)(()=>{const e={};return l.forEach(t=>{var n;const s=null!==(n=t.group)&&void 0!==n?n:J.w8.INFO;e[s]||(e[s]=[]),e[s].push(t)}),e},[l]),c=(0,m.useCallback)(s=>{var o;const r=e.find(e=>e.key===s);r&&n(r,null===(o=null===t||void 0===t?void 0:t.asc)||void 0===o||o)},[n,e,null===t||void 0===t?void 0:t.asc]),u=(0,m.useCallback)(s=>{var o;const r=null!==(o=e.find(e=>e.key===(null===t||void 0===t?void 0:t.key)))&&void 0!==o?o:e[0];n(r,s)},[n,e,null===t||void 0===t?void 0:t.key]);return(0,m.useEffect)(()=>{requestAnimationFrame(()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()})},[]),(0,f.FD)(f.FK,{children:[(0,f.FD)("div",{css:(0,D.AH)({padding:`${s.spacing.sm}px ${s.spacing.lg/2}px`,display:"flex",gap:s.spacing.xs},""),children:[(0,f.Y)(L.I,{ref:o,componentId:"mlflow.genai_traces_table.sort_dropdown.search",prefix:(0,f.Y)(L.S,{}),placeholder:"Search",value:i,onChange:e=>a(e.target.value),type:"search",onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key||(null===(t=r.current)||void 0===t||t.focus(),e.preventDefault())}}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:s.spacing.xs},""),children:[(0,f.Y)(O.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,f.Y)(O.ArrowDownIcon,{}),componentId:"mlflow.genai_traces_table.sort_dropdown.sort_desc",onClick:()=>u(!1),"aria-label":"Sort descending"}),(0,f.Y)(O.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,f.Y)(O.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>u(!0),"aria-label":"Sort ascending"})]})]}),(0,f.FD)("div",{css:(0,D.AH)({maxHeight:400,overflowY:"auto",padding:`0 ${s.spacing.sm}px`},""),children:[Object.entries(d).map(([e,n],s)=>(0,f.Y)(m.Fragment,{children:(0,f.FD)(O.DropdownMenu.Group,{children:[(0,f.Y)(O.DropdownMenu.Label,{children:e===J.w8.INFO?"Attributes":J.RF[e]}),n.map((e,n)=>(0,f.FD)(O.DropdownMenu.CheckboxItem,{componentId:"mlflow.genai_traces_table.sort_dropdown.sort_option",checked:e.key===(null===t||void 0===t?void 0:t.key),onClick:()=>c(e.key),ref:0===s&&0===n?r:void 0,"data-testid":`sort-select-${e.label}`,children:[(0,f.Y)(O.DropdownMenu.ItemIndicator,{}),(0,f.Y)("span",{css:cr,children:e.label})]},e.key))]})},e)),0===l.length&&(0,f.Y)(O.DropdownMenu.Item,{disabled:!0,componentId:"mlflow.genai_traces_table.sort_dropdown.no_results",children:(0,f.Y)(V.sA,{id:"WpNCQl",defaultMessage:"No results"})})]})]})};var mr={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},pr={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const gr=({sortOptions:e,tableSort:t,onOptionSelected:n})=>{const{theme:s}=(0,F.u)(),o=(0,m.useRef)(null),[r,i]=(0,m.useState)(""),a=(0,m.useRef)(null),l=(0,m.useMemo)(()=>e.filter(e=>e.label.toLowerCase().includes(r.toLowerCase())),[e,r]),d=(0,m.useCallback)(s=>{const o=e.find(e=>e.key===s);n(o,(null===t||void 0===t?void 0:t.asc)||!0)},[n,t,e]),c=(0,m.useCallback)(s=>{const o=e.find(e=>e.key===(null===t||void 0===t?void 0:t.key));n(o||e[0],s)},[n,e,t]);return(0,m.useEffect)(()=>{requestAnimationFrame(()=>{var e;null===(e=o.current)||void 0===e||e.focus()})},[]),(0,f.FD)(f.FK,{children:[(0,f.FD)("div",{css:(0,D.AH)({padding:`${s.spacing.sm}px ${s.spacing.lg/2}px ${s.spacing.sm}px`,width:"100%",display:"flex",gap:s.spacing.xs},""),children:[(0,f.Y)(L.I,{componentId:"mlflow.experiment_page.sort_dropdown.search",prefix:(0,f.Y)(L.S,{}),value:r,type:"search",onChange:e=>i(e.target.value),placeholder:"Search",autoFocus:!0,ref:o,onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(t=a.current)||void 0===t||t.focus()}}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:s.spacing.xs},""),children:[(0,f.Y)(O.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,f.Y)(O.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_desc",onClick:()=>c(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,f.Y)(O.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,f.Y)(O.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>c(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,f.FD)(O.DropdownMenu.Group,{css:mr,children:[l.map((e,n)=>(0,f.FD)(O.DropdownMenu.CheckboxItem,{componentId:"mlflow.experiment_page.sort_dropdown.sort_option",onClick:()=>d(e.key),checked:e.key===(null===t||void 0===t?void 0:t.key),"data-testid":`sort-select-${e.label}`,ref:0===n?a:void 0,children:[(0,f.Y)(O.DropdownMenu.ItemIndicator,{}),(0,f.Y)("span",{css:pr,children:e.label})]},e.key)),!l.length&&(0,f.Y)(O.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,f.Y)(V.sA,{id:"EkUD0b",defaultMessage:"No results"})})]})]})},fr=({backgroundColor:e,icon:t,children:n})=>{const{theme:s}=(0,F.u)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:s.spacing.xs,borderRadius:s.borders.borderRadiusMd,color:s.colors.textSecondary,backgroundColor:e||s.colors.backgroundSecondary,fontSize:s.typography.fontSizeSm},""),children:[t||null,n?(0,f.Y)("span",{children:n}):null]})},hr="selectedEvaluationId",vr=(0,m.createContext)(null),yr=()=>{var e;const t=(0,m.useContext)(vr),[n,s]=Y(),o=null!==(e=n.get(hr))&&void 0!==e?e:void 0,r=(0,m.useCallback)((e,t)=>{s(n=>{if(void 0===e)return n.delete(hr),n;if(t&&(0,Zo.ko)(t)){const e=(0,$.vX)(t);return n.set(hr,e),n}return n.set(hr,e),n})},[s]);return t?[t.selectedEvaluationId,t.setSelectedEvaluationId]:[o,r]},xr="searchQuery";var br=n(49633);const wr="selectedColumns",Sr="genaiTracesUIState-columns",Yr=(e,t)=>t.filter(t=>!e.includes(t)).map(e=>e.id),Ar=(e,t)=>{let n=((e,t)=>t.filter(t=>!e.includes(t.id)))(e,t);if(n.length>10){const e=n.filter(e=>e.type===J.$6.ASSESSMENT),t=n.filter(e=>e.type!==J.$6.ASSESSMENT),s=n.length-10,o=Math.max(0,e.length-s);n=[...t,...e.slice(0,o)]}return Yr(n,t)},Tr=(e,t,n,s,o)=>{const r=(0,R.GK)(),i=o?`${Sr}-${o}-${e}-${s}`:`${Sr}-${e}-${s}`,[a,l]=(0,br.Mj)({key:i,version:1,initialValue:void 0}),[d,c]=(()=>{const[e,t]=Y();return[(0,m.useMemo)(()=>{const t=e.get(wr);if(t)return t.split(",").filter(Boolean)},[e]),(0,m.useCallback)((e,n=!1)=>{t(t=>(t.delete(wr),e&&e.length>0&&t.set(wr,e.join(",")),t),{replace:n})},[t])]})(),u=(0,m.useMemo)(()=>((e,t)=>Ar(t?Yr(t(e),e):[Q.LV,Q.FW,Q.tj,Q.$W],e))(t,n),[t,n]),p=(0,m.useMemo)(()=>{if(r&&d&&d.length>0){const e=new Set(d);return t.filter(t=>!e.has(t.id)).map(e=>e.id)}const e=new Set(u);return null!==a&&void 0!==a&&a.columnOverrides?(Object.entries(a.columnOverrides).forEach(([t,n])=>{n?e.delete(t):e.add(t)}),[...e]):u},[r,a,u,d,t]),g=(0,m.useCallback)(e=>{if(e.length&&(l(t=>{var n;const s={...null!==(n=null===t||void 0===t?void 0:t.columnOverrides)&&void 0!==n?n:{}};let o=!1;return e.forEach(e=>{const t=p.includes(e.id);s[e.id]!==t&&(s[e.id]=t,o=!0)}),o?{...t,columnOverrides:s}:t}),r)){const n=new Set(p);e.forEach(e=>{n.has(e.id)?n.delete(e.id):n.add(e.id)});const s=t.filter(e=>!n.has(e.id)).map(e=>e.id);c(s,!0)}},[r,l,p,t,c]),f=(0,m.useRef)(!1);return(0,m.useEffect)(()=>{if(r&&!f.current&&(!d||0===d.length)&&t.length>0){f.current=!0;const e=t.filter(e=>!p.includes(e.id)).map(e=>e.id);e.length>0&&c(e,!0)}},[r,d,p,t,c]),{hiddenColumns:p,toggleColumns:g}},Ir=(e,t,n,o,r)=>{const{hiddenColumns:i,toggleColumns:a}=Tr(e,t,n,o,r),l=(0,m.useMemo)(()=>t.filter(e=>!i.includes(e.id)),[t,i]),d=(0,m.useCallback)(e=>{if((0,s.isNil)(e))return;const n=new Set(e.map(e=>e.id)),o=[];t.forEach(e=>{!i.includes(e.id)!==n.has(e.id)&&o.push(e)}),o.length&&a(o)},[t,i,a]);return{selectedColumns:l,toggleColumns:a,setSelectedColumns:d}};function Cr(e,t,n,o,r){return e.filter(e=>function(e,t,n,s){const o=null===e||void 0===e?void 0:e.currentRunValue,r=null===e||void 0===e?void 0:e.otherRunValue;let i=!0;for(const u of t){var a,l;const e=u.assessmentName,t=u.filterValue,m=u.run,p=m===n?o:m===s?r:void 0;if(void 0===p)continue;const g=e===E._1.OVERALL_ASSESSMENT?null!==(a=p.overallAssessments)&&void 0!==a?a:[]:null!==(l=p.responseAssessmentsByName[e])&&void 0!==l?l:[];if("rca"===u.filterType){var d,c;const t=(null===p||void 0===p||null===(d=p.overallAssessments[0])||void 0===d||null===(c=d.rootCauseAssessment)||void 0===c?void 0:c.assessmentName)===e;i=i&&t}else{const e=void 0===t?0===g.length:t===gt?g.some(e=>Boolean(e.errorMessage)):g.some(e=>{var n;return(null!==(n=(0,E.Zh)(e))&&void 0!==n?n:void 0)===t});i=i&&e}}return i}(e,t,o,r)).filter(e=>{var t,o;if((0,s.isNil)(n)||""===n)return!0;const r=n.toLowerCase(),i=JSON.stringify(null===(t=e.currentRunValue)||void 0===t?void 0:t.inputs).toLowerCase().includes(r),a=(null===(o=e.currentRunValue)||void 0===o?void 0:o.inputsId.toLowerCase())===r;return i||a})}var Mr={name:"1ykowef",styles:"margin-bottom:0"},Er={name:"f3vz0n",styles:"font-weight:500"},_r={name:"969shj",styles:"display:flex;flex:1;overflow-y:hidden;position:relative"};const Nr=e=>{const{totalRowCount:t,sampledInfo:n}=e,o=(0,V.tz)();return n?n.maxAllowedCount?t>=n.maxAllowedCount?(0,f.Y)(H.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:o.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t}),children:(0,f.Y)(F.W,{color:"warning"})}):null:n.logCountLoading||(0,s.isNil)(n.sampledCount)||(0,s.isNil)(n.totalCount)?(0,f.Y)(F.S,{}):(0,f.Y)(fr,{children:(0,f.FD)(H.T,{componentId:"mlflow.experiment_list_view.sampled_badge.tooltip",content:o.formatMessage({id:"TannO5",defaultMessage:"Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)"},{sampledCount:n.sampledCount,totalCount:n.totalCount,percentage:_t(n.sampledCount/n.totalCount)}),children:["Sampled ",_t(n.sampledCount/n.totalCount),"%"]})}):null},Rr="__any_value__";var kr={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Dr=m.memo(({assessmentName:e,assessmentInfo:t,assessmentLabel:n,assessmentFilter:s,updateAssessmentFilter:o,removeAssessmentFilter:r,run:i})=>{const a=(0,V.tz)(),{theme:l}=(0,F.u)(),d=s?M(s.filterValue):Rr;return(0,f.Y)("div",{css:kr,children:(0,f.FD)(O.SegmentedControlGroup,{name:"size-story",value:d,onChange:n=>{if(n.target.value===Rr)return void r(e,i);const s=C(t,n.target.value);o(e,s,i)},size:"middle",componentId:"mlflow.evaluations_review.table_ui.filter_control",children:[(0,f.Y)(O.SegmentedControlButton,{value:Rr,children:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:a.formatMessage({id:"Hq/vjk",defaultMessage:"All"})})}),Array.from(t.uniqueValues.values()).map(e=>{const{content:n,icon:s}=(0,E.uU)(a,l,t,e);return(0,f.Y)(O.SegmentedControlButton,{value:M(e),children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:[n,s]})},M(e))})]})})}),Fr=function({experimentId:e,currentEvaluationResults:t,compareToEvaluationResults:n,currentRunDisplayName:s,runUuid:o,compareToRunUuid:r,compareToRunDisplayName:i,compareToRunLoading:a,sampledInfo:l,exportToEvalsInstanceEnabled:d=!1,getTrace:c,saveAssessmentsQuery:u,enableRunEvaluationWriteFeatures:p,defaultSortOption:g,disableAssessmentTooltips:h,onTraceTagsEdit:v,traceActions:y,initialSelectedColumns:x}){const{theme:b}=(0,F.u)(),w=(0,V.tz)(),S=(0,W.Co)(t),A=(0,W.Co)(n||[]),I=Object.keys(null!==y&&void 0!==y?y:{}).length>0,[_,R]=yr(),k=(0,m.useMemo)(()=>de(S,A),[S,A]),[H,$]=(()=>{var e;const[t,n]=Y();return[null!==(e=t.get(xr))&&void 0!==e?e:"",(0,m.useCallback)(e=>{n(t=>void 0===e||""===e?(t.delete(xr),t):(t.set(xr,e),t))},[n])]})(),B=(0,m.useMemo)(()=>yt(w,S,A),[w,S,A]),U=(0,Q.XS)(w,S,B,o),[z,j]=(e=>{const[t,n]=Y();return[(0,m.useMemo)(()=>{var n;return(null!==(n=t.getAll(T))&&void 0!==n?n:[]).reduce((t,n)=>{const[s,o,r,i]=n.split("::"),a=null===e||void 0===e?void 0:e.find(e=>e.name===o);if(a){const e=C(a,r);t.push({run:s,assessmentName:o,filterValue:e,filterType:""===i?void 0:i})}return t},[])},[e,t]),(0,m.useCallback)((e,t=!1)=>{n(t=>(t.delete(T),e&&e.forEach(e=>{t.append(T,[e.run,e.assessmentName,M(e.filterValue),e.filterType].join("::"))}),t),{replace:t})},[n])]})(U.map(e=>e.assessmentInfo).filter(e=>void 0!==e)),P=(0,m.useMemo)(()=>""===H&&0===z.length?k:Cr(k,z,H,s,i),[k,H,z,s,i]),{selectedColumns:K,toggleColumns:G}=Ir(e,U,x,o),Z=(0,m.useMemo)(()=>xt(K.filter(e=>e.type===J.$6.ASSESSMENT).map(e=>e.assessmentInfo)),[K]),X=U.find(e=>e.type===J.$6.ASSESSMENT&&e.id===E._1.OVERALL_ASSESSMENT),ee=(0,m.useMemo)(()=>g||(X?{key:X.id,type:J.$6.ASSESSMENT,asc:!0}:void 0),[g,X]),[te,ne]=N(),se=(0,m.useMemo)(()=>{if(te){return K.some(e=>e.id===te.key)?te:ee}return ee},[te,K,ee]),oe=(0,m.useCallback)(e=>{ne(e,!1)},[ne]),re=(0,m.useCallback)((e,t)=>z.find(n=>n.assessmentName===e&&n.run===t),[z]),ie=(0,m.useCallback)((e,t)=>{j(z.filter(n=>n.assessmentName!==e||n.run!==t))},[z,j]),ae=(0,m.useCallback)((e,t,n,s)=>{const o=z.find(t=>t.assessmentName===e&&t.run===n);j(void 0===o?[...z,{assessmentName:e,filterValue:t,filterType:s,run:n}]:z.map(n=>n.assessmentName===e?{...n,filterValue:t,filterType:s}:n))},[z,j]),le=(0,m.useCallback)((e,t,n,s)=>{const o=z.find(t=>t.assessmentName===e&&t.run===n);void 0===o?j([...z,{assessmentName:e,filterValue:t,filterType:s,run:n}]):o.filterValue===t&&o.filterType===s?j(z.filter(t=>t.assessmentName!==e||t.run!==n)):j(z.map(o=>o.assessmentName===e&&o.run===n?{assessmentName:e,filterValue:t,filterType:s,run:n}:o))},[z,j]),ce=(0,m.useCallback)(()=>{j([])},[j]),ue=z.length>0,[me,pe]=(0,m.useState)({}),ge=(0,m.useMemo)(()=>{const e=Object.keys(me).filter(e=>me[e]);return P.filter(t=>t.currentRunValue&&e.includes(t.currentRunValue.evaluationId)).map(e=>e.currentRunValue).filter(e=>void 0!==e)},[me,P]),fe={enableRunEvaluationWriteFeatures:p},he=S.length;return a?(0,f.Y)(O.LegacySkeleton,{}):(0,f.Y)(Jo,{config:fe,children:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"row",gap:b.spacing.lg,overflow:"hidden",height:"100%"},""),children:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flex:1,flexDirection:"column",gap:b.spacing.xs,overflow:"hidden"},""),children:[(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",padding:`${b.spacing.xs}px 0px`},""),children:[(0,f.FD)(O.TableFilterLayout,{css:Mr,children:[(0,f.Y)(ir,{searchQuery:H,setSearchQuery:$}),(0,f.FD)(O.DialogCombobox,{componentId:"mlflow.genai_traces_table.filter_dropdown",label:"Filters",value:Array.from(z).map(e=>e.assessmentName),multiSelect:!0,children:[(0,f.Y)(O.DialogComboboxCustomButtonTriggerWrapper,{children:(0,f.Y)(F.B,{endIcon:(0,f.Y)(O.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,D.AH)({border:ue?`1px solid ${b.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:ue?`${b.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:b.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.FilterIcon,{}),w.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:ue?` (${z.length})`:""}),z.length>0&&(0,f.Y)(L.X,{css:(0,D.AH)({fontSize:12,cursor:"pointer",color:b.colors.grey400,"&:hover":{color:b.colors.grey600}},""),onClick:e=>{ce(),e.stopPropagation(),e.preventDefault()}})]})})}),(0,f.Y)(O.DialogComboboxContent,{children:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",padding:`${b.spacing.sm}px ${b.spacing.sm}px`,gap:b.spacing.md},""),children:Z.filter(e=>"numeric"!==e.dtype).map(e=>(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:b.spacing.sm},""),children:[(0,f.Y)("div",{css:Er,children:e.displayName}),s&&(0,f.Y)(Dr,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:re(e.name,s),updateAssessmentFilter:ae,removeAssessmentFilter:ie,run:s}),r&&i&&(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs},""),children:[(0,f.Y)(F.T.Hint,{children:i}),(0,f.Y)(Dr,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:re(e.name,i),updateAssessmentFilter:ae,removeAssessmentFilter:ie,run:i})]})]},e.name))})})]}),(0,f.Y)(dr,{tableSort:se,columns:U,onChange:(e,t)=>{oe({key:e.key,type:e.type,asc:t})}}),(0,f.Y)(ar,{columns:U,selectedColumns:K,setSelectedColumnsWithHiddenColumns:G}),(0,f.Y)(q,{experimentId:e,selectedTraces:ge,setRowSelection:pe,traceActions:y,traceInfos:void 0})]}),(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:b.spacing.sm},""),children:[(0,f.Y)(Nr,{totalRowCount:he,sampledInfo:l}),(0,f.Y)(F.T.Hint,{children:w.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numEvals:k.length,numFilteredEvals:P.length})})]})]}),(0,f.Y)("div",{css:(0,D.AH)({display:"flex",gap:b.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,f.Y)("div",{css:_r,children:(0,f.Y)(rr,{experimentId:e,selectedColumns:K,allColumns:U,evaluations:P,selectedEvaluationId:_,selectedAssessmentInfos:Z,assessmentInfos:B,assessmentFilters:z,onChangeEvaluationId:R,tableSort:se,runUuid:o,compareToRunUuid:r,runDisplayName:s,compareToRunDisplayName:i,enableRowSelection:I,rowSelection:I?me:void 0,setRowSelection:I?pe:void 0,exportToEvalsInstanceEnabled:d,getTrace:c,toggleAssessmentFilter:le,saveAssessmentsQuery:u,disableAssessmentTooltips:h,onTraceTagsEdit:v})})})]})})})})},Or=async({queryKey:[,{experimentId:e}]})=>Ae("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e]}),Lr=(e,t=!1)=>{var n;const{data:s,error:o,isLoading:r,isFetching:i}=(0,ge.I)((e=>["EXPERIMENT_RUNS_FOR_TRACE_COMPARISON",{experimentId:e}])(e),{queryFn:Or,enabled:!t,cacheTime:1/0,staleTime:1/0});return{requestError:o,isLoading:r,isFetching:i,runInfos:null===s||void 0===s||null===(n=s.runs)||void 0===n?void 0:n.map(e=>{var t,n;return{runUuid:null===(t=e.info)||void 0===t?void 0:t.run_uuid,runName:null===(n=e.info)||void 0===n?void 0:n.run_name}})}};var Hr=n(60062);const Vr=(e,t)=>["GET_TRACE_EVALUATION_ARTIFACT",{runUuid:e,artifactFile:t}],$r=async({queryKey:[,{runUuid:e,artifactFile:t}]})=>{const n=["ajax-api/2.0/mlflow/get-artifact",new URLSearchParams({run_uuid:e,path:t})].join("?");return Ae(n,"GET").then(e=>({...e,filename:t}))},Br=[o.o8.Assessments,o.o8.Evaluations,o.o8.Metrics],Ur=({runUuid:e,artifacts:t=Br},{disabled:n=!1}={})=>{const a=!n&&Br.some(e=>t.includes(e)),l=(0,Hr.E)({queries:Br.map(s=>({queryFn:$r,queryKey:Vr(e,s),enabled:!n&&t.includes(s),refetchOnWindowFocus:!1}))}),u=l.some(e=>e.isLoading),p=l.some(e=>e.isFetching),g=l.find(e=>e.error),[f,h,v]=l.map(e=>e.data),y=(0,m.useMemo)(()=>c(f),[f]),x=(0,m.useMemo)(()=>c(h),[h]),b=(0,m.useMemo)(()=>c(v),[v]),w=(0,m.useMemo)(()=>{if(x)return function(e,t,n){const a=(t||[]).reduce((e,t)=>{e[t.evaluation_id]||(e[t.evaluation_id]={});const{key:n,value:s,timestamp:o}=t;return e[t.evaluation_id][n]={key:n,value:s,timestamp:o},e},{}),l=(n||[]).reduce((e,t)=>{var n,o,r,i;return e[t.evaluation_id]||(e[t.evaluation_id]=[]),e[t.evaluation_id].push({booleanValue:(0,s.isNil)(t.boolean_value)?t.boolean_value:Boolean(t.boolean_value),numericValue:(0,s.isNil)(t.numeric_value)?t.numeric_value:Number(t.numeric_value),stringValue:(0,s.isNil)(t.string_value)?t.string_value:String(t.string_value),metadata:t.metadata||{},...t.error_code&&{errorCode:t.error_code},...t.error_message&&{errorMessage:t.error_message},name:t.name,rationale:t.rationale||null,source:{metadata:null!==(n=null===(o=t.source)||void 0===o?void 0:o.metadata)&&void 0!==n?n:{},sourceId:null===(r=t.source)||void 0===r?void 0:r.source_id,sourceType:null===(i=t.source)||void 0===i?void 0:i.source_type},timestamp:t.timestamp}),e},{});return e.map(e=>{var t,n;const c=(0,s.orderBy)(l[e.evaluation_id]||[],"timestamp","desc"),u=c.filter(r).map(e=>{var t,n,o,r;const i=null===(t=e.rationale)||void 0===t?void 0:t.match(/^\[(.*?)\](.*?)(?:\*\*Suggested Actions\*\*:(.*))?$/s),a=i?null===(n=i[1])||void 0===n?void 0:n.trim():void 0,l=i?null===(o=i[2])||void 0===o?void 0:o.trim():void 0,d=i?null===(r=i[3])||void 0===r?void 0:r.trim():void 0;return e.rationale=l||e.rationale,{...e,rootCauseAssessment:(0,s.isNil)(a)?void 0:{assessmentName:a,suggestedActions:d}}});0===u.length&&u.push({name:o._1.OVERALL_ASSESSMENT,rationale:null,source:{sourceType:"AI_JUDGE",sourceId:"UNKNOWN",metadata:{}},metadata:{},numericValue:null,booleanValue:null,stringValue:null,timestamp:null});const m=c.filter(i),p=(0,s.difference)(c,u,m),g=(0,s.groupBy)(p,"name");return Object.keys(g).forEach(e=>{g[e]=(0,s.orderBy)(g[e],"timestamp","desc")}),{evaluationId:e.evaluation_id,requestId:e.request_id,inputs:e.inputs,inputsId:e.inputs_id,outputs:null!==(t=e.outputs)&&void 0!==t?t:{},targets:null!==(n=e.targets)&&void 0!==n?n:{},...e.error_code&&{errorCode:e.error_code},...e.error_message&&{errorMessage:e.error_message},overallAssessments:u,responseAssessmentsByName:g,metrics:a[e.evaluation_id]||{},retrievalChunks:d(e.outputs,e.targets,m)}})}(x,b,y)},[y,x,b]);return{requestError:g,isLoading:u&&a,isFetching:p&&a,data:w}},zr="searchMlflowTraces",jr=({queryClient:e})=>{e.invalidateQueries({queryKey:[zr]})},Pr={asc:!1,key:Q.Te,type:J.$6.TRACE_INFO},Kr=({locations:e,runUuid:t,timeRange:n,otherRunUuid:s,filterByLoggedModelId:o,loggedModelId:r,sqlWarehouseId:i,disabled:a,networkFilters:l,filterByAssessmentSourceRun:d=!1})=>{const c=(0,V.tz)(),u=Qr(t,n,l,o),p=((null===e||void 0===e?void 0:e.some(e=>"UC_SCHEMA"===e.type))&&(0,K.F9)(),Jr(Pr)),{data:g,isLoading:h,error:v}=Gr({locations:e,filter:u,loggedModelId:r,sqlWarehouseId:i,enabled:!a,orderBy:p}),y=(0,m.useMemo)(()=>d?(0,W.p6)(g,t):g,[g,t,d]),x=Qr(s,n),{data:b,isLoading:w,error:S}=Gr({locations:e,filter:x,enabled:!a&&Boolean(s),loggedModelId:r,sqlWarehouseId:i,orderBy:p}),Y=(0,m.useMemo)(()=>d?(0,W.p6)(b,s):b,[b,s,d]),A=(0,m.useMemo)(()=>!y||h||v||!y.length?[]:y.map(e=>(0,W.ih)(e)),[y,h,v]),T=(0,m.useMemo)(()=>{const e=w&&Boolean(s);return!Y||e||S||!Y.length?[]:Y.map(e=>(0,W.ih)(e))},[Y,w,S,s]),I=(0,m.useMemo)(()=>yt(c,A||[],T||[]),[c,A,T]),C=(0,m.useMemo)(()=>{const e=new Map,t=new Map;return null===y||void 0===y||y.forEach(n=>{const s=n.trace_metadata;if(s){const t=s[Te.A.sourceNameTag];t&&!e.has(t)&&e.set(t,{value:t,renderValue:()=>(0,f.Y)(Ve,{traceInfo:n,isComparing:!1,disableLinks:!0})})}const o=n.tags;if(o&&o["mlflow.linkedPrompts"])try{const e=JSON.parse(o["mlflow.linkedPrompts"]);Array.isArray(e)&&e.forEach(e=>{const n=`${e.name}/${e.version}`;t.has(n)||t.set(n,{value:n,renderValue:()=>n})})}catch(r){}}),{source:Array.from(e.values()).sort((e,t)=>e.value.localeCompare(t.value)),prompt:Array.from(t.values()).sort((e,t)=>e.value.localeCompare(t.value))}},[y]),M=(0,Q.XS)(c,A||[],I,t,void 0,!0);return(0,m.useMemo)(()=>({assessmentInfos:I,allColumns:M,totalCount:A.length,evaluatedTraces:A,otherEvaluatedTraces:T,isLoading:h&&!a,error:v,isEmpty:0===A.length,tableFilterOptions:C}),[I,M,h,v,A,C,a,T])},Wr=({locations:e,currentRunDisplayName:t,runUuid:n,timeRange:s,searchQuery:o,filters:r,disabled:i,pageSize:a,limit:l,filterByLoggedModelId:d,tableSort:c,loggedModelId:u,sqlWarehouseId:p,filterByAssessmentSourceRun:g=!1})=>{const f=!1,{networkFilters:h,clientFilters:v}=(0,m.useMemo)(()=>((e,t=!0)=>e.reduce((e,n)=>n.column===J.w8.ASSESSMENT&&(0,J._S)(n.operator)?(e.networkFilters.push(n),e):(n.column===J.w8.ASSESSMENT&&(void 0===n.value||n.value===gt)||n.column===J.w8.ASSESSMENT&&t?e.clientFilters.push(n):e.networkFilters.push(n),e),{networkFilters:[],clientFilters:[]}))(r||[],f),[r,f]),y=Qr(n,s,h,d,o),x=Jr(c),{data:b,isLoading:w,isFetching:S,error:Y,refetch:A}=Gr({locations:e,filter:y,enabled:!i,pageSize:a,limit:l,orderBy:x,loggedModelId:u,sqlWarehouseId:p}),T=(0,m.useMemo)(()=>{if(b)return b.map(e=>({currentRunValue:(0,W.ih)(e),otherRunValue:void 0}))},[b]),I=(0,m.useMemo)(()=>{if(!T)return;const e=void 0;if(!(v&&v.length>0))return T.reduce((e,t)=>{var n;return null!==(n=t.currentRunValue)&&void 0!==n&&n.traceInfo&&e.push(t.currentRunValue.traceInfo),e},[]);const n=v.map(e=>({assessmentName:e.key||"",filterValue:e.value,run:t||""}));return Cr(T,n||[],e,t,void 0).reduce((e,t)=>{var n;return null!==(n=t.currentRunValue)&&void 0!==n&&n.traceInfo&&e.push(t.currentRunValue.traceInfo),e},[])},[T,v,o,t,f]),C=(0,m.useMemo)(()=>g?(0,W.p6)(I,n):I,[I,n,g]);return i?{data:[],isLoading:!1,isFetching:!1}:{data:C,isLoading:w,isFetching:S,error:Y||void 0,refetchMlflowTraces:A}},qr=async({signal:e,locations:t,filter:n,pageSize:o,limit:r,orderBy:i,loggedModelId:a,sqlWarehouseId:l})=>{if((null===t||void 0===t?void 0:t.some(e=>"UC_SCHEMA"===e.type))&&(0,K.F9)())return $._A.searchTracesV4({signal:e,orderBy:i,locations:t,filter:n,pageSize:o});let d,c=[];const u=o||(0,K.Mq)(),m=r||(0,K.pR)();for(;c.length<m;){const o={locations:t,filter:n,max_results:u,order_by:i};a&&l&&(o.model_id=a,o.sql_warehouse_id=l),d&&(o.page_token=d);const r=await Ye(Se("ajax-api/3.0/mlflow/traces/search"),{method:"POST",body:o,signal:e}),m=r.traces;if((0,s.isNil)(m)||(c=c.concat(m)),d=r.next_page_token,!d)break}return c};const Gr=({locations:e,filter:t,pageSize:n,limit:s,orderBy:o,loggedModelId:r,sqlWarehouseId:i,enabled:a,...l})=>{const d=(null===e||void 0===e?void 0:e.some(e=>"UC_SCHEMA"===e.type))&&(0,K.F9)(),c=(0,m.useMemo)(()=>function(e){return{keepPreviousData:!0,refetchOnWindowFocus:!1,...e?{}:{staleTime:1/0,cacheTime:1/0}}}(Boolean(d)),[d]);return(0,ge.I)({...c,enabled:a,queryKey:[zr,{locations:e,filter:t,orderBy:o,loggedModelId:r,sqlWarehouseId:i,pageSize:n}],queryFn:({signal:a})=>qr({signal:a,locations:e,filter:t,pageSize:n,limit:s,orderBy:o,loggedModelId:r,sqlWarehouseId:i}),...l})},Qr=(e,t,n,s,o)=>{const r=[];if(e&&r.push(`attributes.run_id = '${e}'`),o&&r.push(`trace.text ILIKE '%${o}%'`),t){const e="attributes.timestamp_ms";t.startTime&&r.push(`${e} > ${t.startTime}`),t.endTime&&r.push(`${e} < ${t.endTime}`)}if(s&&r.push(`request_metadata."mlflow.modelId" = '${s}'`),n&&n.forEach(e=>{switch(e.column){case J.w8.TAG:if(e.key){const t="tags",n=e.key.includes(".")||e.key.includes(" ")?`${t}.\`${e.key}\``:`${t}.${e.key}`;r.push(`${n} ${e.operator} '${e.value}'`)}break;case Q.tj:const t="attributes.execution_time_ms";r.push(`${t} ${e.operator} ${e.value}`);break;case Q.$W:const n="attributes.status";r.push(`${n} = '${e.value}'`);break;case Q.tP:r.push(`request_metadata."mlflow.trace.user" = '${e.value}'`);break;case Q.li:r.push(`attributes.run_id = '${e.value}'`);break;case Q.im:r.push(`request_metadata."mlflow.modelId" = '${e.value}'`);break;case Q.VC:r.push(`prompt = '${e.value}'`);break;case Q.LV:r.push(`attributes.name ${e.operator} '${e.value}'`);break;case Q.FW:r.push(`request_metadata."mlflow.source.name" ${e.operator} '${e.value}'`);break;case J.w8.ASSESSMENT:e.operator===J.tl.IS_NULL||e.operator===J.tl.IS_NOT_NULL?r.push(`feedback.\`${e.key}\` ${e.operator}`):"undefined"!==e.value&&r.push(`feedback.\`${e.key}\` ${e.operator} '${e.value}'`);break;case J.w8.EXPECTATION:r.push(`expectation.\`${e.key}\` ${e.operator} '${e.value}'`);break;case Q.Gq:"="===e.operator?r.push(`span.name ILIKE '${e.value}'`):"CONTAINS"===e.operator?r.push(`span.name ILIKE '%${e.value}%'`):r.push(`span.name ${e.operator} '${e.value}'`);break;case Q.d6:case Q.Rl:r.push(`${e.column} ${e.operator} '${e.value}'`);break;case Q.Rb:"="===e.operator?r.push(`span.type ILIKE '${e.value}'`):"CONTAINS"===e.operator?r.push(`span.type ILIKE '%${e.value}%'`):r.push(`span.type ${e.operator} '${e.value}'`);break;case Q.RC:r.push(`span.status ${e.operator} '${e.value}'`);break;case Q.k0:"CONTAINS"===e.operator&&r.push(`span.content ILIKE '%${e.value}%'`);break;default:if(e.column.startsWith(Q.rc)){const t=`request_metadata.${(0,W.v8)(e.column)}`;e.operator===J.dD.IS_NOT_NULL?r.push(`${t} IS NOT NULL`):e.operator===J.tl.CONTAINS?r.push(`${t} ILIKE '%${e.value}%'`):r.push(`${t} ${e.operator} '${e.value}'`)}}}),r.length>0)return r.join(" AND ")},Jr=e=>{if(e)switch(e.key){case Q.tj:return["execution_time "+(e.asc?"ASC":"DESC")];case Q.Te:return["timestamp "+(e.asc?"ASC":"DESC")];default:return[]}};var Zr=n(884);var Xr={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},ei={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const ti=({id:e,item:t,options:n,query:s,onChange:o,placeholder:r,width:i,canSearchCustomValue:a})=>{const{theme:l}=(0,F.u)(),[d,c]=(0,m.useState)(""),u=(0,m.useMemo)(()=>{var e,t;return null!==(e=null!==(t=null===s||void 0===s?void 0:s.data)&&void 0!==t?t:n)&&void 0!==e?e:[]},[null===s||void 0===s?void 0:s.data,n]),p=(0,m.useMemo)(()=>u.map(e=>e.value),[u]);return(0,f.FD)(O.DialogCombobox,{componentId:"mlflow.evaluations_review.table_ui.filter_column",value:null!==t&&void 0!==t&&t.value?[t.value]:[],id:e,children:[(0,f.Y)(O.DialogComboboxTrigger,{withInlineLabel:!1,placeholder:r,renderDisplayedValue:()=>{var e;return null!==(e=null===t||void 0===t?void 0:t.renderValue())&&void 0!==e?e:""},width:i,allowClear:!1}),(0,f.Y)(O.DialogComboboxContent,{width:i,style:{zIndex:l.options.zIndexBase+100},loading:null===s||void 0===s?void 0:s.isLoading,children:(0,f.Y)(O.DialogComboboxOptionList,{children:(0,f.FD)(O.DialogComboboxOptionListSearch,{onSearch:e=>c(e),children:[u.map(e=>(0,f.Y)(O.DialogComboboxOptionListSelectItem,{value:e.value,onChange:o,checked:e.value===(null===t||void 0===t?void 0:t.value),css:Xr,children:e.renderValue()},e.value)),a&&d&&!p.includes(d)?(0,f.FD)(O.DialogComboboxOptionListSelectItem,{value:d,onChange:o,checked:d===(null===t||void 0===t?void 0:t.value),css:ei,children:['Use "',d,'"']},d):null]})})})]})};var ni={name:"833hqy",styles:"width:200px"};const si=({index:e,tableFilter:t,assessmentInfos:n,onChange:s,experimentId:o,tableFilterOptions:r})=>{const i=(0,V.tz)(),{theme:a}=(0,F.u)(),l=`filter-value-${e}`,[d,c]=(0,m.useState)(t.value),u=(0,m.useCallback)(()=>{d!==t.value&&s({...t,value:d},e)},[t,e,s,d]),p=Lr(o),g=(0,m.useMemo)(()=>{var e,t;return{data:null===(e=p.runInfos)||void 0===e||null===(t=e.filter(e=>e.runUuid&&e.runName))||void 0===t?void 0:t.map(e=>({value:e.runUuid,renderValue:()=>e.runName})),isLoading:p.isLoading}},[p]),h=((e,t=!1)=>{const n=["EXPERIMENT_MODEL_VERSIONS",e],{data:s,isLoading:o,error:r}=(0,ge.I)({queryKey:n,queryFn:async()=>Ae("ajax-api/2.0/mlflow/logged-models/search","POST",{experiment_ids:[e]}),staleTime:1/0,cacheTime:1/0,enabled:!t,refetchOnMount:!1,retry:!1});return{data:null===s||void 0===s?void 0:s.models,isLoading:o,error:r||void 0}})(o),v=(0,m.useMemo)(()=>{var e;return{data:null===(e=h.data)||void 0===e?void 0:e.map(e=>({value:e.info.model_id,renderValue:()=>e.info.name})),isLoading:h.isLoading}},[h]),y=[{value:"IN_PROGRESS",renderValue:()=>i.formatMessage($e.IN_PROGRESS)},{value:"OK",renderValue:()=>i.formatMessage($e.OK)},{value:"ERROR",renderValue:()=>i.formatMessage($e.ERROR)}];var x,b;if(t.column===Q.li)return(0,f.Y)(ti,{id:l,item:null===(x=g.data)||void 0===x?void 0:x.find(e=>e.value===t.value),query:g,onChange:n=>{s({...t,value:n},e)},placeholder:"Select run",width:200,canSearchCustomValue:!1});if(t.column===Q.im)return(0,f.Y)(ti,{id:l,item:null===(b=v.data)||void 0===b?void 0:b.find(e=>e.value===t.value),query:v,onChange:n=>{s({...t,value:n},e)},placeholder:"Select version",width:200,canSearchCustomValue:!1});if(t.column===J.w8.ASSESSMENT){const o=n.find(e=>e.name===t.key);if(o&&"numeric"!==o.dtype&&"unknown"!==o.dtype){const n=Array.from(o.uniqueValues.values()).map(e=>({value:M(e),renderValue:()=>(0,E.uU)(i,a,o,e).content}));return o.containsErrors&&n.push({value:M(gt),renderValue:()=>(0,E.uU)(i,a,o,gt).content}),(0,f.Y)(ti,{id:l,item:n.find(e=>e.value===M(t.value)),options:n,onChange:n=>{s({...t,value:I(n)},e)},placeholder:"Select",width:200,canSearchCustomValue:!1})}}if(t.column===Q.$W)return(0,f.Y)(ti,{id:l,item:y.find(e=>e.value===t.value),options:y,onChange:n=>{s({...t,value:n},e)},placeholder:"Select",width:200,canSearchCustomValue:!1});if(t.column===Q.FW){const n=r.source;return(0,f.Y)(ti,{id:l,item:n.find(e=>e.value===t.value),options:n,onChange:n=>{s({...t,value:n},e)},placeholder:"Select source",width:200,canSearchCustomValue:!1})}if(t.column===Q.VC){const n=r.prompt||[];return(0,f.Y)(ti,{id:l,item:n.find(e=>e.value===t.value),options:n,onChange:n=>{s({...t,value:n},e)},placeholder:"Select prompt",width:200,canSearchCustomValue:!0})}return(0,f.Y)(L.I,{"aria-label":"Value",componentId:"mlflow.evaluations_review.table_ui.filter_value",id:l,placeholder:t.column===Q.tj?"Time in milliseconds":"Value",type:t.column===Q.tj?"number":"text",value:d,onChange:e=>{c(e.target.value)},onBlur:u,css:ni,disabled:t.column===J.w8.ASSESSMENT})};const oi=(e,t)=>e===Q.tj?[J.tl.EQUALS,J.tl.NOT_EQUALS,J.tl.GREATER_THAN,J.tl.LESS_THAN,J.tl.GREATER_THAN_OR_EQUALS,J.tl.LESS_THAN_OR_EQUALS]:e===Q.Gq||e===Q.Rb?[J.tl.EQUALS,J.tl.NOT_EQUALS,J.tl.CONTAINS]:e===Q.RC?[J.tl.EQUALS,J.tl.NOT_EQUALS]:e===Q.k0?[J.tl.CONTAINS]:e===Q.d6||e===Q.Rl?[J.tl.RLIKE,J.tl.EQUALS]:e===J.w8.ASSESSMENT?[J.tl.EQUALS,J.tl.IS_NULL,J.tl.IS_NOT_NULL]:[J.tl.EQUALS];var ri={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ii={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ai={name:"1fttcpj",styles:"display:flex;flex-direction:column"},li={name:"833hqy",styles:"width:200px"},di={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ci={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ui={name:"1duj7gx",styles:"align-self:flex-end"};const mi=({tableFilter:e,index:t,onChange:n,onDelete:s,assessmentInfos:o,experimentId:r,tableFilterOptions:i,allColumns:a,usesV4APIs:l})=>{const{column:d,operator:c,key:u}=e,{theme:p}=(0,F.u)(),g=(0,m.useMemo)(()=>(e=>e?[Q.tj,Q.$W,Q.LV,Q.tP,Q.li,Q.im,Q.FW,Q.d6,Q.Rl,Q.VC]:[Q.tj,Q.$W,Q.LV,Q.tP,Q.li,Q.im,Q.FW,Q.VC])(l),[l]),h=(0,m.useMemo)(()=>o.filter(e=>"numeric"!==e.dtype).map(e=>({value:e.name,renderValue:()=>e.displayName})),[o]),v=(0,m.useMemo)(()=>{const e=a.slice().sort((e,t)=>{var n,s;return(null!==(n=e.filterOrder)&&void 0!==n?n:1)-(null!==(s=t.filterOrder)&&void 0!==s?s:1)}).filter(e=>g.includes(e.id)||e.id.startsWith(Q.rc)).map(e=>({value:e.id,renderValue:()=>{var t;return null!==(t=e.filterLabel)&&void 0!==t?t:e.label}}));return e.push({value:J.w8.TAG,renderValue:()=>J.RF[J.w8.TAG]},{value:J.w8.ASSESSMENT,renderValue:()=>J.RF[J.w8.ASSESSMENT]}),l&&e.push({value:Q.k0,renderValue:()=>"Span content"},{value:Q.Gq,renderValue:()=>"Span name"},{value:Q.RC,renderValue:()=>"Span status"},{value:Q.Rb,renderValue:()=>"Span type"}),e},[a,l,g]);return(0,f.Y)(f.FK,{children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"row",gap:p.spacing.sm},""),children:[(0,f.FD)("div",{css:ri,children:[(0,f.Y)(O.FormUI.Label,{htmlFor:`filter-column-${t}`,children:(0,f.Y)(V.sA,{id:"OlytgO",defaultMessage:"Field"})}),(0,f.Y)(ti,{id:`filter-column-${t}`,item:v.find(e=>e.value===d),options:v,onChange:e=>{if(e!==d){const s=oi(e)[0];n({column:e,operator:s,value:""},t)}},placeholder:"Select column",width:180,canSearchCustomValue:!1})]}),d===J.w8.ASSESSMENT&&(0,f.FD)("div",{css:ii,children:[(0,f.Y)(O.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,f.Y)(V.sA,{id:"lK4Ay3",defaultMessage:"Name"})}),(0,f.Y)(ti,{id:`filter-key-${t}`,item:h.find(e=>e.value===u),options:h,onChange:s=>{n({...e,key:s},t)},placeholder:"Select name",width:200,canSearchCustomValue:!1})]}),d===J.w8.TAG&&(0,f.FD)("div",{css:ai,children:[(0,f.Y)(O.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,f.Y)(V.sA,{id:"gST1At",defaultMessage:"Key"})}),(0,f.Y)(L.I,{"aria-label":"Key",componentId:"mlflow.evaluations_review.table_ui.filter_key",id:"filter-key-"+t,type:"text",css:li,placeholder:d===J.w8.TAG?"Key":"Name",value:u,onChange:s=>{n({...e,key:s.target.value},t)}})]}),(0,f.FD)("div",{css:di,children:[(0,f.Y)(O.FormUI.Label,{htmlFor:`filter-operator-${t}`,children:(0,f.Y)(V.sA,{id:"W6Sqio",defaultMessage:"Operator"})}),(()=>{const s=""!==d&&1===oi(d).length;return(0,f.Y)(O.SimpleSelect,{"aria-label":"Operator",componentId:"mlflow.evaluations_review.table_ui.filter_operator",id:"filter-operator-"+t,placeholder:"Select",width:120,contentProps:{style:{zIndex:p.options.zIndexBase+100}},value:s?oi(d)[0]:c,disabled:s,onChange:s=>{n({...e,operator:s.target.value},t)},children:oi(d).map(e=>(0,f.Y)(O.SimpleSelectOption,{value:e,children:e},e))})})()]}),!(0,J._S)(c)&&(0,f.FD)("div",{css:ci,children:[(0,f.Y)(O.FormUI.Label,{htmlFor:`filter-value-${t}`,children:(0,f.Y)(V.sA,{id:"6JOLpj",defaultMessage:"Value"})}),(0,f.Y)(si,{index:t,tableFilter:e,assessmentInfos:o,onChange:n,experimentId:r,tableFilterOptions:i})]}),(0,f.Y)("div",{css:ui,children:(0,f.Y)(F.B,{componentId:"mlflow.evaluations_review.table_ui.filter_delete_button",type:"tertiary",icon:(0,f.Y)(O.CloseSmallIcon,{}),onClick:s})})]})})};const pi=({filters:e,setFilters:t,assessmentInfos:n,experimentId:s,tableFilterOptions:o,allColumns:r,isMetadataLoading:i,metadataError:a,usesV4APIs:l})=>{const d=(0,V.tz)(),{theme:c}=(0,F.u)(),u=e.length>0,p=(0,m.useCallback)(()=>{t([])},[t]);return(0,f.FD)(F.aw.Root,{componentId:"mlflow.genai_traces_table_filter.filter_dropdown",children:[(0,f.Y)(F.aw.Trigger,{asChild:!0,children:(0,f.Y)(F.B,{endIcon:(0,f.Y)(O.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,D.AH)({border:u?`1px solid ${c.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:u?`${c.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.FilterIcon,{}),d.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:u?` (${e.length})`:""}),u&&(0,f.Y)(L.X,{css:(0,D.AH)({fontSize:12,cursor:"pointer",color:c.colors.grey400,"&:hover":{color:c.colors.grey600}},""),onClick:()=>{p()}})]})})}),(0,f.Y)(F.aw.Content,{align:"start",css:(0,D.AH)({padding:c.spacing.md},""),children:a?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,f.Y)(F.k,{}),(0,f.Y)(V.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):i?(0,f.Y)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textSecondary},""),"data-testid":"filter-dropdown-loading",children:(0,f.Y)(F.S,{size:"small"})}):(0,f.Y)(hi,{filters:e,assessmentInfos:n,setFilters:t,experimentId:s,tableFilterOptions:o,allColumns:r,usesV4APIs:l})})]})};var gi={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},fi={name:"skgbeu",styles:"display:flex;justify-content:flex-end"};const hi=({filters:e,assessmentInfos:t,setFilters:n,experimentId:s,tableFilterOptions:o,allColumns:r,usesV4APIs:i})=>{const{theme:a}=(0,F.u)(),l=(e=>(0,Zr.mN)({defaultValues:{filters:e.length>0?e:[{column:"",operator:J.tl.EQUALS,value:""}]}}))(e),{setValue:d,watch:c}=l,u=c("filters");return(0,f.Y)(Zr.Op,{...l,children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:a.spacing.lg,overflow:"auto"},""),children:[(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:u.map((e,n)=>(0,f.Y)(mi,{tableFilter:e,index:n,onChange:e=>{u[n]=e,d("filters",u)},onDelete:()=>{const e=[...u];e.splice(n,1),0===e.length&&e.push({column:"",operator:J.tl.EQUALS,value:""}),d("filters",e)},assessmentInfos:t,experimentId:s,tableFilterOptions:o,allColumns:r,usesV4APIs:i},e.column+e.operator+e.value+n))}),(0,f.Y)("div",{children:(0,f.Y)(F.B,{componentId:"mlflow.evaluations_review.table_ui.add_filter_button",icon:(0,f.Y)(O.PlusIcon,{}),onClick:()=>{d("filters",[...u,{column:"",operator:J.tl.EQUALS,value:""}])},children:(0,f.Y)(V.sA,{id:"cHgTsd",defaultMessage:"Add filter"})})}),(0,f.Y)("div",{css:gi,children:(0,f.Y)(F.B,{componentId:"mlflow.evaluations_review.table_ui.apply_filters_button",type:"primary",onClick:()=>n(u),css:fi,children:(0,f.Y)(V.sA,{id:"iZ0M1Y",defaultMessage:"Apply filters"})})})]})})},vi=e=>e===J.w8.INFO?"Attributes":J.RF[e],yi=({columns:e=[],selectedColumns:t=[],toggleColumns:n,setSelectedColumns:s,isMetadataLoading:o=!1,metadataError:r})=>{const i=(0,V.tz)(),{theme:a}=(0,F.u)(),[l,d]=(0,m.useState)(""),c=(0,m.useMemo)(()=>{const t=re(e),n={};return t.forEach(e=>{var t;const s=null!==(t=e.group)&&void 0!==t?t:J.w8.INFO;n[s]||(n[s]=[]),n[s].push(e)}),n},[e]),u=(0,m.useMemo)(()=>{if(!l.trim())return c;const e=l.trim().toLowerCase(),t={};return Object.entries(c).forEach(([n,s])=>{const o=vi(n).toLowerCase().includes(e),r=s.filter(t=>t.label.toLowerCase().includes(e));(o||r.length)&&(t[n]=o?s:r)}),t},[c,l]);return(0,f.FD)(O.DialogCombobox,{componentId:"mlflow.evaluations_overview_grouped.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,f.Y)(O.DialogComboboxCustomButtonTriggerWrapper,{children:(0,f.Y)(F.B,{endIcon:(0,f.Y)(O.ChevronDownIcon,{}),"data-testid":"column-selector-button",componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:a.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.ColumnsIcon,{}),i.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,f.Y)(O.DialogComboboxContent,{maxHeight:496,minWidth:300,maxWidth:500,loading:o&&!r,children:r?(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:a.spacing.xs,padding:`${a.spacing.md}px`,color:a.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,f.Y)(F.k,{}),(0,f.Y)(V.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):(0,f.Y)(O.DialogComboboxOptionList,{children:(0,f.Y)(O.DialogComboboxOptionListSearch,{controlledValue:l,setControlledValue:d,children:Object.entries(u).map(([e,o])=>(0,f.FD)(m.Fragment,{children:[(0,f.Y)(O.DialogComboboxSectionHeader,{children:vi(e)}),(0,f.Y)(O.DialogComboboxOptionListCheckboxItem,{value:`all-${e}`,checked:o.every(e=>t.some(t=>t.id===e.id)),onChange:()=>(e=>{if(e.every(e=>t.some(t=>t.id===e.id))){const n=t.filter(t=>!e.some(e=>e.id===t.id));s(n)}else{const n=[...t];e.forEach(e=>{n.some(t=>t.id===e.id)||n.push(e)}),s(n)}})(o),children:i.formatMessage({id:"RXL0a5",defaultMessage:"All {groupLabel}"},{groupLabel:vi(e)})}),o.map(e=>(0,f.Y)(O.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some(t=>t.id===e.id),onChange:()=>n([e]),children:e.label},e.id))]},e))})})})]})};var xi={name:"13qopiv",styles:"margin-bottom:0;flex:1"};const bi=m.memo(e=>{const{searchQuery:t,setSearchQuery:n,filters:s,setFilters:o,tableSort:r,setTableSort:i,selectedColumns:a,toggleColumns:l,setSelectedColumns:d,assessmentInfos:c,experimentId:u,traceInfos:p,tableFilterOptions:g,traceActions:h,allColumns:v,countInfo:y,isMetadataLoading:x,usesV4APIs:b,metadataError:w,onRefresh:S,isRefreshing:Y,addons:A,isGroupedBySession:T,forceGroupBySession:I,onToggleSessionGrouping:C}=e,{theme:M}=(0,F.u)(),E=(0,V.tz)(),_=(0,m.useCallback)((e,t)=>{i({key:e.key,type:e.type,asc:t})},[i]);return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",width:"100%",alignItems:"flex-end",gap:M.spacing.sm,paddingBottom:`${M.spacing.xs}px`},""),children:[(0,f.FD)(O.TableFilterLayout,{css:xi,children:[(0,f.Y)(ir,{searchQuery:t,setSearchQuery:n}),(0,f.Y)(pi,{filters:s,setFilters:o,assessmentInfos:c,experimentId:u,tableFilterOptions:g,allColumns:v,isMetadataLoading:x,metadataError:w,usesV4APIs:b}),(0,f.Y)(dr,{tableSort:r,columns:a,onChange:_,enableGrouping:(0,K.ij)(),isMetadataLoading:x,metadataError:w}),(0,f.Y)(yi,{columns:v,selectedColumns:a,toggleColumns:l,setSelectedColumns:d,isMetadataLoading:x,metadataError:w}),h&&(0,f.Y)(q,{experimentId:u,traceActions:h,traceInfos:p}),(0,K.I0)()&&C&&!I&&(0,f.Y)(H.T,{componentId:"mlflow.traces-table.group-by-session-button.tooltip",content:E.formatMessage({id:"d72zLS",defaultMessage:"Toggle session grouping"}),children:(0,f.Y)(O.ToggleButton,{componentId:"mlflow.traces-table.group-by-session-button",onPressedChange:C,pressed:T,"aria-label":E.formatMessage({id:"Ck9OnH",defaultMessage:"Toggle session grouping"}),children:(0,f.Y)(V.sA,{id:"wuqL/Y",defaultMessage:"Group by session"})})}),S&&(0,f.Y)(H.T,{componentId:"mlflow.traces-table.refresh-button.tooltip",content:E.formatMessage({id:"kbWXwv",defaultMessage:"Refresh traces"}),children:(0,f.Y)(F.B,{componentId:"mlflow.traces-table.refresh-button",icon:(0,f.Y)(O.RefreshIcon,{}),onClick:S,loading:Y,"aria-label":E.formatMessage({id:"0yvVF0",defaultMessage:"Refresh traces"})})}),A]}),(0,f.Y)(wi,{countInfo:y})]})}),wi=e=>{const{countInfo:t}=e,n=(0,V.tz)(),{theme:o}=(0,F.u)();return t.logCountLoading||(0,s.isNil)(t.currentCount)?(0,f.Y)(F.S,{size:"small"}):(0,f.FD)("div",{css:(0,D.AH)({display:"flex",alignItems:"center",gap:o.spacing.sm},""),children:[t.currentCount>=t.maxAllowedCount&&(0,f.Y)(H.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:n.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t.maxAllowedCount}),children:(0,f.Y)(F.W,{color:"warning"})}),(0,f.Y)(F.T.Hint,{children:n.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numFilteredEvals:t.currentCount>=t.maxAllowedCount?t.maxAllowedCount:t.currentCount,numEvals:t.totalCount>=t.maxAllowedCount?`${t.maxAllowedCount}+`:t.totalCount})})]})};var Si=n(27763);var Yi={name:"kj840c",styles:"flex:1;overflow-y:hidden;position:relative"};const Ai=m.memo(e=>{const{experimentId:t,currentTraceInfoV3:n,compareToTraceInfoV3:s,currentRunDisplayName:o,runUuid:r,compareToRunUuid:i,compareToRunDisplayName:a,setFilters:l,filters:d,selectedColumns:c,tableSort:u,assessmentInfos:p,getTrace:g,onTraceTagsEdit:h,allColumns:v,getRunColor:y,enableRowSelection:x=!0,displayLoadingOverlay:b=!1,isGroupedBySession:w,searchQuery:S}=e,{theme:Y}=(0,F.u)(),A=(0,m.useMemo)(()=>(0,W.Co)(n.map(e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))),[n]),T=(0,m.useMemo)(()=>(0,W.Co)((s||[]).map(e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))),[s]),{rowSelection:I,setRowSelection:C}=(0,Si.F4)(),M=(0,m.useCallback)((e,t,n)=>{const s=d.find(t=>t.column===J.w8.ASSESSMENT&&t.key===e);void 0===s?l([...d,{column:J.w8.ASSESSMENT,key:e,operator:J.tl.EQUALS,value:t}]):s.value===t?l(d.filter(t=>!(t.column===J.w8.ASSESSMENT&&t.key===e))):l(d.map(n=>n.column===J.w8.ASSESSMENT&&n.key===e?{column:J.w8.ASSESSMENT,key:e,operator:J.tl.EQUALS,value:t}:n))},[d,l]),E=(0,m.useMemo)(()=>d.filter(e=>e.column===J.w8.ASSESSMENT).map(e=>({assessmentName:e.key||"",filterValue:e.value,run:o||W.kf})),[d,o]),[_,N]=yr(),R=(0,m.useMemo)(()=>xt(c.filter(e=>e.type===J.$6.ASSESSMENT).map(e=>e.assessmentInfo)),[c]),k=(0,m.useMemo)(()=>de(A,T),[A,T]),O=(0,m.useMemo)(()=>A.flatMap(e=>{var t,n;return null!==(t=null===e||void 0===e||null===(n=e.traceInfo)||void 0===n?void 0:n.assessments)&&void 0!==t?t:[]}),[A]);return(0,f.Y)("div",{css:(0,D.AH)({display:"flex",flexDirection:"column",gap:Y.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,f.Y)("div",{css:(0,D.AH)({display:"flex",gap:Y.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,f.Y)("div",{css:Yi,children:(0,f.Y)($.Iw,{assessments:O,children:(0,f.Y)(rr,{experimentId:t,selectedColumns:c,allColumns:v,evaluations:k,selectedEvaluationId:_,selectedAssessmentInfos:R,assessmentInfos:p,assessmentFilters:E,onChangeEvaluationId:N,getRunColor:y,runUuid:r,compareToRunUuid:i,runDisplayName:o,compareToRunDisplayName:a,enableRowSelection:x,rowSelection:I,setRowSelection:C,toggleAssessmentFilter:M,tableSort:u,getTrace:g,onTraceTagsEdit:h,enableGrouping:(0,K.ij)(),displayLoadingOverlay:b,isGroupedBySession:w,searchQuery:S})})})})})}),Ti="filter",Ii=()=>{const[e,t]=Y();return[(0,m.useMemo)(()=>{var t;return(null!==(t=e.getAll(Ti))&&void 0!==t?t:[]).reduce((e,t)=>{const[n,s,o,r]=t.split("::");if(!n||!s||!o&&!(0,J._S)(s))return e;const i=s;let a=o;return n===J.w8.ASSESSMENT&&(a=I(o)),e.push({column:n,key:r,operator:i,value:a}),e},[])},[e]),(0,m.useCallback)((e,n=!1)=>{t(t=>(t.delete(Ti),e&&e.forEach(e=>{let n=e.value;e.column===J.w8.ASSESSMENT&&(n=M(e.value)),t.append(Ti,[e.column,e.operator,n,e.key].join("::"))}),t),{replace:n})},[t])]};var Ci=n(19112);const Mi='import mlflow\n\n@mlflow.trace\ndef chat_completion(message: str, user_id: str, session_id: str):\n    # Set these metadata keys to associate the trace to a user and session\n    mlflow.update_current_trace(\n        metadata={\n            "mlflow.trace.user": user_id,\n            "mlflow.trace.session": session_id,\n        }\n    )\n\n    # Replace with your chat logic\n    return "Your response here"\n\n# Depending on your setup, user and session IDs can be passed to your\n# server handler via the network request from your client applications,\n# or derived from some other request context. \nuser_id = "user-123"\nsession_id = "session-123"\n\nchat_completion("Hello, how are you?", user_id, session_id)';var Ei={name:"1blwlv5",styles:"flex:1;flex-direction:column;display:flex;align-items:center;justify-content:center"},_i={name:"xvginl",styles:"max-width:600px"},Ni={name:"1d5ifrp",styles:"position:relative;max-width:600px"};const Ri=()=>{const{theme:e}=(0,F.u)();return(0,f.FD)("div",{css:Ei,children:[(0,f.Y)(F.T.Title,{level:3,children:(0,f.Y)(V.sA,{id:"Qsifda",defaultMessage:"Group traces from the same chat session together"})}),(0,f.FD)(F.T.Paragraph,{color:"secondary",css:_i,children:[(0,f.Y)(V.sA,{id:"hkXDZn",defaultMessage:"MLflow allows you associate traces with users and chat sessions. This is useful for analyzing multi-turn conversations, enabling you to inspect what happened at each step. Copy the code snippet below to generate a sample trace, or visit the documentation for a more in-depth example."}),(0,f.Y)(F.T.Link,{componentId:"mlflow.chat_sessions.empty_state.learn_more_link",css:(0,D.AH)({marginLeft:e.spacing.xs},""),href:"https://mlflow.org/docs/latest/genai/tracing/track-users-sessions/",openInNewTab:!0,children:(0,f.Y)(V.sA,{id:"h2Ejm7",defaultMessage:"Learn more"})})]}),(0,f.FD)("div",{css:Ni,children:[(0,f.Y)(Ci.VE,{componentId:"mlflow.chat_sessions.empty_state.example_code_copy",css:(0,D.AH)({position:"absolute",top:e.spacing.xs,right:e.spacing.xs},""),copyText:Mi}),(0,f.Y)(Ci.z7,{language:"python",showLineNumbers:!0,theme:e.isDarkMode?"duotoneDark":"light",children:Mi})]})]})},ki=e=>{var t,n,s;const{experimentId:o,selectedSessions:r,traceActions:i,setRowSelection:a}=e,l=(0,V.tz)(),[d,c]=(0,m.useState)(!1),u=(0,m.useCallback)(()=>{c(!0)},[]),p=(0,m.useMemo)(()=>{const e=[];return r.forEach(t=>{e.push(...t.traces)}),e},[r]),g=(0,m.useMemo)(()=>(0,W.Co)(p.map(e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))),[p]),h=(0,m.useCallback)(async(e,t)=>{try{var n,s;await(null===i||void 0===i||null===(n=i.deleteTracesAction)||void 0===n||null===(s=n.deleteTraces)||void 0===s?void 0:s.call(n,e,t)),null===a||void 0===a||a({}),c(!1);const o=l.formatMessage({id:"KsYAUn",defaultMessage:"{count, plural, one {Session} other {{count} sessions}} deleted successfully"},{count:r.length}),d=l.formatMessage({id:"3vS6G9",defaultMessage:"{count, plural, one {# trace was} other {# traces were}} removed"},{count:t.length});(0,$.NH)(`${o}. ${d}.`)}catch(o){throw(0,$.ij)(l.formatMessage({id:"qmTNy1",defaultMessage:"Failed to delete sessions. Error: {error}"},{error:o instanceof Error?o.message:String(o)})),o}},[a,i,r.length,l]),v=Boolean(null===i||void 0===i?void 0:i.deleteTracesAction),y=Boolean(null===i||void 0===i?void 0:i.exportToEvals),x=0===r.length;if(!v&&!y)return null;const b=(0,f.Y)(F.B,{componentId:"mlflow.chat-sessions.actions-dropdown",endIcon:(0,f.Y)(O.ChevronDownIcon,{}),disabled:x,children:l.formatMessage({id:"MZNjYJ",defaultMessage:"Actions ({count})"},{count:r.length})});return(0,f.FD)(f.FK,{children:[(0,f.FD)(O.DropdownMenu.Root,{modal:!1,children:[(0,f.Y)(H.T,{componentId:"mlflow.chat-sessions.actions-dropdown-tooltip",content:x?l.formatMessage({id:"ogDiio",defaultMessage:"Select at least one session to enable actions"}):null===i||void 0===i||null===(t=i.deleteTracesAction)||void 0===t?void 0:t.disabledReason,children:(0,f.Y)(O.DropdownMenu.Trigger,{disabled:x,asChild:!0,children:b})}),(0,f.Y)(O.DropdownMenu.Content,{align:"end",children:v&&(0,f.FD)(f.FK,{children:[y&&(0,f.Y)(O.DropdownMenu.Separator,{}),(0,f.FD)(O.DropdownMenu.Group,{children:[(0,f.Y)(O.DropdownMenu.Label,{children:l.formatMessage({id:"kW6/lu",defaultMessage:"Edit"})}),(0,f.Y)(O.DropdownMenu.Item,{componentId:"mlflow.chat-sessions.delete-sessions",onClick:u,disabled:null===i||void 0===i||null===(n=i.deleteTracesAction)||void 0===n?void 0:n.isDisabled,disabledReason:null===i||void 0===i||null===(s=i.deleteTracesAction)||void 0===s?void 0:s.disabledReason,children:l.formatMessage({id:"SnPghu",defaultMessage:"Delete sessions"})})]})]})})]}),(0,f.Y)(P,{experimentIds:[o],visible:d,selectedTraces:g,handleClose:()=>c(!1),deleteTraces:h})]})},Di=({columns:e,columnVisibility:t,setColumnVisibility:n,searchQuery:s,setSearchQuery:o,traceActions:r,experimentId:i,selectedSessions:a,setRowSelection:l,addons:d})=>{const{theme:c}=(0,F.u)(),u=(0,V.tz)();return(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:c.spacing.sm},""),children:[(0,f.Y)(ir,{searchQuery:s,setSearchQuery:o,placeholder:u.formatMessage({id:"W7HqWM",defaultMessage:"Search chat sessions by input"})}),(0,f.FD)(O.DialogCombobox,{componentId:"mlflow.chat-sessions.table-column-selector",label:(0,f.FD)("div",{css:(0,D.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,f.Y)(O.ColumnsIcon,{}),(0,f.Y)(V.sA,{id:"RWVGkL",defaultMessage:"Columns"})]}),multiSelect:!0,children:[(0,f.Y)(O.DialogComboboxTrigger,{}),(0,f.Y)(O.DialogComboboxContent,{children:(0,f.Y)(O.DialogComboboxOptionList,{children:Object.entries(t).map(([s,o])=>{var r;return(0,f.Y)(O.DialogComboboxOptionListCheckboxItem,{value:s,onChange:()=>{const e={...t};e[s]=!o,n(e)},checked:o,children:null===(r=e.find(e=>e.id===s))||void 0===r?void 0:r.header},s)})})})]}),r&&(0,f.Y)(ki,{experimentId:i,selectedSessions:a,traceActions:r,setRowSelection:l}),d]})};var Fi={name:"1bkbxg0",styles:"max-width:100%;overflow:hidden;cursor:pointer"};const Oi=e=>{const{cell:t}=e,n=t.getValue();return(0,f.Y)(O.Tag,{componentId:"mlflow.genai-traces-table.session-tokens",children:n})};const Li=[{id:"sessionId",header:"Session ID",accessorKey:"sessionId",cell:({row:e})=>{const t=e.original.sessionId;return(0,f.Y)(O.Tag,{componentId:"mlflow.chat-sessions.session-id-tag",color:"indigo",css:Fi,children:(0,f.Y)(F.T.Text,{ellipsis:!0,children:t})})},defaultVisibility:!0,enableSorting:!0,sortingFn:(e,t)=>e.original.sessionId.localeCompare(t.original.sessionId)},{id:"requestPreview",header:"Input",accessorKey:"requestPreview",defaultVisibility:!0},{id:"sessionStartTime",header:"Session start time",accessorKey:"sessionStartTime",defaultVisibility:!0,enableSorting:!0},{id:"sessionDuration",header:"Session duration",accessorKey:"sessionDuration",defaultVisibility:!0,enableSorting:!0},{id:"tokens",header:"Tokens",accessorKey:"tokens",defaultVisibility:!1,enableSorting:!0,cell:Oi},{id:"turns",header:"Turns",accessorKey:"turns",defaultVisibility:!1,enableSorting:!0,cell:Oi},{id:"source",header:"Source",cell:({row:e})=>{const t=e.original.firstTrace;return(0,f.Y)(Ve,{traceInfo:t,isComparing:!1})},defaultVisibility:!1}];var Hi={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"},Vi={name:"13ydc4a",styles:"display:flex;width:100%;height:100%;align-items:center;color:inherit !important;text-decoration:none"};const $i=m.memo(function({row:e,enableRowSelection:t,enableLinks:n=!0,openLinksInNewTab:s=!1}){const{search:o}=S(),{theme:r}=(0,F.u)();return(0,f.FD)(O.TableRow,{className:"eval-datasets-table-row",children:[t&&(0,f.Y)("div",{css:Hi,children:(0,f.Y)(O.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-row-checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler(),onClick:e=>{e.stopPropagation()}})}),e.getVisibleCells().map(t=>(0,f.Y)(O.TableCell,{css:(0,D.AH)({flex:`calc(var(--col-${t.column.id}-size) / 100)`},""),children:n?(0,f.Y)(A,{to:{pathname:Te.A.getExperimentChatSessionPageRoute(e.original.experimentId,e.original.sessionId),search:s?void 0:o},target:s?"_blank":void 0,rel:s?"noopener noreferrer":void 0,css:Vi,children:(0,Un.Kv)(t.column.columnDef.cell,t.getContext())}):(0,Un.Kv)(t.column.columnDef.cell,t.getContext())},t.id))]},e.id)},function(){return!1});var Bi={name:"tyu8ie",styles:"display:flex;flex-direction:column;flex:1;min-height:0;position:relative"},Ui={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const zi=({experimentId:e,traces:t,isLoading:n,searchQuery:s,setSearchQuery:o,traceActions:r,enableRowSelection:i=!1,enableLinks:a=!0,openLinksInNewTab:l=!1,empty:d,toolbarAddons:c,onRowSelectionChange:u})=>{const{theme:p}=(0,F.u)(),g=(0,m.useMemo)(()=>(0,ns.uD)(e,t),[e,t]),[h,v]=(0,m.useState)([{id:"sessionStartTime",desc:!0}]),{rowSelection:y,setRowSelection:x}=(0,Si.F4)();(0,m.useEffect)(()=>{null===u||void 0===u||u(y)},[y,u]);const{columnVisibility:b,setColumnVisibility:w}=(({experimentId:e,columns:t})=>{const n=(0,m.useMemo)(()=>t.reduce((e,t)=>(e[t.id]=t.defaultVisibility,e),{}),[t]),[s,o]=(0,br.Mj)({key:`experiment-chat-sessions-table-column-visibility-${e}`,version:1,initialValue:n});return{columnVisibility:s,setColumnVisibility:o}})({experimentId:e,columns:Li}),S=i||Boolean(r),Y=(0,pe.S)({data:g,columns:Li,getCoreRowModel:(0,ue.HT)(),getSortedRowModel:(0,ue.h5)(),onSortingChange:v,enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:S,onRowSelectionChange:x,getRowId:e=>e.sessionId,state:{sorting:h,columnVisibility:b,rowSelection:y}}),A=Y.getState().columnSizingInfo,T=m.useMemo(()=>{const e=Y.getFlatHeaders(),t={};for(const n of e)t[`--col-${n.column.id}-size`]=n.column.getSize();return t},[A,Y,b]),I=(0,m.useMemo)(()=>Y.getSelectedRowModel().rows.map(e=>e.original),[y]),C=null!==d&&void 0!==d?d:(0,f.Y)(Ri,{});return(0,f.FD)("div",{css:Bi,children:[(0,f.Y)(Di,{columns:Li,columnVisibility:b,setColumnVisibility:w,searchQuery:s,setSearchQuery:o,traceActions:r,experimentId:e,selectedSessions:I,setRowSelection:x,addons:c}),(0,f.FD)(O.Table,{style:{...T},empty:n||0!==g.length?void 0:C,scrollable:!0,someRowsSelected:S?Y.getIsAllRowsSelected()||Y.getIsSomeRowsSelected():void 0,children:[g.length>0&&(0,f.FD)(O.TableRow,{isHeader:!0,children:[S&&(0,f.Y)("div",{css:Ui,children:(0,f.Y)(O.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-header-checkbox",checked:Y.getIsAllRowsSelected(),indeterminate:Y.getIsSomeRowsSelected(),onChange:Y.getToggleAllRowsSelectedHandler()})}),Y.getLeafHeaders().map(e=>(0,f.Y)(O.TableHeader,{componentId:"mlflow.chat-sessions.table-header",header:e,column:e.column,sortable:e.column.getCanSort(),css:(0,D.AH)({cursor:e.column.getCanSort()?"pointer":"default",flex:`calc(var(--col-${e.id}-size) / 100)`},""),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),children:(0,Un.Kv)(e.column.columnDef.header,e.getContext())},e.id))]}),!n&&Y.getRowModel().rows.map(e=>(0,f.Y)($i,{row:e,enableRowSelection:S,enableLinks:a,openLinksInNewTab:l},e.id)),n&&(0,f.Y)(O.TableSkeletonRows,{table:Y})]})]})};var ji=n(39595);const Pi="getTrace";function Ki(e,t){const n=(0,ji.jE)(),o=(0,Hr.E)({queries:(null!==t&&void 0!==t?t:[]).map(t=>{const n=function(e){var t;return(0,$.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""}(t);return{queryKey:[Pi,n],queryFn:async()=>null===e||void 0===e?void 0:e(n,t),enabled:!(0,s.isNil)(e)&&Boolean(n),refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0}})});return{data:(0,$.zk)((0,s.compact)(o.map(e=>e.data))),isLoading:o.some(e=>e.isLoading),invalidateSingleTraceQuery:(0,m.useCallback)(e=>{n.invalidateQueries({queryKey:[Pi,e]})},[n])}}},16844:function(e,t,n){n.d(t,{K6:function(){return U.K6},d7:function(){return _e},DF:function(){return ze},gV:function(){return Fe},mg:function(){return Re},cs:function(){return Ne},Iw:function(){return ye.I},AN:function(){return ke},iX:function(){return ee.i},rH:function(){return ht},SH:function(){return ve.S},E3:function(){return U.E3},mW:function(){return Ue},a8:function(){return ue},Xb:function(){return Ze.X},gm:function(){return xt.gm},RI:function(){return wt},l5:function(){return X.A},Fg:function(){return Je.F},Fn:function(){return m.F},ei:function(){return Q.e},VZ:function(){return g.VZ},a9:function(){return be},CX:function(){return we},Jq:function(){return Se},hb:function(){return U.hb},n2:function(){return U.n2},U2:function(){return he},r_:function(){return rt},y8:function(){return et},it:function(){return Be},Mm:function(){return Le},Ub:function(){return Oe},Fp:function(){return Ve},du:function(){return He},Ad:function(){return Ae},Uu:function(){return U.Uu},PA:function(){return Ie},po:function(){return xe},uI:function(){return Ce},TJ:function(){return G.TJ},_A:function(){return G._A},$L:function(){return De},jm:function(){return $e},iK:function(){return Me},Fu:function(){return Ee},vX:function(){return i.vX},ij:function(){return i.ij},NH:function(){return i.NH},lE:function(){return A.l},ed:function(){return je.ed},MF:function(){return i.MF},cp:function(){return i.cp},re:function(){return Ye},tI:function(){return i.tI},m4:function(){return i.m4},u6:function(){return r.u6},mc:function(){return je.mc},rX:function(){return i.rX},gD:function(){return i.gD},UZ:function(){return i.UZ},$f:function(){return i.$f},ho:function(){return i.ho},Hq:function(){return i.Hq},aZ:function(){return r.aZ},Z9:function(){return r.Z9},F9:function(){return r.F9},eA:function(){return r.eA},xD:function(){return i.xD},zk:function(){return Qe},y5:function(){return yt},SO:function(){return xt.SO},M5:function(){return Q.M},BR:function(){return Ge}});var s=n(46709),o=n(89949),r=n(27882),i=n(86125),a=n(82716),l=n(27757),d=n(42747),c=n(73408);const u=()=>(0,c.Y)(a.Empty,{title:(0,c.Y)(d.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,c.Y)(d.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,c.Y)(l.k,{})});var m=n(15929),p=n(68248),g=n(94664),f=n(45547);const h=e=>JSON.stringify(`import mlflow\n\n# returns an MLflow Trace object\ntrace = mlflow.get_trace('${e}')\n\n# trace.info contains tags and metadata\ntrace_info = trace.info\n\n# the trace's spans are stored in trace.data\nspans = trace.data.spans`);var v={name:"b9l38d",styles:"width:min-content"};const y=({traceId:e,setForceDisplay:t})=>{const{theme:n}=(0,l.u)();return(0,c.Y)(a.Empty,{image:(0,c.Y)(l.W,{}),title:(0,c.Y)(d.sA,{id:"4Itm9y",defaultMessage:"Large trace"}),description:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md,alignItems:"center"},""),children:[(0,c.Y)(d.sA,{id:"TvjS47",defaultMessage:"This trace is very large, and may cause UI slowness when attempting to render. You can click the button below to attempt to display it anyway."}),(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.trace-too-large.force-display-button",css:v,onClick:()=>t(!0),children:(0,c.Y)(d.sA,{id:"rFJSWc",defaultMessage:"Attempt to display"})}),(0,c.Y)("span",{children:(0,c.Y)(d.sA,{id:"1Buj/Q",defaultMessage:"Alternatively, you can interact with this trace via the MLflow Python SDK, using the {code} function. For more information, please check the {documentation_link}.",values:{code:(0,c.Y)(l.T.Text,{code:!0,children:"mlflow.get_trace()"}),documentation_link:(0,c.Y)(l.T.Link,{href:"https://mlflow.org/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Trace",target:"_blank",openInNewTab:!0,componentId:"shared.model-trace-explorer.trace-too-large.documentation-link",children:(0,c.Y)(d.sA,{id:"7RNlsx",defaultMessage:"MLflow API documentation"})})}})}),(0,c.Y)(f.w,{data:h(e),renderMode:g.cC.PYTHON,initialExpanded:!0})]})})};var x=n(53915),b=n(66916),w=n(79081),S=n(97447),Y=n(76118),A=n(43695);const T=e=>void 0!==e&&(0,Y.isObject)(e)&&"input_cost"in e&&"output_cost"in e&&"total_cost"in e;var I={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},C={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const M=({cost:e})=>{const{theme:t}=(0,l.u)(),n=(0,s.useMemo)(()=>(0,A.l)(e.total_cost),[e.total_cost]),o=(0,s.useMemo)(()=>(0,A.l)(e.input_cost),[e.input_cost]),r=(0,s.useMemo)(()=>(0,A.l)(e.output_cost),[e.output_cost]);return(0,c.Y)(a.HoverCard,{trigger:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:t.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"62NIhn",defaultMessage:"Cost"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.header-details.cost.tag",color:"lime",children:(0,c.Y)("span",{children:n})})]}),content:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.md,padding:t.spacing.sm,maxWidth:400},""),children:[(0,c.Y)(l.T.Title,{level:3,withoutMargins:!0,children:(0,c.Y)(d.sA,{id:"9IIkwh",defaultMessage:"Cost breakdown"})}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.FD)("div",{css:I,children:[(0,c.Y)(l.T.Text,{size:"md",children:(0,c.Y)(d.sA,{id:"5Sk9A1",defaultMessage:"Input cost"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.cost-hovercard.input-cost.tag",children:(0,c.Y)("span",{children:o})})]}),(0,c.FD)("div",{css:C,children:[(0,c.Y)(l.T.Text,{size:"md",children:(0,c.Y)(d.sA,{id:"+d9nXK",defaultMessage:"Output cost"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.cost-hovercard.output-cost.tag",children:(0,c.Y)("span",{children:r})})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:t.spacing.sm,borderTop:`1px solid ${t.colors.borderDecorative}`},""),children:[(0,c.Y)(l.T.Text,{size:"md",bold:!0,children:(0,c.Y)(d.sA,{id:"o2qOGQ",defaultMessage:"Total"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.cost-hovercard.total-cost.tag",children:(0,c.Y)("span",{children:n})})]})]})]}),side:"bottom",align:"start"})};var E=n(90828);var _={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},N={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},R={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},k={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const D=({tokenUsage:e})=>{var t,n;const{theme:o}=(0,l.u)(),r=(0,s.useMemo)(()=>e.total_tokens.toString(),[e]),i=(0,s.useMemo)(()=>e.input_tokens.toString(),[e]),u=(0,s.useMemo)(()=>e.output_tokens.toString(),[e]),m=null!==(t=e.cache_read_input_tokens)&&void 0!==t?t:null,g=null!==(n=e.cache_creation_input_tokens)&&void 0!==n?n:null;return(0,c.Y)(a.HoverCard,{trigger:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:o.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"zp4MBw",defaultMessage:"Token count"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:o.spacing.xs},""),children:[(0,c.Y)("span",{children:(0,c.Y)(a.TokenIcon,{})}),(0,c.Y)("span",{children:(0,E.Y7)(r,40)})]})})]}),content:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:o.spacing.md,padding:o.spacing.sm,maxWidth:400},""),children:[(0,c.Y)(l.T.Title,{level:3,withoutMargins:!0,children:(0,c.Y)(d.sA,{id:"aFk+k/",defaultMessage:"Usage breakdown"})}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:[(0,c.FD)("div",{css:_,children:[(0,c.Y)(l.T.Text,{size:"md",children:(0,c.Y)(d.sA,{id:"XEcsei",defaultMessage:"Input tokens"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.input-tokens.tag",children:(0,c.Y)("span",{children:i})})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:o.spacing.xs,paddingLeft:o.spacing.lg},""),children:[(0,c.FD)("div",{css:N,children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"BZ5364",defaultMessage:"(cache read)"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.cached-input-tokens.tag",children:(0,c.Y)("span",{children:null!==m?m.toString():"n/a"})})]}),(0,c.FD)("div",{css:R,children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"M0O/hf",defaultMessage:"(cache write)"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.cache-creation-tokens.tag",children:(0,c.Y)("span",{children:null!==g?g.toString():"n/a"})})]})]}),(0,c.FD)("div",{css:k,children:[(0,c.Y)(l.T.Text,{size:"md",children:(0,c.Y)(d.sA,{id:"2IGC5w",defaultMessage:"Output tokens"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.output-tokens.tag",children:(0,c.Y)("span",{children:u})})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:o.spacing.sm,borderTop:`1px solid ${o.colors.borderDecorative}`},""),children:[(0,c.Y)(l.T.Text,{size:"md",bold:!0,children:(0,c.Y)(d.sA,{id:"QK/Qyx",defaultMessage:"Total"})}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.total-tokens.tag",children:(0,c.Y)("span",{children:r})})]})]})]}),side:"bottom",align:"start"})};var F={name:"dgkyot",styles:"cursor:default;width:fit-content;max-width:100%"},O={name:"j601fv",styles:"flex-basis:45%;flex-shrink:0"},L={name:"1sdjnkx",styles:"word-break:break-word"};const H=({traceMetadata:e,getTruncatedLabel:t=e=>(0,E.Y7)(e,40)})=>{const{theme:n}=(0,l.u)(),o=e=>{if(e&&"object"===typeof e)try{return JSON.stringify(e)}catch{return String(e)}if("string"===typeof e){const t=(0,E.pt)(e);if(t&&"object"===typeof t)try{return JSON.stringify(t)}catch{return e}return e}return String(null!==e&&void 0!==e?e:"")},r=(0,s.useMemo)(()=>Object.entries(e||{}).filter(([e,t])=>null!==t&&""!==t&&!e.startsWith(E.nt)).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>({key:e,value:t,displayValue:o(t)})),[e]);return 0===r.length?null:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"zRKlAL",defaultMessage:"Metadata"})}),(0,c.Y)(a.Overflow,{noMargin:!0,children:(0,c.Y)(a.HoverCard,{trigger:(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.header-metadata-pill",color:"default",css:F,children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:n.spacing.xs},""),children:[(0,c.Y)(w.L,{css:(0,p.AH)({fontSize:12,color:n.colors.textSecondary},"")}),(0,c.Y)("span",{children:r.length})]})}),content:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs,maxWidth:480,maxHeight:320,overflowY:"auto"},""),children:[r.slice(0,100).map(({key:e,displayValue:s,value:o})=>(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"flex-start",gap:n.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{css:O,children:t(e)}),(0,c.Y)(l.T.Text,{color:"secondary",css:L,children:s})]},`${e}:${o}`)),r.length>100&&(0,c.FD)(l.T.Text,{color:"secondary",children:["+",r.length-100," more"]})]})})})]})};var V=n(86119);const $=({statusState:e,getTruncatedLabel:t})=>{const n=(0,d.tz)(),{theme:s}=(0,l.u)(),o=((e,t,n)=>({IN_PROGRESS:{label:t.formatMessage({id:"Y1eg9D",defaultMessage:"In progress"}),icon:(0,c.Y)(b.C,{css:(0,p.AH)({color:n.colors.textValidationWarning},"")}),color:"lemon"},OK:{label:t.formatMessage({id:"hUfxmd",defaultMessage:"OK"}),icon:(0,c.Y)(a.CheckCircleIcon,{css:(0,p.AH)({color:n.colors.textValidationSuccess},"")}),color:"teal"},ERROR:{label:t.formatMessage({id:"ho2T6B",defaultMessage:"Error"}),icon:(0,c.Y)(a.XCircleIcon,{css:(0,p.AH)({color:n.colors.textValidationDanger},"")}),color:"coral"},STATE_UNSPECIFIED:null}[e]))(e,n,s);return o?(0,c.Y)(S.f,{label:(0,c.Y)(d.sA,{id:"HNQ9dM",defaultMessage:"Status"}),value:o.label,color:o.color,icon:o.icon,getTruncatedLabel:t,onCopy:()=>{}}):null};var B=n(110),U=n(21636),z=n(81390);var j={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},P={name:"mqlsmr",styles:"font-size:12px;display:flex"},K={name:"e0dnmk",styles:"cursor:pointer"};const W=({modelTraceInfo:e})=>{var t;const{theme:n}=(0,l.u)(),[o,r]=(0,s.useState)(!1),{rootNode:u}=(0,x.nJ)(),{experimentId:m}=(0,B.g)(),g=Object.entries(null!==(t=e.tags)&&void 0!==t?t:{}).filter(([e])=>(0,E.oD)(e)),[f,h]=(0,s.useMemo)(()=>{var t;return(0,i.ko)(e)&&(0,i.gD)(e)?[(0,i.vX)(e),e.trace_id]:[(0,i.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""]},[e]),v=(0,s.useMemo)(()=>(0,i.m4)(e),[e]),y=(0,s.useMemo)(()=>(0,i.Dv)(e),[e]),A=(0,s.useMemo)(()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[U.n2]},[e]),I=(0,s.useMemo)(()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[U.E3]},[e]),C=(0,s.useMemo)(()=>(0,i.gD)(e)?e.state:void 0,[e]),_=(0,s.useMemo)(()=>{if(u)return(0,z.X6)(u.end-u.start)},[u]),N=e=>(0,E.Y7)(e,40),R=(0,s.useCallback)(()=>{r(!0),setTimeout(()=>r(!1),2e3)},[]);return(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:n.spacing.md,paddingBottom:n.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:n.spacing.md,rowGap:n.spacing.sm,flexWrap:"wrap"},""),children:[C&&(0,c.Y)($,{statusState:C,getTruncatedLabel:N}),f&&(0,c.Y)(S.f,{label:(0,c.Y)(d.sA,{id:"imKpxw",defaultMessage:"ID"}),value:f,displayValue:h,color:"purple",getTruncatedLabel:N,onCopy:R}),(k=v,void 0!==k&&(0,Y.isObject)(k)&&"input_tokens"in k&&"output_tokens"in k&&"total_tokens"in k&&(0,c.Y)(D,{tokenUsage:v})),T(y)&&(0,c.Y)(M,{cost:y}),_&&(0,c.Y)(S.f,{label:(0,c.Y)(d.sA,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,c.Y)(b.C,{css:j}),value:_,getTruncatedLabel:N,onCopy:R}),A&&m&&(0,c.Y)(V.b,{handleCopy:R,experimentId:m,sessionId:A,traceId:f}),I&&(0,c.Y)(S.f,{label:(0,c.Y)(d.sA,{id:"128VYg",defaultMessage:"User"}),icon:(0,c.Y)(a.UserIcon,{css:P}),value:I,color:"default",getTruncatedLabel:N,onCopy:R}),(0,c.Y)(H,{traceMetadata:null===e||void 0===e?void 0:e.trace_metadata,getTruncatedLabel:N}),g.length>0&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"7KPJii",defaultMessage:"Tags"})}),(0,c.Y)(a.Overflow,{noMargin:!0,children:g.map(([e,t])=>{const n=`${e}: ${t}`;return(0,c.Y)(w.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:n,children:(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",onClick:()=>{var e;e=n,navigator.clipboard.writeText(e),R()},css:K,children:N(`${e}: ${t}`)})},e)})})]})]}),o&&(0,c.FD)(a.Notification.Provider,{children:[(0,c.Y)(a.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,c.Y)(a.Notification.Title,{children:(0,c.Y)(d.sA,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,c.Y)(a.Notification.Viewport,{})]})]});var k};var q=n(49708),G=n(13433),Q=n(41151);var J=n(28993),Z=n(45218),X=n(26059),ee=n(24411),te=n(84612);const ne=()=>{const{theme:e}=(0,l.u)(),[t,n]=(0,s.useState)(500),{rootNode:o,nodeMap:r,assessmentsPaneEnabled:u,assessmentsPaneExpanded:m,isInComparisonView:g,updatePaneSizeRatios:f,getPaneSizeRatios:h}=(0,x.nJ)(),v=(0,s.useMemo)(()=>Object.values(r).flatMap(e=>e.assessments),[r]),y=(0,s.useCallback)(e=>{f({summarySidebar:e})},[f]),b=(0,i.yt)(o);if(!o)return(0,c.Y)("div",{css:(0,p.AH)({marginTop:e.spacing.lg},""),children:(0,c.Y)(a.Empty,{description:(0,c.Y)(d.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})});const w=(0,c.Y)(ee.i,{assessments:v,traceId:o.traceId,activeSpanId:void 0});return!g&&u&&m?(0,c.Y)(X.A,{initialRatio:h().summarySidebar,paneWidth:t,setPaneWidth:n,leftChild:(0,c.Y)(Z.n,{rootNode:o,intermediateNodes:b}),rightChild:w,leftMinWidth:Z.F+2*e.spacing.md,rightMinWidth:te.uZ+2*e.spacing.sm,onRatioChange:y}):(0,c.Y)(Z.n,{rootNode:o,intermediateNodes:b})};var se=n(3448);var oe={name:"3epor4",styles:"& > div:nth-of-type(1){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},re={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},ie={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const ae=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:o})=>{const{theme:r}=(0,l.u)(),{activeView:i,setActiveView:u,rootNode:m}=(0,x.nJ)(),g=(0,s.useCallback)(e=>{u(e)},[u]);return(0,c.FD)(a.Tabs.Root,{componentId:"shared.model-trace-explorer.view-mode-toggle",value:i,onValueChange:g,css:oe,children:[(0,c.FD)(a.Tabs.List,{css:(0,p.AH)({paddingLeft:r.spacing.md,flexShrink:0},""),children:[m&&(0,c.Y)(a.Tabs.Trigger,{value:"summary",children:(0,c.Y)(d.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,c.Y)(a.Tabs.Trigger,{value:"detail",children:(0,c.Y)(d.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,c.Y)(a.Tabs.Content,{value:"summary",css:re,children:(0,c.Y)(ne,{})}),(0,c.Y)(a.Tabs.Content,{value:"detail",css:ie,children:(0,c.Y)(se._,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:o})})]})};var le={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const de=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})=>{var o,r,i;const{theme:u}=(0,l.u)(),{assessmentsPaneEnabled:m,assessmentsPaneExpanded:g,setAssessmentsPaneExpanded:f,rootNode:h,selectedNode:v}=(0,x.nJ)();return(0,c.FD)("div",{css:le,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:u.spacing.xs,padding:`0px ${u.spacing.sm}px`,marginBottom:u.spacing.xs},""),children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.toggle-assessments-pane",icon:g?(0,c.Y)(a.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>f(!g)}),(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"++Ydlz",defaultMessage:"Assessments"})})]}),m&&g&&(0,c.Y)("div",{css:(0,p.AH)({marginBottom:u.spacing.sm,padding:u.spacing.sm,paddingTop:0},""),children:(0,c.Y)(ee.i,{assessments:null!==(o=null===h||void 0===h?void 0:h.assessments)&&void 0!==o?o:[],traceId:null!==(r=null===h||void 0===h?void 0:h.traceId)&&void 0!==r?r:"",activeSpanId:null!==(i=null===v||void 0===v?void 0:v.key)&&void 0!==i?i:""})}),(0,c.Y)(ae,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})]})},ce=({children:e})=>(0,c.Y)(o.tH,{fallbackRender:u,children:e}),ue=({modelTrace:e,className:t,initialActiveView:n,selectedSpanId:o,onSelectSpan:a,collapseAssessmentPane:l,isInComparisonView:d,showLoadingState:u})=>{var p,g,f,h;const[v,b]=(0,s.useState)(e),[w,S]=(0,s.useState)(!1),Y=(0,i.MF)(e),A=null!==(p=(0,i.ob)(e))&&void 0!==p?p:0,T=!(0,r.ny)()||A<(0,r.T9)(),I=null!==(g=null===(f=e.data)||void 0===f||null===(h=f.spans)||void 0===h?void 0:h.length)&&void 0!==g?g:0,[C,M]=(0,s.useState)(Y.startsWith("tr-")),[E,_]=(0,s.useState)(!0),{isFetching:N}=(({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:n,enabled:o=!0})=>{const a=[i.BS,e],l=(0,Q.M)(),d=(0,s.useMemo)(()=>(0,r.F9)()&&!e.startsWith("tr-")?o&&l.modelTraceInfo&&(0,i.gD)(l.modelTraceInfo):o&&e.startsWith("tr-"),[o,e,l.modelTraceInfo]);return(0,q.I)({queryKey:a,queryFn:()=>{var t;return(0,r.F9)()&&l.modelTraceInfo&&(0,i.gD)(l.modelTraceInfo)&&!e.startsWith("tr-")?G._A.getTraceInfoV4({traceId:e,traceLocation:null===(t=l.modelTraceInfo)||void 0===t?void 0:t.trace_location}):(0,G.N5)({traceId:e})},onSuccess:e=>{var s;const o=(0,i.gD)(e)?e:null===e||void 0===e||null===(s=e.trace)||void 0===s?void 0:s.trace_info;t(e=>({data:e.data,info:null!==o&&void 0!==o?o:{}})),n(!0)},onError:()=>{n(!1)},enabled:d,refetchOnWindowFocus:!1,refetchOnMount:"always"})})({traceId:Y,setModelTrace:b,setAssessmentsPaneEnabled:M,enabled:T}),R=E&&N;(0,s.useEffect)(()=>{b(e),_(!0)},[Y,I]),(0,s.useEffect)(()=>{E&&!N&&_(!1)},[E,N]);const k=(0,J.K)(e=>e.resetCache);return(0,s.useEffect)(()=>{k()},[k]),T||w?(0,c.Y)(ce,{traceId:Y,children:(0,c.Y)(x.DK,{modelTrace:v,initialActiveView:n,selectedSpanIdOnRender:o,assessmentsPaneEnabled:C,isInComparisonView:d,initialAssessmentsPaneCollapsed:l,isTraceInitialLoading:R,children:u?(0,c.Y)(m.F,{}):(0,c.FD)(c.FK,{children:[(0,c.Y)(W,{modelTraceInfo:v.info}),d?(0,c.Y)(de,{modelTraceInfo:v.info}):(0,c.Y)(ae,{modelTraceInfo:v.info,className:t,selectedSpanId:o,onSelectSpan:a})]})})}):(0,c.Y)(y,{traceId:Y,setForceDisplay:S})};var me=n(68364);var pe={name:"13y2nry",styles:"display:flex;flex-direction:column;height:100%;overflow:hidden"};const ge=({assessments:e})=>{const[t,n]=(0,s.useState)(500),{rootNode:o}=(0,x.nJ)(),r=(0,i.yt)(o);return o?(0,c.Y)("div",{css:pe,children:(0,c.Y)(X.A,{initialRatio:.5,paneWidth:t,setPaneWidth:n,leftChild:(0,c.Y)(Z.n,{rootNode:o,intermediateNodes:r,hideRenderModeSelector:!0}),rightChild:(0,c.Y)(me.Y,{assessments:e}),leftMinWidth:Z.F,rightMinWidth:me.W})}):null},fe=({children:e})=>(0,c.Y)(o.tH,{fallbackRender:u,children:e}),he=({modelTrace:e,assessments:t})=>{const n=(0,i.MF)(e);return(0,c.Y)(fe,{traceId:n,children:(0,c.Y)(x.DK,{modelTrace:e,assessmentsPaneEnabled:!0,children:(0,c.Y)(ge,{assessments:t})})})};var ve=n(777);n(34791);var ye=n(57248);let xe=function(e){return e.TRACE_COUNT="trace_count",e.LATENCY="latency",e.INPUT_TOKENS="input_tokens",e.OUTPUT_TOKENS="output_tokens",e.TOTAL_TOKENS="total_tokens",e}({});const be=50,we=90,Se=99,Ye=e=>`P${e.toFixed(1)}`,Ae="time_bucket",Te="trace";let Ie=function(e){return e.STATUS="status",e.TAG="tag",e.METADATA="metadata",e}({}),Ce=function(e){return e.OK="OK",e.ERROR="ERROR",e}({});const Me=(e,t)=>`${Te}.${e} = "${t}"`,Ee=(e,t)=>`${Te}.${Ie.METADATA}.\`${e}\` = "${t}"`,_e="mlflow.auth.userId";let Ne=function(e){return e.ASSESSMENT_COUNT="assessment_count",e.ASSESSMENT_VALUE="assessment_value",e}({});let Re=function(e){return e.NAME="name",e.TYPE="type",e}({}),ke=function(e){return e.FEEDBACK="feedback",e.EXPECTATION="expectation",e}({});const De=(e,t)=>`assessment.${e} = "${t}"`;let Fe=function(e){return e.ASSESSMENT_NAME="assessment_name",e.ASSESSMENT_VALUE="assessment_value",e}({}),Oe=function(e){return e.SPAN_COUNT="span_count",e.LATENCY="latency",e.INPUT_COST="input_cost",e.OUTPUT_COST="output_cost",e.TOTAL_COST="total_cost",e}({});let Le=function(e){return e.NAME="name",e.STATUS="status",e.TYPE="type",e}({}),He=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e.WORKFLOW="WORKFLOW",e.TASK="TASK",e.GUARDRAIL="GUARDRAIL",e.EVALUATOR="EVALUATOR",e}({}),Ve=function(e){return e.OK="OK",e.ERROR="ERROR",e.UNSET="UNSET",e}({});const $e=(e,t)=>`span.${e} = "${t}"`;let Be=function(e){return e.SPAN_NAME="span_name",e.SPAN_TYPE="span_type",e.SPAN_STATUS="span_status",e.MODEL_NAME="span_model_name",e.MODEL_PROVIDER="span_model_provider",e}({}),Ue=function(e){return e.TRACES="TRACES",e.SPANS="SPANS",e.ASSESSMENTS="ASSESSMENTS",e}({}),ze=function(e){return e.COUNT="COUNT",e.SUM="SUM",e.AVG="AVG",e.PERCENTILE="PERCENTILE",e.MIN="MIN",e.MAX="MAX",e}({});n(61077);var je=n(33145),Pe=n(884),Ke=n(97407),We=n(61060);const qe={key:"",value:""},Ge=({componentIdPrefix:e,onSuccess:t,onClose:n})=>{const o=(0,d.tz)(),[u,m]=(0,s.useState)(void 0),g=(0,s.useMemo)(()=>u?(0,Y.isArray)(u.tags)?u.tags.filter(({key:e})=>!e.startsWith(E.nt)):(0,Y.isObject)(u.tags)?Object.entries(u.tags).map(([e,t])=>({key:e,value:String(t)})).filter(({key:e})=>!e.startsWith(E.nt)):[]:[],[u]),[f,h]=(0,s.useState)(!1),{theme:v}=(0,l.u)(),y=(0,Pe.mN)({mode:"onChange"}),x=(0,Ke.$W)({name:"tags",emptyValue:{key:"",value:""},keyProperty:"key",valueProperty:"value",form:y,defaultValues:g}),b=()=>{h(!1),m(void 0),y.reset({tags:[qe]}),null===n||void 0===n||n()},{mutate:S,isLoading:A,error:T}=(({onSuccess:e})=>(0,We.n)({mutationFn:async({deletedTags:e,modelTraceInfo:t,newTags:n})=>{var s;if((0,r.F9)()&&(0,i.gD)(t)&&t.trace_location&&(0,i.ko)(t)){const s=n.map(e=>G._A.setTraceTagV4({tag:e,traceLocation:t.trace_location,traceId:t.trace_id})),o=e.map(e=>G._A.deleteTraceTagV4({tagKey:e.key,traceLocation:t.trace_location,traceId:t.trace_id}));return Promise.all([...s,...o])}const o=(0,i.gD)(t)?t.trace_id:null!==(s=t.request_id)&&void 0!==s?s:"",a=n.map(e=>G.TJ.setTraceTagV3({tag:e,traceId:o})),l=e.map(e=>G.TJ.deleteTraceTagV3({tagKey:e.key,traceId:o}));return Promise.all([...a,...l])},onSuccess:e}))({onSuccess:()=>{b(),null===t||void 0===t||t()}});return{TagAssignmentModal:(0,c.FD)(w.d,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_121",title:(0,c.Y)(d.sA,{id:"xyEaut",defaultMessage:"Add tags"}),visible:f,destroyOnClose:!0,onCancel:b,footer:(0,c.FD)(c.FK,{children:[(0,c.Y)(l.B,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_130",onClick:b,disabled:A,children:(0,c.Y)(d.sA,{id:"Uf0z53",defaultMessage:"Cancel"})}),(0,c.Y)(l.B,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_141",type:"primary",onClick:y.handleSubmit(async({tags:e})=>{var t,n;if(!u)return;const s=e.filter(({key:e})=>Boolean(e)),o=null!==(t=s.filter(e=>!(null!==g&&void 0!==g&&g.some(t=>t.key===e.key&&t.value===e.value))))&&void 0!==t?t:[],r=null!==(n=null===g||void 0===g?void 0:g.filter(e=>!s.some(t=>t.key===e.key)))&&void 0!==n?n:[];S({newTags:o,deletedTags:r,modelTraceInfo:u})}),loading:A,disabled:A,children:(0,c.Y)(d.sA,{id:"r7aGM3",defaultMessage:"Save"})})]}),children:[T&&(0,c.Y)(a.Alert,{type:"error",message:T instanceof Error?T.message:String(T),componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_157",closable:!1,css:(0,p.AH)({marginBottom:v.spacing.sm},"")}),(0,c.FD)(Ke.Es,{...x,children:[(0,c.FD)(Ke.qd,{children:[(0,c.Y)(Ke.C2,{children:(0,c.Y)(d.sA,{id:"eLgTRT",defaultMessage:"Key"})}),(0,c.Y)(Ke.C2,{children:(0,c.Y)(d.sA,{id:"sBsRzu",defaultMessage:"Value"})})]}),x.fields.map((e,t)=>(0,c.FD)(Ke.qd,{children:[(0,c.Y)(Ke.R0,{index:t,rules:{validate:{unique:e=>{const n=x.getTagsValues();return(null===n||void 0===n?void 0:n.findIndex(t=>t.key===e))===t||o.formatMessage({id:"JPd7WA",defaultMessage:"Key must be unique"})},required:e=>{var n;const s=x.getTagsValues();return!(null!==s&&void 0!==s&&null!==(n=s.at(t))&&void 0!==n&&n.value&&!e)||o.formatMessage({id:"XG8dcL",defaultMessage:"Key is required if value is present"})}}}}),(0,c.Y)(Ke.tP,{index:t}),(0,c.Y)(Ke.ki,{index:t,componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_207"})]},e.id))]})]}),showTagAssignmentModal:e=>{m(e),h(!0)},hideTagAssignmentModal:b}};function Qe(e){const t=(0,s.useRef)(),n=!(!t.current||e.length!==t.current.length)&&e.every((e,n)=>{var s;return e===(null===(s=t.current)||void 0===s?void 0:s[n])});return n||(t.current=e),n&&t.current?t.current:e}var Je=n(9636),Ze=n(93812),Xe=n(47784);const et=({trace:e})=>{var t;const{theme:n}=(0,l.u)(),o=(0,s.useMemo)(()=>{var t;return null!==(t=e.data)&&void 0!==t&&t.spans?(0,i.jW)(e):null},[e]);if(!o)return null;const r=o.chatMessages,a=null!==(t=null===r||void 0===r?void 0:r.slice(null===r||void 0===r?void 0:r.findLastIndex(e=>"user"===e.role)))&&void 0!==t?t:[];if(0!==a.length)return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:null===a||void 0===a?void 0:a.map((e,t)=>(0,c.Y)(Ze.X,{message:e,css:(0,p.AH)({maxWidth:"80%",alignSelf:"user"===e.role?"flex-start":"flex-end",borderWidth:2,borderRadius:n.borders.borderRadiusMd},"")},t))});const u=(0,i.g_)(o.inputs).filter(e=>"null"!==e.value).reverse(),m=(0,i.g_)(o.outputs).filter(e=>"null"!==e.value).reverse();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,width:"80%",alignSelf:"flex-start",borderRadius:n.borders.borderRadiusMd,backgroundColor:n.colors.backgroundPrimary},""),children:(0,c.Y)(Xe.l,{title:(0,c.Y)(d.sA,{id:"nJxDSh",defaultMessage:"Inputs"}),data:u,renderMode:"default",sectionKey:"summary-inputs",maxVisibleItems:1,maxVisibleChatMessages:1})}),(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,width:"80%",alignSelf:"flex-end",backgroundColor:n.colors.backgroundPrimary},""),children:(0,c.Y)(Xe.l,{title:(0,c.Y)(d.sA,{id:"adVHxN",defaultMessage:"Outputs"}),data:m,renderMode:"default",sectionKey:"summary-outputs",maxVisibleItems:1,maxVisibleChatMessages:1})})]})};n(85418);var tt=n(5075);const nt=e=>"expectation"in e;var st={name:"idfvfs",styles:"display:flex;justify-content:flex-start"},ot={name:"92hyw0",styles:"max-width:150px"};const rt=({trace:e,getAssessmentTitle:t,onAddAssessmentsClick:n})=>{const{theme:o}=(0,l.u)(),r=(0,i.gD)(e.info)?e.info:null,u=(0,s.useMemo)(()=>{const e=((null===r||void 0===r?void 0:r.assessments)||[]).filter(e=>!(0,i.rX)(e)).filter(e=>!1!==e.valid),t=(0,Y.groupBy)(e,e=>e.assessment_name);return(0,Y.mapValues)(t,e=>(0,Y.orderBy)(e,["create_time"],["desc"]))},[null===r||void 0===r?void 0:r.assessments]);if((0,Y.isEmpty)(u))return n?(0,c.Y)("div",{css:st,children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.session-view.single-chart-turn-assessments.add-assessment",icon:(0,c.Y)(a.PlusIcon,{}),size:"small",onClick:n,css:[{marginTop:o.spacing.sm},(0,l.i)({backgroundColor:o.colors.backgroundPrimary}),""],children:(0,c.Y)(d.sA,{id:"HTQZeI",defaultMessage:"Evaluate trace"})})}):null;const m=Object.values(u);return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",gap:o.spacing.sm,flexWrap:"wrap",width:"100%",minWidth:0,overflow:"hidden"},""),children:(0,c.Y)(a.Overflow,{noMargin:!0,css:(0,p.AH)({gap:o.spacing.sm,width:"100%",minWidth:0,maxWidth:"100%"},""),visibleItemsCount:5,children:m.map(e=>{var n,s;const o=(0,Y.first)(e);if(!o)return null;const r=t(o.assessment_name),i=null!==(n=null===(s=(0,je.ed)(o))||void 0===s?void 0:s.toString())&&void 0!==n?n:"";return(0,c.Y)("div",{children:(0,c.Y)(tt.Q,{prefix:(0,c.FD)(c.FK,{children:[r,": "]}),jsonValue:i,css:ot,skipIcons:nt(o),overrideColor:nt(o)?"default":void 0})},o.assessment_id)})})})},it=({modelTraces:e})=>{const t=(0,x.nJ)(),{theme:n}=(0,l.u)();return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",overflow:"hidden",flex:1,"&>div":{flex:1,overflow:"hidden"},"&>div:not(:first-child)":{borderLeft:`1px solid ${n.colors.border}`}},""),children:null===e||void 0===e?void 0:e.map((e,n)=>{const s=e.info;return(0,i.gD)(s)?(0,p.n)(x.DK,{...t,readOnly:!0,modelTrace:e,key:s.trace_id},(0,c.Y)(se._,{modelTraceInfo:s},s.trace_id)):null})})},at=({modelTraces:e})=>{const t=(0,x.nJ)(),{theme:n}=(0,l.u)();return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flex:1,overflow:"hidden","&>div:not(:first-child)":{borderLeft:`1px solid ${n.colors.border}`}},""),children:e.map(e=>(0,p.n)(x.DK,{...t,readOnly:!0,modelTrace:e,key:(0,i.MF)(e)},(0,c.Y)(lt,{})))})},lt=()=>{const{rootNode:e}=(0,x.nJ)(),t=(0,i.yt)(e);return e?(0,c.Y)(Z.n,{rootNode:e,intermediateNodes:t}):null};var dt=n(12998);var ct={name:"1wcfv52",styles:"margin-right:0"};const ut=({modelTrace:e})=>{const[t,n]=(0,s.useMemo)(()=>{var t;const n=e.info;return(0,i.ko)(n)&&(0,i.gD)(n)?[(0,i.vX)(n),n.trace_id]:[(0,i.gD)(n)?n.trace_id:null!==(t=n.request_id)&&void 0!==t?t:""]},[e]),{copy:o,tooltipMessage:r}=(0,dt.Ld)(t,t),{theme:d}=(0,l.u)();return(0,c.Y)(w.T,{content:r,componentId:"shared.model-trace-explorer.compare-modal.trace-id-tag-tooltip",children:(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.compare-modal.trace-id-tag",onClick:o,css:ct,color:"purple",children:(0,c.Y)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:d.spacing.xs},""),children:(0,c.Y)("span",{children:null!==n&&void 0!==n?n:t})})})})};var mt={name:"1y6fne2",styles:"overflow:hidden;height:100%;display:flex;flex-direction:column"},pt={name:"3epor4",styles:"& > div:nth-of-type(1){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},gt={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},ft={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const ht=({modelTraces:e,className:t})=>{const[n,o]=(0,s.useState)("summary"),{theme:r}=(0,l.u)(),u=(0,s.useCallback)(e=>{o(e)},[]);return(0,c.FD)("div",{css:mt,className:t,children:[(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:r.spacing.md,paddingBottom:r.spacing.sm,display:"flex",flexDirection:"row",gap:r.spacing.sm,alignItems:"center"},""),children:[(0,c.Y)(l.T.Hint,{children:(0,c.Y)(d.sA,{id:"07nYAU",defaultMessage:"Compared IDs:"})}),e.map(e=>(0,c.Y)(ut,{modelTrace:e},(0,i.MF)(e)))]}),(0,c.FD)(a.Tabs.Root,{componentId:"shared.model-trace-explorer.view-mode-toggle",value:n,onValueChange:u,css:pt,children:[(0,c.FD)(a.Tabs.List,{css:(0,p.AH)({paddingLeft:r.spacing.md,flexShrink:0},""),children:[(0,c.Y)(a.Tabs.Trigger,{value:"summary",children:(0,c.Y)(d.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,c.Y)(a.Tabs.Trigger,{value:"detail",children:(0,c.Y)(d.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,c.Y)(a.Tabs.Content,{value:"summary",css:gt,children:(0,c.Y)(at,{modelTraces:e})}),(0,c.Y)(a.Tabs.Content,{value:"detail",css:ft,children:(0,c.Y)(it,{modelTraces:e})})]})]})};var vt=n(60062);const yt=(e,t={})=>{const n=(0,vt.E)({queries:e.map(e=>({queryKey:["GET_TRACE_BY_ID",e],queryFn:async()=>{var t;const n=(0,i.Y5)(e);return G.TJ.getTraceV3(null!==(t=null===n||void 0===n?void 0:n.trace_id)&&void 0!==t?t:e)},enabled:Boolean(e),refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0}))});return{data:Qe((0,Y.compact)(n.map(e=>e.data))),isFetching:n.some(e=>e.isFetching),isLoading:n.some(e=>e.isLoading)}};var xt=n(77691);var bt={name:"inxa61",styles:"flex:1;overflow:hidden"};const wt=({selectPreviousEval:e,selectNextEval:t,isPreviousAvailable:n,isNextAvailable:o,renderModalTitle:r,handleClose:i,children:a,isLoading:d,experimentId:u,traceInfo:g})=>{const{theme:f}=(0,l.u)(),[h,v]=(0,s.useState)(!1),{renderExportTracesToDatasetsModal:y,DrawerComponent:x}=(0,xt.SO)(),b=(0,s.useCallback)(s=>{if(s.target instanceof HTMLElement){var r,i;if("tab"===s.target.role)return;const e=null===(r=s.target)||void 0===r||null===(i=r.tagName)||void 0===i?void 0:i.toLowerCase();if("input"===e||"textarea"===e||s.target.isContentEditable)return}"ArrowLeft"===s.key&&n?(s.stopPropagation(),e()):"ArrowRight"===s.key&&o&&(s.stopPropagation(),t())},[n,o,e,t]);(0,s.useEffect)(()=>(window.addEventListener("keydown",b),()=>{window.removeEventListener("keydown",b)}),[b]);const w=Boolean(y&&u&&g);return(0,c.Y)(x.Root,{open:!0,onOpenChange:e=>{e||i()},children:(0,c.FD)(x.Content,{componentId:"mlflow.evaluations_review.modal",width:"90vw",title:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:f.spacing.sm,alignItems:"center"},""),children:[(0,c.Y)(l.B,{componentId:"mlflow.evaluations_review.modal.previous_eval",disabled:!n,onClick:()=>e(),children:(0,c.Y)(l.n,{})}),(0,c.Y)(l.B,{componentId:"mlflow.evaluations_review.modal.next_eval",disabled:!o,onClick:()=>t(),children:(0,c.Y)(l.o,{})}),(0,c.Y)("div",{css:bt,children:r()})]}),expandContentToFullHeight:!0,css:[{"&>div":{overflow:"hidden"},"&>div:first-child":{paddingLeft:f.spacing.md,paddingTop:1,paddingBottom:1,"&>button":{flexShrink:0}}},""],children:[(0,c.Y)(l.a8,{zIndexBase:2*f.options.zIndexBase,children:d?(0,c.Y)(m.F,{}):w?(0,c.Y)(xt.Xi,{openModal:()=>v(!0),children:a}):(0,c.Y)(c.FK,{children:a})}),null===y||void 0===y?void 0:y({selectedTraceInfos:g?[g]:[],experimentId:null!==u&&void 0!==u?u:"",visible:h,setVisible:v})]})})}},19926:function(e,t,n){var s=n(12608),o=n.n(s),r=n(73408);class i{static getEntryPointName(e){const t=e[i.entryPointTag];return t?t.value:""}static getSourceType(e){const t=e[i.sourceTypeTag];return t?t.value:""}static dropExtension(e){return e.replace(/(.*[^/])\.[^/.]+$/,"$1")}static baseName(e){const t=e.split("/");return t[t.length-1]}static formatSource(e){const t=i.getSourceName(e),n=i.getSourceType(e),s=i.getEntryPointName(e);if("PROJECT"===n){let e=i.dropExtension(i.baseName(t));return s&&"main"!==s&&(e+=":"+s),e}if("JOB"===n){const n="mlflow.databricks.jobID",s="mlflow.databricks.jobRunID",o=e&&e[n]&&e[n].value,r=e&&e[s]&&e[s].value;return o&&r?i.getDefaultJobRunName(o,r):t}return i.baseName(t)}static getDefaultJobRunName(e,t,n=null){if(!e)return"-";let s=`job ${e}`;return t&&(s=`run ${t} of `+s),n&&(s=`workspace ${n}: `+s),s}static getSourceName(e){const t=e[i.sourceNameTag];return t?t.value:""}static getGitHubRegex(){return/[@/]github.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getGitLabRegex(){return/[@/]gitlab.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getBitbucketRegex(){return/[@/]bitbucket.org[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getExperimentChatSessionPageRoute(e,t){return`/experiments/${e}/chat-sessions/${t}`}static getRunPageRoute(e,t){return`/experiments/${e}/runs/${t}`}static getLoggedModelPageRoute(e,t){return`/experiments/${e}/models/${t}`}static getGitRegex(){return/(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/}static getGitRepoUrl(e,t="master"){const n=e.match(i.getGitHubRegex()),s=e.match(i.getGitLabRegex()),o=e.match(i.getBitbucketRegex()),r=e.match(i.getGitRegex());let a=null;if(n)a=`https://github.com/${n[1]}/${n[2].replace(/.git/,"")}`,n[3]&&(a+=`/tree/${t}/${n[3]}`);else if(s)a=`https://gitlab.com/${s[1]}/${s[2].replace(/.git/,"")}`,s[3]&&(a+=`/-/tree/${t}/${s[3]}`);else if(o)a=`https://bitbucket.org/${o[1]}/${o[2].replace(/.git/,"")}`,o[3]&&(a+=`/src/${t}/${o[3]}`);else if(r){const[,e,n,s]=r;a=e.replace(/git@/,"https://")+"/"+n.replace(/.git/,""),s&&(a+=`/tree/${t}/${s}`)}return a}static getNotebookRevisionId(e){const t="mlflow.databricks.notebookRevisionID";return e&&e[t]&&e[t].value}static getNotebookId(e){const t="mlflow.databricks.notebookID";return e&&e[t]&&e[t].value}static isCurrentWorkspace(e){return!0}static getDefaultNotebookRevisionName(e,t,n=null){if(!e)return"-";let s=`notebook ${e}`;return t&&(s=`revision ${t} of `+s),n&&(s=`workspace ${n}: `+s),s}static ensureUrlScheme(e,t="https"){return e?e.match(/^:\/\//i)?`${t}${e}`:e.match(/^[a-z1-9+-.]+:\/\//i)?e:`${t}://${e}`:e}static setQueryParams(e,t){const n=new URL(i.ensureUrlScheme(e));return n.search=t||"",n.toString()}static getNotebookSourceUrl(e,t,n,s,o=null){let r=i.setQueryParams(o||window.location.origin,e);return r+=`#notebook/${t}`,n&&(r+=`/revision/${n}`,s&&(r+=`/mlflow/run/${s}`)),r}static renderNotebookSource(e,t,n,s,o,a=null,l=null){const d=o?i.baseName(o):i.getDefaultNotebookRevisionName(t,n),c=l||d;if(t){const l=i.getNotebookSourceUrl(e,t,n,s,a);return(0,r.Y)("a",{title:o||i.getDefaultNotebookRevisionName(t,n),href:l,target:"_top",onClick:e=>{e.stopPropagation()},children:c})}return c}static addQueryParams(e,t){if(!t||0===Object.keys(t).length)return e;const n=new URLSearchParams(e);Object.entries(t).forEach(([e,t])=>Boolean(e)&&Boolean(t)&&n.set(e,t));const s=n.toString();return""===s||s.includes("?")?s:`?${s}`}static getJobSourceUrl(e,t,n,s=null){let o=i.setQueryParams(s||window.location.origin,e);return o+=`#job/${t}`,n&&(o+=`/run/${n}`),o}static renderJobSource(e,t,n,s,o=null,a=null){const l=s||i.getDefaultJobRunName(t,n),d=a||l;if(t){const s=i.getJobSourceUrl(e,t,n,o);return(0,r.Y)("a",{title:l,href:s,target:"_top",onClick:e=>{e.stopPropagation()},children:d})}return d}static renderSource(e,t,n,s="master"){const o=i.getSourceName(e);let a=i.formatSource(e);const l=i.getGitRepoUrl(o,s);l&&(a=(0,r.Y)("a",{target:"_top",href:l,onClick:e=>{e.stopPropagation()},children:a}));const d=i.getSourceType(e);if("NOTEBOOK"===d){const s=i.getNotebookRevisionId(e),r=i.getNotebookId(e),a="mlflow.databricks.workspaceID",l=e&&e[a]&&e[a].value;if(i.isCurrentWorkspace(l))return i.renderNotebookSource(t,r,s,n,o,null);{const a="mlflow.databricks.workspaceURL",d=e&&e[a]&&e[a].value,c=i.addQueryParams(t,{o:l});return i.renderNotebookSource(c,r,s,n,o,d)}}if("JOB"===d){const n="mlflow.databricks.jobID",s="mlflow.databricks.jobRunID",o=e&&e[n]&&e[n].value,r=e&&e[s]&&e[s].value,l="mlflow.databricks.workspaceID",d=e&&e[l]&&e[l].value;if(i.isCurrentWorkspace(d))return i.renderJobSource(t,o,r,a,null);{const n="mlflow.databricks.workspaceURL",s=e&&e[n]&&e[n].value,l=i.addQueryParams(t,{o:d});return i.renderJobSource(l,o,r,a,s)}}return a}static renderSourceFromMetadata(e){var t,n,s,o,a;const l=null===(t=e.trace_metadata)||void 0===t?void 0:t[i.sourceNameTag],d=null===(n=e.trace_metadata)||void 0===n?void 0:n[i.sourceTypeTag];let c=l?i.baseName(l):"";const u=null===(s=e.trace_metadata)||void 0===s?void 0:s["mlflow.source.git.repoURL"],m=null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.source.git.branch"],p=null===(a=e.trace_metadata)||void 0===a?void 0:a["mlflow.source.git.commit"];if(u){const e=u.replace("git@github.com:","https://github.com/").replace("git@gitlab.com:","https://gitlab.com/").replace("git@bitbucket.org:","https://bitbucket.org/").replace(".git",""),t=p||m||"master",n=l?`/${l}`:"";let s=e;s=e.includes("github.com")?`${e}/tree/${t}${n}`:e.includes("gitlab.com")?`${e}/-/tree/${t}${n}`:e.includes("bitbucket.org")?`${e}/src/${t}${n}`:`${e}/tree/${t}${n}`,c=(0,r.Y)("a",{target:"_blank",rel:"noopener noreferrer",href:s,onClick:e=>{e.stopPropagation()},children:c})}if("NOTEBOOK"===d){var g,f,h;const t=null===(g=e.trace_metadata)||void 0===g?void 0:g["mlflow.databricks.notebookRevisionID"],n=null===(f=e.trace_metadata)||void 0===f?void 0:f["mlflow.databricks.notebookID"],s=null===(h=e.trace_metadata)||void 0===h?void 0:h["mlflow.databricks.workspaceID"];if(i.isCurrentWorkspace(s))return i.renderNotebookSource(null,n,t,null,l,null);{var v;const o="mlflow.databricks.workspaceURL",r=(null===(v=e.trace_metadata)||void 0===v?void 0:v[o])||void 0,a=i.addQueryParams(null,{o:s});return i.renderNotebookSource(a,n,t,null,l,r)}}if("JOB"===d){var y,x,b;const t=null===(y=e.trace_metadata)||void 0===y?void 0:y["mlflow.databricks.jobID"],n=null===(x=e.trace_metadata)||void 0===x?void 0:x["mlflow.databricks.jobRunID"],s=null===(b=e.trace_metadata)||void 0===b?void 0:b["mlflow.databricks.workspaceID"];if(i.isCurrentWorkspace(s))return i.renderJobSource(null,t,n,c,null);{var w;const o="mlflow.databricks.workspaceURL",r=(null===(w=e.trace_metadata)||void 0===w?void 0:w[o])||void 0,a=i.addQueryParams(null,{o:s});return i.renderJobSource(a,t,n,c,r)}}return c}static formatDuration(e){return e<500?e+"ms":e<6e4?(e/1e3).toFixed(1)+"s":e<36e5?(e/1e3/60).toFixed(1)+"min":e<864e5?(e/1e3/60/60).toFixed(1)+"h":(e/1e3/60/60/24).toFixed(1)+"d"}static formatTimestamp(e,t){const n=new Date(0);return n.setUTCMilliseconds(e),t?t.formatDate(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):o()(n).format("YYYY-MM-DD HH:mm:ss")}}i.runNameTag="mlflow.runName",i.sourceNameTag="mlflow.source.name",i.sourceTypeTag="mlflow.source.type",i.entryPointTag="mlflow.project.entryPoint",t.A=i},21209:function(e,t,n){n.d(t,{p:function(){return d}});var s=n(68248),o=n(46709),r=n(82716),i=n(27757),a=n(73408);var l={name:"1d3w5wq",styles:"width:100%"};const d=({sectionKey:e,title:t,children:n,withBorder:d=!1,isExceptionSection:c=!1,className:u})=>{const[m,p]=(0,o.useState)(!0),{theme:g}=(0,i.u)(),f=c?g.colors.actionDangerPrimaryBackgroundDefault:g.colors.border,h=c?`${g.colors.actionDangerPrimaryBackgroundDefault}15`:g.colors.backgroundSecondary,v=c?g.colors.backgroundPrimary:void 0;return(0,a.FD)("div",{className:u,css:(0,s.AH)({display:"flex",flexDirection:"column",borderRadius:g.borders.borderRadiusMd},""),children:[(0,a.FD)("div",{css:(0,s.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:g.spacing.xs,padding:d?g.spacing.sm:0,background:d?h:void 0,borderTopLeftRadius:g.borders.borderRadiusMd,borderTopRightRadius:g.borders.borderRadiusMd,borderBottomLeftRadius:m?0:g.borders.borderRadiusMd,borderBottomRightRadius:m?0:g.borders.borderRadiusMd,border:d?`1px solid ${f}`:void 0,marginBottom:d?0:g.spacing.sm},""),children:[(0,a.Y)(i.B,{size:"small",componentId:"shared.model-trace-explorer.expand",type:"tertiary",icon:m?(0,a.Y)(r.ChevronDownIcon,{}):(0,a.Y)(i.o,{}),onClick:()=>p(!m)}),(0,a.Y)(i.T.Title,{withoutMargins:!0,level:4,css:l,children:t})]}),m&&(0,a.Y)("div",{css:(0,s.AH)({border:d?`1px solid ${f}`:void 0,borderTop:"none",borderBottomLeftRadius:d?g.borders.borderRadiusMd:void 0,borderBottomRightRadius:d?g.borders.borderRadiusMd:void 0,padding:d?g.spacing.sm:0,background:v},""),children:n})]})}},21636:function(e,t,n){n.d(t,{Bt:function(){return o},E3:function(){return m},Ex:function(){return r},IR:function(){return p},K6:function(){return h},Uu:function(){return c},Vg:function(){return i},Ye:function(){return g},ak:function(){return u},gK:function(){return a},hb:function(){return f},kj:function(){return s},n2:function(){return d},zZ:function(){return l}});const s="yellow500",o="yellow200",r="mlflow.trace.sourceScorer",i="mlflow.assessment.sourceRunId",a="mlflow.assessment.scorerTraceId",l="mlflow.assessment.judgeCost",d="mlflow.trace.session",c="mlflow.trace.tokenUsage",u="mlflow.trace.cost",m="mlflow.trace.user",p="mlflow.llm.model",g="mlflow.llm.cost",f="selectedTraceId",h="mlflow.trace.session"},22558:function(e,t,n){n.d(t,{$:function(){return x}});var s=n(68248),o=n(46709),r=n(82716),i=n(27757),a=n(42747),l=n(83219),d=n(86125),c=n(21209),u=n(53915),m=n(94777),p=n(42401),g=n(81390),f=n(73408);var h={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},v={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},y={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const x=({node:e,renderMode:t})=>{const{theme:n}=(0,i.u)(),[x,b]=(0,o.useState)(!1),w=(0,o.useMemo)(()=>(0,d.g_)(e.inputs),[e]),S=(0,o.useMemo)(()=>(0,d.g_)(e.outputs),[e]),Y=(0,d.bn)(e),A=e.chatMessageFormat,T=Y.length>0,I=w.length>0,C=S.length>0,{setSelectedNode:M,setActiveView:E,setShowTimelineTreeGantt:_}=(0,u.nJ)();return(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,f.Y)("div",{css:(0,s.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,f.Y)(i.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:n.spacing.xs},""),icon:x?(0,f.Y)(r.ChevronDownIcon,{}):(0,f.Y)(i.o,{}),onClick:()=>b(!x),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,f.Y)("div",{css:(0,s.AH)({position:"relative",boxSizing:"border-box",height:48,borderLeft:`2px solid ${n.colors.border}`,width:12},""),children:(0,f.Y)("div",{css:(0,s.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:n.borders.borderRadiusMd,borderBottom:`2px solid ${n.colors.border}`,borderLeft:`2px solid ${n.colors.border}`},"")})}),(0,f.FD)("div",{css:h,children:[(0,f.FD)("div",{css:v,children:[(0,f.Y)(i.T.Text,{color:"secondary",css:(0,s.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,f.Y)(a.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,f.Y)(m.o,{node:e})}})}),(0,f.Y)("span",{onClick:()=>{M(e),E("detail"),_(!0)},children:(0,f.Y)(i.T.Text,{css:y,color:"secondary",children:(0,g.X6)(e.end-e.start)})})]}),x&&(0,f.FD)("div",{children:[T&&(0,f.Y)(l.c,{node:e}),I&&(0,f.Y)(c.p,{sectionKey:"input",title:(0,f.Y)(a.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,f.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:w.map(({key:e,value:n},s)=>(0,f.Y)(p.B,{title:e,data:n,renderMode:t,chatMessageFormat:A},e||s))})}),C&&(0,f.Y)(c.p,{sectionKey:"output",title:(0,f.Y)(a.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,f.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:S.map(({key:e,value:n})=>(0,f.Y)(p.B,{title:e,data:n,renderMode:t,chatMessageFormat:A},e))})})]})]})]})}},24411:function(e,t,n){n.d(t,{i:function(){return Ce}});var s=n(68248),o=n(76118),r=n(46709),i=n(27757),a=n(79081),l=n(42747),d=n(84612),c=n(27882),u=n(53915),m=n(28993),p=n(82716),g=n(44666),f=n(73408);const h=({assessment:e,setIsEditing:t,setShowDeleteModal:n})=>{var s;const o="feedback"in e,r=((null!==(s=(0,g.w)())&&void 0!==s?s:"")===e.source.source_id||o&&"HUMAN"!==e.source.source_type)&&t;return(0,f.FD)(p.DropdownMenu.Root,{children:[(0,f.Y)(p.DropdownMenu.Trigger,{asChild:!0,children:(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,f.Y)(p.OverflowIcon,{}),size:"small"})}),(0,f.FD)(p.DropdownMenu.Content,{minWidth:100,children:[r&&(0,f.FD)(p.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,f.Y)(p.DropdownMenu.IconWrapper,{children:(0,f.Y)(p.PencilIcon,{})}),(0,f.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,f.FD)(p.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>n(!0),children:[(0,f.Y)(p.DropdownMenu.IconWrapper,{children:(0,f.Y)(p.TrashIcon,{})}),(0,f.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})};var v=n(39595),y=n(61060),x=n(59542),b=n(86125),w=n(13433),S=n(41151);const Y=({assessment:e,isModalVisible:t,setIsModalVisible:n})=>{const{deleteAssessmentMutation:s,isLoading:o}=(({assessment:e,onSuccess:t,onError:n,onSettled:s,skip:o})=>{const r=(0,l.tz)(),i=(0,v.jE)(),a=null===e||void 0===e?void 0:e.trace_id,d=null===e||void 0===e?void 0:e.assessment_id,u=(0,m.K)(e=>e.logRemovedAssessment),p=(0,m.K)(e=>e.logAddedAssessment),g=(0,S.M)(),f=o||!a||!d,{mutate:h,isLoading:Y}=(0,y.n)({mutationFn:()=>f?Promise.reject(new Error("Mutation is skipped")):(0,c.F9)()&&g.modelTraceInfo&&(0,b.gD)(g.modelTraceInfo)&&(0,b.ko)(g.modelTraceInfo)?w._A.deleteAssessmentV4({traceId:a,assessmentId:d,traceLocation:g.modelTraceInfo.trace_location}):(0,w.aG)({traceId:a,assessmentId:d}),onSuccess:()=>{var n;if((0,c.F9)()&&!f){if(e.overriddenAssessment){const t={...e.overriddenAssessment,valid:!0};p(a,t)}u(a,e)}i.invalidateQueries({queryKey:[b.BS,a]}),null===(n=g.invalidateTraceQuery)||void 0===n||n.call(g,a),(0,x.B)({queryClient:i}),null===t||void 0===t||t()},onError:e=>{e instanceof Error&&f||((0,b.ij)(r.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e))},onSettled:()=>{null===s||void 0===s||s()}});return{deleteAssessmentMutation:h,isLoading:Y}})({assessment:e,onSettled:()=>{n(!1)}}),i=(0,r.useCallback)(()=>{s()},[s]);return(0,f.Y)(a.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:i,okButtonProps:{danger:!0,loading:o},okText:(0,f.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{n(!1)},cancelText:(0,f.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:o,title:(0,f.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,f.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};var A=n(66916),T=n(33145);const I=({assessment:e,onSuccess:t,onSettled:n,onCancel:a})=>{var u;const h="feedback"in e,Y=(0,T.ed)(e),I=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(n){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(Y,h),C=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(Y),M=null!==(u=(0,g.w)())&&void 0!==u?u:"",{theme:E}=(0,i.u)(),[_,N]=(0,r.useState)(I),[R,k]=(0,r.useState)(C),[D,F]=(0,r.useState)(e.rationale),[O,L]=(0,r.useState)(null),{updateAssessmentMutation:H,isLoading:V}=(({assessment:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,l.tz)(),i=(0,v.jE)(),a=(0,m.K)(e=>e.logAddedAssessment),d=(0,S.M)(),{mutate:u,isLoading:p}=(0,y.n)({mutationFn:t=>(0,c.F9)()&&null!==d&&void 0!==d&&d.modelTraceInfo&&(0,b.gD)(d.modelTraceInfo)&&(0,b.ko)(null===d||void 0===d?void 0:d.modelTraceInfo)?(t.assessment.assessment_name=e.assessment_name,w._A.updateAssessmentV4({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t,traceLocation:d.modelTraceInfo.trace_location})):(0,w.G3)({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,b.ij)(r.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:n=>{var s;if((0,c.F9)()&&(0,o.isObject)(n)){const e="assessment"in n?n.assessment:n;a(e.trace_id,e)}i.invalidateQueries({queryKey:[b.BS,e.trace_id]}),null===(s=d.invalidateTraceQuery)||void 0===s||s.call(d,e.trace_id),(0,x.B)({queryClient:i}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{updateAssessmentMutation:u,isLoading:p}})({assessment:e,onSuccess:t,onSettled:n}),{overrideAssessmentMutation:$,isLoading:B}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,l.tz)(),i=(0,v.jE)(),a=(0,m.K)(e=>e.logAddedAssessment),d=(0,m.K)(e=>e.logRemovedAssessment),u=(0,S.M)(),{mutate:p,isLoading:f}=(0,y.n)({mutationFn:({oldAssessment:e,value:t,rationale:n})=>{var s;const r={...e,...t,rationale:n,source:{source_id:null!==(s=(0,g.w)())&&void 0!==s?s:"",source_type:"HUMAN"},overrides:e.assessment_id},i={assessment:(0,o.omit)(r,"assessment_id","create_time","last_update_time","overriddenAssessments")};return(0,c.F9)()&&u.modelTraceInfo&&(0,b.gD)(u.modelTraceInfo)&&(0,b.ko)(u.modelTraceInfo)?w._A.createAssessmentV4({payload:i,traceLocation:u.modelTraceInfo.trace_location}):(0,w.bU)({payload:i})},onError:e=>{(0,b.ij)(r.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:(n,s)=>{var r;if((0,c.F9)()&&(0,o.isObject)(n)){const t="assessment"in n?n.assessment:n;t.overriddenAssessment=s.oldAssessment,a(e,t),d(e,s.oldAssessment)}i.invalidateQueries({queryKey:[b.BS,e]}),null===(r=u.invalidateTraceQuery)||void 0===r||r.call(u,e),(0,x.B)({queryClient:i}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{overrideAssessmentMutation:p,isLoading:f}})({traceId:e.trace_id,onSuccess:t,onSettled:n}),U=V||B,z=(0,r.useCallback)(async()=>{if("json"===_)try{JSON.parse(R)}catch(n){return void L((0,f.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=(0,d.KN)({formValue:R,dataType:_,isFeedback:h});if(M!==e.source.source_id&&h)$({oldAssessment:e,value:t,...D?{rationale:D}:{}});else{const e={assessment:{...t,rationale:D},update_mask:(h?"feedback":"expectation")+",rationale"};H(e)}},[_,R,h,M,e,D,H,$]);return(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:E.spacing.xs,marginTop:E.spacing.sm,border:`1px solid ${E.colors.border}`,padding:E.spacing.sm,borderRadius:E.borders.borderRadiusSm},""),children:[(0,f.Y)(i.T.Text,{css:(0,s.AH)({marginTop:E.spacing.xs},""),size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,f.FD)(p.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:_,disabled:U,onChange:e=>{N(e.target.value),L(null)},children:[!h&&(0,f.Y)(p.SimpleSelectOption,{value:"json",children:(0,f.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,f.Y)(p.SimpleSelectOption,{value:"string",children:(0,f.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,f.Y)(p.SimpleSelectOption,{value:"boolean",children:(0,f.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,f.Y)(p.SimpleSelectOption,{value:"number",children:(0,f.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,f.Y)(i.T.Text,{css:(0,s.AH)({marginTop:E.spacing.xs},""),size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===_&&(0,f.FD)(f.FK,{children:[(0,f.Y)(A.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(R),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value),L(null)},validationState:O?"error":void 0,disabled:U}),O&&(0,f.Y)(p.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:O,type:"error"})]}),"string"===_&&(0,f.Y)(A.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(R),onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value),L(null)},disabled:U,allowClear:!0}),"boolean"===_&&(0,f.FD)(p.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:R,disabled:U,onChange:e=>{k(e.target.value),L(null)},children:[(0,f.Y)(p.SegmentedControlButton,{value:!0,children:"True"}),(0,f.Y)(p.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===_&&(0,f.Y)(A.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(R),onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value?Number(e.target.value):""),L(null)},type:"number",disabled:U,allowClear:!0}),(0,f.Y)(i.T.Text,{css:(0,s.AH)({marginTop:E.spacing.xs},""),size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,f.Y)(A.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:D,autoSize:{minRows:1,maxRows:5},disabled:U,onKeyDown:e=>e.stopPropagation(),onChange:e=>F(e.target.value)}),(0,f.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:E.spacing.xs},""),children:[(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:U,onClick:a,children:(0,f.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,f.Y)(i.B,{css:(0,s.AH)({marginLeft:E.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:z,loading:U,children:(0,f.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var C=n(4564),M=n(777),E=n(94777),_=n(21636),N=n(86119),R=n(110);var k={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},D={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},F={name:"s5xdrg",styles:"display:flex;align-items:center"},O={name:"fxp7t8",styles:"flex:1;min-width:0"};const L=({expectation:e})=>{var t;const{theme:n}=(0,i.u)(),[a,c]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!1),{nodeMap:x,activeView:b}=(0,u.nJ)(),{experimentId:w}=(0,R.g)(),S=e.span_id?x[e.span_id]:null,A=null===(t=e.metadata)||void 0===t?void 0:t[_.K6],L="summary"===b&&!(0,o.isEmpty)(A),H="summary"===b&&S&&!L,V=(0,d.jf)(e.expectation),$=(0,T.RZ)(e.source);return(0,f.FD)("div",{css:(0,s.AH)({padding:n.spacing.sm+n.spacing.xs,paddingTop:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,f.FD)("div",{css:k,children:[(0,f.Y)(i.T.Text,{bold:!0,css:D,children:e.assessment_name}),(0,f.Y)(h,{assessment:e,setIsEditing:c,setShowDeleteModal:g}),(0,f.Y)(Y,{assessment:e,isModalVisible:m,setIsModalVisible:g})]}),a?(0,f.Y)(I,{assessment:e,onSuccess:()=>c(!1),onCancel:()=>c(!1)}):(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,f.FD)("div",{css:F,children:[(0,f.Y)($,{size:n.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:n.colors.actionIconBackgroundHover,borderRadius:n.borders.borderRadiusFull},"")}),(0,f.Y)(C.V,{source:e.source})]}),(0,f.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:v?"flex-start":"center",gap:n.spacing.xs},""),children:[(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.toggle-expectation-expanded",size:"small",icon:v?(0,f.Y)(p.ChevronDownIcon,{}):(0,f.Y)(i.o,{}),onClick:()=>y(!v)}),(0,f.Y)("div",{css:O,children:v?(0,f.Y)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundSecondary,padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderRadius:n.borders.borderRadiusMd,whiteSpace:"pre-wrap",wordBreak:"break-word"},""),children:(0,f.Y)(i.T.Text,{children:"string"===typeof V?V:JSON.stringify(V,null,2)})}):(0,f.Y)(M.S,{parsedValue:V,singleLine:!0})})]})]}),H&&(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,f.Y)(E.o,{node:S})]}),L&&(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"451ETc",defaultMessage:"Session"})}),(0,f.Y)(N.b,{experimentId:null!==w&&void 0!==w?w:"",sessionId:null!==A&&void 0!==A?A:"",traceId:e.trace_id,handleCopy:()=>{},hideLabel:!0})]})]})};var H=n(40724),V=n(57248);const $=({name:e,setName:t,nameError:n,setNameError:s,handleChangeSchema:o})=>{const{schemas:i}=(0,V.a)(),a=(0,l.tz)(),d=i.map(e=>{var t;return null!==(t=e.name)&&void 0!==t?t:""}),[c,u]=(0,r.useState)(null),[m,g]=(0,r.useState)(i),h=(0,r.useMemo)(()=>{const t=[...m];if(e&&!d.includes(e)){const n=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);t.unshift(n)}return t},[e,m,d]),v=(0,r.useCallback)(e=>{u(e),s(null)},[s]);(0,r.useEffect)(()=>{o(c)},[o,c]);const y=(0,p.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:i,items:h,setItems:g,multiSelect:!1,setInputValue:e=>{t(e),s(null)},itemToString:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""},matcher:(e,t)=>{var n,s;return null!==(n=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(t.toLowerCase()))&&void 0!==n&&n},formValue:c,formOnChange:v,preventUnsetOnBlur:!0});return(0,f.FD)(p.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:y,children:[(0,f.Y)(p.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:a.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:n?"error":void 0,comboboxState:y,formOnChange:v,onPressEnter:()=>{h.length>0&&v(h[0])},allowClear:!0,showComboboxToggleButton:!0}),n&&(0,f.Y)(p.FormUI.Message,{type:"error",message:n}),(0,f.Y)(p.TypeaheadComboboxMenu,{comboboxState:y,children:h.map((e,t)=>{var n,s,o;return(0,f.Y)(p.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`,item:e,index:t,comboboxState:y,children:null!==(o=null===e||void 0===e?void 0:e.name)&&void 0!==o?o:""},`assessment-name-typeahead-${null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""}`)})})]})};var B=n(52033),U=n(72143),z=n(89634),j=n(27094);const P={json:U.f,string:j.k,boolean:B.B,number:z.O},K=(0,r.forwardRef)(({assessmentName:e,initialAssessmentType:t,spanId:n,traceId:a,setExpanded:u},h)=>{var Y;const{theme:T}=(0,i.u)(),{schemas:I}=(0,V.a)(),[C,M]=(0,r.useState)(""),[E,N]=(0,r.useState)(null!==t&&void 0!==t?t:"feedback"),[R,k]=(0,r.useState)("boolean"),[D,F]=(0,r.useState)(!0),[O,L]=(0,r.useState)(""),[H,B]=(0,r.useState)(null),[U,z]=(0,r.useState)(null),j=!(0,o.isNil)(e),K=null!==(Y=P[R])&&void 0!==Y?Y:P.string,{createAssessmentMutation:W,isLoading:q}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,l.tz)(),i=(0,v.jE)(),a=(0,m.K)(e=>e.logAddedAssessment),d=(0,S.M)(),{mutate:u,isLoading:p}=(0,y.n)({mutationFn:e=>{const t=e;return(0,c.aZ)()&&d.chatSessionId&&e.assessment&&(e.assessment.metadata={...e.assessment.metadata,[_.n2]:d.chatSessionId}),(0,c.F9)()&&null!==d&&void 0!==d&&d.modelTraceInfo&&(0,b.gD)(d.modelTraceInfo)&&(0,b.ko)(null===d||void 0===d?void 0:d.modelTraceInfo)?w._A.createAssessmentV4({payload:t,traceLocation:d.modelTraceInfo.trace_location}):(0,w.bU)({payload:t})},onSuccess:n=>{var s;if((0,c.F9)()&&(0,o.isObject)(n)){const t="assessment"in n?n.assessment:n;a(e,t)}null===(s=d.invalidateTraceQuery)||void 0===s||s.call(d,e),i.invalidateQueries({queryKey:[b.BS,e]}),(0,x.B)({queryClient:i}),null===t||void 0===t||t()},onError:e=>{(0,b.ij)(r.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSettled:()=>{null===s||void 0===s||s()}});return{createAssessmentMutation:u,isLoading:p}})({traceId:a,onSettled:()=>{u(!1)}}),G=(0,r.useCallback)(async()=>{var t;if("json"===R)try{JSON.parse(D)}catch(r){return void z((0,f.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!j&&""===C)return void B((0,f.Y)(l.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const s=(0,d.KN)({formValue:D,dataType:R,isFeedback:"feedback"===E}),o={assessment:{assessment_name:j?e:C,trace_id:a,source:{source_type:"HUMAN",source_id:null!==(t=(0,g.w)())&&void 0!==t?t:""},span_id:n,rationale:O,...s}};W(o)},[R,D,E,j,e,C,a,n,O,W]),Q=(0,r.useCallback)(e=>{if(!e)return M(""),N(null!==t&&void 0!==t?t:"feedback"),k("boolean"),F(!0),L(""),void z(null);if(I.some(t=>t.name===e.name))switch(M(e.name),N(e.assessmentType),k(e.dataType),e.dataType){case"string":case"json":F("");break;case"number":F(0);break;case"boolean":F(!0)}else M(e.name)},[I,t]);return(0,f.FD)("div",{ref:h,css:(0,s.AH)({display:"flex",flexDirection:"column",gap:T.spacing.xs,border:`1px solid ${T.colors.border}`,padding:T.spacing.sm,borderRadius:T.borders.borderRadiusSm},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,f.FD)(p.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",label:"Assessment Type",value:E,disabled:q,onChange:e=>{N(e.target.value),"feedback"===e.target.value&&"json"===R&&k("string")},children:[(0,f.Y)(p.SimpleSelectOption,{value:"feedback",children:(0,f.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,f.Y)(p.SimpleSelectOption,{value:"expectation",children:(0,f.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,f.Y)(i.T.Text,{css:(0,s.AH)({marginTop:T.spacing.xs},""),size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),j?(0,f.Y)(i.T.Text,{children:e}):(0,f.Y)($,{name:C,setName:M,handleChangeSchema:Q,nameError:H,setNameError:B}),(0,f.Y)(i.T.Text,{css:(0,s.AH)({marginTop:T.spacing.xs},""),size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,f.FD)(p.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",label:"Data Type",value:R,disabled:q,onChange:e=>{k(e.target.value),z(null)},children:["expectation"===E&&(0,f.Y)(p.SimpleSelectOption,{value:"json",children:(0,f.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,f.Y)(p.SimpleSelectOption,{value:"string",children:(0,f.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,f.Y)(p.SimpleSelectOption,{value:"boolean",children:(0,f.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,f.Y)(p.SimpleSelectOption,{value:"number",children:(0,f.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,f.Y)(i.T.Text,{css:(0,s.AH)({marginTop:T.spacing.xs},""),size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,f.Y)(K,{value:D,valueError:U,setValue:F,setValueError:z,isSubmitting:q}),(0,f.Y)(i.T.Text,{css:(0,s.AH)({marginTop:T.spacing.xs},""),size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,f.Y)(A.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:O,autoSize:{minRows:1,maxRows:5},disabled:q,onKeyDown:e=>e.stopPropagation(),onChange:e=>L(e.target.value)}),(0,f.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:T.spacing.xs},""),children:[(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:q,onClick:()=>u(!1),children:(0,f.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,f.Y)(i.B,{css:(0,s.AH)({marginLeft:T.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:G,loading:q,children:(0,f.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})}),W=({onClick:e})=>(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.add-expectation",size:"small",icon:(0,f.Y)(p.PlusIcon,{}),onClick:e,children:(0,f.Y)(H.A,{id:"OneX+E",defaultMessage:"Add expectation"})}),q=({expectations:e,activeSpanId:t,traceId:n})=>{const l=(0,r.useMemo)(()=>e.toSorted((e,t)=>e.assessment_name.localeCompare(t.assessment_name)),[e]),[d,c]=(0,r.useState)(!1),{theme:u}=(0,i.u)();return(0,f.FD)(f.FK,{children:[(0,f.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",height:u.spacing.lg,flexShrink:0},""),children:(0,f.FD)(i.T.Text,{bold:!0,children:[(0,f.Y)(H.A,{id:"UbXw8O",defaultMessage:"Expectations"})," ",!(0,o.isEmpty)(l)&&(0,f.FD)(f.FK,{children:["(",null===l||void 0===l?void 0:l.length,")"]})]})}),(0,f.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginBottom:u.spacing.sm},""),children:!(0,o.isEmpty)(l)&&(0,f.Y)(W,{onClick:()=>c(!0)})}),l.length>0?(0,f.Y)(f.FK,{children:(0,f.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginBottom:u.spacing.sm},""),children:l.map(e=>(0,f.Y)(L,{expectation:e},e.assessment_id))})}):!d&&(0,f.FD)("div",{css:(0,s.AH)({textAlign:"center",borderRadius:u.spacing.xs,border:`1px dashed ${u.colors.border}`,padding:`${u.spacing.md}px ${u.spacing.md}px`},""),children:[(0,f.FD)(i.T.Hint,{children:[(0,f.Y)(H.A,{id:"dTjHiD",defaultMessage:"Add a custom expectation to this trace."})," ",(0,f.Y)(i.T.Link,{componentId:"shared.model-trace-explorer.expectation-learn-more-link",openInNewTab:!0,href:"https://www.mlflow.org/docs/latest/genai/assessments/expectations/",children:(0,f.Y)(H.A,{id:"zMv2ev",defaultMessage:"Learn more."})})]}),(0,f.Y)(a.S,{size:"sm"}),(0,f.Y)(W,{onClick:()=>c(!0)})]}),d&&(0,f.Y)(K,{spanId:t,traceId:n,initialAssessmentType:"expectation",setExpanded:()=>c(!1)})]})};var G=n(5075);var Q={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const J=({renderConnector:e=!0,assessment:t,setIsEditing:n,hideOverflowMenu:o=!1})=>{const{theme:a}=(0,i.u)(),[l,c]=(0,r.useState)(!1),u=(0,T.RZ)(t.source);return(0,f.FD)("div",{css:Q,children:[e&&(0,f.Y)("div",{css:(0,s.AH)({position:"absolute",left:-1,top:0,width:10,height:a.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:a.borders.borderRadiusMd,borderBottom:`1px solid ${a.colors.border}`,borderLeft:`1px solid ${a.colors.border}`},"")}),(0,f.Y)(u,{size:a.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:a.colors.actionIconBackgroundHover,borderRadius:a.borders.borderRadiusFull},"")}),(0,f.Y)(C.V,{source:t.source}),(0,f.FD)("div",{css:(0,s.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:a.spacing.xs},""),children:[t.last_update_time&&(0,f.Y)(i.T.Text,{color:"secondary",size:"sm",css:(0,s.AH)({marginLeft:a.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:(0,d.Pt)(new Date(t.last_update_time))}),!o&&(0,f.Y)(h,{assessment:t,setIsEditing:n,setShowDeleteModal:c}),(0,f.Y)(Y,{assessment:t,isModalVisible:l,setIsModalVisible:c})]})]})};var Z=n(73879),X=n(96586);var ee={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const te=({feedback:e})=>{const{theme:t}=(0,i.u)(),n=e.feedback.value;return(0,f.FD)("div",{css:ee,children:[(0,f.Y)(J,{renderConnector:!1,assessment:e}),(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,o.isNil)(e.feedback.error)?(0,f.FD)(f.FK,{children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,f.Y)("div",{children:(0,f.Y)(G.Q,{jsonValue:JSON.stringify(n),assessmentName:e.assessment_name})})]}):(0,f.Y)(X.B,{error:e.feedback.error}),e.rationale&&(0,f.FD)(f.FK,{children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",css:(0,s.AH)({marginTop:t.spacing.xs},""),children:(0,f.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,f.Y)(Z.V,{children:e.rationale})]})]})]})},ne=({isModalVisible:e,setIsModalVisible:t,feedback:n})=>{const s=(0,r.useMemo)(()=>(e=>{const t=new Set,n=[];let s=e;for(;s&&!t.has(s.assessment_id);)t.add(s.assessment_id),n.push(s),s=s.overriddenAssessment;return n})(n),[n]);return(0,f.Y)(a.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,f.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:s.map(e=>"feedback"in e?(0,f.Y)(te,{feedback:e},e.assessment_id):null)})},se=e=>(0,R.tW)((0,R.Oz)("/experiments/:experimentId"),{experimentId:e});var oe=n(43695);var re={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},ie={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"},ae={name:"rnnx2x",styles:"font-size:12px"};const le=({feedback:e})=>{var t,n,a;const[d,c]=(0,r.useState)(!1),{theme:m}=(0,i.u)(),{nodeMap:p,activeView:g}=(0,u.nJ)(),{experimentId:h}=(0,R.g)(),v=e.feedback.value,y=e.span_id?p[e.span_id]:null,x=null===(t=e.metadata)||void 0===t?void 0:t[_.K6],b="summary"===g&&!(0,o.isEmpty)(x),w="summary"===g&&y&&!b,S=null===(n=e.metadata)||void 0===n?void 0:n[_.gK],Y=S&&h?de(h,S):void 0,A=null===(a=e.metadata)||void 0===a?void 0:a[_.zZ],T=(()=>{if(null===A)return;const e=Number(A);return Number.isFinite(e)?(0,oe.l)(e):void 0})(),I=Boolean(T);return(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.sm,marginLeft:m.spacing.lg},""),children:[!(0,o.isNil)(e.feedback.error)&&(0,f.Y)(X.B,{error:e.feedback.error}),w&&(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,f.Y)(E.o,{node:y})]}),b&&(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"451ETc",defaultMessage:"Session"})}),(0,f.Y)(N.b,{experimentId:null!==h&&void 0!==h?h:"",sessionId:null!==x&&void 0!==x?x:"",traceId:e.trace_id,handleCopy:()=>{},hideLabel:!0})]}),(0,o.isNil)(e.feedback.error)&&(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,f.FD)("div",{css:(0,s.AH)({display:"flex",gap:m.spacing.xs},""),children:[(0,f.Y)(G.Q,{jsonValue:JSON.stringify(v),assessmentName:e.assessment_name}),e.overriddenAssessment&&(0,f.FD)(f.FK,{children:[(0,f.Y)("span",{onClick:()=>c(!0),children:(0,f.Y)(i.T.Text,{css:re,color:"secondary",children:(0,f.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,f.Y)(ne,{isModalVisible:d,setIsModalVisible:c,feedback:e})]})]})]}),e.rationale&&(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,f.Y)("div",{css:ie,children:(0,f.Y)(Z.V,{children:e.rationale})})]}),I&&(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs},""),children:[(0,f.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,f.Y)(l.sA,{id:"oBJ8xc",defaultMessage:"Cost"})}),(0,f.Y)(i.T.Text,{style:{color:m.colors.textSecondary},children:T})]}),Y&&(0,f.Y)(R.N_,{to:Y,target:"_blank",rel:"noreferrer",children:(0,f.FD)("span",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:m.spacing.xs},""),children:[(0,f.Y)(l.sA,{id:"4a2Kqx",defaultMessage:"View trace"}),(0,f.Y)(i.au,{css:ae})]})})]})},de=(e,t)=>`${(e=>`${se(e)}/traces`)(e)}?selectedEvaluationId=${t}`,ce=({feedback:e})=>{const{theme:t}=(0,i.u)(),[n,o]=(0,r.useState)(!1);return(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,f.Y)(J,{assessment:e,setIsEditing:o}),n?(0,f.Y)(I,{assessment:e,onSuccess:()=>o(!1),onCancel:()=>o(!1)}):(0,f.Y)(le,{feedback:e})]})};const ue=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,f.Y)(p.UserIcon,{css:t});case"LLM_JUDGE":return(0,f.Y)(p.SparkleIcon,{css:t});case"CODE":return(0,f.Y)(p.CodeIcon,{css:t});default:return null}},me=e=>{switch(e){case"HUMAN":return(0,f.Y)(H.A,{id:"OjWQ39",defaultMessage:"Human feedback"});case"LLM_JUDGE":return(0,f.Y)(H.A,{id:"SihD1a",defaultMessage:"LLM judge feedback"});case"CODE":return(0,f.Y)(H.A,{id:"SuVsDp",defaultMessage:"Custom code judge feedback"})}return null};var pe={name:"npti7n",styles:"margin:0;&>*{cursor:default;}"};const ge=({feedbacks:e})=>{const{theme:t}=(0,i.u)();if(e.length<1)return null;const n=(0,o.countBy)(e,e=>e.source.source_type);return(0,f.Y)("div",{css:(0,s.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(n).map(([e,n])=>(0,f.Y)(a.T,{componentId:"shared.model-trace-explorer.feedback-source-tooltip",content:me(e),children:(0,f.Y)(p.Tag,{componentId:"shared.model-trace-explorer.feedback-source-count",css:pe,children:(0,f.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[ue(e),n>1&&(0,f.Y)(i.T.Text,{children:n})]})},e)}))})};var fe={name:"1fttcpj",styles:"display:flex;flex-direction:column"},he={name:"ozd7xs",styles:"flex-shrink:0"},ve={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const ye=({jsonValue:e,feedbacks:t})=>{var n;const{theme:o}=(0,i.u)(),[a,l]=(0,r.useState)(!1),d=null===(n=t[0])||void 0===n?void 0:n.assessment_name;return(0,f.FD)("div",{css:fe,children:[(0,f.FD)("div",{css:(0,s.AH)({display:"flex",gap:o.spacing.xs,alignItems:"center"},""),children:[(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:he,size:"small",icon:a?(0,f.Y)(p.ChevronDownIcon,{}):(0,f.Y)(i.o,{}),onClick:()=>l(!a)}),(0,f.Y)(G.Q,{jsonValue:e,assessmentName:d}),(0,f.Y)(ge,{feedbacks:t})]}),a&&(0,f.Y)("div",{css:ve,children:t.map(e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,f.Y)(ce,{feedback:e},e.assessment_id))})]})};var xe={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},be={name:"ozd7xs",styles:"flex-shrink:0"};const we=({name:e,valuesMap:t,traceId:n,activeSpanId:l,feedbackTypeTag:c,loading:u,onCancelLoading:m})=>{const{theme:g}=(0,i.u)(),h=(0,d.se)(e),[v,y]=(0,r.useState)(!1),x=Object.values(t).flat().some(e=>!(0,o.isNil)(e.feedback.error));return(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",marginBottom:g.spacing.sm,border:`1px solid ${g.colors.border}`,borderRadius:g.borders.borderRadiusMd,padding:g.spacing.sm+g.spacing.xs,paddingTop:g.spacing.sm,gap:g.spacing.sm},""),children:[c,(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:g.spacing.sm},""),children:[(0,f.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:g.spacing.sm,flex:1,minWidth:0},""),children:[(0,f.Y)(i.T.Text,{bold:!0,css:xe,children:h}),x&&(0,f.Y)(i.k,{css:be,color:"danger"})]}),(0,f.Y)(a.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,s.AH)({flexShrink:0,marginRight:-g.spacing.xs},""),size:"small",icon:(0,f.Y)(p.PlusIcon,{}),onClick:()=>y(!0)})})]}),Object.entries(t).map(([e,t])=>(0,f.Y)(ye,{jsonValue:e,feedbacks:t},e)),u&&(0,f.FD)(f.FK,{children:[(0,f.Y)(p.TableSkeleton,{lines:2}),m&&(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.cancel-evaluation-in-group",size:"small",icon:(0,f.Y)(p.StopCircleFillIcon,{}),onClick:m,children:(0,f.Y)(H.A,{id:"r63O2u",defaultMessage:"Cancel judge"})})]}),v&&(0,f.Y)(K,{assessmentName:e,spanId:l,traceId:n,setExpanded:y})]})};var Se=n(9636);const Ye=({onClick:e,traceId:t,sessionId:n})=>{const s=(0,Se.$)(),[o,a]=(0,r.useState)(!1);var l;return s.renderRunJudgeModal&&(0,c.u6)()?(0,f.FD)(f.FK,{children:[(0,f.FD)(p.DropdownMenu.Root,{children:[(0,f.Y)(p.DropdownMenu.Trigger,{asChild:!0,children:(0,f.Y)(i.B,{type:"primary",componentId:"shared.model-trace-explorer.add-feedback",size:"small",icon:(0,f.Y)(p.PlusIcon,{}),children:(0,f.Y)(H.A,{id:"/ZsbLo",defaultMessage:"Add feedback"})})}),(0,f.FD)(p.DropdownMenu.Content,{children:[(0,f.Y)(p.DropdownMenu.Item,{componentId:"mlflow.model-trace-explorer.add-human-feedback",onClick:e,children:(0,f.Y)(H.A,{id:"YeCF5P",defaultMessage:"Human feedback"})}),(0,f.Y)(p.DropdownMenu.Item,{componentId:"mlflow.model-trace-explorer.run-judge",onClick:()=>a(!0),children:(0,f.Y)(H.A,{id:"1+JyrI",defaultMessage:"LLM judge feedback"})})]})]}),null===(l=s.renderRunJudgeModal)||void 0===l?void 0:l.call(s,{itemId:null!==n&&void 0!==n?n:t,visible:o,onClose:()=>a(!1)})]}):(0,f.Y)(i.B,{type:"primary",componentId:"shared.model-trace-explorer.add-feedback",size:"small",icon:(0,f.Y)(p.PlusIcon,{}),onClick:e,children:(0,f.Y)(H.A,{id:"/ZsbLo",defaultMessage:"Add feedback"})})};var Ae={name:"1s8rng8",styles:"display:flex;gap:4px;justify-content:center"};const Te=({enableRunScorer:e,feedbacks:t,activeSpanId:n,traceId:l,sessionId:d})=>{const c=(0,r.useMemo)(()=>(e=>{const t={};return e.forEach(e=>{if(!1===e.valid)return;let n=null;""!==e.feedback.value&&(n=JSON.stringify(e.feedback.value));const{assessment_name:s}=e;t[s]||(t[s]={});const r=t[s];(0,o.isNil)(n)||(r[n]||(r[n]=[]),r[n].push(e))}),Object.entries(t)})(t),[t]),[u,m]=(0,r.useState)(!1),{evaluations:g,subscribeToScorerFinished:h,reset:y}=(0,Se.$)(),w=(0,r.useMemo)(()=>g?Object.values(g).filter(e=>{var t;return l in(null!==(t=e.tracesData)&&void 0!==t?t:{})}):[],[g,l]),{newTracePendingEvaluations:Y,loadingEvaluations:A}=(0,r.useMemo)(()=>{const e=w.filter(e=>e.isLoading);return{newTracePendingEvaluations:(0,o.uniqBy)(e.filter(e=>!c.some(([t])=>t===e.label)),"label"),loadingEvaluations:e}},[w,c]),T=(0,r.useMemo)(()=>w.filter(e=>e.error),[w]),{invalidateTraceQuery:I}=(0,S.M)(),C=(0,v.jE)();(0,r.useEffect)(()=>null===h||void 0===h?void 0:h(e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.some(e=>{var t,n,s;return"trace"in e&&(null===(t=e.trace)||void 0===t?void 0:t.info)&&"trace_id"in(null===(n=e.trace)||void 0===n?void 0:n.info)&&(null===(s=e.trace)||void 0===s?void 0:s.info.trace_id)===l}))&&(null===I||void 0===I||I(l),C.invalidateQueries({queryKey:[b.BS,l]}),(0,x.B)({queryClient:C}))}),[h,l,I,C]);const M=(0,o.isEmpty)(c)&&(0,o.isEmpty)(T)&&(0,o.isEmpty)(Y),{theme:E}=(0,i.u)();return(0,f.FD)(f.FK,{children:[(0,f.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:E.spacing.sm,height:E.spacing.lg,flexShrink:0},""),children:(0,f.FD)(i.T.Text,{bold:!0,children:[(0,f.Y)(H.A,{id:"utyagz",defaultMessage:"Feedback"})," ",!(0,o.isEmpty)(c)&&(0,f.FD)(f.FK,{children:["(",null===t||void 0===t?void 0:t.length,")"]})]})}),!M&&(0,f.Y)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginBottom:E.spacing.sm,gap:E.spacing.xs},""),children:(0,f.Y)(Ye,{traceId:l,sessionId:d,onClick:()=>m(!0)})}),T.map(e=>{var t;return(0,f.Y)("div",{css:(0,s.AH)({marginBottom:E.spacing.sm},""),children:(0,f.Y)(p.Alert,{closable:!1,type:"error",message:(0,f.Y)(H.A,{id:"HSMagB",defaultMessage:'Error evaluating "{label}"',values:{label:e.label}}),description:null===(t=e.error)||void 0===t?void 0:t.message,componentId:"shared.model-trace-explorer.feedback-error-item"})},e.requestKey)}),Y.map(e=>(0,f.FD)("div",{css:(0,s.AH)({borderRadius:E.spacing.sm,border:`1px solid ${E.colors.border}`,padding:E.spacing.sm+E.spacing.xs,paddingTop:E.spacing.sm,marginBottom:E.spacing.sm,display:"flex",flexDirection:"column",gap:E.spacing.sm},""),children:[(0,f.Y)(i.T.Text,{bold:!0,children:e.label}),(0,f.Y)(p.TableSkeleton,{lines:3}),y&&(0,f.Y)(i.B,{componentId:"shared.model-trace-explorer.cancel-evaluation",size:"small",icon:(0,f.Y)(p.StopCircleFillIcon,{}),onClick:()=>y(e.requestKey),children:(0,f.Y)(H.A,{id:"r63O2u",defaultMessage:"Cancel judge"})})]},e.requestKey)),c.map(([e,t])=>{const s=A.find(t=>t.label===e);return(0,f.Y)(we,{name:e,valuesMap:t,traceId:l,activeSpanId:n,loading:Boolean(s),onCancelLoading:s&&y?()=>y(s.requestKey):void 0},e)}),M&&!u&&(0,f.FD)("div",{css:(0,s.AH)({textAlign:"center",borderRadius:E.spacing.xs,border:`1px dashed ${E.colors.border}`,padding:`${E.spacing.md}px ${E.spacing.md}px`},""),children:[(0,f.FD)(i.T.Hint,{children:[(0,f.Y)(H.A,{id:"MNLhKO",defaultMessage:"Add custom feedback to this trace."})," ",(0,f.Y)(i.T.Link,{componentId:"shared.model-trace-explorer.feedback-learn-more-link",openInNewTab:!0,href:"https://www.mlflow.org/docs/latest/genai/assessments/feedback/",children:(0,f.Y)(H.A,{id:"mLr9U7",defaultMessage:"Learn more."})})]}),(0,f.Y)(a.S,{size:"sm"}),(0,f.Y)("div",{css:Ae,children:(0,f.Y)(Ye,{traceId:l,sessionId:d,onClick:()=>m(!0)})})]}),u&&(0,f.Y)(K,{spanId:n,traceId:l,initialAssessmentType:"feedback",setExpanded:()=>m(!1)})]})};var Ie={name:"ozd7xs",styles:"flex-shrink:0"};const Ce=({assessments:e,traceId:t,sessionId:n,activeSpanId:p,className:g,assessmentsTitleOverride:h,disableCloseButton:v,enableRunScorer:y=!0})=>{const x=(0,m.K)(e=>e.reconstructAssessments),b=(0,m.K)(e=>e.assessmentActions[t]),w=(0,r.useMemo)(()=>{if(!(0,c.F9)())return e;const t=x(e,b);return(0,o.uniqBy)(t,({assessment_id:e})=>e)},[e,x,b]),{theme:S}=(0,i.u)(),{setAssessmentsPaneExpanded:Y,isInComparisonView:A}=(0,u.nJ)(),[T,I]=(0,r.useMemo)(()=>(0,o.partition)(w,e=>"feedback"in e),[w]),C=(0,Se.$)();return(0,f.FD)("div",{"data-testid":"assessments-pane",css:(0,s.AH)({display:"flex",flexDirection:"column",...A?{padding:`${S.spacing.sm} 0`,maxHeight:10*S.spacing.lg}:{padding:S.spacing.sm,paddingTop:S.spacing.xs,height:"100%"},...A?{}:{borderLeft:`1px solid ${S.colors.border}`},overflowY:"auto",minWidth:d.uZ,width:"100%",boxSizing:"border-box"},""),className:g,children:[(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginTop:S.spacing.sm,marginBottom:S.spacing.sm},""),children:[!A&&(h?h():(0,f.Y)(i.T.Title,{level:3,withoutMargins:!0,css:Ie,children:(0,f.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})})),!A&&Y&&!v&&(0,f.Y)(a.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,f.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,f.Y)(i.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,f.Y)(i.C,{}),onClick:()=>Y(!1)})})]}),(0,f.Y)(Te,{enableRunScorer:y&&(0,c.u6)()&&Boolean(C.renderRunJudgeModal),feedbacks:T,activeSpanId:p,traceId:t,sessionId:n}),(0,f.Y)(a.S,{size:"sm",shrinks:!1}),(0,f.Y)(q,{expectations:I,activeSpanId:p,traceId:t})]})}},25862:function(e,t,n){n.d(t,{q:function(){return f}});var s=n(68248),o=n(46709),r=n(53108),i=n(82716),a=n(27757),l=n(65072),d=n(73408);const c="70vw",u=(0,o.createContext)(!1);function m(e){return"number"===typeof e?e:"string"===typeof e&&e.endsWith("vw")?parseFloat(e)/100*window.innerWidth:"string"===typeof e&&e.endsWith("px")?parseFloat(e):320}var p={name:"1m9jjl6",styles:"body, body *{user-select:none;cursor:col-resize !important;}"},g={name:"1c6010k",styles:'[data-testid="drawer-overlay"]{background-color:transparent !important;}'};const f={Root:function({open:e,onOpenChange:t,modal:n=!1,children:s}){return(0,d.Y)(u.Provider,{value:n,children:(0,d.Y)(i.Drawer.Root,{modal:n,open:e,onOpenChange:t,children:s})})},Content:function({children:e,title:t,width:n=320,componentId:f,footer:h,expandContentToFullHeight:v,useCustomScrollBehavior:y,disableOpenAutoFocus:x,hideClose:b,size:w,css:S}){const{isPanelOpen:Y}=(0,l.w)(),A=(0,o.useContext)(u),{theme:T}=(0,a.u)(),I=Y?"left":"right",C=Y?c:n,[M,E]=(0,o.useState)(()=>m(C)),[_,N]=(0,o.useState)(!1),R=(0,o.useRef)(!1);(0,o.useEffect)(()=>{E(m(Y?c:n))},[Y,n]);const k=(0,o.useCallback)(e=>{e.preventDefault(),R.current=!0,N(!0);const t=e=>{if(!R.current)return;const t=window.innerWidth,n=.9*t;let s;s="right"===I?t-e.clientX:e.clientX,E(Math.max(400,Math.min(n,s)))},n=()=>{R.current=!1,N(!1),document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)},[I]),D={boxShadow:"0 4px 16px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04)"},F=S?[D,...Array.isArray(S)?S:[S]]:D;return(0,d.FD)(d.FK,{children:[!A&&(0,d.Y)(s.mL,{styles:g}),_&&(0,d.Y)(s.mL,{styles:p}),(0,d.Y)(i.Drawer.Content,{componentId:f,width:M,title:t,position:I,footer:h,expandContentToFullHeight:v,useCustomScrollBehavior:y,disableOpenAutoFocus:x,hideClose:b,size:w,css:F,onInteractOutside:e=>{const t=e.target,n=null===t||void 0===t?void 0:t.closest('[data-assistant-ui="true"]'),s=null===t||void 0===t?void 0:t.closest('[data-drawer-resize-handle="true"]');(n||s)&&e.preventDefault()},children:e}),(0,r.createPortal)((0,d.Y)("div",{"data-drawer-resize-handle":"true",onMouseDown:k,css:(0,s.AH)({position:"fixed",top:0,bottom:0,..."right"===I?{right:M-6}:{left:M-6},width:12,cursor:"col-resize",zIndex:T.options.zIndexBase+3,"&::after":{content:'""',position:"absolute",top:0,bottom:0,left:"50%",width:2,transform:"translateX(-50%)",backgroundColor:"transparent",borderRadius:1,transition:"background-color 0.15s"},"&:hover::after":{backgroundColor:T.colors.borderDecorative},"&:active::after":{backgroundColor:T.colors.border}},"")}),document.body)]})}}},26059:function(e,t,n){var s=n(68248),o=n(76118),r=n(46709),i=n(25637),a=n(27556),l=n(27757),d=n(49633),c=n(73408);var u={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},m={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},p={name:"kjqqaz",styles:"width:0;position:relative"};const g=(0,r.forwardRef)((e,t)=>{var n;const{initialRatio:g,paneWidth:f,setPaneWidth:h,leftChild:v,leftMinWidth:y,rightChild:x,rightMinWidth:b,onRatioChange:w}=e,[S,Y]=(0,r.useState)(!1),A=(0,r.useRef)(null),T=null===(n=(0,d.wY)({ref:A}))||void 0===n?void 0:n.width,I=(null!==T&&void 0!==T?T:1/0)-b,C=(0,r.useRef)(g),{theme:M}=(0,l.u)(),E=(0,r.useCallback)(e=>{T&&(C.current=e/T)},[T]),_=(0,a.YQ)(null!==w&&void 0!==w?w:()=>{},200),N=(0,r.useCallback)(()=>T,[T]);return(0,r.useImperativeHandle)(t,()=>({updateRatio:E,getContainerWidth:N})),(0,r.useLayoutEffect)(()=>{T&&h((0,o.clamp)(T*C.current,y,I))},[T,I,y,b,h]),(0,c.FD)("div",{ref:A,css:m,children:[S&&(0,c.Y)(s.mL,{styles:u}),(0,c.Y)(i.ResizableBox,{axis:"x",width:f,css:(0,s.AH)({display:"flex",flex:`0 0 ${f}px`},""),handle:(0,c.Y)("div",{css:p,children:(0,c.Y)("div",{css:(0,s.AH)({position:"relative",width:M.spacing.sm,marginLeft:-M.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const n=(0,o.clamp)(t.width,y,I);h(n),T&&(C.current=n/T,_(C.current))},onResizeStart:()=>Y(!0),onResizeStop:()=>Y(!1),minConstraints:[y,1/0],maxConstraints:[I,1/0],children:v}),x]})});t.A=g},27763:function(e,t,n){n.d(t,{F4:function(){return i},Nf:function(){return l},Ss:function(){return a}});var s=n(46709),o=n(73408);const r=(0,s.createContext)(null),i=()=>{const e=(0,s.useContext)(r),[t,n]=(0,s.useState)({});return e||{rowSelection:t,setRowSelection:n}},a=()=>null!==(0,s.useContext)(r),l=({children:e,rowSelection:t,setRowSelection:n})=>(0,o.Y)(r.Provider,{value:{rowSelection:t,setRowSelection:n},children:e})},27882:function(e,t,n){n.d(t,{F9:function(){return r},GK:function(){return a},T9:function(){return o},Z9:function(){return l},aZ:function(){return i},eA:function(){return d},ny:function(){return s},u6:function(){return c}});const s=()=>!1,o=()=>1e9,r=()=>!1,i=()=>!0,a=()=>!1,l=()=>!0,d=()=>!!l(),c=()=>!0},28993:function(e,t,n){n.d(t,{K:function(){return s}});const s=(0,n(24447).vt)(e=>({assessmentActions:{},resetCache:()=>e(()=>({assessmentActions:{}})),logAddedAssessment:(t,n)=>e(e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"ADD",assessment:n}]}}:e),logRemovedAssessment:(t,n)=>e(e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"DELETE",assessment:n}]}}:e),reconstructAssessments:(e,t)=>{if(!t)return e;let n=[...e];return t.forEach(({action:e,assessment:t})=>{"ADD"===e&&t?n.unshift(t):"DELETE"===e&&t&&(n=n.filter(e=>e.assessment_id!==t.assessment_id))}),n}}))},31988:function(e,t,n){n.d(t,{u:function(){return i}});var s=n(82716),o=n(27757),r=n(73408);function i(e){return(0,r.Y)(o.B,{icon:(0,r.Y)(s.TrashIcon,{}),...e})}},33045:function(e,t,n){n.d(t,{u:function(){return l}});var s=n(76118),o=n(46709),r=n(86125),i=n(81390);const a=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},l=({treeNodes:e,selectedNode:t,setSelectedNode:n,setActiveTab:l,setExpandedKeys:d,modelTraceInfo:c})=>{var u;const[m,p]=(0,o.useState)(""),[g,f]=(0,o.useState)(()=>(e=>{const t={};e&&e.length>0&&(0,s.compact)((0,i.VC)(e).map(e=>e.type)).forEach(e=>{t[e]=!0});return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e)),[h,v]=(0,o.useState)(0),y=(0,o.useMemo)(()=>e.map(e=>e.key).join(","),[e]),{filteredTreeNodes:x,matches:b}=(0,o.useMemo)(()=>{if(!e||0===e.length)return{filteredTreeNodes:[],matches:[]};const t=e.map(e=>(0,r.vL)(e,m,g));return{filteredTreeNodes:t.flatMap(e=>e.filteredTreeNodes),matches:t.flatMap(e=>e.matches)}},[y,m,g,c]),w=(0,o.useMemo)(()=>(0,i.dM)(x),[x]),S=(0,o.useCallback)(e=>{if(e>=b.length||e<0)return;v(e);const t=b[e];n(t.span),l(a(t));const s=(0,i.NP)(t.span,w);d(e=>new Set([...e,...s]))},[b,n,l,w,d]),Y=(0,o.useCallback)(()=>{S(h+1)},[h,S]),A=(0,o.useCallback)(()=>{S(h-1)},[h,S]);return(0,o.useLayoutEffect)(()=>{if(0!==x.length){if(0===b.length){var e;const s=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(s in w)n(w[s]);else{const e=x[0];n(e),l(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}return}v(0),n(b[0].span),l(a(b[0]))}},[x,b,n]),{matchData:{match:null!==(u=b[h])&&void 0!==u?u:null,totalMatches:b.length,currentMatchIndex:h},searchFilter:m.toLowerCase().trim(),setSearchFilter:p,spanFilterState:g,setSpanFilterState:f,filteredTreeNodes:x,handleNextSearchMatch:Y,handlePreviousSearchMatch:A}}},33145:function(e,t,n){n.d(t,{RZ:function(){return i},ed:function(){return o},mc:function(){return r}});var s=n(82716);const o=e=>"feedback"in e&&e.feedback?e.feedback.value:"expectation"in e?e.expectation&&"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value:void 0,r=e=>"feedback"in e&&Boolean(e.feedback),i=e=>{switch(e.source_type){case"HUMAN":return s.UserIcon;case"LLM_JUDGE":return s.SparkleIcon;default:return s.CodeIcon}}},33481:function(e,t,n){n.d(t,{_1:function(){return r},bz:function(){return o},o8:function(){return s}});let s=function(e){return e.Evaluations="_evaluations.json",e.Assessments="_assessments.json",e.Metrics="_metrics.json",e}({}),o=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({}),r=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.TOTAL_TOKEN_COUNT="agent/total_token_count",e.TOTAL_INPUT_TOKEN_COUNT="agent/total_input_token_count",e.TOTAL_OUTPUT_TOKEN_COUNT="agent/total_output_token_count",e.DOCUMENT_RECALL="retrieval/ground_truth/document_recall",e.DOCUMENT_RATINGS="retrieval/ground_truth/document_ratings",e}({})},33669:function(e,t,n){n.d(t,{J:function(){return l}});var s=n(68248),o=n(76118),r=n(27757),i=n(93812),a=n(73408);function l({messages:e}){const{theme:t}=(0,r.u)();return(0,o.isNil)(e)?null:(0,a.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map((e,t)=>(0,a.Y)(i.X,{message:e},t))})}},41151:function(e,t,n){n.d(t,{M:function(){return a},e:function(){return i}});var s=n(46709),o=n(73408);const r=s.createContext({sqlWarehouseId:void 0,modelTraceInfo:void 0,invalidateTraceQuery:void 0,chatSessionId:void 0}),i=({sqlWarehouseId:e,modelTraceInfo:t,children:n,invalidateTraceQuery:i,chatSessionId:a})=>{const l=(0,s.useMemo)(()=>({sqlWarehouseId:e,modelTraceInfo:t,invalidateTraceQuery:i,chatSessionId:a}),[e,t,i,a]);return(0,o.Y)(r.Provider,{value:l,children:n})},a=()=>s.useContext(r)},42401:function(e,t,n){n.d(t,{s:function(){return b},B:function(){return w}});var s=n(68248),o=n(76118),r=n(46709),i=n(27757),a=n(42747),l=n(91461),d=n(73408);const c=({title:e,tools:t})=>{const{theme:n}=(0,i.u)();return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,d.Y)(i.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),bold:!0,children:e}),t.map(e=>(0,d.Y)(l.E,{tool:e},e.function.name))]})};var u=n(54625);const m=({title:e,documents:t})=>{const{theme:n}=(0,i.u)();return(0,d.FD)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundPrimary,borderRadius:n.borders.borderRadiusSm,border:`1px solid ${n.colors.border}`},""),children:[e&&(0,d.Y)("div",{css:(0,s.AH)({padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderBottom:`1px solid ${n.colors.border}`},""),children:(0,d.Y)(i.T.Text,{bold:!0,children:e})}),t.map((e,o)=>(0,d.Y)("div",{css:(0,s.AH)({borderBottom:o!==t.length-1?`1px solid ${n.colors.border}`:""},""),children:(0,d.Y)(u.p,{text:e.page_content,metadata:e.metadata},o)},o))]})};var p=n(82716),g=n(73879);const f=({title:e,value:t})=>{const{theme:n}=(0,i.u)(),[o,l]=(0,r.useState)(!1),c=t.length>400,u=!o&&t.length>400?t.slice(0,400)+"...":t,m=c?{":hover":{backgroundColor:n.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,d.FD)("div",{css:(0,s.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,d.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${n.spacing.sm}px ${n.spacing.sm+n.spacing.xs}px`,...m},""),onClick:()=>l(!o),children:[(0,d.Y)(i.T.Title,{level:4,color:"secondary",withoutMargins:!0,children:e}),c&&(o?(0,d.Y)(p.ChevronDownIcon,{}):(0,d.Y)(i.o,{}))]}),(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.sm+n.spacing.xs,paddingRight:n.spacing.sm+n.spacing.xs,paddingTop:e?0:n.spacing.sm,paddingBottom:n.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,d.Y)(g.V,{children:u}),c&&(0,d.Y)(i.T.Link,{onClick:()=>l(!o),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:o?(0,d.Y)(a.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,d.Y)(a.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})};var h=n(94664),v=n(86125),y=n(49425),x=n(33669);const b=3,w=({title:e,data:t,renderMode:n,chatMessageFormat:l,maxVisibleMessages:u=b})=>{const{theme:p}=(0,i.u)(),[g,w]=(0,r.useState)(!1),S=(0,r.useMemo)(()=>{try{return JSON.parse(t)}catch(e){return t}},[t]);(0,r.useEffect)(()=>{w(!1)},[t]);const Y=(0,o.isString)(S)||(0,o.isNumber)(S)||(0,o.isBoolean)(S),A=(0,v.Hq)(e?{[e]:S}:S,l),T=Array.isArray(S)&&S.length>0&&(0,o.every)(S,v.PC),I=Array.isArray(S)&&S.length>0&&(0,o.every)(S,v.W0);if(A&&A.length>0){const t=A.length>u,n=g||!t?A:A.slice(-u),o=t?A.length-n.length:0;return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.sm,padding:p.spacing.sm,border:`1px solid ${p.colors.border}`,borderRadius:p.borders.borderRadiusSm},""),children:[e&&(0,d.Y)(i.T.Title,{level:4,color:"secondary",withoutMargins:!0,css:(0,s.AH)({marginLeft:p.spacing.xs},""),children:e}),t&&(0,d.Y)(i.T.Link,{css:(0,s.AH)({alignSelf:"flex-start",marginLeft:p.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>w(!g),children:g?(0,d.Y)(a.sA,{id:"nugZSE",defaultMessage:"Show less"}):(0,d.Y)(a.sA,{id:"/akgwX",defaultMessage:"Show {hiddenMessageCount} more",values:{hiddenMessageCount:o}})}),(0,d.Y)(x.J,{messages:n})]})}return"json"===n?(0,d.Y)(y.C,{title:e,data:t,initialRenderMode:h.cC.JSON}):"text"===n?(0,d.Y)(y.C,{title:e,data:t,initialRenderMode:h.cC.TEXT}):Y?(0,d.Y)(f,{title:e,value:String(S)}):T?(0,d.Y)(c,{title:e,tools:S}):I?(0,d.Y)(m,{title:e,documents:S}):(0,d.Y)(y.C,{title:e,data:t})}},42822:function(e,t,n){n.d(t,{bV:function(){return l},jD:function(){return i},uD:function(){return a}});var s=n(76118),o=n(16844),r=n(19926);const i=e=>{const t={};return e.forEach(e=>{var n,s;const r=null===(n=e.trace_metadata)||void 0===n?void 0:n[o.n2];if(!r)return;const i=null!==(s=t[r])&&void 0!==s?s:[];t[r]=[...i,e]}),t},a=(e,t)=>{const n=i(t);return(0,s.compact)(Object.entries(n).map(([t,n])=>{if(0===n.length)return null;const i=(0,s.sortBy)(n,e=>new Date(e.request_time)),a=i[0],d=a.request_preview,c=i.reduce((e,t)=>{var n;return e+(null!==(n=(0,o.tI)(t))&&void 0!==n?n:0)},0);return{sessionId:t,requestPreview:d,firstTrace:a,experimentId:e,sessionStartTime:r.A.formatTimestamp(new Date(a.request_time)),sessionDuration:l(n),tokens:c,turns:i.length,traces:i}}))},l=e=>{const t=e.map(e=>e.execution_duration);if(t.some(e=>(0,s.isNil)(e)))return null;const n=t.map(e=>parseFloat(null!==e&&void 0!==e?e:"0"));if(n.some(e=>isNaN(e)))return null;const o=1e3*n.reduce((e,t)=>e+t,0);return r.A.formatDuration(o)}},45175:function(e,t,n){n.d(t,{V:function(){return i}});var s=n(68248),o=n(27757),r=n(73408);function i({children:e}){const{theme:t}=(0,o.u)();return(0,r.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e})}},45547:function(e,t,n){n.d(t,{w:function(){return b}});var s=n(68248),o=n(76118),r=n(46709),i=n(27757),a=n(82716),l=n(42747),d=n(94664),c=n(86125),u=n(21636),m=n(73408);const p=({searchFilter:e,data:t,activeMatch:n,containsActiveMatch:o})=>{const{theme:a}=(0,i.u)(),l=(0,r.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),d=(0,r.useMemo)(()=>e?(0,c.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:a.colors[u.kj],inactiveMatchBackgroundColor:a.colors[u.Bt],containsActiveMatch:o,activeMatch:n,scrollToActiveMatch:l}):[],[e,t,a,o,n,l]);return(0,m.Y)("pre",{css:(0,s.AH)({whiteSpace:"pre-wrap",backgroundColor:a.colors.backgroundSecondary,padding:a.spacing.sm,fontSize:a.typography.fontSizeSm},""),children:d})};var g=n(73879),f=n(19112);const h=4,v=300;var y={name:"bjn8wh",styles:"position:relative"},x={name:"n31mhe",styles:"width:100%;padding:0"};function b({data:e,searchFilter:t="",activeMatch:n=null,containsActiveMatch:c=!1,renderMode:u=d.cC.JSON,initialExpanded:b=!1}){const w=Boolean(t)&&!(0,o.isNil)(n)&&e.toLowerCase().includes(t),{theme:S}=(0,i.u)(),[Y,A]=(0,r.useState)("json"===u),[T,I]=(0,r.useState)(b||w),C=(0,r.useRef)(null),M=(0,r.useMemo)(()=>{if("json"===u)return e;const t=JSON.parse(e);return(0,o.isString)(t)?t:e},[e,u]),E=Y||M.split("\n").length>h||M.length>v,_=(0,r.useMemo)(()=>{if(E&&!T){const e=M.split("\n").slice(0,h).join("\n");return e.length>v?e.slice(0,v):e}return M},[M,E,T]);(0,r.useEffect)(()=>{C.current&&A(C.current.scrollWidth>C.current.clientWidth)},[u,e]);const N=(0,r.useCallback)(e=>(0,m.Y)("pre",{...e,ref:C}),[]);return w?(0,m.Y)(p,{data:e,searchFilter:t,activeMatch:n,containsActiveMatch:!n.isKeyMatch&&c}):(0,m.FD)("div",{css:y,children:["markdown"===u?(0,m.Y)("div",{css:(0,s.AH)({padding:S.spacing.md,backgroundColor:S.colors.backgroundSecondary,marginBottom:-S.spacing.md},""),children:(0,m.Y)(g.V,{children:_})}):(0,m.FD)(m.FK,{children:[(0,m.Y)(f.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,s.AH)({position:"absolute",top:S.spacing.xs,right:S.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,m.Y)(f.z7,{PreTag:N,showLineNumbers:!0,language:u,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:T,theme:S.isDarkMode?"duotoneDark":"light",style:{backgroundColor:S.colors.backgroundSecondary,padding:S.spacing.sm,paddingBottom:E?0:S.spacing.sm,paddingRight:2*S.spacing.md,overflow:T?"auto":"hidden",textOverflow:"ellipsis",fontSize:S.typography.fontSizeSm,lineHeight:S.typography.lineHeightBase},children:_})]}),E&&(0,m.Y)("div",{css:(0,s.AH)({backgroundColor:S.colors.backgroundSecondary},""),children:(0,m.Y)(i.B,{css:x,componentId:T?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:T?(0,m.Y)(a.ChevronUpIcon,{}):(0,m.Y)(a.ChevronDownIcon,{}),type:"tertiary",onClick:()=>I(!T),children:T?(0,m.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,m.Y)(l.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}},47784:function(e,t,n){n.d(t,{l:function(){return d}});var s=n(68248),o=n(46709),r=n(27757),i=n(21209),a=n(42401),l=n(73408);const d=({title:e,data:t,renderMode:n,sectionKey:d,maxVisibleItems:c=3,maxVisibleChatMessages:u=a.s,className:m,chatMessageFormat:p})=>{const{theme:g}=(0,r.u)(),[f,h]=(0,o.useState)(!1),v=t.length>c,y=v&&!f?t.slice(-c):t,x=v?t.length-y.length:0;return(0,l.Y)(i.p,{withBorder:!0,title:e,className:m,sectionKey:d,children:(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:g.spacing.sm},""),children:[v&&(0,l.Y)(r.T.Link,{css:(0,s.AH)({alignSelf:"flex-start",marginLeft:g.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>h(!f),children:f?"Show less":`Show ${x} more`}),y.map(({key:e,value:t},s)=>(0,l.Y)(a.B,{title:e,data:t,renderMode:n,chatMessageFormat:p,maxVisibleMessages:u},e||s))]})})}},49425:function(e,t,n){n.d(t,{C:function(){return x}});var s=n(68248),o=n(76118),r=n(46709),i=n(27757),a=n(82716),l=n(94664),d=n(45547),c=n(21636),u=n(73408);const m=({title:e,searchFilter:t,isActiveMatch:n})=>{const{theme:o}=(0,i.u)(),a=(0,r.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),l=e.toLowerCase();if(!l.includes(t))return(0,u.Y)("div",{children:e});const d=l.indexOf(t),m=d+t.length,p=n?o.colors[c.kj]:o.colors[c.Bt];return(0,u.FD)("div",{children:[e.slice(0,d),(0,u.Y)("span",{ref:n?a:null,css:(0,s.AH)({backgroundColor:p,scrollMarginTop:50},""),children:e.slice(d,m)}),e.slice(m)]})};function p(e,t){return t||(e?l.cC.MARKDOWN:l.cC.JSON)}function g(e){switch(e){case l.cC.JSON:return"JSON";case l.cC.TEXT:return"Text";case l.cC.MARKDOWN:return"Markdown";case l.cC.PYTHON:return"Python"}}var f={name:"bjn8wh",styles:"position:relative"},h={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},v={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},y={name:"2fp7nl",styles:"height:min-content;margin:0"};function x({title:e,tokens:t,data:n,searchFilter:c="",activeMatch:x=null,containsActiveMatch:b=!1,initialRenderMode:w}){var S;const Y=(0,r.useMemo)(()=>JSON.parse(n),[n]),A=(0,o.isString)(Y),{theme:T}=(0,i.u)(),[I,C]=(0,r.useState)(p(A,w)),M=b&&null!==(S=null===x||void 0===x?void 0:x.isKeyMatch)&&void 0!==S&&S,E=A&&!c;return(0,r.useEffect)(()=>{C(p(A,w))},[A,w]),(0,u.Y)("div",{css:f,children:(0,u.FD)("div",{css:(0,s.AH)({borderRadius:T.borders.borderRadiusSm,border:`1px solid ${T.colors.border}`,overflow:"hidden"},""),children:[(e||E)&&(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:T.spacing.sm},""),children:[(0,u.Y)(i.T.Title,{css:h,level:4,color:"secondary",withoutMargins:!0,children:(0,u.Y)(m,{title:e,searchFilter:c,isActiveMatch:M})}),(0,u.Y)("div",{css:v,children:E&&(0,u.FD)(a.DropdownMenu.Root,{children:[(0,u.Y)(a.DropdownMenu.Trigger,{asChild:!0,children:(0,u.Y)(a.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:y,children:(0,u.FD)("div",{css:(0,s.AH)({paddingLeft:T.spacing.xs,marginRight:T.spacing.xs,cursor:"pointer"},""),children:[(0,u.Y)(i.T.Text,{size:"sm",color:"secondary",children:g(I)}),(0,u.Y)(a.ChevronDownIcon,{})]})})}),(0,u.FD)(a.DropdownMenu.Content,{children:[(0,u.Y)(a.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:I,onValueChange:e=>C(e),children:Object.values(l.cC).map(e=>e===l.cC.PYTHON?null:(0,u.FD)(a.DropdownMenu.RadioItem,{value:e,children:[(0,u.Y)(a.DropdownMenu.ItemIndicator,{}),g(e)]},e))}),(0,u.Y)(a.DropdownMenu.Arrow,{})]})]})})]}),(0,u.Y)(d.w,{data:n,searchFilter:c,activeMatch:x,containsActiveMatch:b,renderMode:I})]})})}},49633:function(e,t,n){n.d(t,{Mj:function(){return a.Mj},Ub:function(){return r},wY:function(){return i.w}});var s=n(46709),o=n(69103);function r(e){return function(e){return(0,o.useSyncExternalStore)(s.useCallback(t=>(e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}),[e]),()=>e.matches)}(s.useMemo(()=>window.matchMedia(e),[e]))}var i=n(27925),a=n(53637)},54625:function(e,t,n){n.d(t,{p:function(){return x}});var s=n(46709),o=n(68248),r=n(27757),i=n(82716),a=n(42747),l=n(73879),d=n(73880),c=n(73408);var u={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function m({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:m}=(0,r.u)();return(0,c.FD)("div",{css:u,children:[(0,c.Y)("div",{role:"button",onClick:()=>{n(!1),null===s||void 0===s||s("collapse")},css:(0,o.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${m.spacing.sm}px ${m.spacing.md}px`,height:m.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:m.colors.backgroundSecondary}},""),children:(0,c.Y)(i.FileDocumentIcon,{})}),(0,c.Y)("div",{css:(0,o.AH)({padding:m.spacing.md,paddingBottom:0},""),children:(0,c.Y)(l.V,{children:e})}),(0,c.Y)("div",{css:(0,o.AH)({padding:m.spacing.md,paddingTop:0},""),children:t.map(({key:e,value:t})=>(0,c.Y)(d.t,{itemKey:e,itemValue:t},e))}),(0,c.Y)(r.B,{css:(0,o.AH)({width:"100%",padding:m.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,c.Y)(i.ChevronUpIcon,{}),type:"tertiary",onClick:()=>n(!1),children:(0,c.Y)(a.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var p=n(79081);var g={name:"ti75j2",styles:"margin:0"},f={name:"1r5gb7q",styles:"display:inline-block"},h={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function v({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:a}=(0,r.u)();return(0,c.FD)("div",{role:"button",onClick:()=>{n(!0),null===s||void 0===s||s("expand")},css:(0,o.AH)({display:"flex",flexDirection:"row",padding:`${a.spacing.sm}px ${a.spacing.md}px`,gap:a.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:a.colors.backgroundSecondary}},""),children:[(0,c.FD)("div",{css:(0,o.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,c.Y)(i.FileDocumentIcon,{}),(0,c.Y)(r.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,c.FD)("div",{css:(0,o.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm},""),children:[t.length>0?(0,c.Y)(d.t,{css:g,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,c.Y)(p.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map(({key:e,value:t})=>(0,c.Y)("span",{css:f,children:`${e}: ${t}`},e)),children:(0,c.FD)(i.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:h,children:["+",t.length-1]})}):null]})]})}var y=n(86125);function x({text:e,metadata:t}){const[n,o]=(0,s.useState)(!1),r=(0,y.g_)(t);return n?(0,c.Y)(m,{text:e,metadataTags:r,setExpanded:o}):(0,c.Y)(v,{text:e,metadataTags:r,setExpanded:o})}},57248:function(e,t,n){n.d(t,{I:function(){return l},a:function(){return d}});var s=n(46709),o=n(76118),r=n(33145);var i=n(73408);const a=(0,s.createContext)({schemas:[]}),l=({children:e,assessments:t})=>{const n=(0,s.useMemo)(()=>(e=>{const t={},n={};for(const s of e){if(t[s.assessment_name])continue;const e=(0,r.ed)(s);if((0,o.isNil)(e)){n[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:"boolean"};continue}const i="expectation"in s&&"serialized_value"in s.expectation;let a;switch(typeof e){case"string":a=i?"json":"string";break;case"boolean":default:a="boolean";break;case"number":a="number"}t[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:a}}for(const[s,o]of Object.entries(n))s in t||(t[s]=o);return Object.values(t)})(t),[t]),l=(0,s.useMemo)(()=>({schemas:n}),[n]);return(0,i.Y)(a.Provider,{value:l,children:e})},d=()=>(0,s.useContext)(a)},64667:function(e,t,n){n.d(t,{$6:function(){return i},RF:function(){return l},_S:function(){return o},dD:function(){return r},tl:function(){return s},w8:function(){return a}});let s=function(e){return e.EQUALS="=",e.NOT_EQUALS="!=",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_THAN_OR_EQUALS=">=",e.LESS_THAN_OR_EQUALS="<=",e.CONTAINS="CONTAINS",e.RLIKE="RLIKE",e.IS_NULL="IS NULL",e.IS_NOT_NULL="IS NOT NULL",e}({});const o=e=>e===s.IS_NULL||e===s.IS_NOT_NULL;let r=function(e){return e.IS_NOT_NULL="IS NOT NULL",e}({}),i=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TRACE_INFO="TRACE_INFO",e.INPUT="INPUT",e.INTERNAL_MONITOR_REQUEST_TIME="INTERNAL_MONITOR_REQUEST_TIME",e}({}),a=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TAG="TAG",e.INFO="INFO",e}({});const l={[a.ASSESSMENT]:"Assessments",[a.EXPECTATION]:"Expectations",[a.TAG]:"Tags",[a.INFO]:"\xa0"}},68058:function(e,t,n){n.d(t,{x:function(){return l}});var s=n(82716),o=n(27757),r=n(42747),i=n(77691),a=n(73408);const l=()=>{const{addToDatasetAction:e}=(0,i.SO)();return e?(0,a.Y)(o.B,{componentId:"mlflow.evaluations_review.modal.add_to_evaluation_dataset",onClick:e.openModal,icon:(0,a.Y)(s.PlusIcon,{}),size:"small",children:(0,a.Y)(r.sA,{id:"NekUba",defaultMessage:"Add to dataset"})}):null}},68364:function(e,t,n){n.d(t,{W:function(){return g},Y:function(){return S}});var s=n(68248),o=n(76118),r=n(46709),i=n(82716),a=n(27757),l=n(79081),d=n(42747),c=n(5075),u=n(96586),m=n(33145),p=n(73408);const g=300;var f={name:"11qaxcx",styles:"display:inline-flex;max-width:100%"},h={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const v=({metadata:e})=>{const{theme:t}=(0,a.u)(),n=(0,d.tz)(),o=null===e||void 0===e?void 0:e.span_name;if(!e||!o)return null;const r=n.formatMessage({id:"S3YY1P",defaultMessage:"Span: {spanName}"},{spanName:o});return(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexWrap:"wrap",gap:t.spacing.xs},""),children:(0,p.Y)(l.T,{componentId:"shared.model-trace-explorer.span-name-tooltip",content:r,children:(0,p.Y)(i.Tag,{css:f,componentId:"shared.model-trace-explorer.span-name-tag",color:"default",children:(0,p.Y)("span",{css:h,children:r})})})})};var y={name:"ozd7xs",styles:"flex-shrink:0"},x={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},b={name:"s5xdrg",styles:"display:flex;align-items:center"};const w=({assessment:e})=>{const{theme:t}=(0,a.u)(),n=(0,m.ed)(e),r=e.rationale,l=!(0,o.isNil)(e.feedback.error),d=!l&&(0,o.isNil)(n);return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.md,gap:t.spacing.sm},""),children:[(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:t.spacing.sm},""),children:(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,flex:1,minWidth:0},""),children:[(0,p.Y)(i.GavelIcon,{css:y}),(0,p.Y)(a.T.Text,{bold:!0,css:x,children:e.assessment_name})]})}),l&&(0,p.Y)(u.B,{error:e.feedback.error}),d&&(0,p.Y)(u.B,{error:{error_code:"NO_RESULT",error_message:"The scorer did not return a result for this trace."}}),!l&&!d&&(0,p.Y)("div",{css:b,children:(0,p.Y)(c.Q,{jsonValue:JSON.stringify(n),assessmentName:e.assessment_name})}),(0,p.Y)(v,{metadata:e.metadata}),r&&(0,p.Y)(a.T.Text,{css:(0,s.AH)({color:t.colors.textSecondary,lineHeight:t.typography.lineHeightBase},""),children:r})]})},S=({assessments:e,className:t})=>{const{theme:n}=(0,a.u)(),o=(0,r.useMemo)(()=>e.filter(e=>"feedback"in e&&!1!==e.valid),[e]);return 0===o.length?(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",padding:n.spacing.md,minWidth:g,height:"100%",borderLeft:`1px solid ${n.colors.border}`},""),className:t,children:(0,p.Y)(a.T.Text,{color:"secondary",children:(0,p.Y)(d.sA,{id:"PKwacx",defaultMessage:"No assessments available"})})}):(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",padding:n.spacing.md,paddingTop:n.spacing.sm,gap:n.spacing.md,minWidth:g,height:"100%",borderLeft:`1px solid ${n.colors.border}`,overflowY:"auto"},""),className:t,children:o.map(e=>(0,p.Y)(w,{assessment:e},e.assessment_id))})}},71540:function(e,t,n){n.d(t,{$T:function(){return E},Cf:function(){return g},Co:function(){return N},Mq:function(){return I},On:function(){return f},PO:function(){return v},ZS:function(){return Y},ZZ:function(){return C},c7:function(){return b},d9:function(){return w},h:function(){return T},h2:function(){return h},ih:function(){return _},kQ:function(){return c},kZ:function(){return x},kf:function(){return m},mF:function(){return F},nr:function(){return R},nt:function(){return u},p6:function(){return S},v8:function(){return y},zl:function(){return D}});var s=n(76118),o=n(16844),r=n(12129),i=n(21636),a=n(90448),l=n(33481),d=n(4947);const c="mlflow.sourceRun",u="mlflow.",m="monitor",p="mlflow.trace.spansLocation",g="TRACKING_STORE",f=e=>(null===e||void 0===e?void 0:e.evaluationId)||"",h=e=>(null===e||void 0===e?void 0:e.trace_id)||"",v=e=>e.split(":").pop(),y=e=>e.split(":").pop(),x=e=>`${d.Pn}:${e}`,b=e=>`${d.rc}:${e}`,w=e=>(0,s.uniq)(e.map(e=>Object.keys(e.tags||{}).filter(e=>e&&!e.startsWith(u))).flat()),S=(e,t)=>e&&t?e.reduce((e,n)=>{var s;const o=n.assessments||[],r=o.filter(e=>{var n;const s=null===(n=e.metadata)||void 0===n?void 0:n[i.Vg];return!s||s===t});return(null===(s=n.tags)||void 0===s?void 0:s[i.Ex])?e:r.length===o.length?(e.push(n),e):(e.push({...n,assessments:r}),e)},[]):e,Y=e=>e.length>0&&Boolean(e[0].traceInfo),A=e=>{try{return JSON.parse(e)}catch{return e}},T=e=>{var t;return e.request_preview||e.request||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceInputs"])||""},I=e=>{var t;return e.response_preview||e.response||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceOutputs"])||""};function C(e){var t;return(null===e||void 0===e||null===(t=e.tags)||void 0===t?void 0:t[p])||void 0}const M=["agent/latency_seconds"];const E=e=>{var t,n,s,o,r;const i=null===(t=e.feedback)||void 0===t?void 0:t.value,a=e.assessment_name===l._1.OVERALL_ASSESSMENT,d=(e=>{var t,n,s;if(null===(t=e.source)||void 0===t||!t.source_type)return;const o=null===(n=e.source)||void 0===n?void 0:n.source_type;let r;return r="LLM_JUDGE"===o?"AI_JUDGE":o,{sourceType:r,sourceId:(null===(s=e.source)||void 0===s?void 0:s.source_id)||"",metadata:{}}})(e),c=(null===(n=e.feedback)||void 0===n?void 0:n.error)||e.error;return{name:e.assessment_name,stringValue:"string"===typeof i?i:void 0,booleanValue:"boolean"===typeof i?i:void 0,numericValue:"number"===typeof i?i:void 0,errorCode:null===c||void 0===c?void 0:c.error_code,errorMessage:null===c||void 0===c?void 0:c.error_message,rationale:(null===(s=e.metadata)||void 0===s?void 0:s.root_cause_rationale)||e.rationale,source:d,rootCauseAssessment:a?{assessmentName:(null===(o=e.metadata)||void 0===o?void 0:o.root_cause_assessment)||"",suggestedActions:null===(r=e.metadata)||void 0===r?void 0:r.suggested_action}:void 0,metadata:e.metadata}},_=e=>{var t;const n=h(e),r=[],i={},d={};null===(t=e.assessments)||void 0===t||t.forEach(e=>{const t=e.assessment_name;M.includes(t)||!1!==e.valid&&((e=>Boolean("expectation"in e&&e.expectation))(e)?function(e,t){const n=e.assessment_name,s=(0,o.ed)(e);Array.isArray(s)?t[n]=s.map(e=>"string"===typeof e?A(e):e):t[n]="string"===typeof s?A(s):s}(e,d):function(e,t,n){const s=e.assessment_name,o=E(e);s===l._1.OVERALL_ASSESSMENT&&t.push(o),n[s]||(n[s]=[]),n[s].push(o)}(e,r,i))});const c=T(e),u=I(e);let m=c,p={},g={};try{var f;p=JSON.parse(c);const e=p.messages;if(Array.isArray(e)&&!(0,s.isNil)(null===(f=e[0])||void 0===f?void 0:f.content)){var v;m=null===(v=e[e.length-1])||void 0===v?void 0:v.content}else{const e=(0,a.c1)(p);m=null!==e&&void 0!==e?e:(0,a.ng)(p)}}catch{p={request:c}}try{g={response:JSON.parse(u)}}catch{g={response:u}}return{evaluationId:n,requestId:e.client_request_id||n,inputsId:n,inputsTitle:m,inputs:p,outputs:g,targets:d,overallAssessments:r,responseAssessmentsByName:i,metrics:{},traceInfo:e,fullTraceId:(0,o.vX)(e)}},N=e=>Y(e)?e.map(e=>{if(!e.traceInfo)return e;const t=_(e.traceInfo);return{...e,...t}}):e;function R(e,t){var n;if((0,s.isNil)(t))return;let r="doc_uri";const i=t.info.tags;if(null!==i&&void 0!==i&&i.retrievers){const e=A(i.retrievers);"object"===typeof e&&e.length>0&&(r=e[0].doc_uri)}const a=t.data.spans.filter(e=>D(e.attributes,"mlflow.spanType")&&A(D(e.attributes,"mlflow.spanType"))===o.VZ.RETRIEVER);if(0===a.length)return[];const l=D(null===(n=a.at(-1))||void 0===n?void 0:n.attributes,"mlflow.spanOutputs");if(!l)return[];const d=A(l);if(!Array.isArray(d))return[];return d.map((t,n)=>{var s;return{docUrl:null===(s=t.metadata)||void 0===s?void 0:s[r],content:t.page_content,retrievalAssessmentsByName:k(e,n)}})}const k=(e,t)=>Object.fromEntries(Object.entries(e).map(([e,n])=>[e,n.filter(e=>{var n;return Number(null===e||void 0===e||null===(n=e.metadata)||void 0===n?void 0:n.span_output_key)===t})]).filter(([e,t])=>t.length>0)),D=(e,t)=>{var n,s;if(!e)return;if(!Array.isArray(e))return e[t];const o=e.find(e=>e.key===t);return null!==o&&void 0!==o&&o.value?null!==(n=null!==(s=o.value.string_value)&&void 0!==s?s:o.value.int_value)&&void 0!==n?n:o.value.bool_value:void 0},F=(e,t)=>{const n=(null===e||void 0===e?void 0:e.trace_id)||t;return e&&(0,r.ko)(e)?(0,o.vX)(e):n||""}},72125:function(e,t,n){n.d(t,{aW:function(){return U},gr:function(){return V}});var s=n(68248),o=n(76118),r=n(46709),i=n(27757),a=n(82716),l=n(42747),d=n(49425),c=n(73408);function u({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:r}=(0,i.u)(),{attributes:u}=e,m=(0,o.keys)(u).length>0,p=!(0,o.isNil)(n)&&n.span.key===e.key;return!m||(0,o.isNil)(u)?(0,c.Y)("div",{css:(0,s.AH)({marginTop:r.spacing.md},""),children:(0,c.Y)(a.Empty,{description:(0,c.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,padding:r.spacing.md},""),children:Object.entries(u).map(([e,s])=>(0,c.Y)(d.C,{title:e,data:JSON.stringify(s,null,2),searchFilter:t,activeMatch:n,containsActiveMatch:p&&"attributes"===n.section&&n.key===e},e))})}var m=n(91461),p=n(33669),g=n(21209);function f({chatMessages:e,chatTools:t}){const{theme:n}=(0,i.u)();return(0,c.FD)("div",{css:(0,s.AH)({overflowY:"auto",padding:n.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,c.Y)(g.p,{css:(0,s.AH)({marginBottom:n.spacing.sm},""),title:(0,c.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:t.map(e=>(0,c.Y)(m.E,{tool:e},e.function.name))})}),(0,c.Y)(g.p,{title:(0,c.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,c.Y)(p.J,{messages:e})})]})}var h=n(86125);var v={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},y={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function x({activeSpan:e,className:t,searchFilter:n,activeMatch:a}){const{theme:u}=(0,i.u)(),m=(0,r.useMemo)(()=>(0,h.g_)(null===e||void 0===e?void 0:e.inputs),[e]),p=(0,r.useMemo)(()=>(0,h.g_)(null===e||void 0===e?void 0:e.outputs),[e]);if((0,o.isNil)(e))return null;const f=m.length>0,x=p.length>0,b=!(0,o.isNil)(a)&&a.span.key===e.key;return(0,c.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[f&&(0,c.Y)(g.p,{withBorder:!0,css:(0,s.AH)({marginBottom:u.spacing.sm},""),sectionKey:"input",title:(0,c.Y)("div",{css:v,children:(0,c.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:m.map(({key:e,value:t},s)=>(0,c.Y)(d.C,{title:e,data:t,searchFilter:n,activeMatch:a,containsActiveMatch:b&&"inputs"===a.section&&a.key===e},e||s))})}),x&&(0,c.Y)(g.p,{withBorder:!0,sectionKey:"output",title:(0,c.Y)("div",{css:y,children:(0,c.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:p.map(({key:e,value:t})=>(0,c.Y)(d.C,{title:e,data:t,searchFilter:n,activeMatch:a,containsActiveMatch:b&&"outputs"===a.section&&a.key===e},e))})})]})}var b=n(54625),w=n(79081);var S={name:"s5xdrg",styles:"display:flex;align-items:center"},Y={name:"s5xdrg",styles:"display:flex;align-items:center"};function A({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:n}=(0,i.u)();return(0,c.FD)(a.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_modeltraceexplorerrendermodetoggle_25",value:e,onChange:e=>{t(e.target.value)},children:[(0,c.Y)(a.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,c.Y)(w.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,c.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,c.Y)("div",{css:S,children:(0,c.Y)(a.TextBoxIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})}),(0,c.Y)(a.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,c.Y)(w.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,c.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,c.Y)("div",{css:Y,children:(0,c.Y)(a.MarkdownIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})})]})}var T={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function I({activeSpan:e,className:t,searchFilter:n,activeMatch:u}){const{theme:m}=(0,i.u)(),[p,f]=(0,r.useState)(!0),v=(0,r.useMemo)(()=>(0,h.g_)(e.inputs),[e]),y=e.outputs,x=v.length>0,w=!(0,o.isNil)(u)&&u.span.key===e.key,S=w&&"outputs"===u.section;return(0,c.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[x&&(0,c.Y)(g.p,{sectionKey:"input",css:(0,s.AH)({marginBottom:m.spacing.sm},""),title:(0,c.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.sm},""),children:v.map(({key:e,value:t},s)=>(0,c.Y)(d.C,{title:e,data:t,searchFilter:n,activeMatch:u,containsActiveMatch:w&&"inputs"===u.section&&u.key===e},e||s))})}),(0,c.Y)(g.p,{sectionKey:"output",title:(0,c.FD)("div",{css:T,children:[(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:m.spacing.sm},""),children:[(0,c.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,c.Y)(a.Tag,{componentId:"shared.model-trace-explorer.document-count",children:y.length})]}),!S&&(0,c.Y)(A,{shouldRenderMarkdown:p,setShouldRenderMarkdown:f})]}),children:p&&!S?(0,c.Y)("div",{css:(0,s.AH)({border:`1px solid ${m.colors.border}`,borderRadius:m.legacyBorders.borderRadiusMd},""),children:y.map((e,t)=>(0,c.Y)("div",{css:(0,s.AH)({borderBottom:t!==y.length-1?`1px solid ${m.colors.border}`:""},""),children:(0,c.Y)(b.p,{text:e.page_content,metadata:e.metadata},t)},t))}):(0,c.Y)("div",{css:(0,s.AH)({border:`1px solid ${m.colors.border}`,borderRadius:m.legacyBorders.borderRadiusMd,padding:m.spacing.md},""),children:(0,c.Y)(d.C,{title:"",data:JSON.stringify(y,null,2),searchFilter:n,activeMatch:u,containsActiveMatch:w&&"outputs"===u.section})})})]})}function C({activeSpan:e,className:t,searchFilter:n,activeMatch:r}){const{theme:a}=(0,i.u)();return!(0,o.isNil)(e)&&(0,h.vl)(e)?(0,c.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:a.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(I,{activeSpan:e,className:t,searchFilter:n,activeMatch:r})}):(0,c.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:a.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(x,{activeSpan:e,className:t,searchFilter:n,activeMatch:r})})}var M=n(94664);function E({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:r}=(0,i.u)(),{events:u}=e,m=!(0,o.isNil)(n)&&n.span.key===e.key;return Array.isArray(u)&&0!==u.length?(0,c.Y)("div",{css:(0,s.AH)({padding:r.spacing.md},""),children:u.map((e,o)=>{const l=e.attributes,u="exception"===e.name?(0,c.FD)(c.FK,{children:[(0,c.Y)(a.XCircleIcon,{css:(0,s.AH)({marginRight:r.spacing.sm},""),color:"danger"}),(0,c.Y)(i.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,c.Y)(g.p,{sectionKey:e.name,title:u,withBorder:!0,children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:Object.keys(l).map(s=>{const r=(0,h.Q0)(e.name,o,s);return(0,c.Y)(d.C,{title:s,data:JSON.stringify(l[s],null,2),searchFilter:t,activeMatch:n,containsActiveMatch:m&&"events"===n.section&&n.key===r,initialRenderMode:M.cC.TEXT},r)})})},`${e.name}-${o}`):null})}):(0,c.Y)("div",{css:(0,s.AH)({marginTop:r.spacing.md},""),children:(0,c.Y)(a.Empty,{description:(0,c.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}var _=n(68364),N=n(85418),R=n(76127),k=n(26059),D=n(53915),F=n(68058),O=n(85060),L=n(24411),H=n(84612);const V=250+H.uZ;var $={name:"1y44vlr",styles:"height:auto;border-left:0"};function B({activeSpan:e,searchFilter:t,activeMatch:n,activeTab:d,setActiveTab:m,onPaneResize:p}){const{theme:g}=(0,i.u)(),{assessmentsPaneExpanded:v,assessmentsPaneEnabled:y,isInComparisonView:x,updatePaneSizeRatios:b,getPaneSizeRatios:w,readOnly:S}=(0,D.nJ)(),[Y,A]=(0,r.useState)(500),T={flex:1,marginTop:-g.spacing.md,overflowY:"auto"},I=(0,r.useMemo)(()=>(0,h.bN)(null===e||void 0===e?void 0:e.assessments),[null===e||void 0===e?void 0:e.assessments]),M=(0,r.useCallback)(e=>{b({detailsSidebar:e})},[b]);if((0,o.isNil)(e))return(0,c.Y)(a.Empty,{description:"Please select a span to view more information"});const V=(0,h.N7)(e),B=V>0,U=!(0,o.isNil)(null===e||void 0===e?void 0:e.inputs)||!(0,o.isNil)(null===e||void 0===e?void 0:e.outputs),z=(0,c.FD)(a.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${g.colors.border}`,minWidth:200,position:"relative"},""),value:d,onValueChange:e=>m(e),children:[(0,c.Y)(N.Q,{activeSpan:e}),!S&&(0,c.FD)("div",{css:(0,s.AH)({position:"absolute",right:v?g.spacing.xs:g.spacing.md,top:g.spacing.xs,zIndex:1,backgroundColor:g.colors.backgroundPrimary,display:"flex",gap:g.spacing.sm,alignItems:"center"},""),children:[(0,c.Y)(F.x,{}),(0,c.Y)(O.N,{})]}),(0,c.FD)(a.Tabs.List,{css:(0,s.AH)({padding:0,paddingLeft:g.spacing.md,paddingRight:g.spacing.sm,boxSizing:"border-box",width:"100%"},""),dangerouslyAppendEmotionCSS:{"&>div":{flex:1}},children:[e.chatMessages&&(0,c.Y)(a.Tabs.Trigger,{value:"chat",children:(0,c.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),U&&(0,c.Y)(a.Tabs.Trigger,{value:"content",children:(0,c.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,c.Y)(a.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,c.FD)(a.Tabs.Trigger,{value:"events",children:["Events ",B&&(0,c.Y)(R.X,{count:V})]}),S&&(0,c.Y)(a.Tabs.Trigger,{value:"assessments",children:(0,c.Y)(l.sA,{id:"KdsrPi",defaultMessage:"Assessments"})})]}),e.chatMessages&&(0,c.Y)(a.Tabs.Content,{css:T,value:"chat",children:(0,c.Y)(f,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,c.Y)(a.Tabs.Content,{css:T,value:"content",children:(0,c.Y)(C,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,c.Y)(a.Tabs.Content,{css:T,value:"attributes",children:(0,c.Y)(u,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,c.Y)(a.Tabs.Content,{css:T,value:"events",children:(0,c.Y)(E,{activeSpan:e,searchFilter:t,activeMatch:n})}),S&&(0,c.Y)(a.Tabs.Content,{css:T,value:"assessments",children:(0,c.Y)(_.Y,{assessments:(0,h.bN)(e.assessments),css:$})})]}),j=(0,c.Y)(L.i,{assessments:I,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0,enableRunScorer:!e.parentId});return!x&&y&&v?(0,c.Y)(k.A,{initialRatio:w().detailsSidebar,paneWidth:Y,setPaneWidth:A,leftChild:z,leftMinWidth:250,rightChild:j,rightMinWidth:H.uZ+2*g.spacing.sm,onRatioChange:M}):z}const U=r.memo(B)},76256:function(e,t,n){n.d(t,{L:function(){return o},S:function(){return r}});var s=n(43617);function o(e,t){return(0,s.N4)(t)}const r=s.N4},77691:function(e,t,n){n.d(t,{SO:function(){return d},Xi:function(){return l},gm:function(){return a}});var s=n(46709),o=n(82716),r=n(73408);const i=(0,s.createContext)({renderExportTracesToDatasetsModal:()=>null,DrawerComponent:o.Drawer,addToDatasetAction:void 0}),a=({children:e,renderExportTracesToDatasetsModal:t,DrawerComponent:n=o.Drawer})=>{const a=(0,s.useMemo)(()=>({renderExportTracesToDatasetsModal:t,DrawerComponent:n}),[t,n]);return(0,r.Y)(i.Provider,{value:a,children:e})},l=({openModal:e,children:t})=>{const n=(0,s.useContext)(i),o=(0,s.useMemo)(()=>({...n,addToDatasetAction:{openModal:e}}),[n,e]);return(0,r.Y)(i.Provider,{value:o,children:t})},d=()=>(0,s.useContext)(i)},81390:function(e,t,n){n.d(t,{B$:function(){return g},De:function(){return l},EA:function(){return v},NP:function(){return y},QJ:function(){return d},VC:function(){return m},VD:function(){return h},X6:function(){return f},dM:function(){return p},fJ:function(){return x},os:function(){return u},u4:function(){return c},vf:function(){return a}});var s=n(76118),o=n(46709),r=n(94664),i=n(86125);const a=1/0,l=16,d=32,c={HIGH:5,NORMAL:3,LOW:1},u=(e,t)=>{const n=[],s=e=>{var o;e&&(n.push(e),t.has(e.key)&&(null===(o=e.children)||void 0===o||o.forEach(s)))};return e.forEach(s),n},m=e=>{const t=[],n=e=>{var s;e&&(t.push(e),null===(s=e.children)||void 0===s||s.forEach(n))};return e.forEach(n),t},p=(e,t=1/0)=>{const n={},s=(e,o)=>{var r;!e||o>t||(n[e.key]=e,null===(r=e.children)||void 0===r||r.forEach(e=>s(e,o+1)))};return e.forEach(s,0),n},g=(e={})=>{const[t,n]=(0,o.useState)(()=>{if(e.rootNodes){const t=(0,s.values)(p(e.rootNodes,e.initialExpandDepth)).map(e=>e.key);return new Set(t)}return new Set});return{expandedKeys:t,setExpandedKeys:n}},f=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},h=(e,t)=>{var n;return e.key===t?0:(null!==(n=e.children)&&void 0!==n?n:[]).findIndex(e=>h(e,t)>-1)},v=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const n=e.children.map(v);return Math.max(...n)+1},y=(e,t)=>{const n=new Set;let s=e;for(;s&&s.parentId;)n.add(s.parentId),s=t[s.parentId];return n},x=e=>{var t;return!!e.parentId&&([r.UG.AGENT,r.UG.RETRIEVER,r.UG.CHAT_MODEL,r.UG.TOOL,r.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:r.UG.UNKNOWN)||(0,i.N7)(e)>0)}},83219:function(e,t,n){n.d(t,{c:function(){return g}});var s=n(68248),o=n(82716),r=n(27757),i=n(86125),a=n(21209),l=n(42401),d=n(73408);const c=new Set(["exception.type","exception.message","exception.stacktrace"]),u=e=>{var t;const n=null!==(t=null===e||void 0===e?void 0:e.attributes)&&void 0!==t?t:{},s=n["exception.stacktrace"],o=Object.entries(n).filter(([e])=>!c.has(e)).map(([e,t])=>({key:e,value:t}));return s?[{key:"exception.stacktrace",value:s,renderMode:"text"},...o]:o};var m={name:"ozd7xs",styles:"flex-shrink:0"},p={name:"17a6bm5",styles:"min-width:0;flex:1"};const g=({node:e})=>{const{theme:t}=(0,r.u)(),n=(0,i.bn)(e),c=!e.parentId,g=n[0];if(!g||!(0,i.gq)(g))return null;const f=g.attributes["exception.type"],h=g.attributes["exception.message"];return(0,d.Y)(a.p,{withBorder:!0,isExceptionSection:!0,sectionKey:g.name,css:(0,s.AH)({marginBottom:c?t.spacing.sm:0},""),title:(0,d.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,minWidth:0,flex:1},""),children:[(0,d.Y)(o.XCircleIcon,{color:"danger",css:m}),(0,d.Y)("div",{css:p,children:(0,d.FD)(r.T.Text,{color:"error",bold:!0,css:(0,s.AH)({display:"block",width:`calc(100% - ${t.spacing.lg}px)`},""),children:[f,": ",h]})})]}),children:(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingBottom:t.spacing.sm,paddingLeft:c?0:t.spacing.lg},""),children:u(g).map(({key:e,value:t,renderMode:n})=>(0,d.Y)(l.B,{title:e,data:JSON.stringify(t,null,2),renderMode:null!==n&&void 0!==n?n:"text"},e))})},g.name)}},84612:function(e,t,n){n.d(t,{KN:function(){return d},Pt:function(){return a},jf:function(){return l},se:function(){return i},uZ:function(){return r}});var s=n(42747),o=n(73408);const r=250,i=e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")},a=(e,t=new Date)=>{const n=Math.max(0,Math.floor((t.getTime()-e)/1e3));let r=Math.floor(n/31536e3);return r>=1?(0,o.Y)(s.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:r}}):(r=Math.floor(n/2592e3),r>=1?(0,o.Y)(s.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:r}}):(r=Math.floor(n/86400),r>=1?(0,o.Y)(s.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:r}}):(r=Math.floor(n/3600),r>=1?(0,o.Y)(s.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:r}}):(r=Math.floor(n/60),r>=1?(0,o.Y)(s.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:r}}):(0,o.Y)(s.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))},l=e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}},d=({formValue:e,dataType:t,isFeedback:n})=>n?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}}},85060:function(e,t,n){n.d(t,{N:function(){return l}});var s=n(82716),o=n(27757),r=n(42747),i=n(53915),a=n(73408);const l=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:n,isInComparisonView:l}=(0,i.nJ)();return l?null:(0,a.Y)(o.B,{disabled:!n,type:"primary",componentId:"shared.model-trace-explorer.assessments-pane-toggle",size:"small",icon:e?(0,a.Y)(s.SidebarExpandIcon,{}):(0,a.Y)(s.SidebarCollapseIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),children:e?(0,a.Y)(r.sA,{id:"QK9qFL",defaultMessage:"Hide assessments"}):(0,a.Y)(r.sA,{id:"mltH0e",defaultMessage:"Show assessments"})})}},86119:function(e,t,n){n.d(t,{b:function(){return f}});var s=n(68248),o=n(46709),r=n(27757),i=n(82716),a=n(79081),l=n(42747),d=n(110);var c=n(97447),u=n(21636),m=n(73408);var p={name:"mqlsmr",styles:"font-size:12px;display:flex"},g={name:"rnnx2x",styles:"font-size:12px"};const f=({experimentId:e,sessionId:t,traceId:n,handleCopy:f,hideLabel:h=!1})=>{const{theme:v}=(0,r.u)(),y=(0,d.zy)(),x=t.length>10?`${t.slice(0,10)}...`:t,b=(0,o.useCallback)(e=>e.length>10?`${e.slice(0,10)}...`:e,[]),w=((e,t)=>(0,d.Oz)(`/experiments/${e}/chat-sessions/${t}`))(e,t),S=n?`${w}?${new URLSearchParams({[u.hb]:n}).toString()}`:w;return y.pathname.includes(`/chat-sessions/${t}`)?(0,m.Y)(c.f,{label:(0,m.Y)(l.sA,{id:"XIWwOm",defaultMessage:"Session ID"}),icon:(0,m.Y)(i.SpeechBubbleIcon,{css:p}),value:t,color:"default",getTruncatedLabel:b,onCopy:f,hideLabel:h}):(0,m.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:h?"flex-start":"center",flexDirection:"row",gap:v.spacing.sm},""),children:[!h&&(0,m.Y)(r.T.Text,{size:"md",color:"secondary",children:(0,m.Y)(l.sA,{id:"XIWwOm",defaultMessage:"Session ID"})}),(0,m.Y)(a.T,{componentId:"mlflow.model-trace-explorer.session-id-tag",content:(0,m.Y)(l.sA,{id:"OUPWd8",defaultMessage:"View chat session"}),children:(0,m.Y)(d.N_,{to:S,children:(0,m.Y)(i.Tag,{componentId:"mlflow.model_trace_explorer.header_details.tag-session-id",children:(0,m.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:v.spacing.xs},""),children:[(0,m.Y)(i.SpeechBubbleIcon,{css:g}),(0,m.Y)("span",{children:x})]})})})})]})}},86125:function(e,t,n){n.d(t,{$f:function(){return C},BS:function(){return f},CL:function(){return ee},Dv:function(){return fe},Hq:function(){return X},I$:function(){return Q},LS:function(){return x},M2:function(){return le},MF:function(){return k},N7:function(){return P},NH:function(){return v},OS:function(){return $},PC:function(){return W},Q0:function(){return z},UZ:function(){return M},W0:function(){return B},Y5:function(){return ue},ZI:function(){return ne},bN:function(){return ve},bn:function(){return j},cp:function(){return _},f7:function(){return Y},gD:function(){return I},g_:function(){return V},gq:function(){return ye},h8:function(){return q},ho:function(){return me},iZ:function(){return ce},ij:function(){return h},in:function(){return Z},jW:function(){return F},ko:function(){return ie},m4:function(){return ge},nr:function(){return ae},ob:function(){return D},pQ:function(){return se},rX:function(){return he},tC:function(){return y},tI:function(){return pe},uM:function(){return O},vL:function(){return S},vX:function(){return de},vl:function(){return U},x0:function(){return J},xD:function(){return b},yt:function(){return re}});var s=n(68248),o=n(76118),r=n(46709),i=n(94664),a=n(51847),l=n(90828),d=n(46026),c=n(69660),u=n(21636),m=n(81390),p=n(71540),g=n(73408);const f="model-trace-info-v3",h=e=>{},v=e=>{};function y(e){switch(e){case i.UG.LLM:return i.Dy.MODELS;case i.UG.CHAIN:return i.Dy.CHAIN;case i.UG.AGENT:return i.Dy.AGENT;case i.UG.TOOL:return i.Dy.WRENCH;case i.UG.CHAT_MODEL:return i.Dy.MODELS;case i.UG.RETRIEVER:return i.Dy.SEARCH;case i.UG.PARSER:return i.Dy.CODE;case i.UG.EMBEDDING:return i.Dy.NUMBERS;case i.UG.RERANKER:return i.Dy.SORT;case i.UG.MEMORY:return i.Dy.SAVE;case i.UG.FUNCTION:return i.Dy.FUNCTION;case i.UG.UNKNOWN:return i.Dy.UNKNOWN;default:return i.Dy.FUNCTION}}function x(e){switch(e){case i.UG.LLM:return"LLM";case i.UG.CHAIN:return"Chain";case i.UG.AGENT:return"Agent";case i.UG.TOOL:return"Tool";case i.UG.CHAT_MODEL:return"Chat model";case i.UG.RETRIEVER:return"Retriever";case i.UG.PARSER:return"Parser";case i.UG.EMBEDDING:return"Embedding";case i.UG.RERANKER:return"Reranker";case i.UG.MEMORY:return"Memory";case i.UG.FUNCTION:return"Function";case i.UG.UNKNOWN:return"Unknown";default:return e}}function b(e){try{return JSON.parse(e)}catch(t){return e}}const w=(e,t)=>{if(!t)return[];const n=[],s={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,o.map)(s,(s,o)=>{if("events"===o)return void n.push(...((e,t)=>{const n=e.events;if(!n)return[];const s=[];return n.forEach((n,o)=>{const r=n.attributes;r&&Object.keys(r).forEach(i=>{const a=i.toLowerCase().includes(t),l=z(n.name,o,i);a&&s.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const d=JSON.stringify(r[i]).toLowerCase().split(t).length-1;for(let t=0;t<d;t++)s.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})})}),s})(e,t));V(s).forEach(s=>{s.key.toLowerCase().includes(t)&&n.push({span:e,section:o,key:s.key,isKeyMatch:!0,matchIndex:0});const r=s.value.toLowerCase().split(t).length-1;for(let t=0;t<r;t++)n.push({span:e,section:o,key:s.key,isKeyMatch:!1,matchIndex:t})})}),n};function S(e,t,n){var s,o;const r=t.toLowerCase().trim(),i=Object.values(n.spanTypeDisplayState).every(e=>e);if(""===r&&i)return{filteredTreeNodes:[e],matches:[]};const a=null!==(s=e.children)&&void 0!==s?s:[],l=[],d=[];a.forEach(e=>{const{filteredTreeNodes:t,matches:s}=S(e,r,n);l.push(...t),d.push(...s)});const c=(null!==(o=e.title)&&void 0!==o?o:"").toLowerCase(),u=w(e,r),m=u.length>0||c.includes(r),p=!e.type||n.spanTypeDisplayState[e.type],g=m&&p,f=l.length>0,h=P(e)>0;return g||n.showParents&&f||n.showExceptions&&h?{filteredTreeNodes:[{...e,children:l}],matches:u.concat(d)}:{filteredTreeNodes:l,matches:d}}function Y(e,t){var n;if((0,o.isNil)(t)||(0,o.isNil)(e))return;if(e.key===t)return e;const s=null!==(n=e.children)&&void 0!==n?n:[];for(const o of s){const e=Y(o,t);if(e)return e}}const A=(e,t,n,s,r,i)=>{var l,c;const m=b((0,p.zl)(e.attributes,"mlflow.spanType")),f=b((0,p.zl)(e.attributes,"mlflow.spanInputs")),h=b((0,p.zl)(e.attributes,"mlflow.spanOutputs")),v=_(e),x=E(e),w=null!==(l=r[x])&&void 0!==l?l:[];var S;v||w.push(...null!==(S=r[""])&&void 0!==S?S:[]);const Y=b((0,p.zl)(e.attributes,"mlflow.chat.messages")),A=b((0,p.zl)(e.attributes,"mlflow.message.format")),T=((e,t,n,s,r)=>{var i,a;if(Array.isArray(e)&&e.every(Q))return(0,o.compact)(e.map(ne));const l=null!==(i=X(t,s))&&void 0!==i?i:[],c=null!==(a=X(n,s))&&void 0!==a?a:[];if("pydantic_ai"===s&&c.length>0)return l.length>0?l.concat(c):c;if("voltagent"===s&&r&&r.length>0){const e=(0,d.Nw)(t,n,r);if(e&&e.length>0)return e}return 0!==l.length&&0!==c.length?l.concat(c):void 0})(Y,f,h,A,s),I=((e,t)=>{var n;return Array.isArray(e)&&e.every(W)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(n=t.tools)&&void 0!==n&&n.every(W)?t.tools:void 0})(b((0,p.zl)(e.attributes,"mlflow.chat.tools")),f),C=b((0,p.zl)(e.attributes,u.IR)),M=(e=>{if(e&&"object"===typeof e&&"input_cost"in e&&"output_cost"in e&&"total_cost"in e)return e})(b((0,p.zl)(e.attributes,u.Ye))),k=(0,o.mapValues)((0,o.omitBy)(e.attributes,(e,t)=>t.startsWith("mlflow.")),e=>b(e)),D=e.events,F=(Number(N(e))-t)/1e3,O=(Number(null!==(c=R(e))&&void 0!==c?c:n)-t)/1e3;return{title:e.name,icon:(0,g.Y)(a.P,{type:y(m),hasException:P(e)>0,isRootSpan:!v}),type:m,key:x,start:F,end:O,children:s.slice().sort((e,t)=>e.start-t.start),inputs:f,outputs:h,attributes:k,events:D,chatMessageFormat:A,chatMessages:T,chatTools:I,parentId:v,assessments:w,traceId:i,modelName:C,cost:M}},T=(e,t)=>{if(!e)return"";if(t&&e.length<16)try{return(e=>{const t=atob(e),n=t.length;let s="";for(let o=0;o<n;o++)s+=t.charCodeAt(o).toString(16).padStart(2,"0");return s})(e)}catch(n){return e}return e.startsWith("0x")?e.slice(2):e};function I(e){return!!e&&"trace_location"in e}function C(e){return"start_time_unix_nano"in e&&Array.isArray(e.attributes)}function M(e){return"start_time_unix_nano"in e}function E(e){var t,n,s;return M(e)||C(e)?T(null!==(t=e.span_id)&&void 0!==t?t:"",!0):T(null!==(n=null===(s=e.context)||void 0===s?void 0:s.span_id)&&void 0!==n?n:"",!1)}function _(e){var t,n;return M(e)||C(e)?T(null!==(t=e.parent_span_id)&&void 0!==t?t:"",!0):T(null!==(n=e.parent_id)&&void 0!==n?n:"",!1)}function N(e){return M(e)||C(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function R(e){return M(e)||C(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function k(e){var t;return I(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function D(e){var t,n;if(!I(e.info))return null;const s=Number(null===(t=e.info)||void 0===t||null===(n=t.trace_metadata)||void 0===n?void 0:n["mlflow.trace.sizeBytes"]);return(0,o.isNil)(s)||isNaN(s)?null:s}function F(e){const t=O(e);return t&&1===t.length?t[0]:null}function O(e){var t,n;const s=k(e),o=(null!==(t=null===(n=e.trace_data)||void 0===n?void 0:n.spans)&&void 0!==t?t:e.data.spans).map(oe),r={},l={};if(!o||0===o.length)return[];o.forEach(e=>{const t=E(e);r[t]=e,l[t]=[]}),o.forEach(e=>{var t;const n=E(e),s=_(e);null===(t=l[s])||void 0===t||t.push(n)});const d=Math.min(...o.map(e=>N(e))),c=Math.max(...o.map(e=>R(e))),u=L(e.info);function m(e){var t,n,o;const p=r[e],f=l[e].map(m);if(M(p)||C(p)||"parent_id"in p)return A(p,d,c,f,u,s);const h=null!==(t=p.span_type)&&void 0!==t?t:i.UG.UNKNOWN;return{title:p.name,icon:(0,g.Y)(a.P,{type:y(h)}),type:h,key:p.context.span_id,start:Number(p.start_time)-d,end:Number(null!==(n=p.end_time)&&void 0!==n?n:c)-d,children:f.slice().sort((e,t)=>e.start-t.start),inputs:p.inputs,outputs:p.outputs,attributes:p.attributes,events:p.events,parentId:null!==(o=p.parent_id)&&void 0!==o?o:p.parent_span_id,assessments:[],traceId:s}}const p=new Array;return o.forEach(e=>{const t=_(e);t&&r[t]||p.push(m(E(e)))}),p}const L=e=>{let t=[];var n;I(e)?t=null!==(n=e.assessments)&&void 0!==n?n:[]:t=H(e.tags);const s=(0,o.keyBy)(t,"assessment_id");Object.values(s).forEach(e=>{if(e.overrides){const t=s[e.overrides];e.overriddenAssessment=t}}),t=Object.values(s);const r=t.reduce((e,t)=>{var n;const s=null!==(n=t.span_id)&&void 0!==n?n:"";return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.keys(r).forEach(e=>{r[e].sort((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())}),r},H=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map(([e,t])=>({key:e,value:t}))).filter(({key:e})=>e.startsWith("mlflow.assessment.")).map(({value:e})=>JSON.parse(e))};const V=e=>(0,o.isNil)(e)?[]:Array.isArray(e)||(0,o.isString)(e)||(0,o.isNumber)(e)||(0,o.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map(([e,t])=>({key:e,value:JSON.stringify(t,null,2)})),$=({searchFilter:e,data:t,activeMatchBackgroundColor:n,inactiveMatchBackgroundColor:r,containsActiveMatch:i,activeMatch:a,scrollToActiveMatch:l})=>{const d=new RegExp(`(${(0,o.escapeRegExp)(e.trim())})`,"gi"),c=t.split(d),u=[];let m=0;for(let o=0;o<c.length;o++)if(c[o].toLowerCase().includes(e.toLowerCase().trim())){const e=i&&a.matchIndex===m,t=e?n:r,d=(0,g.Y)("span",{ref:e?l:null,css:(0,s.AH)({backgroundColor:t,scrollMarginTop:50},""),children:c[o]},o);m++,u.push(d)}else u.push(c[o]);return u},B=e=>(0,o.has)(e,"page_content"),U=e=>e.type===i.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,o.every)(e.outputs,B),z=(e,t,n)=>`${e}-${t}-${n}`,j=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter(e=>"exception"===e.name)},P=e=>j(e).length,K=e=>!(0,o.isNil)(e)&&(!(!(0,o.isNil)(e.type)&&!(0,o.isString)(e.type))&&(!(!(0,o.isNil)(e.description)&&!(0,o.isString)(e.description))&&!(!(0,o.isNil)(e.enum)&&!Array.isArray(e.enum)))),W=e=>{var t;if((0,o.isNil)(e)||"function"!==e.type||!(0,o.has)(e,"function.name"))return!1;const n=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,o.isNil)(n)){const e=n.required;if(!(0,o.isNil)(e)&&(!Array.isArray(e)||!e.every(o.isString)))return!1;const t=n.properties;if(!(0,o.isNil)(t)&&!Object.values(t).every(K))return!1}return!0},q=e=>{var t,n;return e&&(0,o.isString)(e.id)&&(0,o.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,o.isString)(null===(n=e.function)||void 0===n?void 0:n.name)},G=e=>!(!(0,o.isNil)(e)&&!(0,o.isString)(e))||!!(0,o.isArray)(e)&&e.every(e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,o.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,o.isNil)(t)&&(0,o.isString)(t.url)&&((0,o.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:n}=e;return!(0,o.isNil)(n)&&(0,o.isString)(n.data)&&((0,o.isNil)(n.format)||["wav","mp3"].includes(n.format));default:return!1}})(e)),Q=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(q))return!1}return(!e.parts||!(0,o.isNil)(e.content))&&("reasoning"===e.type||!!G(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role))},J=e=>Array.isArray(e)&&e.length>0&&e.every(e=>{return(0,o.has)(e,"message")&&(t=e.message,!!Q(t)&&((0,o.isNil)(t.content)||(0,o.isString)(t.content)));var t}),Z=e=>e&&J(e.choices),X=(e,t)=>{var n,s,r,i,a,l,u,m,p,g,f,h,v,y,x,b,w;try{if(Array.isArray(e)&&e.length>0&&e.every(Q))return(0,o.compact)(e.map(ne));switch(t){case"langchain":const t=null!==(n=(0,d.HD)(e))&&void 0!==n?n:(0,d.oI)(e);if(t)return t;break;case"llamaindex":const o=null!==(s=(0,d.Hy)(e))&&void 0!==s?s:(0,d.W3)(e);if(o)return o;break;case"openai":const S=null!==(r=null!==(i=null!==(a=null!==(l=(0,d.a8)(e))&&void 0!==l?l:(0,d.bS)(e))&&void 0!==a?a:(0,d.n_)(e))&&void 0!==i?i:(0,d.AG)(e))&&void 0!==r?r:(0,c.x1)(e);if(S)return S;break;case"dspy":const Y=null!==(u=(0,d.iU)(e))&&void 0!==u?u:(0,d.Pn)(e);if(Y)return Y;break;case"gemini":const A=null!==(m=(0,d.DE)(e))&&void 0!==m?m:(0,d.Sy)(e);if(A)return A;break;case"anthropic":const T=null!==(p=(0,d.KF)(e))&&void 0!==p?p:(0,d.pL)(e);if(T)return T;break;case"mistral":const I=null!==(g=(0,d.Kn)(e))&&void 0!==g?g:(0,d.v_)(e);if(I)return I;break;case"openai-agent":const C=null!==(f=(0,d.xW)(e))&&void 0!==f?f:(0,d.m$)(e);if(C)return C;break;case"autogen":const M=null!==(h=(0,d.nW)(e))&&void 0!==h?h:(0,d.u6)(e);if(M)return M;break;case"bedrock":const E=null!==(v=(0,d.Yv)(e))&&void 0!==v?v:(0,d.f1)(e);if(E)return E;break;case"vercel_ai":const _=null!==(y=(0,d.fJ)(e))&&void 0!==y?y:(0,d.QA)(e);if(_)return _;break;case"pydantic_ai":const N=null!==(x=(0,d.Ii)(e))&&void 0!==x?x:(0,d.TY)(e);if(N)return N;break;case"voltagent":const R=null!==(b=(0,d.o0)(e))&&void 0!==b?b:(0,d.LO)(e);if(R)return R;break;default:const k=null!==(w=(0,d.a8)(e))&&void 0!==w?w:(0,d.bS)(e);if(k)return k}return Array.isArray(e)&&e.length>0&&e.every(d.oi)?(0,o.compact)(e.map(d.pN)):null}catch(S){return null}},ee=e=>{var t;let n=null===(t=e.function)||void 0===t?void 0:t.arguments;try{n=JSON.stringify(JSON.parse(n),null,2)}catch(s){}return{id:e.id,function:{arguments:n,name:e.function.name}}},te=e=>{if((0,o.isNil)(e)||(0,o.isString)(e))return e;return e.map(e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const n=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return n?`![](${n})`:"[image]";case"input_audio":return"[audio]"}}).filter(e=>void 0!==e).join("\n\n")},ne=e=>{var t;return"reasoning"===e.type?null:{...e,content:te(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(ee)}},se=e=>{if((0,o.isNil)(e))return"content";if(P(e)>0)return"events";if(e.chatMessages)return"chat";return!(0,o.isNil)(e.inputs)||!(0,o.isNil)(e.outputs)?"content":"attributes"},oe=e=>{var t;const n=e=>Array.isArray(e)?e.reduce((e,t)=>{return t.key&&t.value?{...e,[t.key]:(n=t.value,(0,o.isObject)(n)?"string_value"in n?n.string_value:"bool_value"in n?n.bool_value:"int_value"in n?n.int_value:"double_value"in n?n.double_value:n:n)}:e;var n},{}):e;return{...e,...e.attributes&&{attributes:n(e.attributes)},...e.events&&{events:null===(t=e.events)||void 0===t?void 0:t.map(e=>({...e,attributes:n(e.attributes)}))}}},re=e=>(0,r.useMemo)(()=>{if(!e)return[];return(0,m.VC)([e]).filter(m.fJ)},[e]),ie=e=>{var t;return Boolean(e&&I(e)&&"UC_SCHEMA"===(null===(t=e.trace_location)||void 0===t?void 0:t.type))},ae=e=>{var t,n,s,o;return"MLFLOW_EXPERIMENT"===e.type?null===(t=e.mlflow_experiment)||void 0===t?void 0:t.experiment_id:"INFERENCE_TABLE"===e.type?null===(n=e.inference_table)||void 0===n?void 0:n.full_table_name:"UC_SCHEMA"===e.type?`${null===(s=e.uc_schema)||void 0===s?void 0:s.catalog_name}.${null===(o=e.uc_schema)||void 0===o?void 0:o.schema_name}`:void 0},le=e=>{const[t,n]=e.split(".");return t&&n?{type:"UC_SCHEMA",uc_schema:{catalog_name:t,schema_name:n}}:{type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}}},de=e=>{if(!e.trace_location)return e.trace_id;const t=ae(e.trace_location);return t?`trace:/${t}/${e.trace_id}`:e.trace_id},ce=e=>{if(!me(e))return;const[,t,n]=e.split("/");return{trace_id:n,trace_location:t}},ue=e=>{const t=ce(e);if(t)return{trace_id:t.trace_id,trace_location:le(t.trace_location)}},me=e=>e.startsWith("trace:/"),pe=e=>{var t;const n=null===(t=e.trace_metadata)||void 0===t?void 0:t[u.Uu];if(!n)return null;try{var s;const e=JSON.parse(n);return null!==(s=null===e||void 0===e?void 0:e.total_tokens)&&void 0!==s?s:null}catch{return null}},ge=e=>{var t,n;return(0,l.pt)(null!==(t=null===e||void 0===e||null===(n=e.trace_metadata)||void 0===n?void 0:n[u.Uu])&&void 0!==t?t:"{}")},fe=e=>{var t,n;return(0,l.pt)(null!==(t=null===e||void 0===e||null===(n=e.trace_metadata)||void 0===n?void 0:n[u.ak])&&void 0!==t?t:"{}")},he=e=>{var t;return!(0,o.isEmpty)(null===(t=e.metadata)||void 0===t?void 0:t[u.K6])},ve=e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.filter(e=>!he(e)))&&void 0!==t?t:[]},ye=e=>{var t;const n=(null===e||void 0===e?void 0:e.attributes)&&"exception.stacktrace"in e.attributes,s="string"===typeof(null===(t=e.attributes)||void 0===t?void 0:t["exception.stacktrace"]);return Boolean((null===e||void 0===e?void 0:e.attributes)&&"string"===typeof e.attributes["exception.type"]&&"string"===typeof e.attributes["exception.message"]&&(!n||s))}},89602:function(e,t,n){n.d(t,{C:function(){return r}});var s=n(27757),o=n(73408);function r({children:e}){return(0,o.Y)(s.T.Text,{bold:!0,children:e})}},90448:function(e,t,n){n.d(t,{Au:function(){return T},CH:function(){return U},ER:function(){return H},FN:function(){return y},II:function(){return D},PB:function(){return L},Pp:function(){return K},Qq:function(){return R},UN:function(){return A},Wp:function(){return Q},Xe:function(){return z},YZ:function(){return B},Zh:function(){return F},_1:function(){return h},aj:function(){return V},bz:function(){return S},c1:function(){return g},c9:function(){return I},eB:function(){return Y},fu:function(){return O},gZ:function(){return b},hG:function(){return k},ik:function(){return $},jr:function(){return C},kp:function(){return v},mS:function(){return M},ng:function(){return W},pZ:function(){return x},rU:function(){return q},sw:function(){return N},uU:function(){return w},vP:function(){return j},w_:function(){return P},xO:function(){return G},yQ:function(){return E}});var s=n(68248),o=n(76118),r=n(82716),i=n(27757),a=n(42747),l=n(44666),d=n(16844),c=n(9858),u=n(73408);const m="Error",p=["openai","langchain","anthropic"],g=e=>{if(!(0,o.isNil)(e)&&"object"===typeof e)try{for(const t of p){const n=(0,d.Hq)(e,t);if(n&&n.length>0){const e=[...n].reverse().find(e=>"user"===e.role);if(null!==e&&void 0!==e&&e.content)return e.content}}}catch{}},f="messages";let h=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.RETRIEVAL_GROUNDEDNESS="retrieval_groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.RETRIEVAL_RELEVANCE="retrieval_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.RETRIEVAL_SUFFICIENCY="retrieval_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GUIDELINES="guidelines",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.CONVERSATIONAL_GUIDELINES="conversational_guidelines",e}({});const v=[h.OVERALL_ASSESSMENT,h.CORRECTNESS,h.GLOBAL_GUIDELINE_ADHERENCE,h.GUIDELINE_ADHERENCE,h.GUIDELINES,h.CONVERSATIONAL_GUIDELINES,h.RELEVANCE_TO_QUERY,h.CONTEXT_SUFFICIENCY,h.RETRIEVAL_SUFFICIENCY,h.CHUNK_RELEVANCE,h.RETRIEVAL_RELEVANCE,h.GROUNDEDNESS,h.RETRIEVAL_GROUNDEDNESS,h.SAFETY],y=e=>"https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/",x={[h.OVERALL_ASSESSMENT]:{basePath:"/generative-ai/agent-evaluation/llm-judge-metrics",hash:"how-quality-is-assessed-by-llm-judges"},[h.CORRECTNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"correctness"},[h.GROUNDEDNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"groundedness"},[h.RETRIEVAL_GROUNDEDNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"groundedness"},[h.RELEVANCE_TO_QUERY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"answer-relevance"},[h.SAFETY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"safety"},[h.CHUNK_RELEVANCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"chunk-relevance-precision"},[h.RETRIEVAL_RELEVANCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"chunk-relevance-precision"},[h.CONTEXT_SUFFICIENCY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"context-sufficiency"},[h.RETRIEVAL_SUFFICIENCY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"context-sufficiency"},[h.GUIDELINE_ADHERENCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"guideline-adherence"},[h.GUIDELINES]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"guideline-adherence"},[h.CONVERSATIONAL_GUIDELINES]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"conversational-guidelines"}};let b=function(e){return e.YES="yes",e.NO="no",e.UNKNOWN="unknown",e}({});function w(e,t,n,o){return o===m?{content:e.formatMessage({id:"/DvT6Y",defaultMessage:"Error"})}:"pass-fail"===n.dtype?o===b.YES?{content:e.formatMessage({id:"pm1RNL",defaultMessage:"Pass"}),icon:(0,u.Y)("span",{css:(0,s.AH)({color:`${(0,c.CY)(t,n,{stringValue:b.YES})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,u.Y)(r.CheckCircleIcon,{css:(0,s.AH)({backgroundColor:(0,c.x2)(t,n,{stringValue:b.YES}),borderRadius:"50%"},"")})})}:o===b.NO?{content:e.formatMessage({id:"9cTaBs",defaultMessage:"Fail"}),icon:(0,u.Y)("span",{css:(0,s.AH)({color:`${(0,c.CY)(t,n,{stringValue:b.NO})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,u.Y)(r.XCircleIcon,{css:(0,s.AH)({backgroundColor:(0,c.x2)(t,n,{stringValue:b.NO}),borderRadius:"50%"},"")})})}:{content:e.formatMessage({id:"27XMby",defaultMessage:"Missing"}),icon:(0,u.Y)("span",{css:(0,s.AH)({color:`${(0,c.CY)(t,n,{stringValue:b.UNKNOWN})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,u.Y)(i.W,{css:(0,s.AH)({backgroundColor:(0,c.x2)(t,n,{stringValue:b.UNKNOWN}),borderRadius:"50%"},"")})})}:"boolean"===n.dtype?!0===o?{content:e.formatMessage({id:"1Ujhc3",defaultMessage:"True"})}:!1===o?{content:e.formatMessage({id:"nvjkTA",defaultMessage:"False"})}:{content:e.formatMessage({id:"keSIQ4",defaultMessage:"null"})}:{content:`${o}`}}let S=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({});const Y={response:(0,a.zR)({id:"WiaEQ3",defaultMessage:"Model output"})},A="expected_facts",T={expected_response:(0,a.zR)({id:"CX8ytv",defaultMessage:"Expected output"}),[A]:(0,a.zR)({id:"N1G2a5",defaultMessage:"Expected facts"})},I={[h.OVERALL_ASSESSMENT]:(0,a.zR)({id:"uoJWOm",defaultMessage:"Overall"}),[h.CORRECTNESS]:(0,a.zR)({id:"7+XQ3q",defaultMessage:"Correctness"}),[h.GROUNDEDNESS]:(0,a.zR)({id:"Ws58cc",defaultMessage:"Groundedness"}),[h.RETRIEVAL_GROUNDEDNESS]:(0,a.zR)({id:"wY58OE",defaultMessage:"Retrieval groundedness"}),[h.CONTEXT_SUFFICIENCY]:(0,a.zR)({id:"GRaplV",defaultMessage:"Context sufficiency"}),[h.RETRIEVAL_SUFFICIENCY]:(0,a.zR)({id:"mdzFsD",defaultMessage:"Retrieval sufficiency"}),[h.RELEVANCE_TO_QUERY]:(0,a.zR)({id:"Yhydp3",defaultMessage:"Relevance"}),[h.SAFETY]:(0,a.zR)({id:"jMUqD1",defaultMessage:"Safety"}),[h.CHUNK_RELEVANCE]:(0,a.zR)({id:"qnMgLj",defaultMessage:"Chunk relevance"}),[h.RETRIEVAL_RELEVANCE]:(0,a.zR)({id:"opUoF8",defaultMessage:"Retrieval relevance"}),[h.GUIDELINE_ADHERENCE]:(0,a.zR)({id:"xV6NWF",defaultMessage:"Guideline adherence"}),[h.GUIDELINES]:(0,a.zR)({id:"ls3868",defaultMessage:"Guidelines"}),[h.GLOBAL_GUIDELINE_ADHERENCE]:(0,a.zR)({id:"tUAhDM",defaultMessage:"Global guideline adherence"}),[h.CONVERSATIONAL_GUIDELINES]:(0,a.zR)({id:"AeRhuI",defaultMessage:"Conversational guidelines"})},C={[h.CORRECTNESS]:(0,a.zR)({id:"i7UTwK",defaultMessage:"Correctness assessment is missing. This is likely because you have not provided an expected response (ground truth) or grading notes."}),[h.GROUNDEDNESS]:(0,a.zR)({id:"jPW0Lj",defaultMessage:"Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[h.RETRIEVAL_GROUNDEDNESS]:(0,a.zR)({id:"TXPJuE",defaultMessage:"Retrieval Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[h.CONTEXT_SUFFICIENCY]:(0,a.zR)({id:"g0tloS",defaultMessage:"Context sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."}),[h.RETRIEVAL_SUFFICIENCY]:(0,a.zR)({id:"ffIouW",defaultMessage:"Retrieval sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."})},M={[h.OVERALL_ASSESSMENT]:(0,a.zR)({id:"hW5ehW",defaultMessage:"The overall assessment passes when all of the judges pass."}),[h.CORRECTNESS]:(0,a.zR)({id:"Y6gWro",defaultMessage:"The correctness LLM judge gives a binary evaluation and written rationale on whether the agent's generated response is factually accurate and semantically similar to the provided ground-truth response or grading notes."}),[h.GROUNDEDNESS]:(0,a.zR)({id:"+Wd9fs",defaultMessage:"The groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[h.RETRIEVAL_GROUNDEDNESS]:(0,a.zR)({id:"6Q/0BO",defaultMessage:"The retrieval groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[h.RELEVANCE_TO_QUERY]:(0,a.zR)({id:"oDwj2g",defaultMessage:"The relevance_to_query LLM judge determines whether the response is relevant to the input request."}),[h.SAFETY]:(0,a.zR)({id:"/gqx4n",defaultMessage:"The safety LLM judge returns a binary rating and a written rationale on whether the generated response has harmful or toxic content."}),[h.CHUNK_RELEVANCE]:(0,a.zR)({id:"aUOkOC",defaultMessage:"The chunk-relevance-precision LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[h.RETRIEVAL_RELEVANCE]:(0,a.zR)({id:"rBydei",defaultMessage:"The retrieval-relevance LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[h.CONTEXT_SUFFICIENCY]:(0,a.zR)({id:"bkWot5",defaultMessage:"The context sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[h.RETRIEVAL_SUFFICIENCY]:(0,a.zR)({id:"fwxkdN",defaultMessage:"The retrieval sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[h.GUIDELINE_ADHERENCE]:(0,a.zR)({id:"4Tg5Vr",defaultMessage:"The guideline adherence LLM judge determines whether the response adheres to the guidelines provided."}),[h.GUIDELINES]:(0,a.zR)({id:"98v9a0",defaultMessage:"The guidelines LLM judge determines whether the response adheres to the guidelines provided. All responses must adhere to guidelines."}),[h.GLOBAL_GUIDELINE_ADHERENCE]:(0,a.zR)({id:"zZ9sIi",defaultMessage:"The global guideline adherence LLM judge determines whether the response adheres to the global guidelines provided. All responses must adhere to global guidelines."}),[h.CONVERSATIONAL_GUIDELINES]:(0,a.zR)({id:"lDQtCN",defaultMessage:"The conversational guidelines LLM judge evaluates whether the assistant's responses throughout a conversation comply with the provided guidelines."})},E={[h.OVERALL_ASSESSMENT]:{[b.YES]:(0,a.zR)({id:"Za9+Cg",defaultMessage:"Pass"}),[b.NO]:(0,a.zR)({id:"j77+aP",defaultMessage:"Fail"})},[h.CHUNK_RELEVANCE]:{[b.YES]:(0,a.zR)({id:"B1Upnc",defaultMessage:"Relevant"}),[b.NO]:(0,a.zR)({id:"M+HfWb",defaultMessage:"Irrelevant"})},[h.RETRIEVAL_RELEVANCE]:{[b.YES]:(0,a.zR)({id:"++039K",defaultMessage:"Relevant"}),[b.NO]:(0,a.zR)({id:"akmaST",defaultMessage:"Irrelevant"})},[h.CONTEXT_SUFFICIENCY]:{[b.YES]:(0,a.zR)({id:"7S/ozs",defaultMessage:"Context sufficient"}),[b.NO]:(0,a.zR)({id:"aAAHaS",defaultMessage:"Context insufficient"})},[h.RETRIEVAL_SUFFICIENCY]:{[b.YES]:(0,a.zR)({id:"rBIGDf",defaultMessage:"Sufficient"}),[b.NO]:(0,a.zR)({id:"lhFnAG",defaultMessage:"Insufficient"})},[h.RELEVANCE_TO_QUERY]:{[b.YES]:(0,a.zR)({id:"rNkAcB",defaultMessage:"Relevant"}),[b.NO]:(0,a.zR)({id:"0M7VVC",defaultMessage:"Irrelevant"})},[h.GROUNDEDNESS]:{[b.YES]:(0,a.zR)({id:"/2InJv",defaultMessage:"Grounded"}),[b.NO]:(0,a.zR)({id:"ZfsnMj",defaultMessage:"Not grounded"})},[h.RETRIEVAL_GROUNDEDNESS]:{[b.YES]:(0,a.zR)({id:"e515YD",defaultMessage:"Grounded"}),[b.NO]:(0,a.zR)({id:"uSVfB9",defaultMessage:"Not grounded"})},[h.CORRECTNESS]:{[b.YES]:(0,a.zR)({id:"eSxQmg",defaultMessage:"Correct"}),[b.NO]:(0,a.zR)({id:"LhxSrc",defaultMessage:"Incorrect"})},[h.SAFETY]:{[b.YES]:(0,a.zR)({id:"DMOaoR",defaultMessage:"Safe"}),[b.NO]:(0,a.zR)({id:"CX/MSu",defaultMessage:"Unsafe"})},[h.GUIDELINE_ADHERENCE]:{[b.YES]:(0,a.zR)({id:"ZNYFUr",defaultMessage:"Adheres to guidelines"}),[b.NO]:(0,a.zR)({id:"hIBLi9",defaultMessage:"Violates guidelines"})},[h.GUIDELINES]:{[b.YES]:(0,a.zR)({id:"luV/3W",defaultMessage:"Adheres to guidelines"}),[b.NO]:(0,a.zR)({id:"WmgIQ+",defaultMessage:"Violates guidelines"})},[h.GLOBAL_GUIDELINE_ADHERENCE]:{[b.YES]:(0,a.zR)({id:"mtYPI8",defaultMessage:"Adheres to global guidelines"}),[b.NO]:(0,a.zR)({id:"rZyNgx",defaultMessage:"Violates global guidelines"})},[h.CONVERSATIONAL_GUIDELINES]:{[b.YES]:(0,a.zR)({id:"iCdWsS",defaultMessage:"Adheres to guidelines"}),[b.NO]:(0,a.zR)({id:"MJILab",defaultMessage:"Violates guidelines"})}},_=e=>{var t;return"AI_JUDGE"===(null===e||void 0===e||null===(t=e.source)||void 0===t?void 0:t.sourceType)},N=e=>{let t=R(e,"request");return(0,o.isNil)(t)&&(t=R(e,f)),(0,o.isNil)(t)&&!(0,o.isNil)(e.inputs)&&Object.keys(e.inputs).length>0&&(t=W(e.inputs)),((0,o.isNil)(t)||""===t)&&(t=e.evaluationId),t},R=(e,t)=>{var n,s;if(!(0,o.isNil)(e.inputsTitle))return"string"===typeof e.inputsTitle?e.inputsTitle:JSON.stringify(e.inputsTitle);let r;const i=e.inputs[t];var a;if((0,o.isPlainObject)(i)&&!(0,o.isNil)(i[f])&&Array.isArray(i[f])&&!(0,o.isNil)(null===(n=i[f][0])||void 0===n?void 0:n.content))r=null===(a=i[f][i[f].length-1])||void 0===a?void 0:a.content;else if((0,o.isNil)(i)||!Array.isArray(i)||(0,o.isNil)(null===(s=i[0])||void 0===s?void 0:s.content)){if(i){const e=g(i);r=null!==e&&void 0!==e?e:W(i)}}else{var l;r=null===(l=i[i.length-1])||void 0===l?void 0:l.content}return r},k=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[S.IS_OVERALL_ASSESSMENT])},D=e=>{var t;return(0,o.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[S.CHUNK_INDEX])},F=e=>{var t,n;const s=null!==(t=null!==(n=e.stringValue)&&void 0!==n?n:e.numericValue)&&void 0!==t?t:e.booleanValue;if(!(0,o.isNil)(s))return s};function O(e,t){let n=e;const s=n.startsWith("#");s&&(n=e.slice(1));return`${s?"#":""}${n}${Math.round(255*Math.min(Math.max(t,0),1)).toString(16).toUpperCase()}`}const L=[h.GUIDELINE_ADHERENCE,h.GUIDELINES,h.GLOBAL_GUIDELINE_ADHERENCE,h.RELEVANCE_TO_QUERY,h.CONTEXT_SUFFICIENCY,h.RETRIEVAL_SUFFICIENCY,h.CORRECTNESS,h.GROUNDEDNESS,h.RETRIEVAL_GROUNDEDNESS,h.SAFETY],H=[h.CHUNK_RELEVANCE],V=({name:e,isOverallAssessment:t,value:n,rationale:s,metadata:o={}})=>{var r;const i=null!==(r=(0,l.w)())&&void 0!==r?r:"";return{booleanValue:"boolean"===typeof n?n:null,numericValue:null,stringValue:"boolean"!==typeof n?n:null,name:e,metadata:t?{...o,[S.IS_OVERALL_ASSESSMENT]:!0}:o,rationale:null!==s&&void 0!==s?s:null,source:{sourceId:i,sourceType:"HUMAN",metadata:{}},timestamp:Date.now(),isDraft:!0}},$=(e,t)=>e.overallAssessments.length>0&&e.overallAssessments.every(_)&&!t.some(k),B=e=>{var t;const n=e.overallAssessments.find(_);if(!n)return null;const s=null!==(t=(0,l.w)())&&void 0!==t?t:"";return{...n,timestamp:Date.now(),isDraft:!0,source:{sourceType:"HUMAN",sourceId:s,metadata:{}},metadata:{...n.metadata,[S.IS_COPIED_FROM_AI]:!0}}},U=e=>"isDraft"in e&&e.isDraft,z=e=>(0,o.orderBy)(Object.entries(e),([e,t],n)=>{const s=v.indexOf(e);return-1!==s?s:null!==(o=null===(r=t[t.length-1])||void 0===r?void 0:r.timestamp)&&void 0!==o?o:n;var o,r}),j=e=>{var t,n;return null!==(t=null===(n=e.overallAssessments)||void 0===n?void 0:n.filter(e=>!U(e)).some(e=>!_(e)))&&void 0!==t&&t},P=e=>{var t,n;return"HUMAN"===(null===(t=e.source)||void 0===t?void 0:t.sourceType)&&!(null!==(n=e.metadata)&&void 0!==n&&n[S.IS_COPIED_FROM_AI])},K=e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t[S.CHUNK_INDEX]},W=e=>(0,o.isPlainObject)(e)||Array.isArray(e)?JSON.stringify(e,void 0,2):e,q=(e,t,n,s)=>{if(t){const n=E[t.name];return n?Object.entries(n).map(([n,s])=>({key:n,label:e.formatMessage(s),rootAssessmentName:t.name})):[]}return(s||[]).filter(e=>"boolean"===e.dtype).map(e=>({key:e.name,label:e.name,rootAssessmentName:e.name,disabled:null===n||void 0===n?void 0:n.some(t=>t.name===e.name)}))},G=e=>{if(e){const t=Boolean(e.rationale),n=!(0,o.isNil)(F(e)),s=Boolean(e.errorMessage);return!(t||n||s)}return!1},Q=e=>Array.isArray(e)&&e.every(e=>(0,o.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)},90828:function(e,t,n){n.d(t,{Y7:function(){return a},nt:function(){return o},oD:function(){return r},pt:function(){return i}});var s=n(76118);const o="mlflow.",r=e=>!e.startsWith(o)&&!e.startsWith("_mlflow_"),i=e=>{try{return JSON.parse(e)}catch(t){return}},a=(e,t)=>{const n=(0,s.truncate)(e,{length:t});return(0,s.takeWhile)(n,e=>"\n"!==e).join("")}},91461:function(e,t,n){n.d(t,{E:function(){return c}});var s=n(68248),o=n(46709),r=n(27757),i=n(82716),a=n(42747),l=n(73408);function d({paramName:e,paramProperties:t,isRequired:n}){const{theme:o}=(0,r.u)(),{type:i,description:d,enum:c}=t,u=i||d||c,m=u?{borderTopLeftRadius:o.borders.borderRadiusMd,borderTopRightRadius:o.borders.borderRadiusMd,borderBottom:`1px solid ${o.colors.border}`}:{borderRadius:o.borders.borderRadiusMd};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:o.borders.borderRadiusMd,border:`1px solid ${o.colors.border}`},""),children:[(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:o.colors.backgroundSecondary,padding:`${o.spacing.sm}px ${o.spacing.md}px`,gap:o.spacing.sm,...m},""),children:[(0,l.Y)(r.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),n&&(0,l.Y)(r.T.Text,{withoutMargins:!0,color:"error",children:(0,l.Y)(a.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),u&&(0,l.FD)("div",{css:(0,s.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:o.spacing.md,padding:`${o.spacing.sm}px ${o.spacing.md}px`},""),children:[i&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(a.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,l.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:i})]}),d&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(a.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,l.Y)(r.T.Text,{withoutMargins:!0,children:d})]}),c&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(a.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,flexWrap:"wrap"},""),children:c.map(e=>(0,l.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:e},e))})]})]})]})}function c({tool:e}){var t,n,a;const{theme:c}=(0,r.u)(),[u,m]=(0,o.useState)(!1),p=e.function.description,g=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,f=null!==(n=null===(a=e.function.parameters)||void 0===a?void 0:a.required)&&void 0!==n?n:[],h=p||g,v=h?{":hover":{backgroundColor:c.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:c.borders.borderRadiusMd,border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,l.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",gap:c.spacing.sm,alignItems:"center",borderBottom:h&&u?`1px solid ${c.colors.border}`:"none",padding:c.spacing.sm,...v},""),onClick:()=>m(!u),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[h&&(u?(0,l.Y)(i.ChevronDownIcon,{}):(0,l.Y)(r.o,{})),(0,l.Y)(r.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),h&&u&&(0,l.FD)("div",{css:(0,s.AH)({padding:c.spacing.sm},""),children:[p&&(0,l.Y)(r.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:c.spacing.sm,padding:`0px ${c.spacing.xs}px`},children:e.function.description}),g&&(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:Object.keys(g).map(e=>(0,l.Y)(d,{paramName:e,paramProperties:g[e],isRequired:f.includes(e)},e))})]})]})}},93241:function(e,t,n){n.d(t,{F9:function(){return a},I0:function(){return l},Mq:function(){return r},UK:function(){return s},ij:function(){return o},pR:function(){return i}});const s=()=>!1,o=()=>!0,r=()=>500,i=()=>1e3,a=()=>!1,l=()=>!0},93812:function(e,t,n){n.d(t,{X:function(){return I}});var s=n(68248),o=n(76118),r=n(46709),i=n(27757),a=n(82716),l=n(42747),d=n(73879),c=n(79081),u=n(94664),m=n(51847),p=n(73408);const g=e=>{switch(e){case"system":return(0,p.Y)(m.P,{type:u.Dy.SYSTEM});case"user":return(0,p.Y)(m.P,{type:u.Dy.USER});case"tool":case"function":return(0,p.Y)(m.P,{type:u.Dy.WRENCH});default:return(0,p.Y)(m.P,{type:u.Dy.MODELS})}},f=e=>{switch(e.role){case"system":return(0,p.Y)(l.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,p.Y)(l.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,p.Y)(l.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,p.Y)(l.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,p.Y)(l.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var h={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},v={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const y=({isExpandable:e,expanded:t,setExpanded:n,message:o})=>{const{theme:r}=(0,i.u)(),d=e?{":hover":{backgroundColor:r.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,p.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:r.spacing.sm,gap:r.spacing.sm,...d},""),onClick:()=>n(!t),children:[e&&(t?(0,p.Y)(a.ChevronDownIcon,{}):(0,p.Y)(i.o,{})),g(o.role),o.tool_call_id?(0,p.Y)(i.T.Text,{color:"secondary",css:h,children:(0,p.Y)(l.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,p.Y)(i.T.Text,{css:(0,s.AH)({marginRight:r.spacing.xs},""),bold:!0,children:f(o)}),toolCallId:(0,p.Y)(c.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:o.tool_call_id,children:(0,p.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:r.spacing.xs},""),children:(0,p.Y)(i.T.Text,{css:v,code:!0,children:o.tool_call_id})})})}})}):(0,p.Y)(i.T.Text,{bold:!0,children:f(o)})]})};var x=n(65854),b=n(45547);var w={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function S({toolCall:e}){const{theme:t}=(0,i.u)();return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,p.Y)(i.T.Text,{color:"secondary",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,p.Y)(l.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,p.FD)(a.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,s.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,p.Y)(a.FunctionIcon,{}),(0,p.Y)(i.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,p.Y)(c.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:e.id,children:(0,p.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,p.Y)(i.T.Text,{css:w,code:!0,color:"secondary",children:e.id})})})}})}),(0,p.Y)(b.w,{data:e.function.arguments})]},e.id)}const Y=e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}};function A({content:e,shouldDisplayCodeSnippet:t}){const{theme:n}=(0,i.u)();return e?t?(0,p.Y)(b.w,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:u.cC.JSON}):(0,p.Y)("div",{css:(0,s.AH)({padding:n.spacing.sm,paddingTop:0,marginBottom:-n.typography.fontSizeBase},""),children:(0,p.Y)(d.V,{children:e})}):null}function T({reasoning:e}){const{theme:t}=(0,i.u)(),[n,o]=(0,r.useState)(!1);return(0,p.FD)("div",{css:(0,s.AH)({margin:t.spacing.sm,marginTop:0,border:`1px solid ${t.colors.borderDecorative}`,borderRadius:t.borders.borderRadiusMd,backgroundColor:t.colors.backgroundSecondary,overflow:"hidden"},""),children:[(0,p.FD)("button",{type:"button",onClick:()=>o(!n),css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs,width:"100%",padding:t.spacing.sm,backgroundColor:"transparent",border:"none",cursor:"pointer",textAlign:"left","&:hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:[n?(0,p.Y)(a.ChevronDownIcon,{css:(0,s.AH)({color:t.colors.textSecondary},"")}):(0,p.Y)(i.o,{css:(0,s.AH)({color:t.colors.textSecondary},"")}),(0,p.Y)(a.LightbulbIcon,{css:(0,s.AH)({color:t.colors.textValidationWarning},"")}),(0,p.Y)(i.T.Text,{bold:!0,css:(0,s.AH)({color:t.colors.textSecondary},""),children:(0,p.Y)(l.sA,{id:"x7NsCC",defaultMessage:"Reasoning"})})]}),n&&(0,p.Y)("div",{css:(0,s.AH)({padding:t.spacing.sm,paddingTop:0,borderTop:`1px solid ${t.colors.borderDecorative}`,marginBottom:-t.typography.fontSizeBase},""),children:(0,p.Y)(d.V,{children:e})})]})}function I({message:e,className:t}){var n;const{theme:d}=(0,i.u)(),[c,u]=(0,r.useState)(!1),{content:m,isJson:g}=Y(null!==(n=e.content)&&void 0!==n?n:""),f=g&&("tool"===e.role||"function"===e.role),h=!f&&m.length>x.w,v=h&&!c?`${m.slice(0,x.w)}...`:m;return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:d.borders.borderRadiusSm,border:`1px solid ${d.colors.border}`,backgroundColor:d.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,p.Y)(y,{isExpandable:h,expanded:c,setExpanded:u,message:e}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:d.spacing.sm},""),children:[e.reasoning&&(0,p.Y)(T,{reasoning:e.reasoning}),!(0,o.isNil)(e.tool_calls)&&e.tool_calls.map(e=>(0,p.Y)(S,{toolCall:e},e.id)),(0,p.Y)(A,{content:v,shouldDisplayCodeSnippet:f})]}),h&&(0,p.Y)(i.B,{componentId:c?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:c?(0,p.Y)(a.ChevronUpIcon,{}):(0,p.Y)(a.ChevronDownIcon,{}),type:"tertiary",onClick:()=>u(!c),css:(0,s.AH)({display:"flex",width:"100%",padding:d.spacing.md,borderRadius:"0px !important"},""),children:c?(0,p.Y)(l.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,p.Y)(l.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}},94664:function(e,t,n){n.d(t,{Dy:function(){return o},UG:function(){return s},VZ:function(){return r},cC:function(){return i}});let s=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),o=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e.SAVE="save",e}({}),r=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),i=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e.PYTHON="python",e}({})},94777:function(e,t,n){n.d(t,{o:function(){return c}});var s=n(68248),o=n(27757),r=n(94664),i=n(86125),a=n(51847),l=n(53915),d=n(73408);const c=({node:e})=>{var t;const{theme:n}=(0,o.u)(),{setSelectedNode:c,setActiveView:u,setShowTimelineTreeGantt:m}=(0,l.nJ)(),p=(0,i.N7)(e)>0;return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",marginRight:n.spacing.xs,gap:n.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:p?n.colors.actionDangerDefaultTextDefault:n.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{c(e),u("detail"),m(!1)},children:[(0,d.Y)(a.P,{hasException:p,type:(0,i.tC)(null!==(t=e.type)&&void 0!==t?t:r.UG.UNKNOWN)}),(0,d.Y)(o.T.Text,{color:p?"error":"primary",css:(0,s.AH)({marginLeft:n.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})}},96586:function(e,t,n){n.d(t,{B:function(){return m}});var s=n(68248),o=n(46709),r=n(82716),i=n(27757),a=n(79081),l=n(42747),d=n(94664),c=n(49425),u=n(73408);const m=({error:e})=>{const{theme:t}=(0,i.u)(),[n,m]=(0,o.useState)(!1);return(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,u.Y)(r.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,u.Y)("span",{children:e.error_message}),e.stack_trace&&(0,u.Y)(i.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>m(!0),children:(0,u.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,u.Y)(a.d,{title:(0,u.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:n,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>m(!1),children:(0,u.Y)(c.C,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:d.cC.TEXT})})]})}},97407:function(e,t,n){n.d(t,{R0:function(){return w},C2:function(){return h.C},ki:function(){return A},Es:function(){return m},qd:function(){return f},tP:function(){return S},$W:function(){return C}});var s=n(59930),o=n.n(s),r=n(884),i=n(45175),a=n(46709),l=n(73408);const d=(0,a.createContext)(null);function c({children:e,...t}){return(0,l.Y)(d.Provider,{value:t,children:e})}function u(){const e=(0,a.useContext)(d);return o()(e,"useTagAssignmentContext must be used within a TagAssignmentRoot"),e}function m({children:e,...t}){const n=(0,r.xW)(),s=(0,l.Y)(c,{...t,children:(0,l.Y)(i.V,{children:e})});return n?s:(o()(t.form,"Nest your component on a FormProvider or pass a form prop"),(0,l.Y)(r.Op,{...t.form,children:s}))}var p=n(68248),g=n(27757);function f({children:e}){const{theme:t}=(0,g.u)(),n=a.Children.toArray(e);o()(n.length<=3,"TagAssignmentRow must have 3 children or less");const s=Array(3).fill(null).map((e,s)=>{var o;return null!==(o=n[s])&&void 0!==o?o:(0,l.Y)("span",{style:{width:t.general.heightSm}},s)});return(0,l.Y)("div",{css:(0,p.AH)({display:"grid",gridTemplateColumns:"1fr 1fr min-content",gap:t.spacing.sm},""),children:s})}var h=n(89602),v=n(66916),y=n(82716);var x={name:"82a6rk",styles:"flex:1"};const b=(0,a.forwardRef)(({errorMessage:e,...t},n)=>(0,l.FD)("div",{css:x,children:[(0,l.Y)(v.I,{validationState:e?"error":"info",...t,ref:n}),e&&(0,l.Y)(y.FormUI.Message,{message:e,type:"error"})]}));function w({index:e,rules:t,render:n}){const{name:s,keyProperty:o,getTagsValues:i,emptyValue:a,appendIfPossible:d}=u();return(0,l.Y)(r.xI,{name:`${s}.${e}.${o}`,rules:t,render:({field:e,fieldState:t,formState:s})=>{var r;const c=e.onChange;return e.onChange=function(e){var t;c(e);const n=i();null!==n&&void 0!==n&&null!==(t=n.at(-1))&&void 0!==t&&t[o]&&d(a,{shouldFocus:!1})},n?n({field:e,fieldState:t,formState:s}):(0,l.Y)(b,{componentId:"TagAssignmentKey.Default.Input",errorMessage:null===(r=t.error)||void 0===r?void 0:r.message,...e})}})}function S({rules:e,index:t,render:n}){const{name:s,valueProperty:o}=u();return(0,l.Y)(r.xI,{rules:e,name:`${s}.${t}.${o}`,render:({field:e,fieldState:t,formState:s})=>{var o;return n?n({field:e,fieldState:t,formState:s}):(0,l.Y)(b,{componentId:"TagAssignmentValue.Default.Input",errorMessage:null===(o=t.error)||void 0===o?void 0:o.message,...e})}})}var Y=n(31988);function A({index:e,...t}){const{removeOrUpdate:n}=u();return(0,l.Y)(Y.u,{onClick:()=>n(e),...t})}var T=n(7655);function I(e,t){if(void 0!==e)return 0===e&&o()(!1,"maxLength must be greater than 0"),{maxLength:{value:e,message:t.formatMessage({id:"JW0GbU",defaultMessage:"You can set a maximum of {maxLength} values"},{maxLength:e})}}}function C({name:e,maxLength:t,emptyValue:n,defaultValues:s,loading:i,form:l,keyProperty:d,valueProperty:c}){const[u]=(0,a.useState)(n),m=(0,r.xW)(),p=Boolean(m)&&!l,g=p?m:l;o()(g,"Nest your component on a FormProvider or pass a form prop"),o()(!(s&&p),"Define defaultValues at form context level");const{setValue:f}=g,h=function({name:e,maxLength:t,emptyValue:n,form:s,keyProperty:i}){const l=(0,T.A)(),d=(0,r.xW)(),c=Boolean(d)&&!s?d:s;o()(c,"Nest your component on a FormProvider or pass a form prop");const[u]=(0,a.useState)(n),{append:m,update:p,remove:g,...f}=(0,r.jz)({name:e,control:c.control,rules:I(t,l)}),{getValues:h}=c,v=(0,a.useCallback)(()=>h(e),[h,e]),y=(0,a.useCallback)((e,n)=>{const s=v();t&&s&&s.length>=t||m(e,n)},[v,t,m]),x=(0,a.useCallback)(e=>{const t=v();if(t&&e===t.length-1)return p(e,u);const n=null===t||void 0===t?void 0:t.at(-1);if(null!==n&&void 0!==n&&n[i])return g(e),void m(u,{shouldFocus:!1});g(e)},[u,v,i,m,g,p]);return{form:c,...f,originalAppend:m,update:p,originalRemove:g,appendIfPossible:y,removeOrUpdate:x,getTagsValues:v}}({name:e,maxLength:t,emptyValue:n,form:g,keyProperty:d}),v=h.getTagsValues;return(0,a.useEffect)(()=>{if(!i){if(s){const n=[...s];return(!t||t&&n.length<t)&&n.push(u),void f(e,n)}if(p){var n;const s=null!==(n=v())&&void 0!==n?n:[];return(!t||t&&s.length<t)&&s.push(u),void f(e,s)}f(e,[u])}},[s,f,i,t,e,u,p,v]),{...h,form:g,maxLength:t,emptyValue:n,name:e,keyProperty:d,valueProperty:c}}},97447:function(e,t,n){n.d(t,{f:function(){return d}});var s=n(68248),o=n(82716),r=n(27757),i=n(79081),a=n(73408);var l={name:"e0dnmk",styles:"cursor:pointer"};const d=({label:e,value:t,displayValue:n=t,icon:d,color:c,getTruncatedLabel:u,onCopy:m,hideLabel:p=!1})=>{const{theme:g}=(0,r.u)();return(0,a.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:p?"flex-start":"center",flexDirection:"row",gap:g.spacing.sm},""),children:[!p&&(0,a.Y)(r.T.Text,{size:"md",color:"secondary",children:e}),(0,a.Y)(i.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:t,maxWidth:400,children:(0,a.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",color:c,onClick:()=>{navigator.clipboard.writeText(t),m()},css:l,children:(0,a.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:g.spacing.xs},""),children:[d&&(0,a.Y)("span",{children:d}),(0,a.Y)("span",{children:u(n)})]})})})]})}}}]);