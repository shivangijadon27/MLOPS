"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[2479],{777:function(e,t,n){n.d(t,{S:function(){return g}});var r=n(68248),s=n(76118),o=n(82716),i=n(27757),l=n(79081),a=n(73408);var c={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},u={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const d=({objectKey:e,value:t})=>{const{theme:n}=(0,i.u)(),d=(0,s.isString)(t)?t:JSON.stringify(t);return(0,a.Y)(l.T,{content:d,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,a.Y)(o.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:c,children:(0,a.FD)(i.T.Text,{css:u,children:[e&&(0,a.FD)(i.T.Text,{bold:!0,css:(0,r.AH)({marginRight:n.spacing.xs},""),children:[e,":"]}),d]})})})},g=({parsedValue:e,singleLine:t=!1})=>{const{theme:n}=(0,i.u)();return(0,s.isNil)(e)?null:Array.isArray(e)?t?(0,a.Y)(d,{value:e}):(0,a.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:e.map((e,t)=>(0,a.Y)(d,{value:e},t))}):(0,s.isObject)(e)?t?(0,a.Y)(d,{value:e}):(0,a.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:Object.entries(e).map(([e,t])=>(0,a.Y)(d,{objectKey:e,value:t},e))}):(0,a.Y)(d,{value:e})}},3448:function(e,t,n){n.d(t,{_:function(){return y}});var r=n(68248),s=n(76118),o=n(46709),i=n(27757),l=n(26059),a=n(3241),c=n(53915),u=n(33045),d=n(72125),g=n(8531),p=n(81390),m=n(73408);var f={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},h={name:"82a6rk",styles:"flex:1"};const y=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:y})=>{const{theme:v}=(0,i.u)(),S=(0,o.useRef)(null),[x,b]=(0,o.useState)(500),{selectedNode:_,setSelectedNode:A,activeTab:I,setActiveTab:T,isInComparisonView:Y,updatePaneSizeRatios:w,getPaneSizeRatios:O,topLevelNodes:N}=(0,c.nJ)(),{expandedKeys:k,setExpandedKeys:D}=(0,p.B$)({rootNodes:N,initialExpandDepth:p.vf}),j=(0,o.useCallback)(e=>{w({detailsPane:e})},[w]),{matchData:C,searchFilter:M,setSearchFilter:F,spanFilterState:E,setSpanFilterState:Z,filteredTreeNodes:R,handleNextSearchMatch:P,handlePreviousSearchMatch:H}=(0,u.u)({treeNodes:N,selectedNode:_,setSelectedNode:A,setActiveTab:T,setExpandedKeys:D,modelTraceInfo:e});(0,o.useLayoutEffect)(()=>{const e=(0,s.values)((0,p.dM)(R,p.vf)).map(e=>e.key);D(new Set(e))},[R,D]);const z=(0,o.useMemo)(()=>{const e=Math.max(...R.map(p.EA))*p.De+7*v.spacing.lg;return Math.max(275,e)},[R,v.spacing.lg]),{traceStartTime:V,traceEndTime:J}=(0,o.useMemo)(()=>{if(!N||0===N.length)return{traceStartTime:0,traceEndTime:0};return{traceStartTime:Math.min(...N.map(e=>e.start)),traceEndTime:Math.max(...N.map(e=>e.end))}},[N]);return(0,m.FD)("div",{css:f,className:t,children:[(0,m.Y)("div",{css:(0,r.AH)({padding:v.spacing.xs,borderBottom:`1px solid ${v.colors.border}`},""),children:(0,m.Y)(a.A,{searchFilter:M,setSearchFilter:F,matchData:C,handleNextSearchMatch:P,handlePreviousSearchMatch:H})}),(0,m.Y)(l.A,{ref:S,initialRatio:O().detailsPane,paneWidth:x,setPaneWidth:b,onRatioChange:j,leftChild:(0,m.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:z},""),children:(0,m.Y)(g.a,{rootNodes:R,selectedNode:_,traceStartTime:V,traceEndTime:J,setSelectedNode:e=>{A(e),(0,s.isString)(null===e||void 0===e?void 0:e.key)&&(null===y||void 0===y||y(null===e||void 0===e?void 0:e.key))},css:h,expandedKeys:k,setExpandedKeys:D,spanFilterState:E,setSpanFilterState:Z})}),leftMinWidth:z,rightChild:(0,m.Y)(d.aW,{activeSpan:_,searchFilter:M,activeMatch:C.match,activeTab:I,setActiveTab:T}),rightMinWidth:d.gr})]})}},4564:function(e,t,n){n.d(t,{V:function(){return l}});var r=n(68248),s=n(27757),o=n(79081),i=n(73408);const l=({source:e})=>{const{theme:t}=(0,s.u)();return(0,i.Y)(o.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,i.Y)("span",{css:(0,r.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,i.Y)(s.T.Text,{children:(0,i.Y)("span",{css:(0,r.AH)({color:t.colors.blue500},""),children:e.source_id})})})})}},15929:function(e,t,n){n.d(t,{F:function(){return c}});var r=n(68248),s=n(82716),o=n(27757),i=n(73408);var l={name:"15currb",styles:"display:flex;height:100%"},a={name:"82a6rk",styles:"flex:1"};const c=({label:e})=>{const{theme:t}=(0,o.u)();return(0,i.FD)("div",{css:l,children:[(0,i.FD)("div",{css:a,children:[(0,i.Y)("div",{css:(0,r.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,i.Y)(s.TitleSkeleton,{label:e})}),(0,i.FD)("div",{css:(0,r.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,i.Y)("div",{css:(0,r.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,i.Y)(s.TableSkeleton,{lines:5})}),(0,i.Y)("div",{css:(0,r.AH)({flex:2,padding:t.spacing.sm},""),children:(0,i.Y)(s.TableSkeleton,{lines:5})})]})]}),(0,i.Y)("div",{css:(0,r.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,i.Y)(s.TableSkeleton,{lines:12})})]})}},27094:function(e,t,n){n.d(t,{k:function(){return i}});var r=n(66916),s=n(73408);var o={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:l})=>(0,s.FD)("div",{children:[(0,s.Y)(r.I,{"data-testid":"assessment-value-string-input",componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),i(null)},disabled:l,allowClear:!0}),t&&(0,s.Y)("div",{css:o,children:t})]})},27925:function(e,t,n){n.d(t,{w:function(){return s}});var r=n(46709);function s({ref:e,debounceTimeMs:t}){const n=(0,r.useRef)({width:-1,height:-1}),s=(0,r.useRef)(),[o,i]=(0,r.useState)(null),l=(0,r.useCallback)(e=>{if(0===e.length)return;const r=e[0].contentRect;if(-1===n.current.width)return n.current={width:r.width,height:r.height},void i(n.current);if(r.width!==n.current.width||r.height!==n.current.height){if(n.current.width=r.width,n.current.height=r.height,!t)return void i({...n.current});clearTimeout(s.current),s.current=setTimeout(()=>{i({...n.current})},t)}},[t]),a=(0,r.useRef)();return a.current||(a.current=new ResizeObserver(l)),(0,r.useEffect)(()=>{const t="function"===typeof e?e():e.current;if(t){const e=a.current;return e.observe(t),()=>e.unobserve(t)}}),o}},33120:function(e,t,n){n.d(t,{ff:function(){return i},we:function(){return l}});var r=n(36476),s=n(34791);const o=fetch;const i=async(e,t="GET",n,s)=>{const i={method:t,signal:s,headers:{...n?{"Content-Type":"application/json"}:{},...c(document.cookie)}};n&&(i.body=function(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}(n));const l=await o(e,i);if(!l.ok){const e=(0,r.a$)(l);if(e){try{const t=(await l.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return l.json()},l=e=>e;const a=e=>{const t="mlflow-request-header-",n=function(e=document.cookie){return e.split(";").reduce((e,t)=>{const[n,r]=t.trim().split("=");return e[n]=decodeURIComponent(r||""),e},{})}(e);return n&&0!==Object.keys(n).length?Object.keys(n).filter(e=>e.startsWith(t)).reduce((e,t)=>({...e,[t.substring(22)]:n[t]}),{}):{}},c=e=>{const t=a(e),n=(0,s.y5)();return{...t,...n?{"X-MLFLOW-WORKSPACE":n}:{}}}},43695:function(e,t,n){n.d(t,{l:function(){return r}});const r=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:6}).format(e)},44666:function(e,t,n){n.d(t,{w:function(){return r}});const r=()=>"User"},45218:function(e,t,n){n.d(t,{F:function(){return h},n:function(){return y}});var r=n(68248),s=n(46709),o=n(82716),i=n(27757),l=n(42747),a=n(22558),c=n(47784),u=n(83219),d=n(86125),g=n(53915),p=n(68058),m=n(85060),f=n(73408);const h=400,y=({rootNode:e,intermediateNodes:t,hideRenderModeSelector:n=!1})=>{const{theme:y}=(0,i.u)(),[v,S]=(0,s.useState)("default"),{readOnly:x}=(0,g.nJ)(),b=e.inputs,_=e.outputs,A=e.chatMessageFormat,I=(0,d.bn)(e),T=t.length>0,Y=I.length>0,w=(0,d.g_)(b).filter(({value:e})=>"null"!==e),O=(0,d.g_)(_).filter(({value:e})=>"null"!==e);return(0,f.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:y.spacing.md,paddingTop:y.spacing.sm,overflow:"auto",minWidth:h},""),children:[!n&&(0,f.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:y.spacing.sm},""),children:(0,f.FD)("div",{css:(0,r.AH)({display:"flex",gap:y.spacing.sm},""),children:[(0,f.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:v,size:"small",onChange:e=>S(e.target.value),children:[(0,f.Y)(o.SegmentedControlButton,{value:"default",children:(0,f.Y)(l.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,f.Y)(o.SegmentedControlButton,{value:"json",children:(0,f.Y)(l.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),!x&&(0,f.FD)(f.FK,{children:[(0,f.Y)(p.x,{}),(0,f.Y)(m.N,{})]})]})}),Y&&(0,f.Y)(u.c,{node:e}),(0,f.Y)(c.l,{title:(0,f.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,r.AH)({marginBottom:T?0:y.spacing.md},""),sectionKey:"summary-inputs",data:w,renderMode:v,chatMessageFormat:A}),T&&t.map(e=>(0,f.Y)(a.$,{node:e,renderMode:v},e.key)),(0,f.Y)(c.l,{title:(0,f.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",data:O,renderMode:v,chatMessageFormat:null!==A&&void 0!==A?A:"openai"})]})}},46026:function(e,t,n){n.d(t,{oi:function(){return ue},KF:function(){return u},pL:function(){return d},nW:function(){return h},u6:function(){return y},Yv:function(){return b},f1:function(){return _},iU:function(){return U},Pn:function(){return G},DE:function(){return O},Sy:function(){return N},HD:function(){return z},oI:function(){return J},Hy:function(){return B},W3:function(){return $},Kn:function(){return j},v_:function(){return C},xW:function(){return M.xW},m$:function(){return M.m$},a8:function(){return M.a8},bS:function(){return M.bS},AG:function(){return M.AG},n_:function(){return M.n_},pN:function(){return pe},Ii:function(){return Se},TY:function(){return xe},fJ:function(){return se},QA:function(){return oe},o0:function(){return Oe},LO:function(){return Ne},Nw:function(){return De}});var r=n(76118),s=n(86125);const o=e=>{if((0,r.isNil)(e)||!(0,r.isObject)(e)||!(0,r.has)(e,"type"))return!1;if("text"===e.type&&(0,r.has)(e,"text")&&(0,r.isString)(e.text))return!0;if("image"===e.type&&(0,r.has)(e,"source")&&(0,r.has)(e.source,"type")){if("base64"===e.source.type&&(0,r.has)(e.source,"media_type")&&(0,r.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,r.has)(e.source,"data")&&(0,r.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,r.has)(e.source,"url")&&(0,r.isString)(e.source.url))return!0}return!1},i=e=>{if((0,r.isNil)(e))return!1;if((0,r.has)(e,"type")){if("text"===e.type&&(0,r.has)(e,"text")&&(0,r.isString)(e.text))return!0;if("image"===e.type&&(0,r.has)(e,"source")&&(0,r.has)(e.source,"type")){if("base64"===e.source.type&&(0,r.has)(e.source,"media_type")&&(0,r.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,r.has)(e.source,"data")&&(0,r.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,r.has)(e.source,"url")&&(0,r.isString)(e.source.url))return!0}if("tool_use"===e.type&&(0,r.has)(e,"id")&&(0,r.has)(e,"name")&&(0,r.has)(e,"input"))return(0,r.isString)(e.id)&&(0,r.isString)(e.name)&&(0,r.isObject)(e.input);if("tool_result"===e.type&&(0,r.has)(e,"tool_use_id")&&(0,r.has)(e,"content")){const t=(0,r.isString)(e.content)||(0,r.isArray)(e.content)&&e.content.every(o);return(0,r.isString)(e.tool_use_id)&&t}if("thinking"===e.type&&(0,r.has)(e,"thinking")&&(0,r.isString)(e.thinking))return!0}return!1},l=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.has)(e,"role")&&(0,r.isString)(e.role)&&["user","assistant"].includes(e.role),n="content"in e&&((0,r.isString)(e.content)||(0,r.isArray)(e.content)&&e.content.every(i));return t&&n},a=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":switch(e.source.type){case"base64":return{type:"image_url",image_url:{url:`data:${e.source.media_type};base64,${e.source.data}`}};case"url":return{type:"image_url",image_url:{url:e.source.url}}}}throw new Error(`Unsupported content block type: ${e.type}`)},c=e=>{const t=[];if("string"===typeof e.content){const n=(0,s.ZI)({type:"message",content:e.content,role:e.role});n&&t.push(n)}else{const{messages:n,textParts:o,toolCalls:i,thinking:l}=(e=>{const t=[],n=[],o=[],i=[];for(const l of e)if("text"===l.type||"image"===l.type)n.push(a(l));else if("tool_use"===l.type)o.push({id:l.id,function:{name:l.name,arguments:JSON.stringify(l.input)}});else if("tool_result"===l.type){const e=(0,r.isString)(l.content)?l.content:l.content.map(e=>a(e)),n=(0,s.ZI)({type:"message",role:"tool",tool_call_id:l.tool_use_id,content:e});n&&t.push(n)}else"thinking"===l.type&&i.push(l.thinking);return{messages:t,textParts:n,toolCalls:o,thinking:i.length>0?i.join("\n\n"):null}})(e.content);if(t.push(...n),o.length>0||i.length>0){const n=(0,s.ZI)({type:"message",content:o.length>0?o:void 0,role:e.role,...i.length>0&&{tool_calls:i}});n&&(l?t.push({...n,reasoning:l}):t.push(n))}}return t},u=e=>{if(!(0,r.isObject)(e))return null;if("messages"in e&&(0,r.isArray)(e.messages)&&e.messages.every(l)){const t=[];for(const n of e.messages)t.push(...c(n));return t}return null},d=e=>(0,r.isObject)(e)&&(0,r.has)(e,"type")&&"message"===e.type&&l(e)?c(e):null,g=e=>(0,r.isObject)(e)&&(0,r.isString)((0,r.get)(e,"id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments")),p=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.get)(e,"type");if(t){if("SystemMessage"===t)return(0,r.isString)((0,r.get)(e,"content"));if("UserMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source");if("AssistantMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source");if("FunctionMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source")}return!(!(0,r.has)(e,"source")||!["system","user","assistant","function"].includes((0,r.get)(e,"source")))&&(0,r.has)(e,"content")},m=e=>(0,r.isString)(e)?(0,s.ZI)({type:"message",content:e,role:"assistant"}):(0,r.isArray)(e)&&e.every(g)?{role:"assistant",tool_calls:e.map(e=>(0,s.CL)({id:e.id,function:{name:e.name,arguments:e.arguments}}))}:null,f=e=>{if("SystemMessage"===e.type)return(0,s.ZI)({type:"message",content:e.content,role:"system"});if("UserMessage"===e.type){if((0,r.isString)(e.content))return(0,s.ZI)({type:"message",content:e.content,role:"user"});if((0,r.isArray)(e.content)){const t=e.content.filter(e=>(0,r.isString)(e)||(0,r.isObject)(e)&&"text"===e.type).map(e=>(0,r.isString)(e)?{type:"text",text:e}:e);if(t.length>0)return(0,s.ZI)({type:"message",content:t,role:"user"})}}if("AssistantMessage"===e.type)return m(e.content);if("FunctionMessage"===e.type)return(0,s.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"});if("system"===e.source)return(0,s.ZI)({type:"message",content:e.content,role:"system"});if("user"===e.source){if((0,r.isString)(e.content))return(0,s.ZI)({type:"message",content:e.content,role:"user"});if((0,r.isArray)(e.content)){const t=e.content.filter(e=>(0,r.isString)(e)).map(e=>({type:"text",text:e}));if(t.length>0)return(0,s.ZI)({type:"message",content:t,role:"user"})}}return"assistant"===e.source?m(e.content):"function"===e.source?(0,s.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"}):null},h=e=>{if((0,r.isNil)(e))return null;if((0,r.isArray)(e)&&e.length>0&&e.every(p))return(0,r.compact)(e.map(f));if((0,r.isObject)(e)&&"messages"in e){const t=e.messages;if((0,r.isArray)(t)&&t.length>0&&t.every(p))return(0,r.compact)(t.map(f))}return null},y=e=>{if((0,r.isNil)(e))return null;if((0,r.isArray)(e)&&e.length>0&&e.every(p))return(0,r.compact)(e.map(f));if((0,r.isObject)(e)&&"content"in e){const t=(0,s.ZI)({role:"assistant",content:e.content,type:"message"});return t?[t]:null}return null},v=e=>{if(e.text)return{type:"text",text:e.text};if(e.json)return{type:"text",text:JSON.stringify(e.json)};if(e.image){const t=e.image.source.bytes,n=e.image.format;let r;if("string"===typeof t)r=t;else{r=Buffer.from(t).toString("base64")}return{type:"image_url",image_url:{url:`data:${`image/${n}`};base64,${r}`}}}return null},S=e=>{let t=e.role;const n=[],r=[];let o;for(const a of e.content)if(a.toolUse){const e=a.toolUse,t="string"===typeof e.input?e.input:JSON.stringify(e.input);r.push((0,s.CL)({id:e.toolUseId,function:{name:e.name,arguments:t}}))}else if(a.toolResult){o=a.toolResult.toolUseId,t="tool";for(const e of a.toolResult.content){const t=v(e);t&&n.push(t)}}else{const e=v(a);e&&n.push(e)}let i="";n.length>0&&(i=n.map(e=>"text"===e.type?e.text:"image_url"===e.type?`[Image: ${e.image_url.url}]`:"").filter(e=>e.length>0).join(" "));const l={role:t,content:i};return r.length>0&&(l.tool_calls=r),o&&(l.tool_call_id=o),l},x=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.has)(e,"role")&&(0,r.isString)(e.role)&&["user","assistant","system"].includes(e.role),n=(0,r.has)(e,"content")&&(0,r.isArray)(e.content);return t&&n},b=e=>{if((0,r.isNil)(e))return null;if((0,r.isObject)(e)&&"messages"in e){const t=e.messages;if((0,r.isArray)(t)&&t.length>0&&t.every(x))return(0,r.compact)(t.map(S))}return null},_=e=>{if((0,r.isNil)(e))return null;if((0,r.isObject)(e)&&"output"in e){const t=e.output;if((0,r.isObject)(t)&&"message"in t){const e=t.message;if(x(e))return[S(e)]}}return null},A=e=>(0,r.isObject)(e)&&"text"in e&&(0,r.isString)(e.text),I=e=>!0===e.thought,T=e=>(0,r.isObject)(e)&&"role"in e&&(0,r.isString)(e.role)&&["user","model"].includes(e.role)&&(0,r.has)(e,"parts")&&Array.isArray(e.parts)&&e.parts.every(A),Y=e=>(0,r.isObject)(e)&&"content"in e&&T(e.content),w=e=>{const t=[],n=[];for(const r of e)I(r)?n.push(r.text):t.push({type:"text",text:r.text});return{textParts:t,thinking:n.length>0?n.join("\n\n"):null}},O=e=>{if(!(0,r.isObject)(e))return null;if("contents"in e){if((0,r.isString)(e.contents)){const t=(0,s.ZI)({type:"message",content:e.contents,role:"user"});return t&&[t]}if((0,r.isArray)(e.contents)&&e.contents.every(T))return(0,r.compact)(e.contents.map(e=>{const t="model"===e.role?"assistant":e.role,{textParts:n,thinking:r}=w(e.parts),o=(0,s.ZI)({type:"message",content:n.length>0?n:void 0,role:t});return o&&r?{...o,reasoning:r}:o}))}return null},N=e=>(0,r.isObject)(e)&&"candidates"in e&&(0,r.isArray)(e.candidates)&&e.candidates.every(Y)?(0,r.compact)(e.candidates.flatMap(e=>e.content).map(e=>{const t="model"===e.role?"assistant":e.role,{textParts:n,thinking:r}=w(e.parts),o=(0,s.ZI)({type:"message",content:n.length>0?n:void 0,role:t});return o&&r?{...o,reasoning:r}:o})):null,k=e=>{if(!(0,r.isArray)(e))return[];const t=[];for(const n of e){const e=n.text;(0,r.isString)(e)&&t.push(e)}return t},D=e=>{if(!(0,r.isObject)(e))return null;const t=e,n=t.role;if(!(0,r.isString)(n))return null;const o=t.content,{textContent:i,reasoning:l}=(e=>{if((0,r.isString)(e))return{textContent:e,reasoning:null};if(!(0,r.isArray)(e))return{textContent:null,reasoning:null};const t=[],n=[];for(const s of e){if(!(0,r.isObject)(s))continue;const e=s.type;if("thinking"===e&&n.push(...k(s.thinking)),"text"===e){const e=s.text;(0,r.isString)(e)&&t.push(e)}}return{textContent:t.length>0?t.join("\n\n"):null,reasoning:n.length>0?n.join("\n\n"):null}})(o),a=t.tool_calls;if((0,r.isArray)(a)&&a.length>0){const e=a.filter(e=>(0,r.isObject)(e)&&"id"in e&&"function"in e);if(e.length>0)return{role:n,content:null!==i&&void 0!==i?i:void 0,tool_calls:e.map(e=>(0,s.CL)({id:e.id,function:e.function})),...l&&{reasoning:l}}}const c=t.tool_call_id;if("tool"===n&&(0,r.isString)(c))return{role:"tool",tool_call_id:c,content:null!==i&&void 0!==i?i:""};const u=(0,s.ZI)({type:"message",content:null!==i&&void 0!==i?i:"",role:n});return u&&l?{...u,reasoning:l}:u},j=e=>{if(!(0,r.isObject)(e))return null;const t=e.messages;if(!(0,r.isArray)(t)||0===t.length)return null;const n=(0,r.compact)(t.map(D));return n.length>0?n:null},C=e=>{if(!(0,r.isObject)(e))return null;const t=e.choices;if(!(0,r.isArray)(t)||0===t.length)return null;const n=(0,r.compact)(t.map(e=>{if(!(0,r.isObject)(e))return null;const t=e.message;return D(t)}));return n.length>0?n:null};var M=n(69660);const F=e=>{if(e)return"string"===typeof e?e:Array.isArray(e)?e.filter(e=>"text"===e.type&&e.text).map(e=>e.text).join("\n\n"):void 0},E=e=>{var t;let n,o,i;switch(e.type){case"user":case"human":n="user";break;case"assistant":case"ai":n="assistant";break;case"system":n="system";break;case"tool":n="tool";break;case"function":n="function";break;default:return null}if((0,r.isString)(e.content))o=e.content;else if(Array.isArray(e.content)){const t=[],n=[];for(const s of e.content){var l;if((0,r.isString)(s))n.push(s);else if("thinking"===s.type&&s.thinking){const e=F(s.thinking);e&&t.push(e)}else"text"===s.type&&s.text?n.push(s.text):"image_url"===s.type&&null!==(l=s.image_url)&&void 0!==l&&l.url&&n.push(`![](${s.image_url.url})`)}t.length>0&&(i=t.join("\n\n")),o=n.filter(Boolean).join("\n\n")}else o=void 0;const a={content:o,role:n,...i&&{reasoning:i}},c=e.tool_calls,u=null===(t=e.additional_kwargs)||void 0===t?void 0:t.tool_calls;return!(0,r.isNil)(c)&&Array.isArray(c)&&c.length>0&&c.every(P)?a.tool_calls=(0,r.compact)(c.map(Z)):!(0,r.isNil)(u)&&Array.isArray(u)&&u.length>0&&u.every(s.h8)&&(a.tool_calls=u.map(s.CL)),(0,r.isNil)(e.tool_call_id)||(a.tool_call_id=e.tool_call_id),a},Z=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),R=e=>!!e&&(!!((0,r.isNil)(e.content)||(0,r.isString)(e.content)||Array.isArray(e.content))&&["human","user","assistant","ai","system","tool","function"].includes(e.type)),P=e=>e&&(0,r.isString)(e.name)&&(0,r.has)(e,"args")&&(0,r.isString)(e.id),H=e=>e&&R(e.message),z=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(R)){const t=e[0].map(E);return t.some(e=>null===e)?null:t}if(Array.isArray(null===e||void 0===e?void 0:e.messages)&&e.messages.length>0&&e.messages.every(R)){const t=e.messages.map(E);return t.some(e=>null===e)?null:t}if(Array.isArray(e)&&e.length>0&&e.every(R)){const t=e.map(E);return t.some(e=>null===e)?null:t}return null},V=e=>{const t=e.map(e=>E(e.message));return t.some(e=>null===e)?null:t},J=e=>(e=>!(!Array.isArray(e)||e.length<1)&&!(!Array.isArray(e[0])||e[0].length<1)&&e[0].every(H))(e)?V(e[0]):Array.isArray(null===e||void 0===e?void 0:e.generations)&&e.generations.length>0&&e.generations[0].every(H)?V(e.generations[0]):null,L=e=>{const t=(0,r.get)(e,"text");return"text"===(0,r.get)(e,"block_type")&&(0,r.isString)(t)},W=e=>{const t=(0,r.get)(e,"blocks"),n=(0,r.get)(e,"role");return(0,r.isString)(n)&&["assistant","system","user"].includes(n)&&(0,r.isArray)(t)&&t.every(L)},K=e=>(0,s.ZI)({role:e.role,content:e.blocks.map(e=>({type:"text",text:e.text}))}),$=e=>{if(!(e=>W((0,r.get)(e,"message")))(e))return null;const t=K(e.message);return t&&[t]},B=e=>(e=>{const t=(0,r.get)(e,"messages");return(0,r.isArray)(t)&&t.every(W)})(e)?(0,r.compact)(e.messages.map(K)):null,U=e=>{if((0,r.has)(e,"messages")&&(0,r.isArray)(e.messages)){return e.messages.map(e=>(0,s.ZI)({type:"message",content:(0,r.isString)(e.content)?q(e.content):e.content,role:e.role})).filter(Boolean)}return null},G=e=>{if((0,r.isArray)(e)&&e.length>0&&e.every(r.isString)){const t=q(e.join("\n")),n=(0,s.ZI)({type:"message",content:t,role:"assistant"});return n&&[n]}return null},q=e=>e.replace(/\r\n/g,"\n").replace(/(^|[^\n])\n(?!\n)/g,(e,t)=>`${t}  \n`),Q=e=>{if(!(0,r.isObject)(e)||!(0,r.has)(e,"type"))return!1;const t=e;return!("text"!==t.type||!(0,r.has)(e,"text")||!(0,r.isString)(t.text))||("image"===t.type&&(0,r.has)(e,"image")?(0,r.isString)(t.image):!!X(e)||!("tool-result"!==t.type||!(0,r.has)(e,"output")))},X=e=>!!(0,r.isObject)(e)&&((0,r.has)(e,"toolCallId")&&(0,r.has)(e,"toolName")&&(0,r.has)(e,"input")),ee=e=>{if(!(0,r.isObject)(e))return!1;const t=e;if(!((0,r.has)(e,"role")&&(0,r.isString)(t.role)&&["user","assistant","system","tool","function"].includes(t.role)))return!1;return(0,r.has)(e,"content")&&((0,r.isString)(t.content)||(0,r.isArray)(t.content)&&t.content.every(Q))},te=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image}};case"tool-call":return{type:"text",text:""};case"tool-result":return{type:"text",text:JSON.stringify(e.output)}}},ne=e=>{if("string"===typeof e.content)return(0,s.ZI)({type:"message",content:e.content,role:e.role,...e.name&&{name:e.name}});{var t;const n=e.content.map(te),r=e.content.filter(e=>"tool-call"===e.type).map(re),o=null===(t=e.content.find(e=>"tool-result"===e.type))||void 0===t?void 0:t.toolCallId;return(0,s.ZI)({content:n,role:e.role,...e.name&&{name:e.name},...o&&{tool_call_id:o},...r&&r.length>0&&{tool_calls:r}})}},re=e=>({id:e.toolCallId,function:{name:e.toolName,arguments:JSON.stringify(e.input)}}),se=e=>{if(!(0,r.isObject)(e))return null;const t=e;return(0,r.has)(e,"messages")&&(0,r.isArray)(t.messages)&&t.messages.every(ee)?(0,r.compact)(t.messages.map(ne)):null},oe=e=>{if(!(0,r.isObject)(e))return null;const t=e;return(0,r.has)(e,"text")&&(0,r.isString)(t.text)?(0,r.compact)([(0,s.ZI)({type:"message",content:t.text,role:"assistant"})]):(0,r.has)(e,"toolCalls")&&(0,r.isArray)(t.toolCalls)&&t.toolCalls.every(X)?(0,r.compact)([(0,s.ZI)({type:"message",content:"",role:"assistant",tool_calls:(0,r.compact)(t.toolCalls.map(re))})]):null},ie=e=>(0,r.isObject)(e)&&"text"===(0,r.get)(e,"type")&&(0,r.isString)((0,r.get)(e,"content")),le=e=>{if(!(0,r.isObject)(e)||"tool_call"!==(0,r.get)(e,"type"))return!1;if(!(0,r.isString)((0,r.get)(e,"name")))return!1;const t=(0,r.get)(e,"id");return(0,r.isNil)(t)||(0,r.isString)(t)},ae=e=>{if(!(0,r.isObject)(e)||"tool_call_response"!==(0,r.get)(e,"type"))return!1;const t=(0,r.get)(e,"id");return!(!(0,r.isNil)(t)&&!(0,r.isString)(t))&&(0,r.has)(e,"response")},ce=e=>ie(e)||le(e)||ae(e),ue=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.get)(e,"role");return!(!(0,r.isString)(t)||!["system","user","assistant","tool"].includes(t))&&(!(!(0,r.has)(e,"parts")||!(0,r.isArray)(e.parts)||0===e.parts.length)&&e.parts.every(ce))},de=e=>{var t,n;const s=(0,r.get)(e,"arguments");let o="";try{o=JSON.stringify(null!==s&&void 0!==s?s:{})}catch{o=String(s)}return{id:String(null!==(t=null!==(n=(0,r.get)(e,"id"))&&void 0!==n?n:(0,r.get)(e,"name"))&&void 0!==t?t:""),function:{name:String((0,r.get)(e,"name")),arguments:o}}},ge=e=>{var t;const n=String(null!==(t=(0,r.get)(e,"id"))&&void 0!==t?t:""),s=(0,r.get)(e,"response");return{role:"tool",tool_call_id:n,content:(0,r.isString)(s)?s:(()=>{try{return JSON.stringify(s)}catch{return String(s)}})()}},pe=e=>{if(!ue(e))return null;const t=e.role,n=[],r=[];let o=null;for(const s of e.parts)ie(s)?n.push({type:"text",text:s.content}):le(s)?r.push(de(s)):ae(s)&&(o=ge(s));return o&&0===n.length&&0===r.length?o:(0,s.ZI)({type:"message",role:t,...e.name&&{name:e.name},...n.length>0&&{content:n},...r.length>0&&{tool_calls:r}})},me=e=>(0,r.isObject)(e)&&(0,r.has)(e,"kind")&&"request"===e.kind&&(0,r.has)(e,"parts")&&(0,r.isArray)(e.parts),fe=e=>(0,r.isObject)(e)&&(0,r.has)(e,"kind")&&"response"===e.kind&&(0,r.has)(e,"parts")&&(0,r.isArray)(e.parts),he=e=>{return{id:e.tool_call_id,function:{name:e.tool_name,arguments:(t=e.args,(0,r.isNil)(t)?"{}":(0,r.isString)(t)?t:JSON.stringify(t,null,2))}};var t},ye=e=>{const t=[];for(const n of e.parts)switch(n.part_kind){case"system-prompt":{const e=(0,s.ZI)({role:"system",content:n.content});e&&t.push(e);break}case"user-prompt":{const e=(0,s.ZI)({role:"user",content:n.content});e&&t.push(e);break}case"tool-return":case"builtin-tool-return":{const e=(0,r.isString)(n.content)?n.content:JSON.stringify(n.content,null,2),o=(0,s.ZI)({role:"tool",content:e,tool_call_id:n.tool_call_id});o&&t.push(o);break}}return t},ve=e=>{const t=[],n=[],r=[],o=[];for(const s of e.parts)switch(s.part_kind){case"text":n.push(s.content);break;case"thinking":r.push(s.content);break;case"tool-call":case"builtin-tool-call":o.push(he(s));break;case"file":n.push("[file]")}const i=n.length>0?n.join("\n\n"):void 0,l=r.length>0?r.join("\n\n"):void 0,a=(0,s.ZI)({role:"assistant",content:i,...o.length>0&&{tool_calls:o}});return a&&t.push(l?{...a,reasoning:l}:a),t},Se=e=>{if(!e)return null;if((0,r.isObject)(e)&&(0,r.has)(e,"message_history")){const t=e.message_history;if((0,r.isArray)(t)&&t.length>0){const e=[];for(const n of t)me(n)?e.push(...ye(n)):fe(n)&&e.push(...ve(n));return e.length>0?e:null}}if((0,r.isArray)(e)&&e.length>0){const t=[];for(const n of e)me(n)?t.push(...ye(n)):fe(n)&&t.push(...ve(n));return t.length>0?t:null}return me(e)?ye(e):null},xe=e=>{if(!e)return null;if((0,r.isObject)(e)&&(0,r.has)(e,"_new_messages_serialized")){const t=e._new_messages_serialized;if((0,r.isArray)(t)&&t.length>0){const e=[];for(const n of t)me(n)?e.push(...ye(n)):fe(n)&&e.push(...ve(n));return e.length>0?e:null}}if((0,r.isArray)(e)&&e.length>0){const t=[];for(const n of e)me(n)?t.push(...ye(n)):fe(n)&&t.push(...ve(n));return t.length>0?t:null}return fe(e)?ve(e):null},be=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return"text"===t.type&&(0,r.isString)(t.text)},_e=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return"tool-call"===t.type&&(0,r.isString)(t.toolCallId)&&(0,r.isString)(t.toolName)},Ae=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return"tool-result"===t.type&&(0,r.isString)(t.toolCallId)&&(0,r.isString)(t.toolName)},Ie=e=>be(e)||_e(e)||Ae(e),Te=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return!!((0,r.has)(e,"role")&&(0,r.isString)(t.role)&&["system","user","assistant","tool"].includes(t.role))&&(!!(0,r.isString)(t.content)||!!(0,r.isArray)(t.content)&&t.content.every(Ie))},Ye=e=>{const t=[];for(const n of e)be(n)&&t.push(n.text);return t.join("\n\n")},we=e=>{if((0,r.isString)(e.content))return(0,s.ZI)({role:e.role,content:e.content});const t=e.content;if("tool"===e.role){const e=(e=>{for(const t of e)if(Ae(t)){const e=t.output;return"json"===(null===e||void 0===e?void 0:e.type)&&null!==e&&void 0!==e&&e.value?JSON.stringify(e.value,null,2):JSON.stringify(e,null,2)}})(t),n=(e=>{for(const t of e)if(Ae(t))return t.toolCallId})(t);return(0,s.ZI)({role:"tool",content:e,...n&&{tool_call_id:n}})}if("assistant"===e.role){const e=Ye(t),n=(e=>{const t=[];for(const n of e)_e(n)&&t.push({id:n.toolCallId,function:{name:n.toolName,arguments:JSON.stringify(n.input,null,2)}});return t})(t);return(0,s.ZI)({role:"assistant",content:e||void 0,...n.length>0&&{tool_calls:n}})}const n=Ye(t);return(0,s.ZI)({role:e.role,content:n})},Oe=e=>{let t=null;if((0,r.isString)(e))try{const n=JSON.parse(e);(0,r.isArray)(n)&&(t=n)}catch{return null}else(0,r.isArray)(e)&&(t=e);return t&&0!==t.length&&t.every(Te)?(0,r.compact)(t.map(we)):null},Ne=e=>{if((0,r.isString)(e)&&e.trim().length>0){const t=(0,s.ZI)({role:"assistant",content:e});return t?[t]:null}return null},ke=e=>{var t;if(Array.isArray(e.attributes)){var n;const t=e.attributes.find(e=>"tool.call.id"===e.key);return null!==(n=null===t||void 0===t?void 0:t.value.string_value)&&void 0!==n?n:""}return null===(t=e.attributes)||void 0===t?void 0:t["tool.call.id"]},De=(e,t,n)=>{const o=[],i=Oe(e);if(!i||0===i.length)return null;o.push(...i);const l=n.filter(e=>{var t;if(Array.isArray(e.attributes)){const t=e.attributes.find(e=>"span.type"===e.key);return"tool"===(null===t||void 0===t?void 0:t.value.string_value)}return"tool"===(null===(t=e.attributes)||void 0===t?void 0:t["span.type"])});if(l.length>0){const e=l.map(e=>{const t=ke(e),n=(e=>{var t;if(Array.isArray(e.attributes)){var n;const t=e.attributes.find(e=>"tool.name"===e.key);return null!==(n=null===t||void 0===t?void 0:t.value.string_value)&&void 0!==n?n:""}return null===(t=e.attributes)||void 0===t?void 0:t["tool.name"]})(e),s=e.inputs;return{id:t,function:{name:n,arguments:(0,r.isObject)(s)?JSON.stringify(s,null,2):String(null!==s&&void 0!==s?s:"")}}}),t=(0,s.ZI)({role:"assistant",content:void 0,tool_calls:e});t&&o.push(t);for(const n of l){const e=ke(n),t=n.outputs,i=(0,r.isObject)(t)?JSON.stringify(t,null,2):String(null!==t&&void 0!==t?t:""),l=(0,s.ZI)({role:"tool",content:i,tool_call_id:e});l&&o.push(l)}}if((0,r.isString)(t)&&t.trim().length>0){const e=(0,s.ZI)({role:"assistant",content:t});e&&o.push(e)}return o.length>0?o:null}},51847:function(e,t,n){n.d(t,{P:function(){return c}});var r=n(68248),s=n(82716),o=n(27757),i=n(66916),l=n(94664),a=n(73408);const c=({type:e=l.Dy.CONNECT,isInTooltip:t=!1,hasException:n=!1,isRootSpan:c=!1})=>{const{theme:u}=(0,o.u)();let d;c?d="ai":n&&(d="danger");const g={[l.Dy.MODELS]:(0,a.Y)(s.ModelsIcon,{color:d}),[l.Dy.DOCUMENT]:(0,a.Y)(s.FileDocumentIcon,{color:d}),[l.Dy.CONNECT]:(0,a.Y)(s.ConnectIcon,{color:d}),[l.Dy.CODE]:(0,a.Y)(s.CodeIcon,{color:d}),[l.Dy.FUNCTION]:(0,a.Y)(s.FunctionIcon,{color:d}),[l.Dy.NUMBERS]:(0,a.Y)(s.NumbersIcon,{color:d}),[l.Dy.SEARCH]:(0,a.Y)(i.S,{color:d}),[l.Dy.SORT]:(0,a.Y)(s.SortUnsortedIcon,{color:d}),[l.Dy.UNKNOWN]:(0,a.Y)(s.QuestionMarkIcon,{color:d}),[l.Dy.WRENCH]:(0,a.Y)(s.WrenchIcon,{color:d}),[l.Dy.AGENT]:(0,a.Y)(s.UserSparkleIcon,{color:d}),[l.Dy.CHAIN]:(0,a.Y)(s.ChainIcon,{color:d}),[l.Dy.USER]:(0,a.Y)(s.UserIcon,{color:d}),[l.Dy.SYSTEM]:(0,a.Y)(s.GearIcon,{color:d}),[l.Dy.SAVE]:(0,a.Y)(s.SaveIcon,{color:d})};let p=u.colors.actionDefaultIconDefault,m=u.colors.actionPrimaryIcon,f=u.colors.backgroundSecondary;switch(e){case l.Dy.SEARCH:p=u.colors.textValidationSuccess,m=u.colors.green500,f=u.isDarkMode?u.colors.green800:u.colors.green100;break;case l.Dy.MODELS:p=u.isDarkMode?u.colors.blue500:u.colors.turquoise,m=u.isDarkMode?u.colors.turquoise:u.colors.blue500,f=u.isDarkMode?u.colors.blue800:u.colors.blue100;break;case l.Dy.WRENCH:p=u.isDarkMode?u.colors.red500:u.colors.red700,m=u.isDarkMode?u.colors.red700:u.colors.red500,f=u.isDarkMode?u.colors.red800:u.colors.red100}return(0,a.FD)("div",{css:(0,r.AH)({position:"relative",width:u.general.iconSize,height:u.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:u.borders.borderRadiusSm,background:t?u.colors.tooltipBackgroundTooltip:f,color:t?m:p,svg:{width:u.general.iconFontSize,height:u.general.iconFontSize},flexShrink:0},""),children:[n&&(0,a.Y)("div",{css:(0,r.AH)({position:"absolute",top:-u.spacing.xs,right:-u.spacing.xs,height:u.spacing.sm,width:u.spacing.sm,borderRadius:u.borders.borderRadiusSm,backgroundColor:u.colors.actionDangerPrimaryBackgroundDefault,zIndex:5},"")}),g[e]]})}},52033:function(e,t,n){n.d(t,{B:function(){return i}});var r=n(82716),s=n(73408);var o={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:l})=>(0,s.FD)("div",{children:[(0,s.FD)(r.SegmentedControlGroup,{"data-testid":"assessment-value-boolean-input",componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:e,disabled:l,onChange:e=>{n(e.target.value),i(null)},children:[(0,s.Y)(r.SegmentedControlButton,{value:!0,children:"True"}),(0,s.Y)(r.SegmentedControlButton,{value:!1,children:"False"})]}),t&&(0,s.Y)("div",{css:o,children:t})]})},53915:function(e,t,n){n.d(t,{DK:function(){return d},nJ:function(){return u}});var r=n(76118),s=n(46709),o=n(86125),i=n(81390),l=n(73408);const a=()=>({summarySidebar:.75,detailsSidebar:.7,detailsPane:window.innerWidth<=768?.33:.25}),c=(0,s.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},isTraceInitialLoading:!1,assessmentsPaneEnabled:!0,isInComparisonView:!1,updatePaneSizeRatios:()=>{},getPaneSizeRatios:()=>a(),readOnly:!1,topLevelNodes:[]}),u=()=>(0,s.useContext)(c),d=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:n,assessmentsPaneEnabled:u,initialAssessmentsPaneCollapsed:d,isTraceInitialLoading:g=!1,isInComparisonView:p=!1,children:m,readOnly:f=!1})=>{var h,y,v;const S=(0,s.useMemo)(()=>(0,o.uM)(e),[e]),x=1===S.length?S[0]:null,b=(0,s.useMemo)(()=>x?(0,i.dM)([x]):{},[x]),_=(0,o.f7)(x,n),A=null!==(h=null!==_&&void 0!==_?_:x)&&void 0!==h?h:void 0,I=(null!==(y=null===A||void 0===A||null===(v=A.assessments)||void 0===v?void 0:v.length)&&void 0!==y?y:0)>0,T=!(0,r.isNil)(null===x||void 0===x?void 0:x.inputs)||!(0,r.isNil)(null===x||void 0===x?void 0:x.outputs),Y=(0,s.useRef)(a()),w=(0,s.useCallback)(()=>Y.current,[]),O=(0,s.useCallback)(e=>{Y.current={...Y.current,...e}},[]),[N,k]=(0,s.useState)(()=>x?null!==t&&void 0!==t?t:T?"summary":"detail":"detail"),[D,j]=(0,s.useState)(A),C=(0,o.pQ)(D),[M,F]=(0,s.useState)(C),[E,Z]=(0,s.useState)(!1),[R,P]=(0,s.useState)(!d&&I||"force-open"===d);(0,s.useEffect)(()=>{const e=(0,o.pQ)(D);F(e)},[D]),(0,s.useEffect)(()=>{x||"summary"!==N||k("detail")},[x,N]);const H=(0,s.useMemo)(()=>({rootNode:x,nodeMap:b,activeView:N,setActiveView:k,activeTab:M,setActiveTab:F,selectedNode:D,setSelectedNode:j,showTimelineTreeGantt:E,setShowTimelineTreeGantt:Z,assessmentsPaneExpanded:!f&&R,setAssessmentsPaneExpanded:P,assessmentsPaneEnabled:u,isTraceInitialLoading:g,isInComparisonView:p,updatePaneSizeRatios:O,getPaneSizeRatios:w,readOnly:f,topLevelNodes:S}),[N,b,M,x,D,E,Z,R,P,u,g,p,O,w,f,S]);return(0,l.Y)(c.Provider,{value:H,children:m})}},59542:function(e,t,n){n.d(t,{B:function(){return r}});const r=({queryClient:e})=>{e.invalidateQueries({queryKey:["searchMlflowTraces"]})}},65854:function(e,t,n){n.d(t,{w:function(){return r}});const r=300},69660:function(e,t,n){n.d(t,{AG:function(){return u},a8:function(){return o},bS:function(){return i},m$:function(){return S},n_:function(){return m},x1:function(){return x},xW:function(){return v}});var r=n(76118),s=n(86125);const o=e=>{var t,n,o;if(!e)return null;const i=null!==(t=null!==(n=e.messages)&&void 0!==n?n:e.input)&&void 0!==t?t:null===(o=e.request)||void 0===o?void 0:o.input;return Array.isArray(i)&&0!==i.length&&i.every(s.I$)?(0,r.compact)(i.map(s.ZI)):null},i=e=>(0,s.x0)(e)?e.map(e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(s.CL)}}):(0,s.in)(e)?e.choices.map(e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(s.CL)}}):null,l=e=>!!((0,r.has)(e,"role")&&(0,r.has)(e,"content")&&["user","assistant","system","developer"].includes(e.role))&&((0,r.isString)(e.content)||(0,r.isArray)(e.content)&&e.content.every(e=>(0,r.has)(e,"type")&&["input_text","input_image","input_file"].includes(e.type))),a=e=>{if(!(0,r.isObject)(e))return!1;if("message"===(0,r.get)(e,"type"))return(0,s.I$)(e);if("function_call"===(0,r.get)(e,"type"))return(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments"));if("function_call_output"===(0,r.get)(e,"type"))return(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"output"));if("image_generation_call"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"output_format");return(0,r.isString)((0,r.get)(e,"result"))&&(0,r.isString)(t)&&["png","jpeg","webp"].includes(t)}if("reasoning"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"summary");return(0,r.has)(e,"id")&&((0,r.isArray)(t)||null===t)}return!1},c=e=>{if((0,r.isString)(e.content)){const t=(0,s.ZI)({type:"message",content:e.content,role:e.role});return t&&[t]}return e.content.map(t=>((e,t)=>{const n=(0,r.get)(e,"text");if("input_text"===(0,r.get)(e,"type")&&(0,r.isString)(n))return(0,s.ZI)({type:"message",content:[{type:"text",text:n}],role:t});const o=(0,r.get)(e,"image_url");return"input_image"===(0,r.get)(e,"type")&&(0,r.isString)(o)?(0,s.ZI)({type:"message",content:[{type:"image_url",image_url:{url:o}}],role:t}):null})(t,e.role)).filter(e=>null!==e)},u=e=>{var t,n;const o=null!==(t=null!==(n=(0,r.get)(e,"input"))&&void 0!==n?n:(0,r.get)(e,"request.input"))&&void 0!==t?t:e;if((0,r.isString)(o)){const e=(0,s.ZI)({type:"message",content:o,role:"user"});return e&&[e]}return(0,r.isArray)(o)&&o.every(e=>l(e)||a(e))?(0,r.compact)(o.flatMap(e=>l(e)?c(e):p(e))):null},d=e=>e.summary&&e.summary.map(e=>e.text).join("\n\n")||null,g=e=>{const t=[];let n=null;for(const r of e)"reasoning"===r.type?n=d(r):(t.push(p(r,n)),n=null);return(0,r.compact)(t)},p=(e,t)=>{if("message"===e.type){const n=(0,s.ZI)(e);return n&&t?{...n,reasoning:t}:n}return"function_call"===e.type?{role:"assistant",tool_calls:[(0,s.CL)({id:e.call_id,function:{arguments:e.arguments,name:e.name}})],...t&&{reasoning:t}}:"function_call_output"===e.type?{role:"tool",tool_call_id:e.call_id,content:e.output}:"image_generation_call"===e.type?(0,s.ZI)({type:"message",content:[{type:"image_url",image_url:{url:`data:image/${e.output_format};base64,${e.result}`}}],role:"tool"}):(e.type,null)},m=e=>{var t;if((0,r.isNil)(e))return null;const n=null!==(t=(0,r.get)(e,"output"))&&void 0!==t?t:e;if((0,r.isArray)(n)&&n.length>0&&n.every(a)){const e=g(n);return e.length>0?e:null}if((0,r.isArray)(n)&&n.length>0&&n.every(e=>"response.output_item.done"===e.type&&a(e.item))){const e=n.map(e=>e.item),t=g(e);return t.length>0?t:null}return null},f=e=>!!(0,r.isObject)(e)&&(!!((0,r.has)(e,"role")&&(0,r.has)(e,"content")&&["user","assistant","system","tool"].includes(e.role))||("function_call"===(0,r.get)(e,"type")?(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments")):"function_call_output"===(0,r.get)(e,"type")&&((0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"output"))))),h=e=>!!(0,r.isObject)(e)&&("response.output_item.done"===(0,r.get)(e,"type")&&a((0,r.get)(e,"item"))),y=e=>{if((0,r.has)(e,"role")&&(0,r.has)(e,"content")){if((0,r.isArray)(e.content)){const t=e.content.filter(e=>"output_text"===e.type&&(0,r.isString)(e.text)).map(e=>e.text).join(" ");if(t)return(0,s.ZI)({...e,content:t})}return(0,s.ZI)(e)}if("function_call"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"call_id"),n=(0,r.get)(e,"arguments"),o=(0,r.get)(e,"name");if((0,r.isString)(t)&&(0,r.isString)(n)&&(0,r.isString)(o))return{role:"assistant",tool_calls:[(0,s.CL)({id:t,function:{arguments:n,name:o}})]}}if("function_call_output"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"call_id"),n=(0,r.get)(e,"output");if((0,r.isString)(t)&&(0,r.isString)(n))return{role:"tool",tool_call_id:t,content:n}}return null},v=e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(f)?(0,r.compact)(e.map(y)):null,S=e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(f)?(0,r.compact)(e.map(y)):null,x=e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(e=>(e=>!!(0,r.isObject)(e)&&"response.output_text.delta"===(0,r.get)(e,"type")&&(0,r.isString)((0,r.get)(e,"delta")))(e)||h(e))&&e.some(e=>h(e))?(0,r.compact)(e.filter(h).map(e=>p(e.item))):null},72143:function(e,t,n){n.d(t,{f:function(){return i}});var r=n(82716),s=n(66916),o=n(73408);const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:l})=>(0,o.FD)("div",{children:[(0,o.Y)(s.I.TextArea,{"data-testid":"assessment-value-json-input",componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(e),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),i(null)},validationState:t?"error":void 0,disabled:l}),t&&(0,o.Y)(r.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:t,type:"error"})]})},73880:function(e,t,n){n.d(t,{t:function(){return c}});var r=n(68248),s=n(82716),o=n(27757),i=n(79081),l=n(73408);const a=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},c=({itemKey:e,itemValue:t,charLimit:n=18,maxWidth:c=150,className:u})=>{const{shouldTruncateKey:d,shouldTruncateValue:g}=function(e,t,n){const r=e.length+t.length,s=e.length>t.length,o=s?t.length:e.length;return r<=n?{shouldTruncateKey:!1,shouldTruncateValue:!1}:o>n/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:s,shouldTruncateValue:!s}}(e,t,n);return(0,l.Y)(i.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,l.Y)(s.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:u,children:(0,l.FD)("span",{css:(0,r.AH)({maxWidth:c,display:"inline-flex"},""),children:[(0,l.Y)(o.T.Text,{bold:!0,css:a(d),size:"sm",children:e}),":\xa0",(0,l.Y)(o.T.Text,{css:a(g),size:"sm",children:t})]})})})}},76127:function(e,t,n){n.d(t,{X:function(){return i}});var r=n(68248),s=n(27757),o=n(73408);function i({count:e}){const{theme:t}=(0,s.u)();return(0,o.Y)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,o.Y)("span",{css:(0,r.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}},85418:function(e,t,n){n.d(t,{Q:function(){return p}});var r=n(68248),s=n(46709),o=n(82716),i=n(27757),l=n(42747),a=n(43695),c=n(73408);var u={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},d={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const g=({cost:e})=>{const{theme:t}=(0,i.u)(),n=(0,s.useMemo)(()=>(0,a.l)(e.total_cost),[e.total_cost]),g=(0,s.useMemo)(()=>(0,a.l)(e.input_cost),[e.input_cost]),p=(0,s.useMemo)(()=>(0,a.l)(e.output_cost),[e.output_cost]);return(0,c.Y)(o.HoverCard,{trigger:(0,c.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:t.spacing.sm},""),children:[(0,c.Y)(i.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(l.sA,{id:"sSc3Jm",defaultMessage:"Cost"})}),(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.span-cost-badge",color:"lime",children:(0,c.Y)("span",{children:n})})]}),content:(0,c.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:t.spacing.md,padding:t.spacing.sm,maxWidth:400},""),children:[(0,c.Y)(i.T.Title,{level:3,withoutMargins:!0,children:(0,c.Y)(l.sA,{id:"P31kXd",defaultMessage:"Cost breakdown"})}),(0,c.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.FD)("div",{css:u,children:[(0,c.Y)(i.T.Text,{size:"md",children:(0,c.Y)(l.sA,{id:"5Sk9A1",defaultMessage:"Input cost"})}),(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.span-cost-hovercard.input-cost.tag",children:(0,c.Y)("span",{children:g})})]}),(0,c.FD)("div",{css:d,children:[(0,c.Y)(i.T.Text,{size:"md",children:(0,c.Y)(l.sA,{id:"+d9nXK",defaultMessage:"Output cost"})}),(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.span-cost-hovercard.output-cost.tag",children:(0,c.Y)("span",{children:p})})]}),(0,c.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:t.spacing.sm,borderTop:`1px solid ${t.colors.borderDecorative}`},""),children:[(0,c.Y)(i.T.Text,{size:"md",bold:!0,children:(0,c.Y)(l.sA,{id:"o2qOGQ",defaultMessage:"Total"})}),(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.span-cost-hovercard.total-cost.tag",children:(0,c.Y)("span",{children:n})})]})]})]}),side:"bottom",align:"start"})},p=({activeSpan:e})=>{const{theme:t}=(0,i.u)(),{modelName:n,cost:s}=e;return n||s?(0,c.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:t.spacing.md,paddingLeft:t.spacing.md,paddingBottom:t.spacing.sm,flexWrap:"wrap"},""),children:[n&&(0,c.FD)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[(0,c.Y)(i.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(l.sA,{id:"RhQhT4",defaultMessage:"Model"})}),(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.span-model-badge",color:"turquoise",children:n})]}),s&&(0,c.Y)(g,{cost:s})]}):null}},89634:function(e,t,n){n.d(t,{O:function(){return i}});var r=n(66916),s=n(73408);var o={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:l})=>(0,s.FD)("div",{children:[(0,s.Y)(r.I,{"data-testid":"assessment-value-number-input",componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value?Number(e.target.value):""),i(null)},type:"number",disabled:l,allowClear:!0}),t&&(0,s.Y)("div",{css:o,children:t})]})}}]);