"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1078],{3409:function(e,n,t){t.d(n,{tz:function(){return h},h:function(){return O},iE:function(){return L},nN:function(){return A},XQ:function(){return x},lh:function(){return w},Vn:function(){return H},OM:function(){return _},t4:function(){return M},dC:function(){return E},WW:function(){return D},Id:function(){return I},R3:function(){return C},zZ:function(){return R},IT:function(){return N},T4:function(){return z},gy:function(){return F}});var i=t(68248),o=t(46709),r=t(27757),a=t(82716),s=t(40724),l=t(70431),c=t(80739);var d=t(91105),u=t(69983),p=t(60284),m=t(44105),g=t(15756),v=t(73408);const h=200,f=120,y=60;var T={name:"lugakg",styles:"font-weight:normal"};const x=({icon:e,title:n,value:t,subtitle:o})=>{const{theme:a}=(0,r.u)();return(0,v.FD)("div",{css:(0,i.AH)({marginBottom:a.spacing.lg},""),children:[(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,i.AH)({color:a.colors.textSecondary,display:"flex"},""),children:e}),(0,v.Y)(r.T.Text,{bold:!0,size:"lg",children:n})]}),void 0!==t&&(0,v.FD)(r.T.Title,{level:3,css:(0,i.AH)({margin:0,marginTop:a.spacing.sm},""),children:[t,o&&(0,v.FD)(v.FK,{children:[" ",(0,v.Y)(r.T.Text,{color:"secondary",css:T,children:o})]})]})]})},b=({children:e,height:n=280})=>{const{theme:t}=(0,r.u)();return(0,v.Y)("div",{css:(0,i.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.lg,height:n,display:"flex",alignItems:"center",justifyContent:"center"},""),children:e})};var k={name:"1u1zie3",styles:"width:120px"},S={name:"m0jwvv",styles:"width:80px"},Y={name:"82a6rk",styles:"flex:1"};const w=({height:e=280})=>{const{theme:n}=(0,r.u)();return(0,v.FD)("div",{css:(0,i.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,padding:n.spacing.lg,height:e,display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,v.Y)(a.TitleSkeleton,{css:k}),(0,v.Y)(a.TitleSkeleton,{css:S}),(0,v.Y)("div",{css:Y,children:(0,v.Y)(a.TableSkeleton,{lines:4})})]})},A=({height:e,message:n})=>(0,v.Y)(b,{height:e,children:(0,v.Y)(r.T.Text,{color:"error",children:n||(0,v.Y)(s.A,{id:"cp/h86",defaultMessage:"Failed to load chart data"})})}),L=({height:e,message:n})=>(0,v.Y)("div",{css:(0,i.AH)({height:e||"100%",display:"flex",alignItems:"center",justifyContent:"center"},""),children:(0,v.Y)(r.T.Text,{color:"secondary",children:n||(0,v.Y)(s.A,{id:"zwktEP",defaultMessage:"No data available for the selected time range"})})});function C(e,n,t){const i=p.Ay.getExperimentPageTabRoute(e,m.fM.Traces),o=new URLSearchParams,{startTimeLabel:r,startTime:a,endTime:s}=null!==n&&void 0!==n?n:{};return r&&o.set("startTimeLabel",r),a&&o.set("startTime",a),s&&o.set("endTime",s),null===t||void 0===t||t.forEach(e=>o.append("filter",e)),`${i}?${o.toString()}`}function I(e,n,t,i){return C(e,{startTimeLabel:"CUSTOM",startTime:new Date(n).toISOString(),endTime:new Date(n+1e3*t).toISOString()},i)}function M(e){return[g.w8.ASSESSMENT,g.dD.IS_NOT_NULL,"",e].join("::")}function _(e,n){return[g.w8.ASSESSMENT,g.tl.EQUALS,n,e].join("::")}function E(e){return[g.Gq,g.tl.EQUALS,e].join("::")}function D(e){return[g.RC,g.tl.EQUALS,e].join("::")}function H({active:e,payload:n,label:t,formatter:a,linkConfig:l}){var c,p,m,g,h;const{theme:y}=(0,r.u)(),T=(0,d.Zp)(),{hideTooltipLinks:x,tooltipLinkUrlBuilder:b,tooltipLinkText:k}=null!==(c=(0,o.useContext)(u.J0))&&void 0!==c?c:{};if(!e||null===n||void 0===n||!n.length)return null;const S=null===(p=n[0])||void 0===p?void 0:p.payload,Y=void 0!==(null===l||void 0===l?void 0:l.onLinkClick),w=(null===l||void 0===l?void 0:l.experimentId)&&(null===l||void 0===l?void 0:l.timeIntervalSeconds)&&void 0!==(null===S||void 0===S?void 0:S.timestampMs),A=!x&&l&&(Y||w);return(0,v.FD)("div",{css:(0,i.AH)({backgroundColor:`${y.colors.backgroundPrimary}80`,backdropFilter:"blur(2px)",border:`1px solid ${y.colors.border}`,borderRadius:y.borders.borderRadiusMd,fontSize:y.typography.fontSizeSm,padding:y.spacing.sm,pointerEvents:"auto",marginLeft:-20,marginRight:-20},""),children:[t&&(0,v.Y)("div",{css:(0,i.AH)({fontWeight:500,marginBottom:y.spacing.xs},""),children:t}),(0,v.Y)("div",{css:(0,i.AH)({maxHeight:f,overflowY:"auto",overflowX:"hidden"},""),children:n.map((e,n)=>{const[t,o]=a(e.value,e.name);return(0,v.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:y.spacing.xs,paddingTop:y.spacing.xs,paddingBottom:y.spacing.xs},""),children:[(0,v.Y)("span",{css:(0,i.AH)({width:y.spacing.sm,height:y.spacing.sm,borderRadius:"50%",backgroundColor:e.color,flexShrink:0},"")}),(0,v.FD)("span",{css:(0,i.AH)({color:e.color},""),children:[o,":"]}),(0,v.Y)("span",{children:t})]},n)})}),A&&(0,v.Y)("div",{css:(0,i.AH)({borderTop:`1px solid ${y.colors.border}`,marginTop:y.spacing.xs,paddingTop:y.spacing.xs},""),children:(0,v.Y)(r.T.Link,{componentId:null!==(m=null===l||void 0===l?void 0:l.componentId)&&void 0!==m?m:"mlflow.overview.usage.traces.view_traces_link",onClick:()=>{if(Y)l.onLinkClick(t,S);else if(w){const e=b?b(l.experimentId,S.timestampMs,l.timeIntervalSeconds):I(l.experimentId,S.timestampMs,l.timeIntervalSeconds);T(e)}},css:(0,i.AH)({cursor:"pointer",display:"flex",alignItems:"center",gap:y.spacing.xs},""),children:null!==(g=null!==(h=null===l||void 0===l?void 0:l.linkText)&&void 0!==h?h:k)&&void 0!==g?g:(0,v.Y)(s.A,{id:"c+3yBY",defaultMessage:"View traces for this period"})})})]})}function R(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary,dy:e.spacing.sm},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}}function N(){const{theme:e}=(0,r.u)();return{tick:{fontSize:10,fill:e.colors.textSecondary},axisLine:!1,tickLine:!1,width:40}}function F(e){var n;const{theme:t}=(0,r.u)();return{formatter:e=>(0,v.Y)("span",{css:(0,i.AH)({color:t.colors.textPrimary,fontSize:t.typography.fontSizeSm,cursor:"pointer"},""),children:e}),wrapperStyle:{maxHeight:null!==(n=null===e||void 0===e?void 0:e.maxHeight)&&void 0!==n?n:y,overflowY:"auto",overflowX:"hidden",paddingTop:t.spacing.xs}}}const O=({children:e,componentId:n,...t})=>{const{theme:a}=(0,r.u)(),s=function(e){const n=(0,o.useRef)((0,l.A)()),t=(0,o.useRef)(0),i=(0,c.R)();return{onClick:(0,o.useCallback)(()=>{if(!e)return;const o=Date.now();o-t.current<1e4||(t.current=o,i({componentId:e,componentViewId:n.current,componentType:r.f.Card,eventType:r.d.OnClick,value:"chart_interaction"}))},[e,i])}}(n);return(0,v.Y)("div",{css:(0,i.AH)({border:`1px solid ${a.colors.border}`,borderRadius:a.borders.borderRadiusMd,padding:a.spacing.lg,backgroundColor:a.colors.backgroundPrimary},""),...s,...t,children:e})};function z(){const{theme:e}=(0,r.u)();return{strokeOpacity:.3,fill:e.colors.blue200,fillOpacity:.3}}},23327:function(e,n,t){t.d(n,{o:function(){return s}});var i=t(49708),o=t(61077),r=t(90935);const a="traceMetrics";function s({experimentIds:e,startTimeMs:n,endTimeMs:t,viewType:s,metricName:l,aggregations:c,timeIntervalSeconds:d,filters:u,dimensions:p,enabled:m=!0}){const g={experiment_ids:e,view_type:s,metric_name:l,aggregations:c,time_interval_seconds:d,start_time_ms:n,end_time_ms:t,filters:u,dimensions:p};return(0,i.I)({queryKey:[a,e,n,t,s,l,c,d,u,p],queryFn:async()=>await async function(e){return(0,o.qP)((0,o.we)("ajax-api/3.0/mlflow/traces/metrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).catch(r.J)}(g),enabled:e.length>0&&m,refetchOnWindowFocus:!1})}},30618:function(e,n,t){t.d(n,{b:function(){return l}});var i=t(90970),o=t(15714),r=t(60719),a=t(49960),s=t(44941),l=(0,i.gu)({chartName:"LineChart",GraphicalChild:o.N,axisComponents:[{axisType:"xAxis",AxisComp:r.W},{axisType:"yAxis",AxisComp:a.h}],formatAxisMap:s.pr})},81078:function(e,n,t){t.d(n,{TraceLatencyChart:function(){return k}});var i=t(68248),o=t(46709),r=t(27757),a=t(66916),s=t(40724),l=t(66774),c=t(30618),d=t(60719),u=t(49960),p=t(858),m=t(15714),g=t(97245),v=t(6581),h=t(16844),f=t(23327),y=t(83110),T=t(69983);var x=t(3409),b=t(73408);const k=()=>{const{theme:e}=(0,r.u)(),n=(0,x.zZ)(),t=(0,x.IT)(),k=(0,x.gy)(),{getOpacity:S,handleLegendMouseEnter:Y,handleLegendMouseLeave:w}=(0,y.pH)(),{experimentIds:A,timeIntervalSeconds:L}=(0,T.W0)(),{chartData:C,avgLatency:I,isLoading:M,error:_,hasData:E}=function(){var e,n,t;const{experimentIds:i,startTimeMs:r,endTimeMs:a,timeIntervalSeconds:s,timeBuckets:l,filters:c}=(0,T.W0)(),{data:d,isLoading:u,error:p}=(0,f.o)({experimentIds:i,startTimeMs:r,endTimeMs:a,viewType:h.mW.TRACES,metricName:h.po.LATENCY,aggregations:[{aggregation_type:h.DF.PERCENTILE,percentile_value:h.a9},{aggregation_type:h.DF.PERCENTILE,percentile_value:h.CX},{aggregation_type:h.DF.PERCENTILE,percentile_value:h.Jq}],timeIntervalSeconds:s,filters:c}),{data:m,isLoading:g,error:v}=(0,f.o)({experimentIds:i,startTimeMs:r,endTimeMs:a,viewType:h.mW.TRACES,metricName:h.po.LATENCY,aggregations:[{aggregation_type:h.DF.AVG}],filters:c}),x=(0,o.useMemo)(()=>(null===d||void 0===d?void 0:d.data_points)||[],[null===d||void 0===d?void 0:d.data_points]),b=u||g,k=p||v,S=null===m||void 0===m||null===(e=m.data_points)||void 0===e||null===(n=e[0])||void 0===n||null===(t=n.values)||void 0===t?void 0:t[h.DF.AVG],Y=(0,o.useCallback)(e=>{var n,t,i;return{p50:(null===(n=e.values)||void 0===n?void 0:n[(0,h.re)(h.a9)])||0,p90:(null===(t=e.values)||void 0===t?void 0:t[(0,h.re)(h.CX)])||0,p99:(null===(i=e.values)||void 0===i?void 0:i[(0,h.re)(h.Jq)])||0}},[]),w=(0,y.NM)(x,Y);return{chartData:(0,o.useMemo)(()=>l.map(e=>{const n=w.get(e);return{name:(0,y.fq)(e,s),p50:(null===n||void 0===n?void 0:n.p50)||0,p90:(null===n||void 0===n?void 0:n.p90)||0,p99:(null===n||void 0===n?void 0:n.p99)||0,timestampMs:e}}),[l,w,s]),avgLatency:S,isLoading:b,error:k,hasData:x.length>0}}(),D=(0,o.useCallback)((e,n)=>[(0,y.YL)(e),n],[]),H={p50:e.colors.blue300,p90:e.colors.blue500,p99:e.colors.yellow500};return M?(0,b.Y)(x.lh,{}):_?(0,b.Y)(x.nN,{}):(0,b.FD)(x.h,{componentId:"mlflow.charts.trace_latency",children:[(0,b.Y)(x.XQ,{icon:(0,b.Y)(a.C,{}),title:(0,b.Y)(s.A,{id:"C83vFj",defaultMessage:"Latency"}),value:void 0!==I?(0,y.YL)(I):void 0}),(0,b.Y)("div",{css:(0,i.AH)({height:x.tz,marginTop:e.spacing.sm},""),children:E?(0,b.Y)(l.u,{width:"100%",height:"100%",children:(0,b.FD)(c.b,{data:C,margin:{top:10,right:30,left:10,bottom:0},children:[(0,b.Y)(d.W,{dataKey:"name",...n}),(0,b.Y)(u.h,{...t}),(0,b.Y)(p.m,{content:(0,b.Y)(x.Vn,{formatter:D,linkConfig:{experimentId:A[0],timeIntervalSeconds:L,componentId:"mlflow.overview.usage.latency.view_traces_link"}}),cursor:{stroke:e.colors.actionTertiaryBackgroundHover}}),(0,b.Y)(m.N,{type:"monotone",dataKey:"p50",stroke:H.p50,strokeWidth:2,dot:(0,y.vx)(H.p50),name:"p50",strokeOpacity:S("p50")}),(0,b.Y)(m.N,{type:"monotone",dataKey:"p90",stroke:H.p90,strokeWidth:2,dot:(0,y.vx)(H.p90),name:"p90",strokeOpacity:S("p90")}),(0,b.Y)(m.N,{type:"monotone",dataKey:"p99",stroke:H.p99,strokeWidth:2,dot:(0,y.vx)(H.p99),name:"p99",strokeOpacity:S("p99")}),void 0!==I&&(0,b.Y)(g.e,{y:I,stroke:e.colors.textSecondary,strokeDasharray:"4 4",label:{value:`AVG (${(0,y.YL)(I)})`,position:"insideTopRight",fill:e.colors.textSecondary,fontSize:10}}),(0,b.Y)(v.s,{verticalAlign:"bottom",iconType:"plainline",onMouseEnter:Y,onMouseLeave:w,...k})]})}):(0,b.Y)(x.iE,{})})]})}},90935:function(e,n,t){t.d(n,{J:function(){return o}});var i=t(36476);async function o(e){if(e instanceof i.Un){var n;const t=await(null===(n=e.response)||void 0===n?void 0:n.json());e.message=null===t||void 0===t?void 0:t.message}throw e}}}]);