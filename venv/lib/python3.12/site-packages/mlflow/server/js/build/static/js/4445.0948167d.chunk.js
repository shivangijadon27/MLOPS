"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[4445],{21678:function(e,t,a){function n(e,t,a){if(void 0===t||null===t||"string"!==typeof t)return a;for(const n in e)if(e[n]===t)return e[n];return a}a.d(t,{wB:function(){return v},bw:function(){return y},u8:function(){return m},SK:function(){return n}});var s=a(68248),o=a(27757),r=a(82716),l=a(46709),i=a(40724);var d=function(e,t){const[a,n]=(0,l.useState)(null);return(0,l.useEffect)(()=>{if(e.current&&t){const a=()=>{if(!e.current)return;const a=e.current.offsetWidth,s=Object.keys(t).filter(e=>t[e]>=a).sort((e,a)=>t[e]-t[a])[0];n(s)};a();const s=new ResizeObserver(a);return s.observe(e.current),()=>s.disconnect()}},[e,t]),a},c=a(73408);const u={sm:316,lg:480},m=({isLoading:e,asideSections:t,children:a,isTabLayout:n=!0,sidebarSize:i="sm",verticalStackOrder:m})=>{const{theme:f}=(0,o.u)(),g=(0,l.useRef)(null),h="small"===d(g,{small:f.responsive.breakpoints.lg}),v="main-first"===m,y=u[i],_=y-16,w=h?v?{width:"100%"}:{borderBottom:`1px solid ${f.colors.border}`,width:"100%"}:v?{width:_}:{paddingBottom:f.spacing.sm,width:_};return(0,c.FD)("div",{"data-testid":"entity-overview-container",ref:g,css:(0,s.AH)({display:"flex",flexDirection:h?v?"column":"column-reverse":"row",gap:f.spacing.lg},""),children:[(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexGrow:1,flexDirection:"column",gap:f.spacing.md,width:h?"100%":`calc(100% - ${y}px)`},""),children:e?(0,c.Y)(r.GenericSkeleton,{}):a}),(0,c.Y)("div",{style:{display:"flex",...n&&{marginTop:-f.spacing.md}},children:(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:f.spacing.lg,...w},""),children:[e&&(0,c.Y)(r.GenericSkeleton,{}),!e&&(0,c.Y)(p,{secondarySections:t})]})})]})},p=({secondarySections:e})=>(0,c.Y)("div",{children:e.filter(e=>null!==e).filter(e=>null!==(null===e||void 0===e?void 0:e.content)).map(({title:e,isTitleLoading:t,content:a,id:n},s)=>(0,c.Y)(g,{title:e,isTitleLoading:t,content:a,index:s},n))}),f=({children:e})=>{const{theme:t}=(0,o.u)();return(0,c.Y)(o.T.Title,{level:4,style:{whiteSpace:"nowrap",marginRight:t.spacing.lg,marginTop:0},children:e})},g=({title:e,content:t,index:a,isTitleLoading:n=!1})=>{const{theme:l}=(0,o.u)(),d=n?(0,c.Y)(r.ParagraphSkeleton,{label:(0,c.Y)(i.A,{id:"KJqjTs",defaultMessage:"Section title loading"})}):e?(0,c.Y)(f,{children:e}):null,u={padding:`${l.spacing.md}px 0 ${l.spacing.md}px 0`};return(0,c.FD)("div",{css:(0,s.AH)({...u,...0===a?{}:{borderTop:`1px solid ${l.colors.border}`}},""),children:[d,t]})};var h={name:"10x9q33",styles:"flex:1;align-self:start;overflow:hidden"};const v=({keyValue:e,value:t,maxWidth:a})=>{const{theme:n}=(0,o.u)();return(0,c.FD)("div",{"data-testid":`key-value-${e}`,css:(0,s.AH)({display:"flex",alignItems:"center","&:has(+ div)":{marginBottom:n.spacing.xs},maxWidth:null!==a&&void 0!==a?a:450,wordBreak:"break-word",lineHeight:n.typography.lineHeightLg},""),children:[(0,c.Y)("div",{css:(0,s.AH)({color:n.colors.textSecondary,flex:.5,alignSelf:"start"},""),children:e}),(0,c.Y)("div",{css:h,children:t})]})},y=()=>(0,c.Y)(o.T.Text,{color:"secondary",children:(0,c.Y)(i.A,{id:"8EQFzg",defaultMessage:"None"})})},27042:function(e,t,a){a.d(t,{Q:function(){return b}});var n=a(68248),s=a(76118),o=a(46709),r=a(27757),l=a(79081),i=a(82716),d=a(7655),c=a(40724),u=a(884),m=a(73408);var p={name:"4zleql",styles:"display:block"};function f(e){return t=>function(e,t){const a=(0,d.A)(),{theme:c}=(0,r.u)(),u=e.props.searchValue.toLowerCase();return(0,o.useMemo)(()=>{if(!u)return e;if((0,s.sortedIndexOf)(t,u)>=0)return e;const r=/^[^,.:/=\-\s]+$/.test(u);return o.cloneElement(e,{flattenOptions:[{data:{value:u,disabled:!r,style:{color:r?c.colors.actionTertiaryTextDefault:c.colors.actionDisabledText},children:(0,m.Y)(l.T,{content:r?void 0:a.formatMessage({id:"fWEvZL",defaultMessage:", . : / - = and blank spaces are not allowed"}),componentId:"mlflow.common.components.tag-select-dropdown.add-new-tag-tooltip",side:"right",children:(0,m.FD)("span",{css:p,children:[(0,m.Y)(i.PlusIcon,{css:(0,n.AH)({marginRight:c.spacing.sm},"")}),a.formatMessage({id:"IJbauF",defaultMessage:'Add tag "{tagKey}"'},{tagKey:u})]})})},key:u,groupOption:!1},...e.props.flattenOptions]})},[t,e,u,a,c])}(t,e)}var g={name:"1d3w5wq",styles:"width:100%"};function h({allAvailableTags:e,control:t,onKeyChangeCallback:a}){const n=(0,d.A)(),[s,r]=(0,o.useState)(!1),l=(0,o.useRef)(null),{field:c,fieldState:p}=(0,u.as)({control:t,name:"key",rules:{required:{message:n.formatMessage({id:"RlBbjb",defaultMessage:"A tag key is required"}),value:!0}}});return(0,m.Y)(i.LegacySelect,{allowClear:!0,ref:l,dangerouslySetAntdProps:{showSearch:!0,dropdownRender:f(e)},css:g,placeholder:n.formatMessage({id:"8ALhnh",defaultMessage:"Type a key"}),value:c.value,defaultValue:c.value,open:s,onDropdownVisibleChange:e=>{r(e)},filterOption:(e,t)=>null===t||void 0===t?void 0:t.value.toLowerCase().includes(e.toLowerCase()),onSelect:e=>{c.onChange(e),null===a||void 0===a||a(e)},onClear:()=>{c.onChange(void 0),null===a||void 0===a||a(void 0)},validationState:p.error?"error":void 0,children:e.map(e=>(0,m.Y)(i.LegacySelect.Option,{value:e,children:e},e))})}var v=a(59281),y=a(77153);function _(e){return new Map(e.map(e=>[e.key,e]))}var w={name:"82a6rk",styles:"flex:1"},x={name:"82a6rk",styles:"flex:1"};const b=({onSuccess:e,saveTagsHandler:t,allAvailableTags:a,valueRequired:p=!1,title:f})=>{const g=(0,o.useRef)(),[b,k]=(0,o.useState)(""),{theme:I}=(0,r.u)(),[M,S]=(0,o.useState)(new Map),[C,A]=(0,o.useState)(new Map),[Y,F]=(0,o.useState)(!1),E=(0,u.mN)({defaultValues:{key:void 0,value:""}}),R=()=>F(!1),D=(0,o.useCallback)(e=>{g.current=e,S(_(e.tags||[])),A(_(e.tags||[])),E.reset(),F(!0)},[E]),H=async()=>{g.current&&(k(""),N(!0),t(g.current,Array.from(M.values()),Array.from(C.values())).then(()=>{R(),null===e||void 0===e||e(),N(!1)}).catch(e=>{var t;N(!1),k(e instanceof y.s?null===(t=e.getUserVisibleError())||void 0===t?void 0:t.message:e.message)}))},V=(0,d.A)(),L=E.watch(),[P,N]=(0,o.useState)(!1),K=(0,o.useMemo)(()=>!(0,s.isEqual)((0,s.sortBy)(Array.from(M.values()),"key"),(0,s.sortBy)(Array.from(C.values()),"key")),[M,C]),O=L.key||L.value,q=K&&O;return{EditTagsModal:(0,m.FD)(l.d,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_135",destroyOnClose:!0,visible:Y,title:null!==f&&void 0!==f?f:(0,m.Y)(c.A,{id:"TBX+Gs",defaultMessage:"Add/Edit tags"}),onCancel:R,footer:(0,m.FD)(r.x,{children:[(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_147",dangerouslyUseFocusPseudoClass:!0,onClick:R,css:(0,n.AH)({marginRight:K?0:I.spacing.sm},""),children:V.formatMessage({id:"2a/rR8",defaultMessage:"Cancel"})}),q?(0,m.Y)(T,{formValues:L,isLoading:P,onSaveTask:H}):(0,m.Y)(l.T,{content:K?void 0:V.formatMessage({id:"16onEc",defaultMessage:"Please add or remove one or more tags before saving"}),componentId:"mlflow.common.hooks.useeditkeyvaluetagsmodal.tooltip",children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_174",dangerouslyUseFocusPseudoClass:!0,disabled:!K,loading:P,type:"primary",onClick:H,children:V.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})})]}),children:[(0,m.FD)("form",{onSubmit:E.handleSubmit(()=>{if(p&&!L.value.trim())return;const e=new Map(C);e.set(L.key,L),A(e),E.reset()}),css:(0,n.AH)({display:"flex",alignItems:"flex-end",gap:I.spacing.md},""),children:[(0,m.FD)("div",{css:(0,n.AH)({minWidth:0,display:"flex",gap:I.spacing.md,flex:1},""),children:[(0,m.FD)("div",{css:w,children:[(0,m.Y)(i.FormUI.Label,{htmlFor:"key",children:V.formatMessage({id:"crTWax",defaultMessage:"Key"})}),(0,m.Y)(h,{allAvailableTags:a||[],control:E.control,onKeyChangeCallback:e=>{var t;const a=e?C.get(e):void 0;E.setValue("value",null!==(t=null===a||void 0===a?void 0:a.value)&&void 0!==t?t:"")}})]}),(0,m.FD)("div",{css:x,children:[(0,m.Y)(i.FormUI.Label,{htmlFor:"value",children:p?V.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):V.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"})}),(0,m.Y)(i.RHFControlledComponents.Input,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_223",name:"value",control:E.control,"aria-label":p?V.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):V.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"}),placeholder:V.formatMessage({id:"FFe+Ug",defaultMessage:"Type a value"})})]})]}),(0,m.Y)(l.T,{content:V.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),componentId:"mlflow.common.hooks.useeditkeyvaluetagsmodal.add-tag-tooltip",children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_248",htmlType:"submit","aria-label":V.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),children:(0,m.Y)(i.PlusIcon,{})})})]}),b&&(0,m.Y)(i.FormUI.Message,{type:"error",message:b}),(0,m.Y)("div",{css:(0,n.AH)({display:"flex",rowGap:I.spacing.xs,flexWrap:"wrap",marginTop:I.spacing.sm},""),children:Array.from(C.values()).map(e=>(0,m.Y)(v.t,{isClosable:!0,tag:e,onClose:()=>(({key:e})=>{A(t=>(t.delete(e),new Map(t)))})(e)},e.key))})]}),showEditTagsModal:D,isLoading:P}};var k={name:"1y0ex1",styles:"max-width:400px"};function T({isLoading:e,formValues:t,onSaveTask:a}){const o=(0,d.A)(),{theme:l}=(0,r.u)(),i=`${`${(0,s.truncate)(t.key,{length:20})||"_"}`}${t.value?`:${(0,s.truncate)(t.value,{length:20})}`:""}`,c=o.formatMessage({id:"wcSVYI",defaultMessage:'Are you sure you want to save and close without adding "{tag}"'},{tag:i});return(0,m.FD)(r.aw.Root,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_309",children:[(0,m.Y)(r.aw.Trigger,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_306",dangerouslyUseFocusPseudoClass:!0,loading:e,type:"primary",children:o.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})}),(0,m.FD)(r.aw.Content,{align:"end","aria-label":c,children:[(0,m.Y)(r.T.Paragraph,{css:k,children:c}),(0,m.Y)(r.aw.Close,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_316",onClick:a,children:o.formatMessage({id:"mv6CY3",defaultMessage:"Yes, save and close"})})}),(0,m.Y)(r.aw.Close,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_324",type:"primary",css:(0,n.AH)({marginLeft:l.spacing.sm},""),children:o.formatMessage({id:"geizp1",defaultMessage:"Cancel"})})}),(0,m.Y)(r.aw.Arrow,{})]})]})}},27462:function(e,t,a){a.d(t,{F:function(){return o}});var n=a(46709),s=a(40720);const o=({traceSearchLocations:e,reviewAppId:t,labelingSessionId:a,traceIdToItemIdMap:o})=>{const r=(0,s.C)();return(0,n.useMemo)(()=>({deleteTraces:async(e,t)=>r.mutateAsync({experimentId:e,traceRequestIds:t})}),[r])}},32874:function(e,t,a){a.d(t,{Z:function(){return v}});var n=a(27757),s=a(82716),o=a(46709),r=a(40724),l=a(79081),i=a(66916),d=a(42747),c=a(61077),u=a(39595),m=a(61060),p=a(34599);var f=a(73408);const g=({visible:e,experimentId:t,onCancel:a})=>{const{theme:r}=(0,n.u)(),g=(0,d.tz)(),[h,v]=(0,o.useState)(""),[y,_]=(0,o.useState)(""),{createEvaluationDatasetMutation:w,isLoading:x}=(({onSuccess:e,onError:t})=>{const a=(0,u.jE)(),{mutate:n,isLoading:s}=(0,m.n)({mutationFn:async({datasetName:e,experimentIds:t})=>{const a={name:e,experiment_ids:t};return(await(0,c.ff)((0,c.we)("ajax-api/3.0/mlflow/datasets/create"),{method:"POST",body:a})).dataset},onSuccess:()=>{a.invalidateQueries({queryKey:[p.P4]}),null===e||void 0===e||e()},onError:e=>{null===t||void 0===t||t(e)}});return{createEvaluationDatasetMutation:n,isLoading:s}})({onSuccess:()=>{a()}}),b=(0,o.useCallback)(()=>{h?w({datasetName:h,experimentIds:[t]}):_(g.formatMessage({id:"sbHChH",defaultMessage:"Dataset name is required"}))},[w,t,h,g]);return(0,f.FD)(l.d,{componentId:"mlflow.create-evaluation-dataset-modal",visible:e,onCancel:a,okText:g.formatMessage({id:"creoEe",defaultMessage:"Create"}),cancelText:g.formatMessage({id:"nEnDEu",defaultMessage:"Cancel"}),onOk:b,okButtonProps:{loading:x,disabled:!h},title:(0,f.Y)(d.sA,{id:"287Ack",defaultMessage:"Create evaluation dataset"}),zIndex:r.options.zIndexBase+20,children:[(0,f.Y)(s.FormUI.Label,{htmlFor:"dataset-name-input",children:(0,f.Y)(d.sA,{id:"xdFMIN",defaultMessage:"Dataset name"})}),(0,f.Y)(i.I,{componentId:"mlflow.create-evaluation-dataset-modal.dataset-name",id:"dataset-name-input",name:"name",type:"text",placeholder:g.formatMessage({id:"ZQpc2w",defaultMessage:"Enter dataset name"}),value:h,onChange:e=>{v(e.target.value),_("")}}),y&&(0,f.Y)(s.FormUI.Message,{type:"error",message:y})]})};var h={name:"b9l38d",styles:"width:min-content"};const v=({experimentId:e})=>{const[t,a]=(0,o.useState)(!1);return(0,f.FD)(f.FK,{children:[(0,f.Y)(n.B,{componentId:"mlflow.eval-datasets.create-dataset-button",css:h,icon:(0,f.Y)(s.DatabaseIcon,{}),onClick:()=>a(!0),children:(0,f.Y)(r.A,{id:"N7BCue",defaultMessage:"Create dataset"})}),(0,f.Y)(g,{experimentId:e,visible:t,onCancel:()=>a(!1)})]})}},33656:function(e,t,a){a.d(t,{N9:function(){return m},NW:function(){return c},OT:function(){return i},Yc:function(){return u}});var n=a(46709),s=a(22141),o=a.n(s),r=a(76251);let l=null;const i=()=>l||(l=new r.Converter,l.setFlavor("github"),l),d={allowedTags:["h1","h2","h3","h4","h5","h6","h7","h8","blockquote","p","a","ul","ol","nl","li","ins","b","i","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","pre","del","sup","sub","dl","dt","dd","kbd","q","samp","samp","var","hr","rt","rp","summary","iframe","img","caption","figure"],allowedAttributes:{a:["href","name","target"],img:["src","longdesc"],div:["itemscope","itemtype"]}},c=e=>o()(e,d),u=e=>e.replace(new RegExp("<a","g"),'<a target="_blank"'),m=()=>(0,n.useCallback)(e=>{const t=i().makeHtml(e);return c(t)},[])},34599:function(e,t,a){a.d(t,{Hb:function(){return r},P4:function(){return s},lA:function(){return o},uz:function(){return n}});const n="GET_DATASET_RECORDS",s="SEARCH_EVALUATION_DATASETS",o="FETCH_TRACES",r="CHECK_MULTITURN_DATASETS"},40720:function(e,t,a){a.d(t,{C:function(){return l}});var n=a(39595),s=a(61060),o=a(12803),r=a(15756);const l=()=>{const e=(0,n.jE)();return(0,s.n)({mutationFn:async({experimentId:e,traceRequestIds:t})=>{const a=[];for(let s=0;s<t.length;s+=100)a.push(t.slice(s,s+100));const n=a.map(t=>o.x.deleteTracesV3(e,t));return{traces_deleted:(await Promise.all(n)).reduce((e,t)=>e+t.traces_deleted,0)}},onSuccess:()=>(0,r.BL)({queryClient:e})})}},52849:function(e,t,a){a.d(t,{v:function(){return s}});var n=a(46709);const s=({isFetching:e,hasNextPage:t,fetchNextPage:a})=>(0,n.useCallback)(n=>{if(n){const{scrollHeight:s,scrollTop:o,clientHeight:r}=n;s-o-r<200&&!e&&t&&a()}},[a,e,t])},55532:function(e,t,a){a.d(t,{p:function(){return Y}});var n=a(68248),s=a(27757),o=a(79081),r=a(82716),l=a(66916),i=a(90061),d=a(43617),c=a(76256),u=a(40724),m=a(52849),p=a(72607),f=a(46709),g=a(16844),h=a(76118),v=a(15756);var y=a(61077),_=a(61060);var w=a(32874),x=a(49708),b=a(69986),k=a(34599);var T=a(60062),I=a(181);var M=a(73408);const S=[{id:"name",accessorKey:"name",header:"Name"}];var C={name:"tardml",styles:"height:500px;overflow:hidden"},A={name:"82a6rk",styles:"flex:1"};const Y=({experimentId:e,visible:t,setVisible:a,selectedTraceInfos:Y})=>{const{theme:F}=(0,s.u)(),[E,R]=(0,f.useState)(""),[D,H]=(0,f.useState)(E),V=Y.map(e=>(0,g.MF)({info:e,data:{spans:[]}})),{data:L,isLoading:P}=(({traceIds:e})=>(0,x.I)({queryKey:[k.lA,e],queryFn:async({queryKey:[,e]})=>{const t=(0,h.chunk)(e,20),a=[];for(const n of t){const e=await Promise.all(n.map(e=>(0,b.Uv)(e)));a.push(...e)}return a}}))({traceIds:V}),N=(e=>{const t=e.map(e=>{const t=e.data.spans.find(e=>!(0,g.cp)(e));if((0,h.isNil)(t))return null;const a={};if((0,g.gD)(e.info))for(const o of null!==(n=e.info.assessments)&&void 0!==n?n:[]){var n;if("expectation"in o)if("serialized_value"in o.expectation){const e=o.expectation.serialized_value.value;try{a[o.assessment_name]=JSON.parse(e)}catch(s){a[o.assessment_name]=e}}else a[o.assessment_name]=o.expectation.value}return{inputs:(0,g.UZ)(t)||(0,g.$f)(t)?(0,g.xD)((0,v.zl)(t.attributes,"mlflow.spanInputs")):t.inputs,expectations:a,source:{source_type:"TRACE",source_data:{trace_id:(0,g.MF)(e)}}}});return(0,h.compact)(t)})((0,h.compact)(L)),{data:K,isLoading:O,isFetching:q,fetchNextPage:z,hasNextPage:B}=(0,p.J)({experimentId:e,nameFilter:E}),U=O||P,W=(0,m.v)({isFetching:q,hasNextPage:null!==B&&void 0!==B&&B,fetchNextPage:z}),$=(0,c.L)("mlflow/server/js/src/experiment-tracking/pages/experiment-evaluation-datasets/components/ExportTracesToDatasetModal.tsx",{columns:S,getRowId:e=>e.dataset_id,data:null!==K&&void 0!==K?K:[],getCoreRowModel:(0,i.HT)(),enableColumnResizing:!1}),J=$.getSelectedRowModel().rows.map(e=>e.original),j=J.map(e=>e.dataset_id),{data:Z=!1,isLoading:G}=(({datasetIds:e})=>{const t=(0,T.E)({queries:e.map(e=>({queryKey:[k.Hb,e],queryFn:async()=>{const t=new URLSearchParams;t.set("dataset_id",e),t.set("max_results","1");const a=await(0,y.ff)((0,y.we)(`ajax-api/3.0/mlflow/datasets/${e}/records?${t.toString()}`),{method:"GET"}).catch(()=>null);if(!a)return!1;const n=(0,I.pt)(a.records);if(n&&n.length>0){const e=n[0].inputs;if(e&&e.goal)return!0}return!1},refetchOnWindowFocus:!1}))});return{isLoading:t.some(e=>e.isLoading),data:t.some(e=>!0===e.data)}})({datasetIds:j}),{upsertDatasetRecordsMutation:Q,isLoading:X}=(({onSuccess:e,onError:t})=>{const{mutate:a,isLoading:n}=(0,_.n)({mutationFn:async({datasetId:e,records:t})=>{const a={dataset_id:e,records:t};return await(0,y.ff)((0,y.we)(`ajax-api/3.0/mlflow/datasets/${e}/records`),{method:"POST",body:a})},onSuccess:()=>{null===e||void 0===e||e()},onError:e=>{null===t||void 0===t||t(e)}});return{upsertDatasetRecordsMutation:a,isLoading:n}})({onSuccess:()=>{a(!1)}}),ee=(0,f.useCallback)(()=>{Promise.all(J.map(e=>Q({datasetId:e.dataset_id,records:JSON.stringify(N)})))},[J,Q,N]);return(0,M.Y)(o.d,{componentId:"mlflow.export-traces-to-dataset-modal",visible:t,onCancel:()=>a(!1),okText:(0,M.Y)(u.A,{id:"a1liZ7",defaultMessage:"Export"}),okButtonProps:{disabled:P||0===J.length||Z||G,loading:X},onOk:ee,title:(0,M.Y)(u.A,{id:"ZBRK9J",defaultMessage:"Export traces to datasets"}),zIndex:F.options.zIndexBase+10,children:(0,M.FD)("div",{css:C,children:[Z&&(0,M.Y)(r.Alert,{componentId:"mlflow.export-traces-to-dataset-modal.multiturn-error",type:"error",css:(0,n.AH)({marginBottom:F.spacing.sm},""),message:(0,M.Y)(u.A,{id:"FhnIR9",defaultMessage:"Exporting to multi-turn datasets is not yet supported."}),closable:!1}),(0,M.FD)("div",{css:(0,n.AH)({display:"flex",gap:F.spacing.sm,alignItems:"center",marginBottom:F.spacing.sm},""),children:[(0,M.Y)(l.I,{allowClear:!0,placeholder:"Search by dataset name",value:D,onChange:e=>{H(e.target.value),e.target.value||R(e.target.value)},onClear:()=>{H(""),R("")},onPressEnter:()=>R(D),componentId:"mlflow.eval-datasets.search-input",css:A,prefix:(0,M.Y)(l.S,{})}),(0,M.Y)(w.Z,{experimentId:e})]}),(0,M.FD)(r.Table,{scrollable:!0,onScroll:e=>W(e.currentTarget),someRowsSelected:$.getIsSomeRowsSelected()||$.getIsAllRowsSelected(),empty:!O&&!q&&0===K.length&&(0,M.Y)(r.Empty,{description:(0,M.Y)(u.A,{id:"F4K195",defaultMessage:"No evaluation datasets found"})}),children:[(0,M.FD)(r.TableRow,{isHeader:!0,children:[(0,M.Y)(r.TableRowSelectCell,{componentId:"mlflow.export-traces-to-dataset-modal.header-checkbox",checked:$.getIsAllRowsSelected(),indeterminate:$.getIsSomeRowsSelected(),onChange:$.getToggleAllRowsSelectedHandler()}),$.getLeafHeaders().map(e=>(0,M.Y)(r.TableHeader,{componentId:"mlflow.eval-datasets.column-header",header:e,column:e.column,css:(0,n.AH)({width:e.column.columnDef.size,maxWidth:e.column.columnDef.maxSize},""),children:(0,d.Kv)(e.column.columnDef.header,e.getContext())},e.id))]}),!U&&$.getRowModel().rows.map(e=>(0,M.FD)(r.TableRow,{children:[(0,M.Y)("div",{children:(0,M.Y)(r.TableRowSelectCell,{componentId:"mlflow.export-traces-to-dataset-modal.row-checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler()})}),e.getVisibleCells().map(e=>(0,M.Y)(r.TableCell,{css:(0,n.AH)({width:e.column.columnDef.size,maxWidth:e.column.columnDef.maxSize},""),children:(0,d.Kv)(e.column.columnDef.cell,e.getContext())},e.id))]},e.id)),(U||q)&&(0,M.Y)(r.TableSkeletonRows,{table:$})]})]})})}},55840:function(e,t,a){a.d(t,{z:function(){return i}});var n=a(98022),s=a.n(n),o=a(46709),r=a(91105),l=a(11522);const i=()=>{const e=(0,r.g)(),t=(0,r.zy)(),a=(0,o.useMemo)(()=>decodeURIComponent(t.search),[t.search]),n=(0,o.useMemo)(()=>{const e=s().parse(a.substring(1));if(e.experiments){const t=e.experiments;return(null===t||void 0===t?void 0:t.toString())||""}return""},[a]);return(0,o.useMemo)(()=>{if(null!==e&&void 0!==e&&e.experimentId)return[null===e||void 0===e?void 0:e.experimentId];if(n)try{return JSON.parse(n)}catch{return l.A.logErrorAndNotifyUser(`Could not parse experiment query parameter ${n}`),""}return[]},[n,null===e||void 0===e?void 0:e.experimentId])}},59281:function(e,t,a){a.d(t,{t:function(){return h}});var n=a(68248),s=a(82716),o=a(79081),r=a(27757),l=a(46709),i=a(7655),d=a(91701),c=a(73408);const{Paragraph:u}=r.T;var m={name:"zjik7",styles:"display:flex"},p={name:"1ff36h2",styles:"flex-grow:1"};const f=l.memo(e=>{const{theme:t}=(0,r.u)();return(0,c.Y)(o.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,c.FD)("div",{css:m,children:[(0,c.Y)(u,{css:p,children:(0,c.Y)("pre",{css:(0,n.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,c.Y)("div",{css:(0,n.AH)({marginTop:t.spacing.sm},""),children:(0,c.Y)(d.i,{copyText:e.tagValue,showLabel:!1,icon:(0,c.Y)(s.CopyIcon,{}),"aria-label":"Copy"})})]})})});function g(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const h=({isClosable:e=!1,onClose:t,tag:a,enableFullViewModal:d=!1,charLimit:u=30,maxWidth:m=300,className:p})=>{const h=(0,i.A)(),[v,y]=(0,l.useState)(!1),{shouldTruncateKey:_,shouldTruncateValue:w}=function(e,t=30){const{key:a,value:n}=e,s=a.length+n.length,o=a.length>n.length,r=o?n.length:a.length;return s<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:r>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:o,shouldTruncateValue:!o}}(a,u),x=d&&(_||w),b=h.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,c.FD)("div",{children:[(0,c.Y)(s.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:a.key,className:p,children:(0,c.Y)(o.T,{content:x?b:"",componentId:"mlflow.common.components.key-value-tag.tooltip",children:(0,c.FD)("span",{css:(0,n.AH)({maxWidth:m,display:"inline-flex"},""),onClick:()=>x?y(!0):void 0,children:[(0,c.Y)(r.T.Text,{bold:!0,title:a.key,css:g(_),children:a.key}),a.value&&(0,c.FD)(r.T.Text,{title:a.value,css:g(w),children:[": ",a.value]})]})})}),(0,c.Y)("div",{children:v&&(0,c.Y)(f,{tagKey:a.key,tagValue:a.value,isKeyValueTagFullViewModalVisible:v,setIsKeyValueTagFullViewModalVisible:y})})]})}},69986:function(e,t,a){a.d(t,{RT:function(){return f},Rb:function(){return d},Uv:function(){return i},a_:function(){return g},fz:function(){return h},lc:function(){return y}});var n=a(12803),s=a(16844),o=a(71540),r=a(13433),l=a(15756);async function i(e,t){if(e){if((0,o.ZZ)(t)===o.Cf){const t=await(0,r.UA)({traceId:e});if(null!==t&&void 0!==t&&t.trace&&t.trace.data)return{info:t.trace.trace_info||{},data:t.trace.data}}return(0,s.ho)(e)?s._A.getTraceV4(e):e.startsWith("tr-")?s.TJ.getTraceV3(e):d(e)}}async function d(e){if(!e)return;const[t,a]=await Promise.all([n.x.getExperimentTraceInfo(e).then(e=>e.trace_info||{}),n.x.getExperimentTraceData(e)]);return a?{info:t,data:a}:void 0}function c(e){if("trace_id"in e&&"span_id"in e){return!e.parent_span_id}const t=e;return!t.parent_span_id&&!t.parent_id}function u(e){var t;return((null===(t=e.data)||void 0===t?void 0:t.spans)||[]).find(c)||null}function m(e){return"string"===typeof e?e:JSON.stringify(e)}function p(e,t,a){if(t in e){const a=e[t];if(void 0!==a)return m(a)}return void 0!==(0,l.zl)(e.attributes,a)?m((0,l.zl)(e.attributes,a)):null}function f(e){const t=u(e);return t?p(t,"inputs","mlflow.spanInputs"):null}function g(e){const t=u(e);return t?p(t,"outputs","mlflow.spanOutputs"):null}function h(e){const t={},a=e.info;return a.assessments&&Array.isArray(a.assessments)?(a.assessments.forEach(e=>{var a;if(!function(e){return"expectation"in e}(e))return;if(!1===e.valid)return;if("HUMAN"!==(null===(a=e.source)||void 0===a?void 0:a.source_type))return;const n=function(e){if("value"in e)return e.value;if("serialized_value"in e&&e.serialized_value)try{return JSON.parse(e.serialized_value.value)}catch{return e.serialized_value.value}return null}(e.expectation);void 0!==n&&null!==n&&(t[e.assessment_name]=n)}),t):t}function v(e){if("trace_id"in e&&"span_id"in e){var t;let a=null===(t=e.attributes)||void 0===t?void 0:t["mlflow.spanType"];if("string"===typeof a&&a.startsWith('"')&&a.endsWith('"'))try{a=JSON.parse(a)}catch{}return"RETRIEVER"===a}let a=e.span_type;if("string"===typeof a&&a.startsWith('"')&&a.endsWith('"'))try{a=JSON.parse(a)}catch{}return"RETRIEVER"===a}function y(e){const t=function(e){var t;const a=(null===(t=e.data)||void 0===t?void 0:t.spans)||[];if(0===a.length)return[];const n=a.filter(v);if(0===n.length)return[];const s=new Set;for(const r of n){const e="span_id"in r?r.span_id:r.context.span_id;e&&s.add(e)}const o=[];for(const r of n){let e,t=!0;if("trace_id"in r&&"span_id"in r)e=r.parent_span_id;else{const t=r;e=t.parent_span_id||t.parent_id}for(;e;){if(s.has(e)){t=!1;break}let n;for(const t of a)if(("span_id"in t?t.span_id:t.context.span_id)===e){n=t;break}if(!n)break;if("trace_id"in n&&"span_id"in n)e=n.parent_span_id;else{const t=n;e=t.parent_span_id||t.parent_id}}t&&o.push(r)}return o}(e);if(0===t.length)return null;const a=[];for(const o of t){let e=[],t="",r="";if("trace_id"in o&&"span_id"in o){var n;const a=o;t=a.span_id||"",r=a.name||t;let s=null===(n=a.attributes)||void 0===n?void 0:n["mlflow.spanOutputs"];if("string"===typeof s)try{s=JSON.parse(s)}catch{continue}s&&"object"===typeof s&&Array.isArray(s)&&(e=s.map(e=>{var t;return{doc_uri:e.doc_uri||e.uri||(null===(t=e.metadata)||void 0===t?void 0:t.doc_uri)||"",content:e.content||e.page_content||""}}))}else{var s;const a=o;t=(null===(s=a.context)||void 0===s?void 0:s.span_id)||"",r=a.name||t,a.outputs&&Array.isArray(a.outputs)&&(e=a.outputs.map(e=>({doc_uri:e.doc_uri||e.uri||"",content:e.content||e.page_content||""})))}e.length>0&&a.push({span_id:t,span_name:r,documents:e})}return 0===a.length?null:{retrieved_documents:a}}},72607:function(e,t,a){a.d(t,{J:function(){return l}});var n=a(96584),s=a(61077),o=a(46709),r=a(34599);const l=({experimentId:e,enabled:t=!0,nameFilter:a=""})=>{const{data:l,fetchNextPage:i,hasNextPage:d,isLoading:c,isFetching:u,refetch:m,error:p}=(0,n.q)({queryKey:[r.P4,e,a],queryFn:async({queryKey:[,e,t],pageParam:a})=>{const n={experiment_ids:[e],filter_string:t?`name ILIKE '%${t}%'`:void 0,order_by:["created_time DESC"],max_results:50,page_token:a};return await(0,s.ff)((0,s.we)("ajax-api/3.0/mlflow/datasets/search"),{method:"POST",body:n})},cacheTime:0,refetchOnWindowFocus:!1,retry:!1,enabled:t,getNextPageParam:e=>e.next_page_token});return{data:(0,o.useMemo)(()=>{var e;return null!==(e=null===l||void 0===l?void 0:l.pages.flatMap(e=>{var t;return null!==(t=e.datasets)&&void 0!==t?t:[]}))&&void 0!==e?e:[]},[l]),fetchNextPage:i,hasNextPage:d,isLoading:c,isFetching:u,refetch:m,error:p}}},82636:function(e,t,a){a.d(t,{l:function(){return s}});var n=a(15756);const s=e=>{let t=!1,a=!1,s=!1;for(const l of e){var o,r;const e=l.traceInfo;e&&((0,n.h)(e)&&(a=!0),(0,n.Mq)(e)&&(t=!0),null!==(o=l.traceInfo)&&void 0!==o&&null!==(r=o.trace_metadata)&&void 0!==r&&r["mlflow.trace.tokenUsage"]&&(s=!0))}return{responseHasContent:t,inputHasContent:a,tokensHasContent:s}}},88525:function(e,t,a){a.d(t,{$:function(){return l}});var n=a(27042),s=a(12803),o=a(46709),r=a(181);const l=({onSuccess:e,existingTagKeys:t=[]})=>{const{showEditTagsModal:a,EditTagsModal:l}=(0,n.Q)({saveTagsHandler:async(e,t,a)=>{if(!e.traceRequestId)return;const n=e.traceRequestId,o=a.filter(({key:e,value:a})=>!t.some(({key:t,value:n})=>t===e&&a===n)),r=t.filter(({key:e})=>!a.some(({key:t})=>e===t));return Promise.all([...o.map(({key:e,value:t})=>s.x.setExperimentTraceTagV3(n,e,t)),...r.map(({key:e})=>s.x.deleteExperimentTraceTagV3(n,e))])},valueRequired:!0,allAvailableTags:t.filter(e=>e&&!e.startsWith(r.nt)),onSuccess:e});return{showEditTagsModalForTrace:(0,o.useCallback)(e=>{var t;if(!e.trace_id)return;const n=Object.entries(null!==(t=e.tags)&&void 0!==t?t:{}).map(([e,t])=>({key:e,value:t})).filter(({key:e})=>e&&!e.startsWith(r.nt))||[];a({traceRequestId:e.trace_id,tags:n||[]})},[a]),EditTagsModal:l}}}}]);